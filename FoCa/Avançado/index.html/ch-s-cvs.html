<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Guia Foca GNU/Linux - CVS</title>

</head>

<body>

<a name="ch-s-cvs"></a>
<hr>

[ <a href="ch-s-pop3.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ <a href="ch-s-apache.html">12</a> ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ 17 ]
[ <a href="ch-s-samba.html">18</a> ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-s-samba.html">próximo</a> ]

<hr>

<h1>
Guia Foca GNU/Linux
<br>Capítulo 17 - CVS
</h1>

<hr>

<p>
Este capítulo explica os requerimentos, instalação, configuração, segurança e
diversos modelos de configuração de acesso para trabalho em grupo utilizados
pelo <code>CVS</code>.

<p>
Não tome-o como uma referência completa ao uso e configuração do cvs, a
pesquisa de sua info page é muito importante.

<hr>

<a name="s-s-cvs-intro"></a>
<h2>17.1 Introdução ao CVS</h2>

<p>
O CVS (<em>Concurrent Version Software</em>) permite que se organizem grupos de
trabalho para desenvolvimento de projetos colaborativos.  Um projeto pode ser
desde um programa em C, documentação em equipe, etc.  O uso do CVS é
recomendado para qualquer desenvolvimento de projeto que tenha vários
envolvidos trabalhando ao mesmo tempo.

<p>
Para cada mudança feita no programa, é pedido uma descrição dos trabalhos
realizados e o sistema registra todas as modificações realizadas ao longo do
desenvolvimento, permitindo voltar a uma versão anterior ou ver as mudanças
entre elas facilmente.

<p>
Imagine uma situação onde você está desenvolvendo um programa de computador e
após a última modificação ele para de funcionar.  Com o CVS é possível ver o
que foi modificado e voltar até a versão que estava funcionando para consertar
o problema.  No desenvolvimento de documentação e tradução o CVS também
desempenha um papel importante, pois com ele o tradutor pode ver o que foi
modificado entre a versão do documento original que ele usou para tradução e
uma versão recente, traduzindo apenas as diferenças.

<p>
Uma seção de <code>cvs</code> é feita de modo interativo através do comando
<code>cvs</code>.  Por exemplo:
<ul>
<li>
<samp>logar no sistema</samp> - cvs login
</li>
<li>
<samp>baixar um projeto</samp> - cvs checkout projeto
</li>
</ul>

<p>
Cada comando do <code>cvs</code> será explicado em detalhes no decorrer deste
capítulo.

<hr>

<a name="s-s-cvs-versao"></a>
<h3>17.1.1 Versão</h3>

<p>
A versão do <code>CVS</code> documentada no guia é a <em>1.11.1</em>.  As
explicações aqui certamente serão compatíveis com versões posteriores deste
programa.

<hr>

<a name="s-s-cvs-historia"></a>
<h3>17.1.2 História</h3>

<p>
O <code>CVS</code> é uma substituição do sistema RCS (Revision Control System)
ele possui mais recursos e foi criado sendo compatível com o RCS.

<p>
A história do CVS (extraída de sua info page) é que ele foi iniciado a partir
de um conjunto de scripts shell escritos por <em>Dick Grune</em> que foram
postados ao grupo de notícias <samp>comp.sources.unix</samp> no volume 6 de
Dezembro de 1986.  Na versão atual não estão mais presentes shell scripts
porque muitos dos conflitos de resolução de algorítmos vem deles.

<p>
Em Abril de 1989, <em>Brian Berliner</em> fez o design e programou o CVS.  Mais
tarde, Jeff Polk ajudou Brian com o design do módulo CVS.

<hr>

<a name="s-s-cvs-contribuindo"></a>
<h3>17.1.3 Contribuindo com o CVS</h3>

<p>
Através da lista de discussão <samp>info-cvs</samp>.  Para se inscrever envie
uma mensagem com o subject &quot;subscribe&quot; para
<samp>info-cvs-request@gnu.org</samp>.  Outra alternativa é através do grupo de
noticias (newsgroup) da Usenet <samp>comp.software.config-mgm</samp>.

<hr>

<a name="s-s-cvs-caracteristicas"></a>
<h3>17.1.4 Características</h3>

<p>
Abaixo uma lista de características que tornam o CVS útil no gerenciamento de
trabalhos em grupo:
<ul>
<li>
Gerenciamento de projeto em equipe
</li>
</ul>
<ul>
<li>
Log de todas as alterações realizadas
</li>
</ul>
<ul>
<li>
Lock de arquivos, permitindo que somente uma determinada pessoa modifique o
arquivo durante o desenvolvimento do projeto.
</li>
</ul>
<ul>
<li>
Histórico de todas as mudanças feitas, isto permite voltar a uma versão
anterior em caso de problemas, e ver o que houve de errado com o código.
</li>
</ul>
<ul>
<li>
Os projetos podem ser hospedados em repositórios.
</li>
</ul>
<ul>
<li>
Podem ser criados diversas equipes de trabalho para cada repositórios, e
definidos quem terá ou não acesso ao repositório individualmente.  O
desenvolvedor <samp>gleydson</samp>, por exemplo, podem ter acesso ao projeto
<samp>x_beta</samp> e não ter acesso a projeto <samp>secret_y</samp>.
</li>
</ul>
<ul>
<li>
Permissões de acesso individuais de leitura/gravação.
</li>
</ul>
<ul>
<li>
É possível criar um usuário com acesso anônimo sem dar uma conta no sistema.
</li>
</ul>
<ul>
<li>
Pode tanto utilizar o banco de dados de contas/senhas do sistema como um banco
de dados de autenticação do próprio CVS.
</li>
</ul>
<ul>
<li>
Permite utilizar diversos &quot;métodos&quot; de acesso ao servidor:
<em>local</em>, <em>pserver</em>, <em>ext</em>, etc.  Cada um destes métodos
será descrito a seguir.
</li>
</ul>
<ul>
<li>
Permite o acesso via ssh para usuários que já possuam conta na máquina
servidora.  Este método garante segurança no envio da senha criptografada (veja
<a href="ch-d-cripto.html#s-d-cripto-sniffer">Sniffer, Seção 20.2</a> para
detalhes).
</li>
</ul>
<ul>
<li>
Permite visualizar facilmente o que foi modificado entre duas versões de um
arquivo.
</li>
</ul>

<p>
<strong>OBS</strong>: O CVS possui algumas limitações e falhas, uma delas que
mais me faz falta é um suporte a protocolo pserver via ssh que resolveria o
problema de tráfego em texto plano e gerenciamento de grupos com permissões
diferenciadas.

<hr>

<a name="s-s-cvs-ficha"></a>
<h3>17.1.5 Ficha técnica</h3>

<p>
Pacote: <code>cvs</code>

<p>
Utilitários:
<ul>
<li>
<samp>cvs</samp> - Servidor/ferramenta cliente.
</li>
<li>
<samp>cvsbug</samp> - Envia um bug sobre o CVS para a equipe de suporte.
</li>
<li>
<samp>rcs2log</samp> - Converte arquivos de log do formato usado pelo
<code>RCS</code> para o <code>CVS</code>.  Utilizado na migração desta
ferramenta para o <code>CVS</code>.
</li>
<li>
<samp>cvsconfig</samp> - Usado pela <code>Debian</code> para ativar/desativar o
servidor <samp>pserver</samp>.  Pode também ser usado o <samp>dpkg-reconfigure
cvs</samp> para desativar o servidor <samp>pserver</samp> e suas
características.
</li>
<li>
<samp>cvs-makerepos</samp> - Script da <code>Debian</code> que lê a lista de
repositórios de <code>/etc/cvs-pserver.conf</code>, cria os repositórios no
local apropriado, corrige as permissões do diretório e adiciona os repositórios
no servidor <samp>pserver</samp>.
</li>
<li>
<samp>cvs-pserver</samp> - Script da <code>Debian</code> responsável por fazer
uma inicialização mais inteligente do servidor de CVS via <samp>pserver</samp>,
leitura e processamento de repositórios, etc.  Normalmente ele é chamado a
partir do arquivo <code>/etc/inetd.conf</code>.
</li>
</ul>

<hr>

<a name="s-s-cvs-hwreq"></a>
<h3>17.1.6 Requerimentos de Hardware</h3>

<p>
Para executar o <code>CVS</code> é requerido pelo menos 3 vezes mais memória
que o tamanho do maior arquivo usado pelo projeto (para realização de diffs
entre as atualizações) e uma boa quantidade de espaço em disco.

<p>
Na realidade os requerimentos sobre o CVS dependem muito da aplicação que será
desenvolvida.  É recomendável que a máquina tenha memória suficiente para
evitar o uso de swap, que degrada bastante a performance do sistema.

<hr>

<a name="s-s-cvs-logs"></a>
<h3>17.1.7 Arquivos de log criados pelo CVS</h3>

<p>
Problemas na inicialização do <code>CVS</code> são registrados no arquivo
<code>/var/log/daemon.log</code>.  Os logs de modificações feitas nos arquivos
de um projeto no CVS são armazenadas no formato <code>arquivo.extensão,v</code>
(é adicionado o &quot;,v&quot; ao final do arquivo para indicar que é um
arquivo de controle de modificações do CVS).

<hr>

<a name="s-s-cvs-install"></a>
<h3>17.1.8 Instalação</h3>

<p>
O <code>CVS</code> pode ser baixado de <code><a
href="http://www.cvshome.org/">http://www.cvshome.org/</a></code>.

<p>
Para pacotes <code>Debian</code> basta apenas executar o comando: <samp>apt-get
install cvs</samp> e seguir as telas de configuração para ter o pacote
<code>CVS</code> instalado e (opcionalmente) com o servidor sendo executado.
Você poderá a qualquer momento reconfigurar o <code>CVS</code> executando:
<samp>dpkg-reconfigure cvs</samp>.

<p>
Uma boa documentação de referência é encontrada no pacote <code>cvs-doc</code>.

<hr>

<a name="s-s-cvs-rodando"></a>
<h3>17.1.9 Iniciando o servidor/reiniciando/recarregando a configuração</h3>

<p>
A única configuração requerida é quando o <code>CVS</code> é executado via
<samp>pserver</samp>.  Para isto, é necessária a seguinte linha no arquivo
<code>/etc/inetd.conf</code>

<pre>
     cvspserver      stream  tcp     nowait.200      root    /usr/sbin/tcpd /usr/sbin/cvs-pserver
</pre>

<p>
Note que o parâmetro &quot;200&quot; indica quantas vezes o processo
<code>CVS</code> poderá ser executado por minuto no sistema.  Caso esse número
seja excedido, o serviço será desabilitado e será necessário reiniciar o
servidor <code>inetd</code> com o comando <samp>killall -HUP inetd</samp> para
reativar o servidor CVS pserver (veja <a
href="ch-rede.html#s-rede-servicos-inetd-c">/etc/inetd.conf, Seção 4.7.2.1</a>
capítulo do <code>inetd</code> para detalhes).  Ajuste este valor de forma
adequada ao seu servidor!

<p>
Veja o script <code>cvs-pserver</code> sendo executado no final da linha.  Ele
foi desenvolvido para lidar de forma mais inteligente com a configuração do
servidor CVS pserver.

<hr>

<a name="s-s-cvs-opcoescmd"></a>
<h3>17.1.10 Opções de linha de comando</h3>

<p>
As seguintes opções são aceitas pelo CVS.
<dl>
<dt>-z [num]</dt>
<dd>
Utiliza o gzip para fazer a transferência compactada dos arquivos.  O valor
especificado pode ser de 0 a 9, quanto maior o número maior o nível de
compactação e uso da CPU.
<p>
Exemplo: <samp>cvs -z 3 checkout teste</samp>
</dd>
<dt>-q</dt>
<dd>
Oculta mensagens sobre recursão de diretório durante os comandos do CVS.
</dd>
<dt>-d [repositório]</dt>
<dd>
Permite especificar o repositório através da linha de comando.
</dd>
<dt>-e [editor]</dt>
<dd>
Define qual é o editor de textos usado para registrar o texto de commits.
</dd>
<dt>-n</dt>
<dd>
Executa o cvs em modo &quot;simulação&quot; não modificando qualquer arquivo do
repositório.
</dd>
<dt>-t</dt>
<dd>
Mostra mensagens mostrando o processo de execução de comandos do CVS.  É
bastante útil para aprendizado do cvs usado junto com a opção <em>-n</em>.
</dd>
<dt>-r</dt>
<dd>
Torna os novos arquivos criados somente para leitura.  É a mesma coisa que
especificar a variável <var>CVSREAD</var>.
</dd>
<dt>-w</dt>
<dd>
Torna os novos arquivos criados leitura/gravação que é o padrão.
</dd>
<dt>-x</dt>
<dd>
Utiliza criptografia para a transferência dos arquivos quando é utilizado em
conjunto com o <code>Kerberos</code>.
</dd>
</dl>

<p>
Você pode obter detalhes sobre opções sobre um comando em especial do CVS
(<em>commit</em>, <em>checkout</em>, etc) digitando: <samp>cvs comando
--help</samp>.  Veja <a href="#s-s-cvs-p">Criando projetos para serem usados no
CVS, Seção 17.3</a> para exemplos sobre cada uma delas.

<hr>

<a name="s-s-cvs-d"></a>
<h2>17.2 Servidor de CVS - configurando métodos de acesso ao repositório</h2>

<p>
O CVS é uma aplicação cliente/servidor, possuindo diversas maneiras de fazer o
acesso seu repositório (veja <a href="#s-s-cvs-p-repos">Repositório, Seção
17.3.1</a> repositórios).  Estes métodos são os seguintes:
<ul>
<li>
local (<a href="#s-s-cvs-d-metodos-local">local, Seção 17.2.1</a>).
</li>
<li>
ext (<a href="#s-s-cvs-d-metodos-ext">ext, Seção 17.2.3</a>).
</li>
<li>
pserver (<a href="#s-s-cvs-d-metodos-pserver">pserver (password server), Seção
17.2.4</a>).
</li>
<li>
fork (<a href="#s-s-cvs-d-metodos-fork">fork, Seção 17.2.2</a>).
</li>
<li>
GSSAPI (<a href="#s-s-cvs-d-metodos-gssapi">gssapi, Seção 17.2.6</a>).
</li>
</ul>

<p>
Eles são explicados em detalhes nas sub-seções a seguir.

<hr>

<a name="s-s-cvs-d-metodos-local"></a>
<h3>17.2.1 local</h3>

<p>
Acessa o diretório do repositório diretamente no disco local.  A vantagem deste
método é que não é requerido nem nome nem senha para acesso (você precisa
apenas ter permissões para acesso aos arquivos que deseja trabalhar) e também
não é preciso nenhuma conexão de rede.

<p>
Este método é ideal para trabalhar na máquina local ou com os arquivos
administrativos do CVS existentes no diretório <code>CVSROOT</code> do
repositório.  É muito útil também para configurar outros métodos de acesso,
como o <samp>pserver</samp>.

<p>
Para criar seu repositório, veja <a href="#s-s-cvs-p-mkrepos">Criando um
repositório, Seção 17.3.2</a>.

<hr>

<a name="s-s-cvs-d-metodos-local-c"></a>
<h4>17.2.1.1 Configurando o método local</h4>

<p>
Para utilizar o método de acesso local, basta definir a variável
<var>CVSROOT</var> da seguinte forma (assumindo que o repositório esteja
instalado em <code>/var/lib/cvs</code>):

<pre>
     export CVSROOT=/var/lib/cvs
     
     ou 
     
     export CVSROOT=local:/var/lib/cvs
</pre>

<p>
Depois disso, basta utilizar os comandos normais do <code>cvs</code> sem
precisar se autenticar no sistema.  Veja os detalhes de utilização dos comandos
de CVS após o login na seção <a href="#s-s-cvs-c">Clientes de CVS, Seção
17.5</a>.

<hr>

<a name="s-s-cvs-d-metodos-fork"></a>
<h3>17.2.2 fork</h3>

<p>
Este método é semelhante ao local, mas ele &quot;simula&quot; uma conexão de
rede com o servidor.  É muito usado para fins de testes.

<hr>

<a name="s-s-cvs-d-metodos-fork-c"></a>
<h4>17.2.2.1 Configurando o método fork</h4>

<p>
Para utilizar o método de acesso <em>fork</em>, basta definir a variável
<var>CVSROOT</var> da seguinte forma (assumindo que o repositório esteja
instalado em <code>/var/lib/cvs</code>):

<pre>
     export CVSROOT=fork:/var/lib/cvs
</pre>

<p>
Depois disso, basta utilizar os comandos normais do <code>cvs</code>, sem
precisar se autenticar no sistema.  Veja os detalhes de utilização dos comandos
do CVS após o login em <a href="#s-s-cvs-c">Clientes de CVS, Seção 17.5</a>.

<hr>

<a name="s-s-cvs-d-metodos-ext"></a>
<h3>17.2.3 ext</h3>

<p>
Este método de acesso lhe permite especificar um programa externo que será
usado para fazer uma conexão remota com o servidor <code>cvs</code>.Este
programa é definido na variável <var>CVS_RSH</var> e caso não ela seja
especificada o padrão é <code>rsh</code>.

<p>
Este método requer que o usuário possua um login/senha no banco de dados de
autenticação <code>/etc/passwd</code> do servidor de destino.  Suas permissões
de acesso ao CVS (leitura/gravação) serão as mesmas definidas neste arquivo.

<p>
O uso do acesso criptografado via <code>ssh</code> é possível definindo o
programa <code>ssh</code> na variável <var>CVS_RSH</var>.  Veja os exemplos a
seguir em <a href="#s-s-cvs-d-metodos-ext-c">Configurando o método ext, Seção
17.2.3.1</a>.

<p>
Para criar seu repositório, veja <a href="#s-s-cvs-p-mkrepos">Criando um
repositório, Seção 17.3.2</a>.

<hr>

<a name="s-s-cvs-d-metodos-ext-c"></a>
<h4>17.2.3.1 Configurando o método ext</h4>

<p>
Defina a variável <var>CVSROOT</var> da seguinte forma para utilizar este
método de acesso (assumindo <code>/var/lib/cvs</code> como repositório):

<pre>
     export CVSROOT=:ext:conta@servidor.org.br:/var/lib/cvs
     cvs login
</pre>

<p>
A &quot;conta&quot; é uma conta de usuário existente no servidor remoto (por
exemplo, <samp>gleydson</samp>) seguido do nome do servidor remoto (separado
por uma &quot;@&quot;).  Por exemplo para acessar o servidor
<em>cvs.cipsga.org.br</em> usando a conta <em>michelle</em>:

<pre>
     export CVSROOT=:ext:michelle@cvs.cipsga.org.br:/var/lib/cvs
     cvs checkout
</pre>

<p>
OBS: A senha via método de acesso &quot;ext&quot; será pedida somente uma vez
quando for necessário o primeiro acesso ao servidor remoto.  Veja os detalhes
de utilização dos comandos de CVS após o login na seção <a
href="#s-s-cvs-c">Clientes de CVS, Seção 17.5</a>.  O uso mais freqüente do
<samp>ext</samp> é para conexões seguras feitas via <code>ssh</code>, feita da
seguinte forma:

<pre>
     export CVS_RSH=ssh
     export CVSROOT=:ext:michelle@cvs.cipsga.org.br:/var/lib/cvs
     cvs checkout
</pre>

<p>
O acesso de leitura/gravação do usuário, é definido de acordo com as permissões
deste usuário no sistema.  Uma maneira recomendada é definir um grupo que terá
acesso a gravação no CVS e adicionar usuários que possam fazer gravação neste
grupo.

<p>
<strong>OBS1:</strong> O acesso via <code>ssh</code> traz a vantagem de que as
senhas trafegarão de forma segura via rede, não sendo facilmente capturadas por
sniffers e outros programas de monitoração que possam estar instalados na rota
entre você e o servidor.

<p>
<strong>OBS2:</strong> É possível especificar a senha na variável
<var>CVSROOT</var> usando a sintaxe semelhante a usada no ftp:

<pre>
     export CVSROOT=:ext:michelle:senha@cvs.cipsga.org.br:/var/lib/cvs
</pre>

<p>
Entretanto isto não é recomendado, pois os processos da máquina poderão
capturar facilmente a senha (incluindo usuários normais, caso a máquina não
esteja com patches de restrições de acesso a processos configurada, que é o
padrão em quase todas as distribuições de <code>Linux</code>).

<hr>

<a name="s-s-cvs-d-metodos-pserver"></a>
<h3>17.2.4 pserver (password server)</h3>

<p>
Este é um método de acesso remoto que utiliza um banco de dados de usuários
senhas para acesso ao repositório.  A diferença em relação ao método de acesso
<em>ext</em> é que o <em>pserver</em> roda através de um servidor próprio na
porta 2401.  O acesso dos usuários (leitura/gravação) no repositório pode ser
feita tanto através do banco de dados de usuários do sistema
(<code>/etc/passwd</code>) como através de um banco de dados separado por
repositório.

<p>
A grande vantagem deste segundo método é que cada projeto poderá ter membros
com acessos diferenciados; o membro x poderá ter acesso ao projeto
<samp>sgml</samp> mas não ao projeto <samp>focalinux</samp>; ou o usuário y
poderá ter acesso de gravação (para trabalhar no projeto
<samp>focalinux</samp>) mas somente acesso de leitura ao projeto
<samp>sgml</samp>.

<p>
Este é o método de acesso preferido para a criação de usuários anônimos (uma
vez que o administrador de um servidor que hospede muitos projetos não vai
querer abrir um acesso anônimo via <samp>ext</samp> para todos os projetos).

<p>
Também existe a vantagem que novos membros do projeto e tarefas administrativas
são feitas por qualquer pessoa que possua acesso de gravação aos arquivos do
repositório.

<hr>

<a name="s-s-cvs-d-metodos-pserver-c"></a>
<h3>17.2.5 Configurando um servidor pserver</h3>

<hr>

<a name="s-s-cvs-d-metodos-pserver-c-pserver"></a>
<h4>17.2.5.1 Ativando o servidor pserver</h4>

<p>
Para ativar o pserver (caso ainda não o tenha feito).  Execute o comando
<samp>dpkg-reconfigure cvs</samp> e selecione a opção <samp>Ativar o servidor
pserver</samp>.  Uma maneira de fazer isso automaticamente é modificando o
arquivo <code>/etc/inetd.conf</code> adicionando a seguinte linha:

<pre>
     # na Debian
     cvspserver      stream  tcp     nowait.400      root    /usr/sbin/tcpd /usr/sbin/cvs-pserver
     
     # em outras Distribuições 
     cvspserver  stream  tcp  nowait  root  /usr/bin/cvs cvs -f --allow-root=/var/lib/cvs pserver
</pre>

<p>
Na <code>Debian</code>, o cvs é iniciado através do script
<code>/usr/sbin/cvs-pserver</code> que checa os binários e executa o
<code>cvs</code> para todos os repositórios especificados no arquivo
<code>/etc/cvs-pserver.conf</code>.

<p>
Caso precise adicionar mais repositórios para acesso via <em>pserver</em> ou
outro método de acesso, veja <a href="#s-s-cvs-p-mkrepos">Criando um
repositório, Seção 17.3.2</a>.

<p>
Você também poderá executar o método <samp>pserver</samp> sob um usuário que
não seja o root, para isto, modifique a entreada referênte ao usuário.grupo no
<code>inetd.conf</code> e tenha certeza que o daemon consegue fazer as
operações de suid/sgid no diretório onde o repositório se encontra.

<hr>

<a name="s-s-cvs-d-metodos-pserver-c-system"></a>
<h4>17.2.5.2 Servidor pserver usando autenticação do sistema</h4>

<p>
Para usar o banco de dados de autenticação do sistema
(<code>/etc/passwd</code>) para autenticar os usuários remotos, primeiro tenha
certeza que o servidor <em>pserver</em> está ativado (como descrito em <a
href="#s-s-cvs-d-metodos-pserver-c-pserver">Ativando o servidor pserver, Seção
17.2.5.1</a>.  Repetindo o exemplo anterior, a usuária <em>Michelle</em> deverá
ter uma conta em <code>/etc/passwd</code> para fazer acesso ao cvs:

<pre>
     export CVSROOT=:pserver:michelle@cvs.cipsga.org.br:/var/lib/cvs
     cvs login
</pre>

<p>
Será pedido a senha da usuária <samp>michelle</samp>.  Entrando com a senha
correta, o sistema retornará para o aviso de comando.  Uma mensagem será
mostrada caso a senha entrada seja incorreta.  Daqui em diante, o resto da
seção CVS é normal e você terá as permissões de acesso ao repositório de acordo
com as suas permissões de acesso naquele diretório.

<p>
<strong>OBS1:</strong> A senha poderá ser passada junto com o login da mesma
forma como o ftp.  Veja a observação em <a
href="#s-s-cvs-d-metodos-ext-c">Configurando o método ext, Seção 17.2.3.1</a>.

<p>
<strong>OBS2:</strong> A desvantagem do método pserver padrão é que a seção é
feita em texto plano, desta forma, alguns cuidados podem ser tomados para
tornar o sistema um pouco mais seguro.  Um deles é dar <code>/bin/false</code>
como shell de usuário (para desativar o login no sistema) ou usar o método de
acesso descrito em <a href="#s-s-cvs-d-metodos-pserver-c-system">Servidor
pserver usando autenticação do sistema, Seção 17.2.5.2</a> em combinação com
este.  Tenha conciencia das influências disso se a máquina for usada para
outras tarefas, como um servidor &quot;pop3&quot; por exemplo.

<hr>

<a name="s-s-cvs-d-metodos-pserver-c-pwrepos"></a>
<h4>17.2.5.3 Servidor pserver com autenticação própria</h4>

<p>
Esta forma de acesso armazena os usuários em um banco de dados próprio, não
requerendo a criação de contas locais no arquivo <code>/etc/passwd</code>.
Para criar um servidor deste tipo siga os seguintes procedimentos:
<ol type="1" start="1" >
<li>
Exporte a variável <var>CVSROOT</var> apontando para o repositório que deseja
configurar o acesso.  Como isto é uma configuração administrativa, assumo o
método de acesso <em>local</em> sendo usada pelo usuário administrador do
servidor: <samp>export CVSROOT=/var/lib/cvs</samp>.
</li>
<li>
Crie um diretório para trabalhar nos arquivos administrativos do repositório:
<samp>mkdir /tmp/repos</samp>
</li>
<li>
Entre no diretório criado acima e execute o comando: <samp>cvs checkout
.</samp>
</li>
<li>
Quando terminar de baixar os arquivos, entre no subdiretório
<code>CVSROOT</code>, os arquivos de configuração do repositório se encontram
lá (para detalhes sobre cada um destes arquivos, veja <a
href="#s-s-cvs-cvsroot">Arquivos administrativos em CVSROOT, Seção 17.4</a>.
</li>
<li>
Edite o arquivo <code>config</code> e mude a variável <var>SystemAuth</var>
para <samp>no</samp>.  Isto diz ao servidor <em>pserver</em> não usar os
arquivos de autenticação do sistema, mas a invés disso usar seu banco de dados
próprio.
<p>
Em algumas instalações, caso exista o arquivo <code>passwd</code> no
repositório, o <em>pserver</em> automaticamente o utiliza ao invés do
<code>/etc/passwd</code>.
</li>
<li>
Crie um arquivo <code>passwd</code> no diretório <code>CVSROOT</code> o formato
deste arquivo é:
<pre>
     usuario:senha:usuario_local
</pre>
<p>
Onde:
<dl>
<dt>usuario</dt>
<dd>
Nome da conta de usuário que fará acesso ao CVS.
</dd>
<dt>senha</dt>
<dd>
Senha que será usada pelo usuário.  Ela deverá ser criptografada usando o
algoritmo crypt.  O comando <code>mkpasswd senha</code> pode ser usado para
gerar a senha criptografada.  Caso este campo seja deixado em branco, nenhuma
senha de usuário será utilizada.  O utilitário <code>mkpasswd</code> está
presente no pacote <code>whois</code> na <code>Debian</code>.
</dd>
<dt>usuario_local</dt>
<dd>
Usuário local que terá suas permissões mapeadas ao usuário do CVS.  Como a
conta de usuário do <code>cvs</code> não existe no sistema, é necessário que o
sistema tenha uma maneira de saber que nível de acesso este usuário terá.  Caso
não crie este usuário ou ele seja inválido, você terá erros do tipo &quot;: no
such user&quot; no momento que fizer o &quot;cvs login&quot;.
<p>
Uma forma segura de se fazer isto, é criar uma conta de usuário *somente* com
acesso aos arquivos do CVS, sem shell e senha.  Isto permitirá mapear a UID/GID
do usuário criado com o acesso do CVS sem comprometer a segurança do sistema de
arquivos.  Isto pode ser feito através do seguinte comando:
<pre>
     adduser --disabled-password --disabled-login usuario
</pre>
<p>
É necessário especificar um diretório home do usuário, pois o servidor cvs
precisa ter acesso ao arquivo <code>/home/do/cvs/.cvsignore</code>.
<p>
<strong>OBS1:</strong> Mais uma vez: Leve sempre em conta a forma que os outros
serviços em sua máquina estão configurados (como eles fazem acesso, permissões
de acesso, diretórios onde gravam arquivos, são algumas delas) antes de
escolher como um serviço novo na máquina funcionará.  Isto poderá modificar ou
deixar vulnerável a segurança de sua instalação.
<p>
<strong>OBS2:</strong> Permita que os usuários <strong>somente</strong> tenham
acesso a máquina via CVS.
<p>
<strong>OBS3:</strong> Certifique-se sempre que o dono/grupo do repositório
seja <samp>root.src</samp> (ou outro grupo que tenha criado) adicione somente
usuários de confiança no grupo <code>src</code> para criar novos projetos.
<p>
Exemplos:
<pre>
     gleydsonm:K32dk1234k:cvsuser
     anonymous::pooruser
</pre>
<p>
O usuário cvs <em>gleydsonm</em> quando logar no cvs, terá as permissões de
acesso do usuário <em>cvsuser</em> do sistema.
<p>
<strong>OBS1:</strong> Certifique-se que o usuário local possui permissões de
gravação no diretório do CVS, caso contrário ele não poderá fazer
<em>commits</em>.  Lembre-se que as permissões de leitura/gravação do usuário
serão controladas através de arquivos do próprio pserver, mas também é
necessária a permissão de gravação do usuário no repositório.  Isto poderá ser
feito através de grupos de sistema e garante uma dupla camada de segurança.
<p>
<strong>OBS2:</strong> Caso tenha preferido usar o <samp>pserver</samp> sob um
usuário diferente de root e esteja obtendo a mensagem <samp>setgid failed:
Operation not permitted</samp>, significa que o servidor CVS não consegue mudar
para o grupo referente ao usado no diretório do repositório.  Verifique se as
permissões estão adequadas e se o grupo do usuário CVS no
<code>/etc/passwd</code> é o mesmo que especificou para acesso ao repositório.
</dd>
</dl>
</li>
<li>
Para dar direito de leitura ao repositório, crie um arquivo chamado
<code>readers</code> e adicione os nomes de usuários que terão acesso ao
repositório (um por linha).  O nome que deverá ser usado é o nome do usuário de
<em>CVS</em> e não do sistema (usuário <samp>gleydsonm</samp>, segundo o
exemplo).
<p>
Exemplo:
<pre>
     gleydsonm
     anonymous
</pre>
</li>
<li>
Para dar direito de gravação ao repositório, crie um arquivo chamado
<code>writers</code>.  Seu formato é idêntico ao arquivo <code>readers</code>.
<p>
Exemplo:
<pre>
     gleydsonm
     macan
     otavio
     hmh
     kov
</pre>
</li>
<li>
Pronto, o acesso a CVS usando um banco de dados próprio está pronto!  basta dar
o commit nos arquivos, adicionar os arquivos <code>readers</code>,
<code>writers</code> e <code>passwd</code> no repositório (veja <a
href="#s-s-cvs-p-add">Adicionando um arquivo ao módulo CVS do servidor, Seção
17.3.9</a>) para o servidor de CVS para te-lo funcionando.  Note que em versões
mais novas do CVS, não é possível transferir o arquivo <code>passwd</code> via
rede, então será necessário cria-lo manualmente dentro do repositório do
servidor.
<p>
<strong>OBS:</strong> O arquivo <code>passwd</code> não é transferido pelo
commit por motivos de segurança, pois ele contém senhas que podem ser
capturadas e usada por pessoas maliciosas.  Será necessário transferi-lo
manualmente para o repositório do servidor remoto (você terá que ser o usuário
<em>root</em> ou ter permissões adequadas).  O recomendável é utilizar o
<code>scp</code> (<a href="ch-s-ssh.html#s-s-ssh-cliente-scp">scp, Seção
15.2.2</a>) para realizar transferências seguras.  .
</li>
</ol>

<p>
O método de acesso do CVS aos arquivos <code>readers</code> e
<code>writers</code> é restritiva, portanto se um nome de usuário existir no
arquivo <code>readers</code> e <code>writers</code> o que valerá será o menor
nível de acesso.  Vendo os exemplos acima, os usuários <em>gleydsonm e
anonymous</em> terão somente acesso a leitura do repositório e <em>macan,
otavio, hmh, kov</em> acesso de leitura e gravação.

<hr>

<a name="s-s-cvs-d-metodos-gssapi"></a>
<h3>17.2.6 gssapi</h3>

<p>
Quando o CVS é compilado com o suporte a Kerberos 5, ele tenta estabelecer
automaticamente uma conexão segura usando este método.  Este método funciona
somente se o CVS estiver compilado com o suporte a Kerberos (opção
<samp>--with-gssapi</samp>).

<hr>

<a name="s-s-cvs-p"></a>
<h2>17.3 Criando projetos para serem usados no CVS</h2>

<p>
Esta seção descreve todos os passos necessários para colocação de um projeto
para ser desenvolvido através do CVS, os comandos do cvs, considerações a
respeito dos comandos e sua utilização através de exemplos didáticos.

<hr>

<a name="s-s-cvs-p-repos"></a>
<h3>17.3.1 Repositório</h3>

<p>
Um repositório CVS é o local que armazena módulos e também os arquivos
administrativos (que contém permissões, etc) são armazenados em um subdiretório
chamado <code>CVSROOT</code>.

<p>
O acesso a um repositório é feito através de parâmetros especificados na
variável <var>CVSROOT</var> ou pela opção <em>-d repositório</em> do cvs.  Veja
<a href="#s-s-cvs-d">Servidor de CVS - configurando métodos de acesso ao
repositório, Seção 17.2</a> para ver exemplos de métodos de acesso.

<p>
O Repositório pode conter um ou mais módulos, cada módulo representa um projeto
no servidor, criado após o uso do comando <samp>import</samp>.  Segue um
exemplo da estrutura de um repositório CVS:

<pre>
     var/lib
          |
          +- cvs
              |- CVSROOT
              |- projeto1
              +- projeto2
</pre>

<p>
O subdiretório <code>cvs</code> é o repositório (veja o subdiretório
<code>CVSROOT</code> dentro dele) e os diretórios dentro dele
<code>projeto1</code> e <code>projeto2</code> são os módulos criados através do
comando <samp>cvs import ...</samp>(veja <a
href="#s-s-cvs-p-import">Adicionando um novo projeto, Seção 17.3.6</a>).

<p>
Para acessar o projeto do CVS, então é definido o repositório que tem
permissões de acesso na variável <samp>CVSROOT</samp> e então é executado um
comando (checkout, update, commit, etc) no módulo que desejamos utilizar:

<pre>
     export CVSROOT=:ext:anonymous@servidor.org.br:/var/lib/cvs (&lt;- Repositório &quot;cvs&quot;)
     cvs checkout projeto1 (&lt;- módulo que desejamos pegar do servidor)
</pre>

<p>
Nas seções seguintes serão explicados cada um dos comandos usados para
trabalhar com um projeto no <code>cvs</code>.

<hr>

<a name="s-s-cvs-p-mkrepos"></a>
<h3>17.3.2 Criando um repositório</h3>

<p>
Para adicionar um novo repositório no sistema, edite o arquivo
<code>/etc/cvs-pserver.conf</code> e defina o nome de cada repositório na
variável <var>CVS_PSERV_REPOS</var> separados por &quot;:&quot; (exemplo:
<samp>CVS_PSERV_REPOS=&quot;/var/lib/cvs:/var/lib/cvs2&quot;</samp>).

<p>
Feito isso execute o comando <code>cvs-makerepos</code> para que os diretórios
especificados no arquivo <code>/etc/cvs-pserver.conf</code> sejam criados com
as devidas permissões.

<p>
Para adicionar manualmente um repositório (/var/lib/cvs), execute os seguintes
passos:
<ol type="1" start="1" >
<li>
Execute o comando <samp>cvs -d /var/lib/cvs init</samp> (para criar o
repositório e os arquivos administrativos que ficam armazenados dentro de
<code>CVSROOT</code>.
</li>
<li>
Mude as permissões do diretório para sgid com: <samp>chmod 2775
/var/lib/cvs</samp>.
</li>
<li>
Mude o dono/grupo com o comando: <samp>chown root.src /var/lib/cvs</samp>
</li>
<li>
Opcional: caso utilize o método de acesso <em>pserver</em> será necessário
adicionar a opção <samp>--allow-root=/var/lib/cvs</samp> na linha que inicia o
servidor pserver.  Este parâmetro deve ser usada para cada repositório
adicionado no servidor.
</li>
</ol>

<p>
A partir de agora, seu repositório já está pronto para ser utilizado.

<hr>

<a name="s-s-cvs-p-login"></a>
<h3>17.3.3 Logando no servidor de CVS via pserver</h3>

<p>
Quando é usado o método de acesso pserver (<a
href="#s-s-cvs-d-metodos-pserver">pserver (password server), Seção 17.2.4</a>),
é necessário fazer para ter acesso ao repositório.  Por exemplo, para acessar o
repositório <code>/var/lib/cvs</code> no servidor <code>servidor.org.br</code>:

<pre>
     export CVSROOT=:pserver:anonymous@servidor.org.br:/var/lib/cvs
     cvs login
     
     ou 
     
     cvs -d :pserver:anonymous@servidor.org.br:/var/lib/cvs login
</pre>

<p>
Então será solicitada a senha para ter acesso ao sistema.  Note que toda a
seção de <code>cvs</code> ocorre por comandos interativos que logo após
concluídos retornam para o interpretador de comandos.  O restante desta seção
descreverá estes comandos e como utiliza-los de maneira eficiente.

<p>
<strong>OBS:</strong> O uso da variável <var>CVSROOT</var> torna a utilização
bastante prática, assim não precisamos especificar o repositório, método de
acesso, etc.  toda vez que usar um comando do <code>cvs</code>.

<hr>

<a name="s-s-cvs-p-logout"></a>
<h3>17.3.4 Encerrando uma seção de CVS</h3>

<p>
Embora que não seja necessário, após o uso do cvs é recomendável executar o
logout do servidor para encerrar sua conexão com a máquina remota.

<pre>
     # (assumindo que a variável CVSROOT está definida)
     cvs logout
     
     ou 
     
     cvs -d :pserver:anonymous@servidor.org.br:/var/lib/cvs logout
</pre>

<p>
<strong>OBS:</strong> Para os paranóicos é importante encerrar uma seção de
CVS, pois ele possui alguns bugs e um spoofing pode tornar possível o uso de
uma seção deixada aberta.

<hr>

<a name="s-s-cvs-p-checkout"></a>
<h3>17.3.5 Baixando arquivos</h3>

<p>
O comando <samp>checkout</samp> (ou &quot;co&quot;) é usado para fazer isto.
Para utilizá-lo seguindo os exemplos anteriores:

<pre>
     mkdir /tmp/cvs
     cd /tmp/cvs
     cvs checkout modulo
     cvs -d :pserver:anonymous@servidor.org.br:/var/lib/cvs
</pre>

<p>
Será criado um subdiretório chamado <code>modulo</code> que contém todos os
arquivos do servidor de CVS remoto.  É necessário apenas que tenha acesso de
leitura ao servidor de CVS para executar este comando.  Você pode usar a opção
<samp>-z [num]</samp> para ativar a compactação na transferência dos arquivos,
isso acelera bastante a transferência em conexões lentas: <samp>cvs -z 3
checkout modulo</samp>.

<p>
Também é possível especificar apenas subdiretórios de um módulo para baixa-lo
via CVS e a estrutura de diretórios criada localmente será idêntica ao do
servidor remoto.

<hr>

<a name="s-s-cvs-p-import"></a>
<h3>17.3.6 Adicionando um novo projeto</h3>

<p>
Use o comando <samp>cvs import</samp> para adicionar um novo projeto ao CVS.
As entradas nos arquivos administrativos serão criadas e o projeto estará
disponível para utilização dos usuários.  A sintaxe básica do comando
<samp>import</samp> é a seguinte:

<p>
<samp>cvs import [<em>opções</em>] [<em>dir_modulo</em>] [<em>tag</em>]
start</samp>

<p>
Para adicionar o projeto <samp>focalinux</samp> que reside em
<code>/usr/src/focalinux</code> ao cvs:

<pre>
     # Primeiro exportamos o CVSROOT para dizer onde e qual repositório acessar
     export CVSROOT=:ext:usuario@servidor.com.br:2401/var/lib/cvs
     
     cd /usr/src/focalinux
     cvs import documentos/focalinux tag_modulo start
</pre>

<p>
Por padrão o <code>import</code> sempre utiliza a máscara <em>*</em> para fazer
a importação dos arquivos do diretório atual.  O projeto <samp>focalinux</samp>
será acessado através de $CVSROOT/documentos/focalinux (<samp>cvs checkout
documentos/focalinux</samp>), ou seja,
<code>/var/lib/cvs/documentos/focalinux</code> no servidor CVS terá a cópia do
focalinux.  <samp>tag_modulo</samp> define o nome que será usado como
identificador nas operações com os arquivos do CVS (pode ser usado
&quot;focalinux&quot; em nosso exemplo).  O parâmetro &quot;start&quot; diz
para criar o módulo.

<p>
<strong>OBS:</strong> Por segurança, o diretório que contém os arquivos deverá
ser sempre um caminho relativo na estrutura de diretórios, ou seja, você
precisará entrar no diretório pai (como <code>/usr/src/projeto</code>) para
executar o <samp>cvs import</samp>.  Não é permitido usar <samp>/</samp> ou
<samp>..</samp>, isto proíbe a descida em diretórios de nível mais altos e
sérios incidentes de segurança em servidores CVS mal configurados pelo
Administrador.

<hr>

<a name="s-s-cvs-p-update"></a>
<h3>17.3.7 Sincronizando a cópia remota com a cópia local</h3>

<p>
Este comando sincroniza a cópia remota do CVS (ou arquivo) com a cópia local
que está trabalhando em sua máquina.  Quando se trabalha nativamente no CVS em
equipe é recomendado a utilização deste comando pois alguém pode ter modificado
o arquivo antes de você, então uma incompatibilidade entre sua versão e a nova
poderia causar problemas.

<p>
Supondo que tenha acabado de modificar o arquivo <code>main.c</code> do módulo
<code>cvsproj</code>, então antes de fazer o commit (<a
href="#s-s-cvs-p-commit">Enviando as mudanças para o servidor remoto, Seção
17.3.8</a>) use o update:

<pre>
     cvs update main.c
     
     ou 
     
     cvs -d :ext:usuario@servidor.com.br:2401/var/lib/cvs update main.c
</pre>

<p>
Após alguns segundos, sua cópia local ficará sincronizada com a cópia remota.
Caso ele mostre alguma mensagem de saída, verifique o arquivo para solucionar
qualquer conflito e então envie o arquivo para o servidor remoto (<a
href="#s-s-cvs-p-commit">Enviando as mudanças para o servidor remoto, Seção
17.3.8</a>).

<p>
Você pode fazer o update de mais arquivos usando referências globais
(<samp>*</samp>, <samp>?</samp> ou <samp>[]</samp>).

<hr>

<a name="s-s-cvs-p-commit"></a>
<h3>17.3.8 Enviando as mudanças para o servidor remoto</h3>

<p>
O comando &quot;commit&quot; (ou &quot;ci&quot;), envia as mudanças feitas nos
arquivos locais para o servidor remoto.  Um exemplo de commit no arquivo
<code>main.c</code>:

<pre>
     cvs commit main.c
     
     cvs commit main.?
     
     cvs commit *
</pre>

<p>
O editor padrão do sistema será aberto e pedirá uma descrição das modificações
para o commit.  Esta descrição será usada como referência sobre as atualizações
feitas em cada etapa do desenvolvimento.  A mensagem também pode ser
especificada usando a opção &quot;-m mensagem&quot;, principalmente quando o
texto explicando as alterações é pequeno.

<p>
Para mudar o editor de texto padrão que será usado pelo <code>cvs</code>,
altere a variável de ambiente <var>EDITOR</var> ou especifique o editor que
deseja usar na linha de comando com a opção &quot;-e editor&quot;:

<pre>
     cvs commit -e vi main.c
</pre>

<hr>

<a name="s-s-cvs-p-add"></a>
<h3>17.3.9 Adicionando um arquivo ao módulo CVS do servidor</h3>

<p>
Após criar/copiar o arquivo para seu diretório de trabalho, use o comando
<samp>add</samp> para fazer isto.  O arquivo será enviado ao servidor, bastando
apenas executa o <samp>commit</samp> para salvar o arquivo:

<pre>
     cvs add main.h
     cvs commit main.h
</pre>

<hr>

<a name="s-s-cvs-p-add-dir"></a>
<h3>17.3.10 Adicionando um diretório ao módulo CVS do servidor</h3>

<p>
O método para adicionar um diretório com arquivos é semelhante ao de adicionar
apenas arquivos ao cvs.  O único ponto que deve se seguido é que primeiro deve
ser adicionado o diretório (com o &quot;cvs add&quot;) salvar no servidor
remoto (&quot;cvs commit&quot;) e depois adicionar os arquivos existentes
dentro dele (assim como descrito em <a href="#s-s-cvs-p-add">Adicionando um
arquivo ao módulo CVS do servidor, Seção 17.3.9</a>).  Para adicionar o
diretório <code>teste</code> e seus arquivos no servidor <code>cvs</code>
remoto:

<pre>
     cvs add teste
     cvs commit -m &quot;Adicionado&quot; teste
     cvs add teste/*
     cd teste
     cvs commit -m &quot;Adicionados&quot; .
</pre>

<p>
Os dois primeiros comandos agendam o diretório <code>teste</code> e fazem o
<samp>commit</samp> no diretório remoto.  Os dois últimos, enviam os arquivos
existentes dentro deste diretório para o servidor remoto.

<hr>

<a name="s-s-cvs-p-remove"></a>
<h3>17.3.11 Removendo um arquivo do módulo CVS remoto</h3>

<p>
O comando para fazer isto é o &quot;remove&quot;.  Primeiro use o
<code>rm</code> para remover o arquivo/diretório de sua cópia local, depois
execute o <samp>remove</samp> seguido de commit para confirmar a remoção do
arquivo:

<pre>
     cvs remove main.h
     cvs commit main.h
</pre>

<hr>

<a name="s-s-cvs-p-removed"></a>
<h3>17.3.12 Removendo um diretório do módulo CVS remoto</h3>

<p>
Para remover um diretório, primeiro remova todos os arquivos existentes dentro
dele com o comando <code>rm</code> e salve para o servidor (seguindo os métodos
descritos em <a href="#s-s-cvs-p-remove">Removendo um arquivo do módulo CVS
remoto, Seção 17.3.11</a>).  O CVS não remove diretamente diretórios vazios,
uma maneira de contornar isto é usar o <samp>update</samp> ou
<samp>commit</samp> seguido da opção <samp>-P</samp> para ignorar diretórios
vazios.  Então a cópia remota do diretório será removida do servidor:

<pre>
     rm -f teste/*
     cvs remove teste/.
     cvs commit teste/.
     cd ..
     cvs checkout modulo
</pre>

<p>
Depois do checkout, o subdiretório teste terá sido removido.

<hr>

<a name="s-s-cvs-p-release"></a>
<h3>17.3.13 Dizendo que o módulo atual não está mais em uso</h3>

<p>
O comando &quot;release&quot; faz esta função.  Ele não é requerido, mas caso
você tenha feito modificações que ainda não foram salvas no servidor de cvs
(<samp>commit</samp>), ele alertará de arquivos modificados e perguntará se
deseja continuar.  Registrando também o abandono das modificações no histórico
do <code>cvs</code>.  O comando pode ser acompanhado de &quot;-d&quot; para
remover o módulo anteriormente baixado com o &quot;commit&quot;:

<pre>
     cvs release modulo
     
     cvs release -d modulo
</pre>

<p>
O <samp>release</samp> retorna os seguintes códigos quando verifica que as duas
cópias (local e remota) não estão sincronizadas:
<dl>
<dt>U ou P</dt>
<dd>
Existe uma versão nova do arquivo no repositório.  Para corrigir isso, execute
o comando &quot;update&quot;.
</dd>
<dt>A</dt>
<dd>
O arquivo não foi adicionado ainda ao repositório remoto.  Se apagar o
repositório local, este arquivo não será adicionado.  Para corrigir isto,
executa o comando &quot;add&quot; do cvs.
</dd>
<dt>R</dt>
<dd>
O arquivo foi removido localmente, mas não foi removido do servidor remoto.
Use os procedimentos em <a href="#s-s-cvs-p-remove">Removendo um arquivo do
módulo CVS remoto, Seção 17.3.11</a> para corrigir a situação.
</dd>
<dt>M</dt>
<dd>
O arquivo está modificado localmente e não foi salvo ainda no servidor.  Use os
procedimentos em <a href="#s-s-cvs-p-update">Sincronizando a cópia remota com a
cópia local, Seção 17.3.7</a> e <a href="#s-s-cvs-p-commit">Enviando as
mudanças para o servidor remoto, Seção 17.3.8</a> para salvar o arquivo.
</dd>
<dt>?</dt>
<dd>
O arquivo está em seu diretório de trabalho mas não tem referências no
repositório remoto e também não está na lista de arquivos ignorados do CVS.
</dd>
</dl>

<hr>

<a name="s-s-cvs-p-diff"></a>
<h3>17.3.14 Visualizando diferenças entre versões de um arquivo</h3>

<p>
Com o comando &quot;diff&quot; é possível visualizar que diferenças o arquivo
que está sendo editado possui em relação ao arquivo do repositório remoto.
Outra funcionalidade útil do &quot;diff&quot; é comparar 2 versões de arquivos
do mesmo repositório CVS.  Exemplos:
<dl>
<dt>cvs diff main.c</dt>
<dd>
Verifica as diferenças entre o arquivo <code>main.c</code> local e remoto.
</dd>
<dt>cvs diff -u -r 1.1 -r 1.2 main.c</dt>
<dd>
Mostra as diferenças em formato unificado para mostrar as diferenças entre as
versões 1.1 e 1.2 do arquivo <code>main.c</code>.
</dd>
</dl>

<hr>

<a name="s-s-cvs-p-status"></a>
<h3>17.3.15 Visualizando o status de versão de arquivos</h3>

<p>
O comando &quot;status&quot; permite verificar que versões do arquivo
especificado está disponível localmente, remotamente, qual a versão inicial do
arquivo no repositório, sticky tag.  Exemplos:
<dl>
<dt>cvs status main.c</dt>
<dd>
Verifica o status do arquivo <code>main.c</code>.
</dd>
<dt>cvs status -v main.c</dt>
<dd>
Mostra o status do arquivo <code>main.c</code>, adicionalmente mostra também as
tags existentes no arquivo (versão inicial, versão do repositório).
</dd>
</dl>

<hr>

<a name="s-s-cvs-p-utils"></a>
<h3>17.3.16 Outros utilitários para trabalho no repositório</h3>

<p>
Além dos comandos do <code>cvs</code> descritos aqui, existem comandos no
pacote <code>cvsutils</code> que auxiliam desde quem está aprendendo a utilizar
o CVS (com o comando <code>cvsdo</code> para simular algumas operações de
adição/remoção de arquivos) até profissionais que usam o programa no dia a dia
(<code>cvsu</code>, <code>cvsco</code>, <code>cvschroot</code>).

<hr>

<a name="s-s-cvs-cvsroot"></a>
<h2>17.4 Arquivos administrativos em CVSROOT</h2>

<p>
Esta seção descreve a função de cada um dos arquivos administrativos, isto pode
ser útil na configuração e personalização do CVS e de seu repositório.

<p>
Para não alongar muito o capítulo, procurei colocar uma breve descrição da
função de cada um deles, o comentários e exemplos existentes nos arquivos
oferecem uma boa compreensão do seu conteúdo.

<hr>

<a name="s-s-cvs-cvsroot-config"></a>
<h3>17.4.1 <code>config</code></h3>

<p>
Este arquivo é segue os padrões do arquivos de configuração e possui alguns
parâmetros que controlam o comportamento do CVS.  Segue uma lista deles:
<dl>
<dt><var>SystemAuth</var></dt>
<dd>
Define se será utilizado a autenticação via <code>/etc/passwd</code> quando o
método <em>pserver</em> for utilizado.  Note que se o arquivo
<code>passwd</code> for criado no <code>CVSROOT</code>, o <var>SystemAuth</var>
será definido automaticamente para <samp>no</samp>.
<p>
Exemplo: <samp>SystemAuth=yes</samp>.
</dd>
<dt><var>LockDir</var></dt>
<dd>
Especifica o diretório onde serão gravados os arquivos de lock.  Caso não seja
especificado, será usado o diretório do CVS.
<p>
Exemplo: <samp>LockDir=/var/lock/cvs</samp>
</dd>
<dt><var>TopLevelAdmin</var></dt>
<dd>
Permite criar ou não um diretório chamado <code>CVS</code> no root do diretório
de trabalho durante o <samp>cvs checkout</samp>.
</dd>
<dt><var>LogHistory</var></dt>
<dd>
Utiliza opções para especificar o que será registrado nos arquivos de log do
<samp>CVS</samp>.
<ul>
<li>
<samp>TOFEWGCMAR</samp> ou <samp>all</samp>
<p>
Registra todas as operações nos logs do <code>cvs</code>.
</li>
<li>
<samp>TMAR</samp>
<p>
Registra todas as operações que modificam os arquivos
<code>&quot;,v&quot;</code>
</li>
</ul>
</dd>
</dl>

<hr>

<a name="s-s-cvs-cvsroot-modules"></a>
<h3>17.4.2 <code>modules</code></h3>

<p>
Especifica opções e programas externos que serão usados durante a execução de
comandos no repositório CVS.

<hr>

<a name="s-s-cvs-cvsroot-cvswrappers"></a>
<h3>17.4.3 <code>cvswrappers</code></h3>

<p>
Este arquivo define ações de controle de características de arquivos, de acordo
com seu nome.

<p>
Pode ser também definidas ações através de arquivos <code>.cvswrappers</code>.

<hr>

<a name="s-s-cvs-cvsroot-commitinfo"></a>
<h3>17.4.4 <code>commitinfo</code></h3>

<p>
Define programas para fazer uma checagem baseada no diretório e dizer se o
commit é permitido.

<hr>

<a name="s-s-cvs-cvsroot-verifymsg"></a>
<h3>17.4.5 <code>verifymsg</code></h3>

<p>
Especifica o programa usado para verificar as mensagens de log.

<hr>

<a name="s-s-cvs-cvsroot-loginfo"></a>
<h3>17.4.6 <code>loginfo</code></h3>

<p>
Programa que é executado após o commit.  Ele pode ser usado para tratar a
mensagem de log e definir onde ela será gravada/enviada, etc.

<hr>

<a name="s-s-cvs-cvsroot-cvsignore"></a>
<h3>17.4.7 <code>cvsignore</code></h3>

<p>
Tudo que constar neste arquivo não será gravado (commit) no cvs.  Referências
globais podem ser usadas para especificar estes arquivos.  Veja a info page do
cvs para detalhes sober seu formato.

<p>
Pode também ser especificado através de arquivos <code>.cvsignore</code>.

<hr>

<a name="s-s-cvs-cvsroot-checkoutlist"></a>
<h3>17.4.8 <code>checkoutlist</code></h3>

<p>
Especifica os arquivos que deseja manter sobre o controle do CVS que se
encontram em <code>CVSROOT</code>.  Se adicionar um script adicional, ou
qualquer outro arquivo no diretório <code>CVSROOT</code> ele deverá constar
neste arquivo.

<hr>

<a name="s-s-cvs-cvsroot-history"></a>
<h3>17.4.9 <code>history</code></h3>

<p>
É usado para registrar detalhes do comando <em>history</em> do CVS.

<hr>

<a name="s-s-cvs-c"></a>
<h2>17.5 Clientes de CVS</h2>

<p>
Esta seção traz alguns programas cliente em modo texto/gráfico e visualizadores
de repositórios via web.  Eles facilitam o trabalho de controle de revisão por
parte de iniciantes e flexibilidade para pessoas mais experientes, além de ter
uma interface de navegação disponível para todos os interessados em fazer
pesquisas no repositório.

<hr>

<a name="s-s-cvs-c-cvs"></a>
<h3>17.5.1 cvs</h3>

<p>
Este é o cliente <code>Unix</code> padrão, bastante poderoso e que opera em
modo texto.  As explicações neste capítulo do guia assumem este cliente de
<code>cvs</code>, então as explicações sobre sua utilização se encontra em <a
href="#s-s-cvs-p">Criando projetos para serem usados no CVS, Seção 17.3</a> e
os parâmetros de linha de comando em <a href="#s-s-cvs-opcoescmd">Opções de
linha de comando, Seção 17.1.10</a>

<p>
É <strong>altamente</strong> recomendável a leitura caso deseje utilizar um
cliente de <code>cvs</code> gráfico, pois os conceitos são os mesmos.

<hr>

<a name="s-s-cvs-c-gcvs"></a>
<h3>17.5.2 gcvs - Linux</h3>

<p>
Este é um cliente CVS em GTK+Python para <code>Linux</code> que interage
externamente com o cliente <code>cvs</code> externo, todas as opções do cvs
estão disponíveis através de checkboxes nas telas de comando, incluindo suporte
a compactação, visualizador gráfico da árvore de releases, histórico, diffs,
etc.

<p>
Sua instalação é bastante fácil, instale o programa com <samp>apt-get install
gcvs</samp> e execute o programa através do menu do sistema ou do terminal.
Utilize os seguintes procedimentos para configurar e utilizar o programa:
<ol type="1" start="1" >
<li>
Defina o repositório <var>CVSROOT</var> através do menu
<em>Admin</em>/<em>Preferences</em>.  Selecione o método de acesso, entre com o
login, servidor e repositório.
<pre>
     Exemplo: :pserver:anonymous@servidor:/var/lib/cvs
</pre>
<p>
O formato deve ser <em>EXATAMENTE</em> como o usado na variável CVSROOT no
shell, incluindo os &quot;:&quot;.  Caso tenha erros de login, verifique o
valor de <var>CVSROOT</var> cuidadosamente antes de contactar o administrador
de sistemas!
</li>
<li>
Agora faça o login no sistema em: <em>Admin</em>, <em>Login</em>.  Note que o
status de todas as operações do <code>cvs</code> são mostradas na janela de
status que fica na parte inferior da tela.
</li>
<li>
Crie um diretório que será usado para armazenar os fontes baixados do CVS, por
exemplo: <samp>mkdir ~/projetos</samp>
</li>
<li>
Acesse o menu <em>Create</em>, <em>Checkout Module</em> para baixar o projeto
do CVS para sua máquina local.  Ele irá te pedir o nome de diretório para onde
o código fonte do servidor CVS será baixado.  Digite <code>~/projetos</code> ou
outro diretório que foi criado no passo anterior.
<p>
<strong>OBS:</strong> Não utilize o nome <code>&quot;cvs&quot;</code> para o
diretório local, pois o <code>gcvs</code> oculta automaticamente pois os
arquivos administrativos de controle ficam neste local.
</li>
<li>
Altere o diretório padrão do <code>gcvs</code> para o diretório onde baixou o
projeto (<code>~/projetos</code>)clicando no botão &quot;set&quot; no topo da
coluna esquerda do <code>gcvs</code>.
</li>
<li>
Para enviar um arquivo modificado de volta ao servidor, selecione os arquivos,
clique em <em>Modify</em>, <em>Commit Selection</em>, entre com a mensagem
descrevendo as alterações e clique em &quot;OK&quot;.
<p>
Note que os arquivos modificados serão identificados por um ícone vermelho e
seu status será &quot;Mod.  File&quot; (arquivo modificado).
</li>
<li>
Se desejar adicionar um novo projeto no CVS, entre em <em>Create</em>,
<em>Import Module</em>, entre no diretório que deseja adicionar como um projeto
no servidor de CVS.  Após isto será feita uma checagem e mostrada uma tela de
possíveis problemas que podem ocorrer durante a importação do novo projeto.
<p>
Na próxima tela, digite o nome do módulo e caminho no servidor remoto no
primeiro campo, no segundo campo a mensagem de log para adicionar o projeto ao
servidor.  Em &quot;Vendor tag&quot; especifique o nome do projeto e sua versão
logo abaixo.  Clique em &quot;OK&quot; e aguarde a transferência dos arquivos
para o servidor.
<p>
Para maiores detalhes sobre a criação de novos projetos no servidor de CVS,
veja <a href="#s-s-cvs-p-import">Adicionando um novo projeto, Seção 17.3.6</a>.
<p>
<strong>OBS:</strong> Você deverá ter permissão de gravação para criar um novo
projeto no servidor CVS.
</li>
<li>
A partir de agora você poderá explorar as funções do programa e fazer uso das
funções habituais do CVS.  Todas as funções de operação e opções extras do CVS
estão disponíveis na interface gráfica, basta se acostumar com sua utilização.
</li>
</ol>

<p>
Após isto, explore bastante as opções do programa.  Todas as funcionalidades do
CVS estão organizadas entre os menus do programa.  Caso não entenda bem as
funções do programa, leia atentamente <a href="#s-s-cvs-p">Criando projetos
para serem usados no CVS, Seção 17.3</a> e também não deixe de consultar
detalhes na info page do cvs.

<hr>

<a name="s-s-cvs-c-wincvs"></a>
<h3>17.5.3 WinCVS - Windows</h3>

<p>
Este é um cliente CVS em Python para <code>Windows</code> equivalente ao
<code>gcvs</code> para <code>Linux</code>.  Suas funcionalidades e
recomendações são idênticas aos do <code>gcvs</code>.  Este cliente pode ser
baixado de: <code><a
href="http://telia.dl.sourceforge.net/sourceforge/cvsgui/WinCvs13b13.zip">http://telia.dl.sourceforge.net/sourceforge/cvsgui/WinCvs13b13.zip</a></code>
e o Python para Windows de <code><a
href="http://starship.python.net/crew/mhammond/downloads/win32all-153.exe">http://starship.python.net/crew/mhammond/downloads/win32all-153.exe</a></code>.

<p>
Para sua utilização, as explicações em <a href="#s-s-cvs-c-gcvs">gcvs - Linux,
Seção 17.5.2</a> são totalmente válidas.

<hr>

<a name="s-s-cvs-c-maccvs"></a>
<h3>17.5.4 MacCVS - Macintosh (PPC)</h3>

<p>
Idêntico ao <code>gcvs</code>, pode ser baixado de <code><a
href="http://telia.dl.sourceforge.net/sourceforge/cvsgui/MacCvsX-3.3a1-1.dmg">http://telia.dl.sourceforge.net/sourceforge/cvsgui/MacCvsX-3.3a1-1.dmg</a></code>.

<hr>

<a name="s-s-cvs-c-viewcvs"></a>
<h3>17.5.5 viewcvs</h3>

<p>
Este é um visualizador de repositórios CVS via web, ele precisa apenas de um
servidor web instalado com suporte a CGI.  Para instalar, execute o comando
<samp>apt-get install <code>viewcvs</code></samp> e siga os passos para
configurar programa.  Para adequar melhor o <code>viewcvs</code> ao seu
sistema, edite o arquivo <code>/etc/viewcvs/viewcvs.conf</code>.

<p>
O <code>viewcvs</code> possui uma interface que se parece com a navegação de um
diretório de ftp, recursos como a extração de diffs coloridos entre versões de
um arquivo selecionado, visualização de commits (com data, log do commit,
usuário, etc.), classificação da listagem exibida.

<p>
<strong>OBS:</strong>Leve em consideração as implicações de segurança impostas
por aplicativos cgi sendo executados em seu sistema.  Veja <a
href="ch-s-apache.html">Apache, Capítulo 12</a> para entender melhor o assunto.

<hr>

<a name="s-s-cvs-exemplo"></a>
<h2>17.6 Exemplo de uma seção CVS</h2>

<p>
Nota: este exemplo é apenas didático, não foi feita nenhuma modificação real no
conteúdo do repositório do <code>dillo</code> :-)

<pre>
     # Definir o CVSROOT
     export CVSROOT=:pserver:gleydson@ima.cipsga.org.br:/var/lib/cvs
     
     # entrar no servidor
     gleydson@host:/tmp/teste$ cvs login
     Logging in to :pserver:gleydson@ima.cipsga.org.br:2401/var/lib/cvs
     CVS password: &lt;password&gt;
     
     gleydson@oberon:/tmp/teste$ 
     
     # Pegar o módulo &quot;dillo do cvs&quot;
     cvs -z 3 co dillo
     
     cvs server: Updating dillo
     cvs server: Updating dillo/CVSROOT
     U dillo/CVSROOT/checkoutlist
     U dillo/CVSROOT/commitinfo
     U dillo/CVSROOT/config
     U dillo/CVSROOT/cvswrappers
     U dillo/CVSROOT/editinfo
     U dillo/CVSROOT/loginfo
     U dillo/CVSROOT/modules
     U dillo/CVSROOT/notify
     U dillo/CVSROOT/rcsinfo
     U dillo/CVSROOT/taginfo
     U dillo/CVSROOT/verifymsg
     cvs server: Updating dillo/CVSROOT/Emptydir
     cvs server: Updating dillo/dillo
     U dillo/dillo/AUTHORS
     U dillo/dillo/COPYING
     U dillo/dillo/ChangeLog
     U dillo/dillo/ChangeLog.old
     U dillo/dillo/INSTALL
     U dillo/dillo/Makefile.am
     U dillo/dillo/Makefile.in
     U dillo/dillo/NEWS
     U dillo/dillo/README
     U dillo/dillo/aclocal.m4
     U dillo/dillo/config.h.in
     U dillo/dillo/configure
     U dillo/dillo/configure.in
     U dillo/dillo/depcomp
     U dillo/dillo/dillorc
     U dillo/dillo/install-sh
     U dillo/dillo/missing
     U dillo/dillo/mkinstalldirs
     U dillo/dillo/stamp-h.in
     cvs server: Updating dillo/dillo/doc
     U dillo/dillo/doc/Cache.txt
     U dillo/dillo/doc/Cookies.txt
     U dillo/dillo/doc/Dillo.txt
     U dillo/dillo/doc/Dw.txt
     U dillo/dillo/doc/DwImage.txt
     U dillo/dillo/doc/DwPage.txt
     ...
     
     # Modifica o arquivo do projeto
     cd /dillo/dillo/doc
     vi Cache.txt
     
     
     # Update no arquivo para atualizar a cópia local com a remota
     cvs update Cache.txt
     M Cache.txt
     
     gleydson@host:/tmp/teste
     
     # Damos o commit no arquivo
     cvs commit Cache.txt
     
     
     # Saimos do sistema
     cvs logout
</pre>

<hr>

[ <a href="ch-s-pop3.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ <a href="ch-s-apache.html">12</a> ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ 17 ]
[ <a href="ch-s-samba.html">18</a> ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-s-samba.html">próximo</a> ]

<hr>

<p>
Guia Foca GNU/Linux

<address>
Versão 6.40 - segunda, 30 de outubro de 2006<br>
<br>
Gleydson Mazioli da Silva <code><a href="mailto:gleydson@guiafoca.org">gleydson@guiafoca.org</a></code><br>
<br>
</address>

<hr>

</body>

</html>

