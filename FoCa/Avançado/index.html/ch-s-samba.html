<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Guia Foca GNU/Linux - SAMBA</title>

</head>

<body>

<a name="ch-s-samba"></a>
<hr>

[ <a href="ch-s-cvs.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ <a href="ch-s-apache.html">12</a> ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ <a href="ch-s-cvs.html">17</a> ]
[ 18 ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-d-restr.html">próximo</a> ]

<hr>

<h1>
Guia Foca GNU/Linux
<br>Capítulo 18 - SAMBA
</h1>

<hr>

<p>
Este capítulo descreve a configuração, utilização, aplicação, integração de
redes <code>Windows</code> e <code>Linux</code> através do <code>SAMBA</code>.
Entre as explicações de cada opção, são passados detalhes importantes
relacionados com seu funcionamento, performance e impactos de segurança sobre o
servidor como um todo.

<p>
Uma seção foi especialmente separada para os mais paranóicos (como eu)
conhecerem, combinar e aplicar as restrições de forma mais adequada a
configuração da máquina.

<hr>

<a name="s-s-samba-intro"></a>
<h2>18.1 Introdução</h2>

<p>
O <code>SAMBA</code> é um servidor e conjunto de ferramentas que permite que
máquinas <code>Linux</code> e <code>Windows</code> se comuniquem entre si,
compartilhando serviços (arquivos, diretório, impressão) através do protocolo
SMB (Server Message Block)/CIFS (Common Internet File System), equivalentes a
implementação NetBEUI no Windows.  O <code>SAMBA</code> é uma das soluções em
ambiente UNIX capaz de interligar redes heterogênea.

<p>
Na lógica da rede Windows o <code>NetBEUI</code> é o protocolo e o
<code>NETBIOS</code> define a forma com que os dados são transportados.  Não é
correto dizer que o <code>NetBIOS</code> é o protocolo, como muitos fazem.

<p>
Com o <code>SAMBA</code>, é possível construir domínios completos, fazer
controle de acesso a nível de usuário, compartilhamento, montar um servidor
WINS, servidor de domínio, impressão, etc.  Na maioria dos casos o controle de
acesso e exibição de diretórios no samba é mais minucioso e personalizável que
no próprio Windows.

<p>
O guia Foca GNU/Linux documentará como instalar e ter as máquinas Windows de
diferentes versões (<code>Win3.11, Win95, Win95OSR/2, Win98, XP, WinNT,
W2K</code>) acessando e comunicando-se entre si em uma rede NetBEUI.  Estas
explicações lhe poderão ser indispensáveis para solucionar problemas, até mesmo
se você for um técnico especialista em redes Windows e não tem ainda planos de
implementar um servidor SAMBA em sua rede.

<hr>

<a name="s-s-samba-versao"></a>
<h3>18.1.1 Versão documentada</h3>

<p>
A versão do servidor samba documentada neste capítulo do guia é a 2.2.

<hr>

<a name="s-s-samba-historia"></a>
<h3>18.1.2 História</h3>

<p>
Andrew Tridgell - Desenvolveu o samba porque precisava montar um volume Unix em
sua máquina DOS.  Inicialmente ele utilizava o NFS, mas um aplicativo precisava
de suporte NetBIOS.  Andrew então utilizou um método muito avançado usado por
administradores para detectar problemas: escreveu um sniffer de pacotes que
atendesse aos requerimentos para ter uma única função: analisar e auxilia-lo a
interpretar todo o tráfego NetBIOS da rede.

<p>
Ele escreveu o primeiro código que fez o servidor Unix aparecer como um
servidor de arquivos Windows para sua máquina DOS que foi publicado mais ou
menos em meados de 1992 quando também começou a receber patches.  Satisfeito
com o funcionamento de seu trabalho, deixou seu trabalho de lado por quase 2
anos.  Um dia, ele resolveu testar a máquina Windows de sua esposa com sua
máquina Linux, e ficou maravilhado com o funcionamento do programa que criou e
veio a descobrir que o protocolo era documentado e resolveu levar este trabalho
a fundo melhorando e implementando novas funções.

<p>
O SAMBA atualmente é um servidor fundamental para a migração de pequenos grupos
de trabalho à grandes domínios com clientes mixtos.  Nenhum servidor de rede
NetBEUI conhecido proporciona tanta flexibilidade de acesso a clientes como o
SAMBA para compartilhamento de arquivos/impressão em rede.  As funções de
segurança que foram adicionadas ao SAMBA hoje garantem um controle mais
rigoroso que a própria implementação usada no Windows NT, incluindo o serviços
de diretórios, mapeamento entre IDs de usuários Windows com Linux, PDC, perfis
móveis e uma coisa que inclusive apresenta problemas no Windows:
compatibilidade total entre as diferentes implementações de versões do Windows.

<p>
Sua configuração pode receber ajustes finos pelo administrador nos soquetes TCP
de transmissão, recepção, cache por compartilhamento, configurações físicas que
afetam a performance de rede.  Seu código vem sendo melhorado constantemente
por hackers, obtendo excelente performance com hardwares mais obsoletos.  O
guia tem por objetivo abordar estes temas e permitir que você configure seu
sistema com uma performance batendo a mesma alcançada em um servidor NT
dedicado.

<hr>

<a name="s-s-samba-contribuindo"></a>
<h3>18.1.3 Contribuindo</h3>

<p>
Para contribuir com o desenvolvimento do samba, veja os detalhes na página:
http://us1.samba.org/samba/devel/

<p>
Caso encontre um bug no programa, ele poderá ser relatado se inscrevendo na
lista de discussão samba-technical-request@lists.samba.org.  Após responder a
mensagem de confirmação, envie um relato detalhado do problema encontrado no
programa.

<hr>

<a name="s-s-samba-caracteristicas"></a>
<h3>18.1.4 Características</h3>

<p>
Segue abaixo algumas funcionalidades importantes de aplicações do samba e seu
conjunto de ferramentas:
<ul>
<li>
Compartilhamento de arquivos entre máquinas <code>Windows</code> e
<code>Linux</code> ou de máquinas <code>Linux</code> (sendo o servidor SAMBA)
com outro SO que tenha um cliente NetBEUI (Macintosh, OS/2, LanManager, etc).
</li>
<li>
Montar um servidor de compartilhamento de impressão no <code>Linux</code> que
receberá a impressão de outras máquinas <code>Windows</code> da rede.
</li>
<li>
Controle de acesso aos recursos compartilhados no servidor através de diversos
métodos (compartilhamento, usuário, domínio, servidor).
</li>
<li>
Controle de acesso leitura/gravação por compartilhamento.
</li>
<li>
Controle de acesso de leitura/gravação por usuário autenticado.
</li>
<li>
Possibilidade de definir contas de &quot;Convidados&quot;, que podem se
conectar sem fornecer senha.
</li>
<li>
Possibilidade de uso do banco de dados de senha do sistema
(<code>/etc/passwd</code>), autenticação usando o arquivo de dados
criptografados do samba, LDAP, PAM, etc.
</li>
<li>
Controle de cache e opções de tunning por compartilhamento.
</li>
<li>
Permite ocultar o conteúdo de determinados diretórios que não quer que sejam
exibidos ao usuário de forma fácil.
</li>
<li>
Possui configuração bastante flexível com relação ao mapeamento de nomes DOS
=&gt; UNIX e vice versa, página de código, acentuação, etc.
</li>
<li>
Permite o uso de aliases na rede para identificar uma máquina com outro nome e
simular uma rede NetBIOS virtual.
</li>
<li>
O <code>samba</code> possibilita ajuste fino nas configurações de transmissão e
recepção dos pacotes TCP/IP, como forma de garantir a melhor performance
possível de acordo com suas instalações.
</li>
<li>
Permite o uso do gerenciador de mensagem do Linux (<code>Linpopup</code>) para
a troca de mensagens com estações <code>Windows</code> via
<samp>NetBios</samp>.  Com a flexibilidade do <code>samba</code> é possível até
redirecionar a mensagem recebida via e-mail ou pager.
</li>
<li>
Possui suporte completo a servidor WINS (também chamado de <em>NBNS</em> -
<em>NetBios Name Service</em>) de rede.  A configuração é bastante fácil.
</li>
<li>
Faz auditoria tanto dos acessos a pesquisa de nomes na rede como acesso a
compartilhamentos.  Entre os detalhes salvos estão a data de acesso, IP de
origem, etc.
</li>
<li>
Suporte completo a controlador de domínio Windows (PDC).
</li>
<li>
Suporte quase completo a backup do controlador de domínio (BDC).  Até a versão
2.2 do <code>samba</code>, o suporte a BDC é parcial.  Este código
provavelmente estará estável até a versão 3.0.
</li>
<li>
Permite montar unidades mapeadas de sistemas <code>Windows</code> ou outros
servidores <code>Linux</code> como um diretório no <code>Linux</code>.
</li>
<li>
Permite a configuração de recursos simples através de programas de configuração
gráficos, tanto via sistema, como via web.
</li>
<li>
Permite executar comandos no acesso ao compartilhamento ou quando o acesso ao
compartilhamento é finalizado.
</li>
<li>
Com um pouco de conhecimento e habilidade de administração de sistemas
<code>Linux</code>, é possível criar ambientes de auditoria e monitoração até
monitoração de acesso a compartilhamento em tempo real.
</li>
<li>
Entre outras possibilidades.
</li>
</ul>

<hr>

<a name="s-s-samba-ficha"></a>
<h3>18.1.5 Ficha técnica</h3>

<p>
Pacote <code>samba</code>

<p>
Outros utilitários importantes para a operação do clientes <code>samba</code>.
<ul>
<li>
<samp>smbclient</samp> - Ferramenta para navegação e gerenciamento de arquivos,
diretórios e impressoras compartilhados por servidores <code>Windows</code> ou
<code>samba</code>.
</li>
<li>
<samp>smbfs</samp> - Pacote que possui ferramentas para o mapeamento de
arquivos e diretórios compartilhados por servidores <code>Windows</code> ou
<code>samba</code> em um diretório local.
</li>
<li>
<samp>winbind</samp> - Daemon que resolve nomes de usuários e grupo através de
um servidor NT/SAMBA e mapeia os UIDs/GIDs deste servidor como usuários locais.
</li>
</ul>

<hr>

<a name="s-s-samba-hwreq"></a>
<h3>18.1.6 Requerimentos de Hardware</h3>

<p>
Processador 386 ou superior, 15 MB de espaço em disco (não levando em conta os
logs gerados e espaço para arquivos de usuários, aplicativos, etc.), 8 MB de
memória RAM.

<hr>

<a name="s-s-samba-logs"></a>
<h3>18.1.7 Arquivos de log criados</h3>

<p>
O daemon nmbd salva seus logs em /var/log/daemon.log (dependendo da diretiva de
configuração <em>syslog</em> do arquivo smb.conf) e em
<code>/var/log/samba/log.nmbd</code>.  Os detalhes de acesso a compartilhamento
são gravados no arquivo <code>/var/log/samba/log.smbd</code> (que pode ser
modificado de acordo com a diretiva <em>log file</em> no <code>smb.conf</code>,
<a href="#s-s-samba-s-global-log">Log de acessos/serviços, Seção 18.2.8.5</a>).

<hr>

<a name="s-s-samba-install"></a>
<h3>18.1.8 Instalação</h3>

<p>
Digite <samp>apt-get install samba smbclient smbfs</samp> para instalar o
conjunto de aplicativos samba.  O pacote <code>samba</code> é o servidor samba
e os pacotes <code>smbclient</code> e <code>smbfs</code> fazem parte dos
aplicativos cliente.  Caso deseje apenas mapear compartilhamentos remotos na
máquina Linux, instale somente os 2 últimos pacotes.

<hr>

<a name="s-s-samba-rodando"></a>
<h3>18.1.9 Iniciando o servidor/reiniciando/recarregando a configuração</h3>

<p>
O servidor samba pode ser executado tanto via inetd como daemon:
<dl>
<dt>inetd</dt>
<dd>
No modo inetd, o servidor de nomes <em>nmbd</em> será carregado assim que for
feita a primeira requisição de pesquisa e ficará residente na memória.  No caso
de acesso a um compartilhamento, o <em>smbd</em> será carregado e lerá a
configuração em <code>smb.conf</code> a cada acesso do cliente a um
compartilhamento.  Quando o <code>samba</code> opera via inetd, ele não usa o
controle de acesso dos arquivos <code>hosts.allow</code> e
<code>hosts.deny</code>.  Veja <a href="#s-s-samba-a-restrip">Restringindo o
acesso por IP/rede, Seção 18.12.2</a> e <a
href="#s-s-samba-a-restrif">Restringindo o acesso por interface de rede, Seção
18.12.3</a> para detalhes de como fazer o controle de acesso.
<p>
Para reiniciar o samba digite <samp>killall -HUP nmbd</samp>.  Não é necessário
reiniciar o serviço <samp>smbd</samp>, conforme foi explicado acima.
</dd>
<dt>daemon</dt>
<dd>
Quando opera no modo <em>daemon</em>, ambos os daemons <code>nmbd</code> e
<code>smbd</code> são carregados.  No caso de um acesso a compartilhamento, é
criado um processo filho do <code>smbd</code> que é finalizado assim que o
compartilhamento não for mais usado.
<p>
Para iniciar o samba em modo <samp>daemon</samp> digite:
<samp>/etc/init.d/samba start</samp>, para interromper o samba:
<samp>/etc/init.d/samba stop</samp> e para reiniciar: <samp>/etc/init.d/samba
restart</samp>.
</dd>
</dl>

<p>
Se desejar mudar do modo <em>daemon</em> para <em>inetd</em> ou vice versa,
edite o arquivo <code>/etc/default/samba</code> e modifique o valor da linha
<samp>RUN_MODE=</samp> para <samp>daemons</samp> ou <samp>inetd</samp>.  Uma
forma de fazer isso automaticamente é executando o <samp>dpkg-reconfigure
samba</samp>.

<p>
<strong>OBS:</strong> Como praticamente não existe diferença entre os modos de
operação <em>inetd</em> e <em>daemon</em> para o <code>SAMBA</code>, é
aconselhável que execute sempre que possível via <em>inetd</em>, pois isto
garantirá uma disponibilidade maior do serviço caso algo aconteça com um dos
processos.

<hr>

<a name="s-s-samba-opcoescmd"></a>
<h3>18.1.10 Opções de linha de comando</h3>

<p>
Opções de linha de comando usadas pelo <code>nmbd</code>:
<dl>
<dt>-H [arquivo_lmhosts]</dt>
<dd>
Quando especificado, o servidor samba fará a procura de nomes primeiro neste
arquivo e depois usando a rede.
</dd>
<dt>-s [arquivo_cfg]</dt>
<dd>
Especifica uma nova localização para o arquivo de configuração do samba.  Por
padrão o <code>/etc/samba/smb.conf</code> é usado.
</dd>
<dt>-d [num]</dt>
<dd>
Especifica o nível de depuração do nmbd, que podem ir de 0 a 10.  O valor
padrão é 0.
</dd>
<dt>-l [diretório]</dt>
<dd>
Especifica a localização do diretório onde o nmbd gravará o arquivo de log
<code>log.nmbd</code>.  O valor padrão é <code>/var/log/samba</code>
</dd>
<dt>-n [nomeNetBIOS]</dt>
<dd>
Permite utilizar o nome NetBIOS especificado a invés do especificado no arquivo
<code>smb.conf</code> para identificar o computador na rede.
</dd>
</dl>

<hr>

<a name="s-s-samba-s"></a>
<h2>18.2 Conceitos gerais para a configuração do SAMBA</h2>

<p>
Este capítulo documenta como configurar o seu servidor <code>SAMBA</code>
permitindo o acesso a compartilhamento de arquivos e impressão no sistema.

<hr>

<a name="s-s-samba-nome"></a>
<h3>18.2.1 Nome de máquina (nome NetBios)</h3>

<p>
Toda a máquina em uma rede NetBEUI é identificada por um nome, este nome deve
ser único na rede e permite que outras máquinas acessem os recursos
disponibilizados ou que sejam enviadas mensagens para a máquina.  Este nome é
composto de 16 caracteres, sendo 15 que identificam a máquina e o último o tipo
de serviço que ela disponibiliza.  O tipo de serviço é associado com o nome da
máquina e registrado em servidores de nomes confirme a configuração da máquina
(você verá isto mais adiante).

<p>
O nome de máquina é especificado nas diretivas <em>netbios name</em> e
<em>netbios aliases</em> (veja <a href="#s-s-samba-s-global-nome">Nomes e
grupos de trabalho, Seção 18.2.8.1</a>) para detalhes.

<hr>

<a name="s-s-samba-workgroup"></a>
<h3>18.2.2 Grupo de trabalho</h3>

<p>
O grupo de trabalho organiza a estrutura de máquinas da rede em forma de
árvore, facilitando sua pesquisa e localização.  Tomemos como exemplo uma
empresa grande com os departamentos <samp>comunicação</samp>,
<samp>redes</samp>, <samp>web</samp>, <samp>rh</samp>, as máquinas que
pertencem ao grupo de <samp>redes</samp> serão agrupadas no programa de
navegação:

<pre>
     redes
       gleydson
       tecnico
       marcelo
       henrique
       michelle
     
     rh
       mrpaoduro
      
     web
       web1
       web2
       web3
     
     comunicacao
       comunic1
       comunic2
       comunic3
</pre>

<p>
A segurança no acesso a arquivos e diretórios na configuração de <em>grupo de
trabalho</em> é controlada pela própria máquina, normalmente usando segurança a
nível de compartilhamento.  Esta segurança funciona definindo um usuário/senha
para acessar cada compartilhamento que a máquina possui.  O <code>Lan
Manager</code>, <code>Windows for Workgroups</code>, <code>Windows 95</code>,
<code>Windows 98</code>, <code>XP Home Edition</code> usam este nível de acesso
por padrão.  Se deseja configurar uma rede usando o nível de grupo de trabalho,
veja <a href="#s-s-samba-wrkgrp">Configuração em <samp>Grupo de
Trabalho</samp>, Seção 18.4</a> para detalhes passo a passo e exemplos
práticos.

<p>
Os programas para navegação na rede NetBIOS são mostrados em <a
href="#s-s-samba-c-workgroup-linux-smbclient">smbclient, Seção 18.14.2.9.2</a>,
<a href="#s-s-samba-c-workgroup-linux-nmblookup">nmblookup, Seção
18.14.2.9.3</a> e <a href="#s-s-samba-c-graficos">Programas de navegação
gráficos, Seção 18.14.5</a>.

<hr>

<a name="s-s-samba-dominio"></a>
<h3>18.2.3 Domínio</h3>

<p>
O funcionamento é semelhante ao grupo de trabalho, com a diferença que a
segurança é controlada pela máquina central (PDC) usando diretivas de acesso e
grupos.  O PDC (Primary Domain Controller) deverá ter todas as contas de acesso
que serão utilizadas pelo usuário para acessar os recursos existentes em outras
máquinas, script de logon que poderá ser executado em cada máquina para fazer
ajustes, sincronismo, manutenção ou qualquer outra tarefa programada pelo
administrador do sistema.

<p>
Estas características para configuração de máquinas em domínio são documentadas
passo a passo em <a href="#s-s-samba-dom-intro">Uma breve introdução a um
Domínio de rede, Seção 18.7.1</a>.

<hr>

<a name="s-s-samba-compart"></a>
<h3>18.2.4 Compartilhamento</h3>

<p>
Um compartilhamento é um recurso da máquina local que é disponibilizado para
acesso via rede, que poderá ser <em>mapeada</em> (veja <a
href="#s-s-samba-mapeamento">Mapeamento, Seção 18.2.5</a>) por outra máquina.
O compartilhamento pode ser um diretório, arquivo, impressora.  Além de
permitir o acesso do usuário, o compartilhamento pode ser protegido por senha,
e ter controle de acesso de leitura/gravação, monitoração de acessos,
diretórios ocultos, autenticação via PDC (domínio) e outras formas para
restringir e garantir segurança na disponibilização dos dados (veja <a
href="#s-s-samba-a">Controle de acesso ao servidor SAMBA, Seção 18.12</a> para
aprender os métodos de como fazer isto).

<p>
Um compartilhamento no SAMBA pode ser acessível publicamente (sem senha) ou
estar rigidamente protegido tendo que passar por diversas barreiras para chegar
ao seu conteúdo, como senhas, endereço de origem, interfaces, usuário
autorizados, permissões de visualização, etc.

<p>
O guia <em>Foca Linux</em> abordará estes assuntos com detalhes e explicará
didaticamente como tornar seguro seu servidor samba e garantir um minucioso
controle de acesso a seus compartilhamentos.

<hr>

<a name="s-s-samba-mapeamento"></a>
<h3>18.2.5 Mapeamento</h3>

<p>
Mapear significa pegar um diretório/arquivo/impressora compartilhado por alguma
máquina da rede para ser acessada pela máquina local.  Para mapear algum
recurso de rede, é necessário que ele seja compartilhado na outra máquina (veja
<a href="#s-s-samba-compart">Compartilhamento, Seção 18.2.4</a>).  Por exemplo,
o diretório <code>/usr</code> <samp>compartilhado</samp> com o nome
<samp>usr</samp>, pode ser mapeado por uma máquina <code>Windows</code> como a
unidade <em>F:</em>, ou mapeado por uma máquina <code>Linux</code> no diretório
<code>/mnt/samba</code>.

<p>
O programa responsável por mapear unidades compartilhadas no <code>Linux</code>
é o <code>smbmount</code> e <code>smbclient</code> (veja <a
href="#s-s-samba-c-workgroup-linux">Linux, Seção 18.14.2.9</a>).

<hr>

<a name="s-s-samba-nmbd"></a>
<h3>18.2.6 Navegação na Rede e controle de domínio</h3>

<p>
Esta função é controlada pelo <code>nmbd</code> que fica ativo o tempo todo
disponibilizando os recursos da máquina na rede, participando de eleições
NetBIOS (<a href="#s-s-samba-s-oslevel">Níveis de sistema para eleição de rede,
Seção 18.2.12</a>), fazer logon de máquinas no domínio (<a
href="#s-s-samba-dom-intro">Uma breve introdução a um Domínio de rede, Seção
18.7.1</a>), etc.

<p>
A função de navegação na rede é feita utilizando o compartilhamento
<code>IPC$</code>.  Este compartilhamento possui acesso público somente leitura
e utiliza o usuário &quot;guest&quot; para disponibilização de seus.  Como deve
ter percebido, é necessário especificar esta ID de usuário através do parâmetro
<samp>guest account</samp> (<a href="#s-s-samba-s-a-param">Descrição de
parâmetros usados em compartilhamento, Seção 18.3.1</a>), ou a navegação de
recursos no sistema (ou na rede, dependendo da configuração do SAMBA) não
funcionará.

<p>
<strong>OBS:</strong> A função de navegação (browsing) poderá não funcionar
corretamente caso a máquina não consiga resolver nomes NetBIOS para endereços
IP.

<hr>

<a name="s-s-samba-arquivocfg"></a>
<h3>18.2.7 Arquivo de configuração do samba</h3>

<p>
Toda a configuração relacionada com nomes, grupo de trabalho, tipo de servidor,
log, compartilhamento de arquivos e impressão do <code>samba</code> é colocada
no arquivo de configuração <code>/etc/samba/smb.conf</code>.  Este arquivo é
dividido em <em>seções</em> e <em>parâmetros</em>.

<p>
Uma seção no arquivo de configuração do <code>samba</code>
(<code>smb.conf</code>) é definido por um nome entre &quot;[ ]&quot;.  As
seções tem o objetivo de organizar os parâmetros pra que tenham efeito somente
em algumas configurações de compartilhamento do servidor (exceto os da seção
<samp>[global]</samp> que não especificam compartilhamentos, mas suas diretivas
podem ser válidas para todas os compartilhamentos do arquivo de configuração).
Alguns nomes de seções foram reservados para configurações específicas do
<code>samba</code>, eles são os seguintes:
<dl>
<dt><samp>[global]</samp></dt>
<dd>
Define configurações que afetam o servidor samba como um todo, fazendo efeito
em todos os compartilhamentos existentes na máquina.  Por exemplo, o grupo de
trabalho, nome do servidor, página de código, restrições de acesso por nome,
etc.  Veja <a href="#s-s-samba-s-global">Seção <samp>[global]</samp>, Seção
18.2.8</a>.
</dd>
<dt><samp>[homes]</samp></dt>
<dd>
Especifica opções de acesso a diretórios homes de usuários.  O diretório home é
disponibilizado somente para seu dono, após se autenticar no sistema.  Veja <a
href="#s-s-samba-s-homes">Seção <samp>[homes]</samp>, Seção 18.2.9</a>.
</dd>
<dt><samp>[printers]</samp></dt>
<dd>
Define opções gerais para controle das impressoras do sistema.  Este
compartilhamento mapeia os nomes de todas as impressoras encontradas no
<code>/etc/printcap</code>.  Configurações especiais podem ser feitas
separadamente.  Veja <a href="#s-s-samba-s-printers">Seção
<samp>[printers]</samp>, Seção 18.2.10</a>.
</dd>
<dt><samp>[profile]</samp></dt>
<dd>
Define um perfil quando o servidor <code>samba</code> é usado como PDC de
domínio.  Veja <a href="#s-s-samba-dom-profiles">Configurando perfis de
usuários, Seção 18.7.8</a>.
</dd>
</dl>

<p>
Qualquer outro nome de [seção] no arquivo <code>smb.conf</code> que não sejam
as acima, são tratadas como um compartilhamento ou impressora.

<p>
Um <em>parâmetro</em> é definido no formato <em>nome = valor</em>.  Para um
exemplo prático, veja um exemplo de arquivo <code>smb.conf</code> em <a
href="#s-s-samba-exemplos">Exemplos de configuração do servidor SAMBA, Seção
18.15</a>.  Na configuração de booleanos, a seguinte sintaxe pode ser usada:
<ul>
<li>
<samp>0</samp> ou <samp>1</samp>
</li>
<li>
<samp>yes</samp> ou <samp>no</samp>
</li>
<li>
<samp>true</samp> ou <samp>false</samp>
</li>
</ul>

<p>
Assim, as seguintes configurações são equivalentes

<pre>
     master browse = 0
     master browse = no
     master browse = false
</pre>

<p>
Todos significam &quot;NÃO ser o navegador principal de domínio&quot;.  A
escolha fica a gosto do administrador.  Durante a configuração, você notará o
poder da flexibilidade oferecida pelo samba na configuração de um servidor SMB
:-)

<p>
Linhas iniciadas por <samp>#</samp> ou <samp>;</samp> são tratadas como
comentário.  Quebras de linha pode ser especificadas com uma <samp>\</samp> no
final da linha.

<hr>

<a name="s-s-samba-s-global"></a>
<h3>18.2.8 Seção <samp>[global]</samp></h3>

<p>
Os parâmetros especificados nesta seção tem efeito em todo o servidor
<code>samba</code> incluindo os compartilhamentos.  Caso o parâmetro seja
novamente especificado para o compartilhamento, o valor que valerá é o do
compartilhamento.

<p>
Por exemplo, se <samp>guest user = nobody</samp> for usado na seção
<em>[global]</em> e o <samp>guest user = foca</samp> for usado no
compartilhamento <samp>[focalinux]</samp>, o usuário que fará acesso público a
todos os compartilhamentos do servidor será o <samp>nobody</samp>, exceto para
o compartilhamento <samp>[focalinux]</samp>, que será feito pelo usuário
<samp>foca</samp>.  Veja <a href="#s-s-samba-s-a">Compartilhamento de arquivos
e diretórios, Seção 18.3</a> para obter uma lista e descrição dos principais
parâmetros de compartilhamentos existentes.  Uma lista completa pode ser obtida
na página de manual do <code>smb.conf</code>.

<p>
Irei descrever alguns parâmetros utilizados nesta seção, organizado de forma
didática e simplificada.

<hr>

<a name="s-s-samba-s-global-nome"></a>
<h4>18.2.8.1 Nomes e grupos de trabalho</h4>

<dl>
<dt>netbios name = [nome do servidor]</dt>
<dd>
Especifica o nome NetBIOS primário do servidor samba.  Caso não seja ajustado,
ele usará o hostname de sua máquina como valor padrão.
<p>
Ex.: <samp>netbios name = focasamba</samp>.
</dd>
<dt>workgroup = [grupo de trabalho/domínio]</dt>
<dd>
Diz qual o nome do grupo de trabalho/domínio que a máquina samba pertencerá.
<p>
Ex.: <samp>workgroup = focalinux</samp>.
</dd>
<dt>netbios aliases = [nomes alternativos ao sistema]</dt>
<dd>
Permite o uso de nomes alternativos ao servidor, separados por espaços.
<p>
Ex.: <samp>teste1 teste2</samp>.
</dd>
<dt>server string = [identificação]</dt>
<dd>
Identificação enviada do servidor samba para o ambiente de rede.  A string
padrão é <samp>Samba %v</samp> (%v é substituída pela versão do samba, para
maiores detalhes, veja <a href="#s-s-samba-s-varsubst">Variáveis de
substituição, Seção 18.2.13</a>).
<p>
Ex: <samp>server string = Servidor Samba versão %v</samp>.
</dd>
<dt>name resolve order = [ordem]</dt>
<dd>
Define a ordem de pesquisa para a resolução de nomes no samba.  A ordem padrão
é: <samp>lmhosts host wins bcast</samp>, que é a melhor para resolução rápida e
que tente gerar menos tráfego broadcast possível.  Veja <a
href="#s-s-samba-s-nameresolv">Resolução de nomes de máquinas no samba, Seção
18.5</a> para uma explicação mais detalhada.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-carac"></a>
<h4>18.2.8.2 Caracteres e página de código</h4>

<p>
Uma das partes essenciais após colocar o <code>SAMBA</code> em funcionamento, é
configurar a página de código para que os caracteres sejam gravados e exibidos
corretamente no cliente.  A primeira coisa que precisa verificar é se seu
kernel possui o suporte a página de código local.  Caso não tenha, baixe o
fonte do kernel e siga os seguintes passos na configuração:
<ul>
<li>
Dentro da opção &quot;File Systems&quot;, &quot;Network File Systems&quot;
defina como &quot;Default Remote NLS Option&quot; a iso8859-1.  Esta opção
permite ao <code>smbmount</code> montar os volumes locais usando os caracteres
corretos.
</li>
<li>
Entre na opção &quot;File Systems&quot;, &quot;Native Language Support&quot;.
Na opção &quot;Default NLS Option&quot; coloque &quot;iso8859-1&quot;.  Ative
também o suporte as páginas de código 437, 850 e 860 e também ao conjunto de
caracteres iso8859-1 e UTF8.
</li>
</ul>

<p>
Note que esta ordem pode variar dependendo da versão do seu kernel, basta que
as entenda para fazer as modificações apropriadas.
<dl>
<dt>character set = [conjunto_caracteres]</dt>
<dd>
Seleciona o conjunto de caracteres dos arquivos exibidos pelo servidor samba.
Para os idiomas de língua latina, sempre utilize iso8859-1.
<p>
Ex.: <samp>character set = iso8859-1</samp>.
</dd>
<dt>client code page = [pagina_de_codigo]</dt>
<dd>
Seleciona a página de código do servidor samba para tratar os caracteres.  Para
os idiomas de língua latina, sempre utilize 850.
<p>
Ex.: <samp>client code page = 850</samp>.
</dd>
<dt>preserve case =</dt>
<dd>
Seleciona se arquivos com nomes extensos criados serão criados com os
caracteres em maiúsculas/minúsculas definidos pelo cliente (no) ou se será
usado o valor de <em>default case</em> (caso seja especificado
<samp>yes</samp>).
</dd>
<dt>short preserve case =</dt>
<dd>
Seleciona se os arquivos com nomes curtos (formato 8.3) serão criados com os
caracteres mixtos enviados pelo cliente (no) ou se será usando o valor de
<em>default case</em> (caso seja especificado <samp>yes</samp>).
</dd>
<dt>default case = [lower/upper]</dt>
<dd>
Define se os arquivos criados terão seus nomes todos em minúsculas (lower) ou
maiúsculas (upper).
</dd>
<dt>valid chars = [caracteres]</dt>
<dd>
Define caracteres válidos nos nomes de arquivos: <samp>valid chars =á:Á é:É í:Í
ó:Ó ú:Ú â:Â ê:Ê ô:Ô ã:Ã õ:Õ à:À ò:Ò</samp>.  Este parâmetro
<strong>DEVERÁ</strong> ser sempre especificado depois do <samp>client code
page</samp>, pois caso contrário, eles serão substituídos por estes.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-restrusu"></a>
<h4>18.2.8.3 Restrições de acesso/mapeamento de usuários</h4>

<dl>
<dt><samp>guest account = [conta]</samp></dt>
<dd>
Define a conta local de usuário que será mapeada quando um usuário se conectar
sem senha (usuário guest).  Veja mais detalhes em <a
href="#s-s-samba-s-a-param">Descrição de parâmetros usados em compartilhamento,
Seção 18.3.1</a>.
</dd>
<dt><samp>invalid users</samp></dt>
<dd>
Define uma lista de usuários que não terão acesso aos recursos do servidor ou
compartilhamento.  É seguro restringir o acesso samba a usuários com grande
poder no sistema (como o <samp>root</samp>).  Veja mais detalhes em <a
href="#s-s-samba-a-restrusu">Restringindo o acesso por usuários, Seção
18.12.4</a>.
</dd>
<dt><samp>valid users</samp></dt>
<dd>
Semelhante a opção <samp>invalid users</samp> mas permite que somente os
usuários especificados tenham acesso ao sistema.  Veja mais detalhes em <a
href="#s-s-samba-a-restrusu">Restringindo o acesso por usuários, Seção
18.12.4</a>.
</dd>
<dt><samp>default service = nome</samp></dt>
<dd>
Caso o serviço que o usuário deseja se conectar não for encontrado no servidor,
o SAMBA mapeará o serviço especificado nesta diretiva como alternativa.  A
variável &quot;%S&quot; e o caracter &quot;_&quot; podem ser interessantes em
algumas alternativas de configuração.  A opção <samp>default</samp> é um
sinônimo para esta opção.  Caso utilize esta opção, crie o compartilhamento em
modo somente leitura e com acesso público, caso contrário (dependendo do
planejamento de partições e segurança do sistema de arquivos) a máquina poderá
ser derrubada sem dificuldades.
</dd>
<dt><samp>username map = [arquivo]</samp></dt>
<dd>
Especifica um arquivo que faz o mapeamento entre nomes fornecidos por clientes
e nomes de contas Unix locais.  Veja <a
href="#s-s-samba-a-usernamemap">Mapeamento de nomes de usuários, Seção
18.12.16</a> para mais detalhes de como configurar este recurso.
</dd>
<dt>obey pam restrictions = yes</dt>
<dd>
Indica se as restrições do usuário nos módulos PAM terão efeito também no
SAMBA.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-nivelauth"></a>
<h4>18.2.8.4 Níveis de autenticação</h4>

<p>
(esta seção contém algumas explicações que dependem do resto do conteúdo do
guia, caso não entenda de imediato a fundo as explicações, recomendo que a leia
novamente mais tarde).
<dl>
<dt></dt>
<dd>
Define o nível de segurança do servidor.  Os seguintes valores são válidos:
<ul>
<li>
<samp>share</samp> - Usada principalmente quando apenas a senha é enviada por
compartilhamento acessado para o servidor, caso muito típico em sistemas
<code>Lan Manager</code> e <code>Windows for Workgroups</code>.
<p>
Mesmo assim o samba tenta mapear para um UID de usuário local do sistema usando
os seguintes métodos (retirado da página de manual do samba):
<ol type="1" start="1" >
<li>
Se o parâmetro <samp>guest only</samp> é usado no compartilhamento junto com o
<samp>guest ok</samp>, o acesso é imediatamente permitido, sem verificar
inclusive a senha.
</li>
<li>
Caso um nome de usuário seja enviado junto com a senha, ele é utilizado para
mapear o UID e aplicar as permissões deste usuário (como acontece no nível de
segurança <em>user</em>).
</li>
<li>
Se ele usou um nome para fazer o logon no <code>Windows</code> este nome será
usado como usuário local do SAMBA.  Caso ele seja diferente, você deverá usar o
mapeamento de nomes para associar o nome remoto do nome local (veja <a
href="#s-s-samba-a-usernamemap">Mapeamento de nomes de usuários, Seção
18.12.16</a>)
</li>
<li>
O nome do serviço é tentado como nome de usuário.
</li>
<li>
O nome da máquina NetBios é tentada como nome de usuário
</li>
<li>
Os usuários especificados na opção <samp>user</samp> do compartilhamentos são
utilizados (veja <a href="#s-s-samba-s-a-param">Descrição de parâmetros usados
em compartilhamento, Seção 18.3.1</a>).
</li>
<li>
Caso nenhum destes métodos acima for satisfeito, o acesso é NEGADO.
</li>
</ol>
<p>
Hoje em dia, o uso do nível de acesso <samp>share</samp> é raramente usado,
porque todos os sistemas a partir do <code>Windows 95</code> e acima enviam o
nome de usuário ao acessar um compartilhamento (caindo na segunda checagem do
nível <em>share</em>), sendo equivalente a usar o nível <em>user</em>.
Entretanto, o nível de segurança <em>share</em> é recomendado para servidores
onde TODO o conteúdo deve ter acesso público (seja leitura ou gravação) e o
parâmetro <samp>guest shares</samp> também funciona nativamente.
<p>
As senhas criptografadas (<samp>encrypt passwords = 1</samp>)
<strong>NÃO</strong> funcionarão no nível <em>share</em>, lembre-se deste
detalhe.
</li>
<li>
<samp>user</samp> - Este é o padrão.  O usuário precisa ter uma conta de
usuário no <code>Linux</code> para acessar seus compartilhamentos.  A mesma
conta de usuário/senha deverá ser usada no <code>Windows</code> para acessar
seus recursos ou realizado um mapeamento de nomes de usuários (veja <a
href="#s-s-samba-a-usernamemap">Mapeamento de nomes de usuários, Seção
18.12.16</a>).  Este é o padrão do SAMBA.  No nível de acesso <em>user</em> o
usuário precisa ser autenticado de qualquer forma, inclusive se for usado o
parâmetro <samp>guest only</samp> ou <samp>user</samp>.  Os seguintes passos
são usados para autorizar uma conexão usando o nível <em>user</em> (retirado da
documentação do SAMBA):
<ul>
<li>
É tentada a validação usando o nome/senha passados pelo cliente.  Se tudo
estiver OK, a conexão é permitida.
</li>
<li>
Caso já tenha se autenticado anteriormente para acessar o recurso e forneceu a
senha correta, o acesso é permitido.
</li>
<li>
O nome NetBIOS da máquina do cliente e qualquer nome de usuário que foi usado é
novamente tentado junto com a senha para tentar permitir o acesso ao recurso
compartilhado.
</li>
<li>
Caso o cliente tenha validado o nome/senha com o servidor e o cliente enviou
novamente o token de validação, este nome de usuário é usado.
</li>
<li>
É tentada a checagem com o parâmetro <em>user</em> no compartilhamento (veja <a
href="#s-s-samba-s-a-param">Descrição de parâmetros usados em compartilhamento,
Seção 18.3.1</a>.
</li>
<li>
É verificado se o serviço é público, então a conexão é feita usando o usuário
<samp>guest account</samp> e ignorando a senha (veja <a
href="#s-s-samba-a-publico">Criando um compartilhamento para acesso sem senha,
Seção 18.12.7</a>).
</li>
</ul>
</li>
<li>
<samp>domain</samp> - Neste nível, o acesso só será permitido quando a máquina
for adicionada ao domínio com o <code>smbpasswd</code> (<a
href="#s-s-samba-c-dominio-linux">Linux, Seção 18.14.3.9</a>).  Neste nível de
acesso, a conta de usuário será validada em um servidor PDC (controlador de
domínio) e o acesso aos recursos das máquinas que fazem parte do domínio será
feito a partir do PDC.  Veja <a href="#s-s-samba-c-dominio-linux">Linux, Seção
18.14.3.9</a> para detalhes.
</li>
<li>
<samp>server</samp> - A máquina samba tentara autenticar o usuário em outro
servidor NT (ou samba).  No caso da autenticação falhar, será usado o nível de
acesso <em>user</em> na base de usuários local (será necessário o arquivo de
senhas criptografado do samba para que a autenticação local funcione, veja <a
href="#s-s-samba-senhas-crypto">Ativando o suporte a senhas criptografadas,
Seção 18.8</a>).  Este nível é bastante usado quando configuramos um servidor
de perfis de usuários ou logon separado do PDC.
</li>
</ul>
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-log"></a>
<h4>18.2.8.5 Log de acessos/serviços</h4>

<dl>
<dt>log file= [arquivo]</dt>
<dd>
Define a localização e nome do arquivo de log gerado pelo samba.  As variáveis
de expansão podem ser usadas caso o administrador queira ter um melhor controle
dos logs gerados (veja <a href="#s-s-samba-s-varsubst">Variáveis de
substituição, Seção 18.2.13</a>).
<p>
Ex.: <samp>/var/log/samba/samba-log-%m</samp>.
<p>
<strong>OBS:</strong> Se possível coloque uma extensão no arquivo de log gerado
pelo <code>SAMBA</code> (como <code>.log</code>).  O motivo disto é porque se
estes logs forem rotacionados pelo <code>logrotate</code> você terá problemas
de recompactação múltiplas caso utilize um coringa <code>samba-log-*</code>,
gerando arquivos como <code>.gz.gz.gz..</code>, lotando a tabela de arquivos do
diretório e deixando sua máquina em um loop de compactação.
</dd>
<dt>max log size = [tamanho]</dt>
<dd>
Especifica o tamanho máximo em Kb do arquivo de log gerado pelo samba.  O valor
padrão é 5000Kb (5MB).
</dd>
<dt>debug pid = [valor]</dt>
<dd>
Este processo adiciona a pid aos logs gerados pelo processo <code>smbd</code>
Isto é útil para depuração caso existam múltiplos processos rodando.  O valor
padrão é <em>no</em> e a opção <em>debug timestamp</em> deve ser
<samp>yes</samp> para esta opção ter efeito.
</dd>
<dt>debug timestamp = [valor]</dt>
<dd>
Ativa ou desativa a gravação de data/hora nos arquivos de log gerados pelo
samba.  O valor padrão é <samp>yes</samp>.
</dd>
<dt>debug level = [valor]</dt>
<dd>
Aumenta o nível de depuração dos daemons do SAMBA de <samp>0</samp> a
<samp>9</samp>.  Um nível de depuração interessante e que produz uma quantidade
razoável de dados para configuração de um <code>logrotate</code> só para o
SAMBA é o <samp>2</samp>, produzindo a lista de todos os compartilhamentos
acessados, quem acessou, data/hora (dependendo das outras opções de depuração).
Isto permite ao administrador saber exatamente o que está sendo acessado e por
quem, quais as tentativas de acesso.  Assim terá certeza que o conteúdo não
está sendo acessado indevidamente.  O nível de depuração <samp>0</samp> é o
padrão.
</dd>
<dt>debug uid = [valor]</dt>
<dd>
Este parâmetro inclui o euid, egid, uid, gid nos arquivos de log.  O valor
padrão é <samp>no</samp>.
</dd>
<dt>lock directory = [diretório]</dt>
<dd>
Define onde serão gravados os arquivos de lock gerados pelo samba.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-browsing"></a>
<h4>18.2.8.6 Navegação no servidor/tipo de servidor</h4>

<dl>
<dt>os level=[num]</dt>
<dd>
Especifica o nível do sistema operacional.  Este número é usado para as
eleições netbios para definir o navegador de grupo local e controlador de
domínio (veja <a href="#s-s-samba-s-oslevel">Níveis de sistema para eleição de
rede, Seção 18.2.12</a> para detalhes).  O valor pode ser de 0 a 255, o padrão
é 32.
</dd>
<dt>announce as = [sistema]</dt>
<dd>
Selecione o nome que o <code>samba</code> (<code>nmbd</code>) se anunciará na
lista de pesquisa de rede.  Os seguintes nomes podem ser usados:
<ul>
<li>
<samp>NT Server (ou NT)</samp> - Anuncia como <em>Windows NT Server</em>.  Este
é o padrão.
</li>
<li>
<samp>NT Workstation</samp> - Anuncia-se como um <em>NT Workstation</em>.
</li>
<li>
<samp>Win95 ou WfW</samp> - Anuncia-se na rede como uma estação <em>Windows
9x</em>, <em>Windows for Workgroups</em>, <em>Windows NT Server</em> e
<em>Windows NT Workstation</em> de uma só vez.
</li>
</ul>
</dd>
<dt>domain master = [valor]</dt>
<dd>
Diz se o servidor tentará se tornar o navegador principal de domínio.  Os
valores que podem ser especificados são: <samp>yes, no e auto</samp>.  O valor
padrão é <samp>auto</samp>.  Veja <a href="#s-s-samba-dom-dmbrowser">Domain
Master Browser, Seção 18.7.3</a>.
</dd>
<dt>local master = [valor]</dt>
<dd>
Diz se o servidor participará ou não das eleições para navegador local do grupo
de trabalho (workgroup).  Os valores que podem ser especificados são:
<samp>yes, no</samp>.  O valor padrão é <samp>yes</samp>.  Para vencer a
eleição, o samba precisa ter o valor de <samp>os level</samp> maior que os
demais.
<p>
Note também que o Windows NT não aceita perder as eleições e convoca uma nova
eleição caso ele perca.  Como esta eleição é feita via broadcasting, isso gera
um tráfego grande na rede.  Desta forma, se tiver um computador NT na rede
configure este valor para &quot;no&quot;.  Veja <a
href="#s-s-samba-dom-lmbrowser">Local Master Browser, Seção 18.7.2</a>.
</dd>
<dt>preferred master = [valor]</dt>
<dd>
Diz se o servidor samba terá ou não vantagens de ganhar uma eleição local.  Se
estiver configurado para &quot;yes&quot;, o servidor samba pedirá uma eleição e
terá vantagens para ganha-la.  O servidor poderá se tornar garantidamente o
<em>navegador principal do domínio</em> se esta opção for usada em conjunto com
<em>domain master = 1</em>.  Os valores especificados podem ser <samp>yes, no e
auto</samp>, o padrão é <samp>auto</samp>.
<p>
Antes de ajustar este valor para <samp>yes</samp>, verifique se existem outros
servidores NetBIOS em sua rede que tem preferência para se tornar o master
principal, pois poderá ocorrer um tráfego alto de broadcasting causado pelas
eleições solicitadas pelas outras máquinas.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-global-outras"></a>
<h4>18.2.8.7 Outros parâmetros de configuração</h4>

<dl>
<dt><samp>include</samp></dt>
<dd>
Inclui um outro arquivo de configuração na porção atual do arquivo de
configuração.  Você pode utilizar variáveis de substituição, exceto
<samp>%u</samp>, <samp>%P</samp> e <samp>%S</samp> (veja <a
href="#s-s-samba-s-varsubst">Variáveis de substituição, Seção 18.2.13</a>).
</dd>
</dl>

<hr>

<a name="s-s-samba-s-homes"></a>
<h3>18.2.9 Seção <samp>[homes]</samp></h3>

<p>
Esta seção tem a função especial de disponibilizar o diretório home do usuário.
Quando o usuário envia seu nome de login como compartilhamento é feita uma
busca no arquivo <code>smb.conf</code> procurando por um nome de
compartilhamento que confira.  Caso nenhum seja encontrado, é feita uma busca
por um nome de usuário correspondente no arquivo <code>/etc/passwd</code>, se
um nome conferir e a senha enviada também, o diretório de usuário é
disponibilizado como um compartilhamento com o mesmo nome do usuário local.  O
diretório home do usuário poderá ser modificado com o uso de mapeamento de
nomes, veja <a href="#s-s-samba-a-usernamemap">Mapeamento de nomes de usuários,
Seção 18.12.16</a>.  Quando o caminho do compartilhamento não for especificado,
o SAMBA utilizará o diretório home do usuário (no <code>/etc/passwd</code>).

<p>
Para maior segurança da instalação, principalmente porque o diretório home do
usuário não é um requerimento para a autenticação de usuário, recomendo usar a
variável de substituição <samp>%S</samp> apontando para um diretório com as
permissões apropriadas configuradas em seu sistema, por exemplo:

<pre>
      [homes]
       comment = Diretórios de Usuários
       path=/pub/usuarios/%S
</pre>

<p>
Você apenas terá o trabalho extra de criar os diretórios de usuários que farão
acesso ao sistema.  Isto não será nenhum problema após você programar um shell
script simples que verifique os nomes de contas em <code>/etc/passwd</code> e
crie os diretórios com as permissões/grupos adequados (isso não será abordado
por este capítulo do guia, embora não seja complicado).  Se deseja, existem
exemplos em <a href="#s-s-samba-exemplos">Exemplos de configuração do servidor
SAMBA, Seção 18.15</a> sobre a seção <em>[homes]</em> no arquivo de
configuração.

<p>
Os parâmetros aceitos em <em>[homes]</em> aqui são os mesmos usados para
compartilhamentos normais (veja <a href="#s-s-samba-s-a-param">Descrição de
parâmetros usados em compartilhamento, Seção 18.3.1</a>).  Abaixo segue mais um
exemplo de seção <em>[homes]</em>:

<pre>
     [homes] 
     comment = Diretório home de usuários
     writable = yes
     public = no
     invalid users = root nobody @adm
     follow symlinks = no
     create mode = 0640
     directory mode = 0750
</pre>

<p>
A explicação de cada um dos parâmetros podem ser encontradas em <a
href="#s-s-samba-s-a-param">Descrição de parâmetros usados em compartilhamento,
Seção 18.3.1</a>.  O guia está com os parâmetros bem organizados em seções
específicas, apenas de uma olhada para entender com o capítulo do SAMBA foi
organizado e não terá dificuldades de se localizar.

<p>
<strong>OBS1:</strong>Caso nenhum caminho de compartilhamento seja utilizado, o
diretório home do usuário será compartilhado.

<p>
<strong>OBS2:</strong>Não utilize o parâmetro <em>public yes</em> na seção
guest, caso contrário todos os diretórios de usuários serão lidos por todos.
Veja <a href="#s-s-samba-a-public-access">Considerações de segurança com o uso
do parâmetro &quot;public = yes&quot;, Seção 18.12.14</a> para maiores
detalhes.

<hr>

<a name="s-s-samba-s-printers"></a>
<h3>18.2.10 Seção <samp>[printers]</samp></h3>

<p>
Esta seção tem a função de disponibilizar as impressoras existentes no sistema
(lp, lp1, lp2, etc) existentes no <code>/etc/printcap</code> como
compartilhamento de sistemas Windows.  O método que os nomes de impressoras são
pesquisados é idêntico a forma feita para a seção <em>[homes]</em>: Primeiro o
nome do compartilhamento é pesquisado como um nome de serviço, depois se ele é
um nome de usuário (tentando mapear o serviço disponibilizado em [homes]),
depois será verificado a seção <em>[printers]</em>.

<p>
Ao invés de usar este recurso, se preferir você poderá compartilhar as
impressoras individualmente.  Para detalhes, veja <a
href="#s-s-samba-i-win-linux">Configurando o Linux como um servidor de
impressão Windows, Seção 18.11.1</a>.

<p>
<strong>OBS:</strong>É importante lembrar que a seção <em>[printers]</em>
<strong>DEVE</strong> ser definida como <samp>printable</samp> usando o
parâmetro <em>printable = yes</em> para funcionar.  O utilitário
<code>testparm</code> poderá ser usado para verificar problemas no arquivo cd
configuração do SAMBA (veja <a href="#s-s-samba-s-testparm">Buscando problemas
na configuração, Seção 18.2.11</a>).

<hr>

<a name="s-s-samba-s-testparm"></a>
<h3>18.2.11 Buscando problemas na configuração</h3>

<p>
Durante o processo de configuração do SAMBA, é comum cometer erros de
digitação, usar parâmetros em lugares indevidos, etc.  É recomendável o uso do
<code>testparm</code> para checar a configuração do SAMBA sempre que houver
modificações para ter certeza nada comprometa o funcionamento que planejou para
sua máquina.

<p>
Para usar o <code>testparm</code> é só digitar <samp>testparm</samp>.  Logo
após executa-lo, analise se existem erros nas seções de configuração e te
pedirá para pressionar &lt;ENTER&gt; para ver um dump do arquivo:

<pre>
     Load smb config files from /etc/samba/smb.conf
     Processing section &quot;[homes]&quot;
     Processing section &quot;[printers]&quot;
     Processing section &quot;[tmp]&quot;
     Processing section &quot;[cdrom]&quot;
     Loaded services file OK.
     Press enter to see a dump of your service definitions
</pre>

<p>
A saída acima indica que está tudo OK com todas as configurações que foram
realizadas no servidor.  É possível especificar um outro arquivo de
configuração do SAMBA usando <samp>testparm /etc/samba/smb2.conf</samp>.

<p>
Também é permitido simular o nome NetBIOS que fará acesso a máquina usando o
parâmetro <samp>-L nome</samp> (que será substituído na variável
<var>%L</var>).

<hr>

<a name="s-s-samba-s-oslevel"></a>
<h3>18.2.12 Níveis de sistema para eleição de rede</h3>

<p>
Para selecionar qual sistema NetBIOS será o local master browse ou domain
master browse, é usado um método bastante interessante: o de eleições.

<p>
Quando uma nova máquina entra na rede NetBIOS, ela solicita quem é o Local
Master Browser, caso nenhuma responda, ela força uma eleição na rede através de
uma requisição Broadcasting especial.  Vence a eleição quem tiver o ***maior
número***, chamado de OS Level (nível de sistema operacional).  Caso duas
máquinas empatem, o desempate é feito usando outros critérios.

<p>
Se você for a única máquina de um workgroup, automaticamente você será o Local
Master Browser.  De meia em meia hora uma nova eleição é feita, forçando mais
tráfego broadcasting na rede.  Durante este novo processo de eleição, a lista
de computadores é atualizada; as novas máquinas são adicionadas e as desligadas
saem da lista após 36 minutos.  Este é o motivo porque as máquinas Windows
continuam aparecendo no ambiente de rede por algum tempo mesmo depois que
desligadas ou porque elas não aparecem de imediato.

<p>
O OS Level é um número que é característico de cada sistema operacional ficando
entre 0 (mais baixo) e 255.  Os níveis de acessos dos sistemas operacionais são
os seguintes:

<pre>
     Windows for Workgroups                         1
     Windows 95                                     1
     Windows 98                                     2
     Windows 98 Second Edition                      2
     
     
     Windows 2000 Server (standalone)               16
     Windows 2000 Professional                      16
     Windows NT 4.0 Wks                             17
     Windows NT 3.51 Wks                            16
     
     
     Windows NT 3.51 Server                         32
     Windows NT 4.0 Server                          33
     Windows 2000 Server (Domain Controller)        32
     
     SAMBA                                          32
</pre>

<p>
O valor padrão do OS Level do SAMBA é 32, entretanto ele é bastante flexível
para permitir sua mudança através do parâmetro &quot;os level&quot; (veja <a
href="#s-s-samba-s-global-browsing">Navegação no servidor/tipo de servidor,
Seção 18.2.8.6</a>), isto garante que o SAMBA sempre vença as eleições da rede
sobre qualquer outro sistema operacional.

<p>
No caso de um servidor que estiver configurado para ser o navegador de rede,
assim que for iniciado ele solicitará uma eleição de rede.  As regras são as
mesmas, vence o que tiver o *maior* número.  Este número pode ser configurado
facilmente no SAMBA para que ele sempre vença as eleições de rede, tomando
conta da lista de máquinas.  Isto é especialmente interessante por causa da
estabilidade do servidor <code>Linux</code>, quando migramos de servidor NT ou
para fornecer mais serviços de navegação, como servidor WINS.

<p>
<strong>OBS</strong>: Nunca deixe um servidor NT configurado para ser o Local
Browser ou Domain Master Browser competir com o SAMBA.  Mesmo que o SAMBA
ganhe, o NT é um péssimo perdedor e convoca uma nova eleição para tentar
novamente se eleger, gerando um *extremo* tráfego broadcasting em redes
grandes.

<hr>

<a name="s-s-samba-s-varsubst"></a>
<h3>18.2.13 Variáveis de substituição</h3>

<p>
Esta seção foi baseada nos dados da página de manual do samba, com adições que
não estavam presentes na versão original e exemplos.  Existem variáveis
especiais que podem ser usadas no arquivo de configuração do samba e são
substituídas por parâmetros especiais no momento da conexão do usuário.  Um
exemplo de utilização de variáveis de substituição seria mudar a localização do
diretório home do usuário:

<pre>
     [homes]
      comment = Diretório home do usuário
      path = /home/usuarios/%u
</pre>

<p>
Cada uma das variáveis são descritas em detalhes abaixo:
<dl>
<dt>%S</dt>
<dd>
O nome do serviço atual, se existir.  Seu uso é interessante, principalmente no
uso de diretórios homes.
</dd>
</dl>
<dl>
<dt>%P</dt>
<dd>
O diretório raíz do serviço atual, se existir.
</dd>
</dl>
<dl>
<dt>%u</dt>
<dd>
O nome de usuário do serviço atual, se aplicável.  Esta variável é bastante
útil para programação de scripts e também para criar arquivos de log
personalizados, etc.
</dd>
</dl>
<dl>
<dt>%g</dt>
<dd>
O grupo primário do usuário %u.
</dd>
</dl>
<dl>
<dt>%U</dt>
<dd>
O nome de usuário da seção (o nome de usuário solicitado pelo cliente, não é
uma regra que ele será sempre o mesmo que ele recebeu).
</dd>
</dl>
<dl>
<dt>%G</dt>
<dd>
O nome do grupo primário de %U.
</dd>
</dl>
<dl>
<dt>%H</dt>
<dd>
O diretório home do usuário, de acordo com %u.
</dd>
</dl>
<dl>
<dt>%v</dt>
<dd>
A versão do Samba.
</dd>
</dl>
<dl>
<dt>%h</dt>
<dd>
O nome DNS da máquina que está executando o Samba.
</dd>
</dl>
<dl>
<dt>%m</dt>
<dd>
O nome NetBIOS da máquina do cliente.  Isto é muito útil para log de conexões
personalizados e outras coisas úteis.
</dd>
</dl>
<dl>
<dt>%L</dt>
<dd>
O nome NetBIOS do servidor.  Como o servidor pode usar mais de um nome no samba
(aliases), você poderá saber com qual nome o seu servidor está sendo acessado e
possivelmente torna-lo o nome primário de sua máquina.
</dd>
</dl>
<dl>
<dt>%M</dt>
<dd>
O nome DNS da máquina cliente.
</dd>
</dl>
<dl>
<dt>%N</dt>
<dd>
O nome do seu servidor de diretórios home NIS.  Este parâmetro é obtido de uma
entrada no seu arquivo auto.map.  Se não tiver compilado o SAMBA com a opção
<samp>--with-automount</samp> então este valor será o mesmo de %L.
</dd>
</dl>
<dl>
<dt>%p</dt>
<dd>
O caminho do diretório home do serviço, obtido de uma entrada mapeada no
arquivo <code>auto.map</code> do NIS.  A entrada NIS do arquivo
<code>auto.map</code> é dividida na forma &quot;%N:%p&quot;.
</dd>
</dl>
<dl>
<dt>%R</dt>
<dd>
O nível de protocolo selecionado após a negociação.  O valor retornado pode ser
CORE, COREPLUS, LANMAN1, LANMAN2 ou NT1.
</dd>
</dl>
<dl>
<dt>%d</dt>
<dd>
A identificação de processo do processo atual do servidor.
</dd>
</dl>
<dl>
<dt>%a</dt>
<dd>
A arquitetura da máquina remota.  Somente algumas são reconhecidas e a resposta
pode não ser totalmente confiável.  O <code>samba</code> atualmente reconhece
<em>Samba</em>, <em>Windows for Workgroups</em>, <em>Windows 95</em>,
<em>Windows NT</em> e <em>Windows 2000</em>.  Qualquer outra coisa será
mostrado como &quot;UNKNOWN&quot; (<em>desconhecido</em>).
</dd>
</dl>
<dl>
<dt>%I</dt>
<dd>
O endereço IP da máquina do cliente.
</dd>
</dl>
<dl>
<dt>%T</dt>
<dd>
A data e hora atual.
</dd>
</dl>
<dl>
<dt>%$(var_ambiente)</dt>
<dd>
Retorna o valor da <em>variável de ambiente</em> especificada.
</dd>
</dl>

<hr>

<a name="s-s-samba-s-a"></a>
<h2>18.3 Compartilhamento de arquivos e diretórios</h2>

<p>
Esta seção documenta como disponibilizar arquivos e impressoras com o SAMBA e
os parâmetros usados para realizar restrições de compartilhamento, modo que os
dados serão disponibilizados e ítens de performance.  A maior parte destes
parâmetros são empregados em serviços do SAMBA, mas nada impede que também
sejam colocado na seção <em>[global]</em> do arquivo de configuração,
principalmente quando isto é válido para diversos serviços compartilhados (veja
<a href="#s-s-samba-s-global">Seção <samp>[global]</samp>, Seção 18.2.8</a>).

<hr>

<a name="s-s-samba-s-a-param"></a>
<h3>18.3.1 Descrição de parâmetros usados em compartilhamento</h3>

<p>
Abaixo o guia traz algumas das opções que podem ser usadas para controlar o
comportamento do compartilhamento de arquivos por <em>serviços</em> no servidor
SAMBA:
<dl>
<dt>path</dt>
<dd>
Indica o diretório que será compartilhado.  Lembre-se que o usuário terá as
permissões de acesso que ele teria caso estivesse logado no sistema como um
usuário UNIX normal, exceto se estiver fazendo mapeamento para outros nomes de
usuários (veja <a href="#s-s-samba-a-usernamemap">Mapeamento de nomes de
usuários, Seção 18.12.16</a>).
<p>
Ex: <samp>path=/pub</samp> - Compartilha o diretório local <code>/pub</code>.
<p>
<strong>OBS:</strong> Quando não é definido um <samp>path</samp>, o diretório
<code>/tmp</code> é usado como padrão.
</dd>
<dt>comment</dt>
<dd>
Descrição do compartilhamento que será mostrada na janela de procura de rede ou
no <samp>smbclient -L maquina</samp>.
<p>
Ex: <samp>comment=Pasta de conteúdo público do sistema</samp>.
</dd>
<dt>browseable</dt>
<dd>
Define se o compartilhamento será ou não exibido na janela de procura de rede.
Mesmo não sendo exibido, o compartilhamento poderá ser acessado.  Veja <a
href="#s-s-samba-a-invisivel">Criando um compartilhamento invisível, Seção
18.12.12</a> para uma explicação mais detalhada.
<p>
Ex: <samp>browseable=yes</samp> - Lista o compartilhamento na janela de
pesquisa de servidores.
</dd>
<dt>guest account</dt>
<dd>
Conta que será usada para fazer acesso sem senha (convidado) quando o parâmetro
<samp>guest ok</samp> ou <samp>public</samp> forem usados em um
compartilhamento.  Por padrão ela é mapeada para o usuário <samp>nobody</samp>.
É importante especificar uma nome de usuário <em>guest</em> (convidado),
principalmente porque seu UID será usado para fazer várias operações no SAMBA,
como exibir os recursos disponíveis na máquina para a rede.  Por motivos
claros, é recomendável que este usuário <strong>não</strong> tenha acesso login
ao sistema.
<p>
Caso não tenha a intenção de ocultar o SAMBA na lista de máquinas da rede
(fazendo apenas acesso direto aos recursos), especifique um valor para esta
opção.
<p>
Ex: <samp>guest account = sambausr</samp> - Mapeia os usuário se conectando sem
senha para o usuário <samp>sambausr</samp>, desde que o acesso guest seja
permitido pela opção <samp>public</samp>.
</dd>
<dt>public</dt>
<dd>
Permitem aos usuários usuários se conectarem ao compartilhamento sem fornecer
uma senha usando o usuário guest.  O UID que o usuário guest será mapeado é
especificado pelo parâmetro <samp>guest account</samp>).  Veja <a
href="#s-s-samba-a-publico">Criando um compartilhamento para acesso sem senha,
Seção 18.12.7</a>.  O parâmetro <samp>guest ok</samp> é equivalente a
<samp>public</samp>.
<p>
Ex: <samp>public = no</samp> - Não permite
</dd>
<dt>guest only</dt>
<dd>
Permite somente conexões guest ao recurso.  O UID do usuário é mapeado para
guest, mesmo que forneça uma senha correta.  O valor padrão é <samp>no</samp>.
<p>
Ex: <samp>guest only = no</samp>.
</dd>
<dt>write list</dt>
<dd>
Lista de usuários separados por espaço ou vírgula que poderão ler e gravar no
compartilhamento.  Caso o nome for iniciado por &quot;@&quot;, o nome
especificado será tratado como um grupo UNIX (<code>/etc/group</code>) e todos
os usuários daquele grupo terão acesso de gravação.  O uso deste parâmetro
ignora o <samp>read only = yes</samp>.  Veja <a
href="#s-s-samba-a-restr">Excessão de acesso na permissão padrão de
compartilhamento, Seção 18.12.10</a> para mais detalhes.
<p>
Ex: <samp>write list = gleydson, @usuarios</samp> - Permite acesso gravação
somente do usuário <samp>gleydson</samp> e todos os usuários pertencentes ao
grupo <samp>@usuarios</samp>.
<p>
<strong>OBS:</strong> - O significado de &quot;@&quot; nos parâmetros
&quot;invalid users&quot;/&quot;valid users&quot; é diferente das opções
<samp>write list</samp> e <samp>read list</samp>.
</dd>
<dt>read list</dt>
<dd>
Lista de usuários separados por espaço ou vírgula que poderão apenas ler o
compartilhamento.  O caracter &quot;@&quot; pode ser especificado para fazer
referência a grupos, como no <samp>write list</samp>.  O uso deste parâmetro
ignora o <samp>read only = no</samp>.  Veja <a
href="#s-s-samba-a-restr">Excessão de acesso na permissão padrão de
compartilhamento, Seção 18.12.10</a> para mais detalhes.
<p>
Ex: <samp>read list = nobody, system, operador, @usuarios</samp> - Permite
acesso de leitura somente do usuário <samp>nobody, system, operador</samp> e
todos os usuários pertencentes ao grupo <samp>@usuarios</samp>.
</dd>
<dt>user</dt>
<dd>
Especifica um ou mais nomes de usuários ou grupos (caso o nome seja seguido de
&quot;@&quot;) para checagem de senha.  Quando o cliente somente fornece uma
senha (especialmente na rede <code>Lan Manager</code>, <code>Windows for
Workgroups</code> e primeira versão do <code>Windows 95</code>) ela será
validada no banco de dados de senhas usando o usuário especificado nesta opção.
<p>
Ex: <samp>user = john @usuariosrede</samp>
</dd>
<dt>only user</dt>
<dd>
Especifica se somente serão permitidas conexões vindas de usuários da diretiva
<samp>user</samp>.  O padrão é <samp>no</samp>.  Caso deseje restringir o
acesso a determinados usuários, o certo é faze-lo usando <samp>valid
users</samp> e <samp>invalid users</samp> (veja <a
href="#s-s-samba-a-restrusu">Restringindo o acesso por usuários, Seção
18.12.4</a>).  O uso de <samp>only user</samp> é apropriado quando é necessário
um controle específico de acesso sobre a diretiva <samp>user</samp>.
<p>
Ex: <samp>only user = no</samp>.
</dd>
<dt>locking</dt>
<dd>
Permite ao SAMBA fazer um lock real de arquivo ou apenas simular.  Caso seja
especificado como &quot;0&quot;, o arquivo não é bloqueado para acesso
exclusivo no servidor mas uma resposta positiva de lock é retornada ao cliente.
Se definido como &quot;1&quot;, um lock real é feito.  O padrão é
<samp>yes</samp>.
<p>
Ex: <samp>locking = yes</samp>
</dd>
<dt>available</dt>
<dd>
Faz o SAMBA ignorar o compartilhamento (como se tivesse retirado do servidor).
O valor padrão é &quot;no&quot;.
</dd>
<dt>follow symlinks</dt>
<dd>
Permite o uso de links simbólicos no compartilhamento (veja também a opção
<samp>wide links</samp>).  A desativação desta opção diminui um pouco a
performance de acesso aos arquivos.  Como é restrita a compartilhamento, o
impacto de segurança depende dos dados sendo compartilhados.  O valor padrão
desta opção é &quot;YES&quot;.
<p>
Ex: <samp>follow symlinks = yes</samp>
</dd>
<dt>wide links</dt>
<dd>
Permite apontar para links simbólicos para fora do compartilhamento exportada
pelo SAMBA.  O valor padrão esta opção é &quot;YES&quot;.
<p>
Ex: <samp>wide links = yes</samp>.
<p>
<strong>OBS:</strong> - A desativação desta opção causa um aumento na
performance do servidor SAMBA, evitando a chamada de funções do sistema para
resolver os links.  Entretanto, diminui a segurança do seu servidor, pois
facilita a ocorrência de ataques usando links simbólicos.
<p>
Lembre-se mais uma vez que a segurança do seu sistema começa pela política e
uma instalação bem configurada, isso já implica desde a escolha de sua
distribuição até o conhecimento de permissões e planejamento na implantação do
servidor de arquivos.
</dd>
<dt>dont descend</dt>
<dd>
Não mostra o conteúdo de diretórios especificados.
<p>
Ex: <samp>dont descend = /root, /proc, /win/windows, &quot;/win/Arquivos de
Programas&quot;, &quot;/win/program files&quot;</samp>.
</dd>
<dt>printable</dt>
<dd>
Especifica se o compartilhamento é uma impressora (yes) ou um compartilhamento
de arquivo/diretório (no).  O padrão é &quot;no&quot;.
</dd>
<dt>read only</dt>
<dd>
Especifica se o compartilhamento é somente para leitura (yes) ou não (no) para
todos os usuários.  O parâmetro <samp>writable</samp> é um antônimo equivalente
a este parâmetro, só que utiliza as opções invertidas.  Por segurança, o valor
padrão é somente leitura.  Veja uma explicação mais detalhada em <a
href="#s-s-samba-a-ro">Criando um compartilhamento com acesso somente leitura,
Seção 18.12.8</a>.
<p>
Ex: <samp>read only = yes</samp>.
</dd>
<dt>create mask</dt>
<dd>
Modo padrão para criação de arquivos no compartilhamento.  O parâmetro
&quot;create mode&quot; é um sinônimo para este.  O modo de arquivos deve ser
especificado em formato octal.
<p>
Ex: <samp>create mask = 0600</samp>.
</dd>
<dt>directory mask</dt>
<dd>
Modo padrão para a criação de diretórios no compartilhamento.  O parâmetro
&quot;directory mode&quot; é um sinônimo para este.  O modo de diretório deve
ser especificado em formato octal.
<p>
Ex: <samp>directory mask = 0700</samp>.
</dd>
<dt>getwd cache</dt>
<dd>
Permite utilizar um cache para acesso as requisições getwd, diminuindo o número
de ciclos de processamento para acesso a arquivos/diretórios.  O valor padrão é
&quot;Yes&quot;.
</dd>
<dt>write cache size</dt>
<dd>
Tamanho do cache de leitura/gravação do compartilhamento.  Este valor é
especificado em bytes e o padrão é &quot;0&quot;.  Veja <a
href="#s-s-samba-perf">Melhorando a performance do compartilhamento/servidor,
Seção 18.13</a> para detalhes sobre seu uso.
<p>
Ex: <samp>write cache size = 384000</samp>.
</dd>
<dt>inherit permissions</dt>
<dd>
Permite herdar permissões de arquivos/diretórios do diretório pai quando novos
arquivos/diretórios são criados, isto inclui bits SGID (set group ID).  O
padrão é <samp>NÃO</samp> herdar permissões.  O uso desta opção substitui as
opções fornecidas por <samp>create mask</samp>, <samp>directory mask</samp>,
<samp>force create mask</samp> e <samp>force directory mask</samp>.
<p>
Ex: <samp>inherit permissions</samp>.
</dd>
<dt>preexec</dt>
<dd>
Executa um comando antes a abertura de um compartilhamento.  O parâmetro
<samp>exec</samp> é um sinônimo para este.  Veja <a
href="#s-s-samba-a-comandos">Executando comandos antes e após o acesso ao
compartilhamento, Seção 18.12.13</a>.
</dd>
<dt>postexec</dt>
<dd>
Executa um comando depois da utilização do compartilhamento.  Veja <a
href="#s-s-samba-a-comandos">Executando comandos antes e após o acesso ao
compartilhamento, Seção 18.12.13</a>.
</dd>
<dt>preexec close</dt>
<dd>
Fecha imediatamente o compartilhamento caso o valor do comando executado pela
opção <samp>preexec</samp> seja diferente de 0.  O uso desta opção só faz
sentido em conjunto com <samp>preexec</samp>.  O valor padrão é &quot;no&quot;.
Veja <a href="#s-s-samba-a-comandos">Executando comandos antes e após o acesso
ao compartilhamento, Seção 18.12.13</a>.
<p>
Exemplo: <samp>preexec close = yes</samp>.
</dd>
<dt>volume = nome</dt>
<dd>
Retorna o nome de volume especificado quando é feito o acesso ao
compartilhamento.  Isto é muito útil para instalações onde o serial do CD,
disquete ou HD é verificado durante o acesso.  Isto acontece com freqüência em
produtos de fabricantes proprietários como forma de evitar a execução ilegal do
programa.
</dd>
</dl>

<hr>

<a name="s-s-samba-wrkgrp"></a>
<h2>18.4 Configuração em <samp>Grupo de Trabalho</samp></h2>

<p>
A configuração <em>grupo de trabalho</em> é o método mais simples para
compartilhar recursos em uma rede e também é indicado quando se possui uma rede
pequena (até 30 máquinas) pois o gerenciamento não é tão complicado.  Acima
deste número, é recomendada a utilização da configuração de domínio para
definição de políticas de acesso mais precisas pelo administrador e para manter
o controle sobre os recursos da rede (veja <a
href="#s-s-samba-dom-config">Configurando um servidor PDC no SAMBA, Seção
18.7.4</a>).

<p>
A configuração do nível de acesso por grupo de trabalho tem como
características principais essa simplicidade na configuração e o controle de
acesso aos recursos sendo feito pela máquina local através de senhas e controle
de IP.

<p>
Quanto ao método de senhas, você pode optar tanto por usar senhas
criptografadas (<a href="#s-s-samba-senhas-crypto">Ativando o suporte a senhas
criptografadas, Seção 18.8</a>) ou senhas em texto limpo (<a
href="#s-s-samba-senhas-plano">Ativando o suporte a senhas em texto plano,
Seção 18.9</a>).

<p>
Veja abaixo um exemplo explicado de configuração do <code>SAMBA</code> para
grupo de trabalho:

<pre>
      [global]
       netbios name = servidor
       workgroup = focalinux
       security = user
       obey pam restrictions = yes
       encrypt passwords = no
       os level = 30
       guest account = nobody
       server string = servidor da rede
       local master = true
       domain master = false
     
      [homes]
       comment = Diretórios de usuários
       create mask= 0700
       directory mask = 0700
       browseable = no
       
      [tmp]
       path = /tmp
       comment = Diretório temporário do sistema
       read only = yes
       valid users = gleydson
       public = no
</pre>

<p>
Agora, verifique se existem erros na configuração com o comando
<code>testparm</code> (<a href="#s-s-samba-s-testparm">Buscando problemas na
configuração, Seção 18.2.11</a>) e reinicie o <code>SAMBA</code> (<a
href="#s-s-samba-rodando">Iniciando o servidor/reiniciando/recarregando a
configuração, Seção 18.1.9</a>).  O nome do grupo de trabalho que a máquina
pertencerá é <samp>focalinux</samp> (<samp>workgroup = focalinux</samp>).  O
nível de acesso usado neste exemplo é de usuário (<samp>security =
user</samp>), para mais detalhes sobre este método, veja <a
href="#s-s-samba-s-global-nivelauth">Níveis de autenticação, Seção
18.2.8.4</a>.  O parâmetro <samp>local master</samp> foi definido para
<samp>yes</samp> para o <code>SAMBA</code> tentar ser o navegador local do
grupo de trabalho (veja <a href="#s-s-samba-dom-lmbrowser">Local Master
Browser, Seção 18.7.2</a>).

<p>
Para testar se o servidor está funcionando, digite o seguinte comando:

<pre>
     smbclient -L servidor -U usuario
</pre>

<p>
Digite a senha de usuário quando solicitado.  O comando deverá listar os
recuros da máquina, indicando que a configuração está funcionando corretamente.
Se você é paranóico e está preocupado com a segurança da máquina, recomendo ler
a <a href="#s-s-samba-a">Controle de acesso ao servidor SAMBA, Seção 18.12</a>.

<hr>

<a name="s-s-samba-s-nameresolv"></a>
<h2>18.5 Resolução de nomes de máquinas no samba</h2>

<p>
O Samba pode utiliza os seguintes métodos para resolução de nomes de máquinas
na rede (<a href="#s-s-samba-nome">Nome de máquina (nome NetBios), Seção
18.2.1</a>).  Eles estão listados em ordem de prioridade do mais para o menos
recomendável:
<ul>
<li>
<samp>lmhosts</samp> - Pesquisa primeiro o arquivo
<code>/etc/samba/lmhosts</code> (veja <a
href="#s-s-samba-s-nameresolv-lmhosts">Arquivo <code>/etc/samba/lmhosts</code>,
Seção 18.5.1</a> para detalhes sobre este arquivo).
</li>
<li>
<samp>host</samp> - Faz a pesquisa no arquivo <code>/etc/hosts</code> e no DNS
em busca do nome da máquina.
</li>
<li>
<samp>wins</samp> - Pesquisa no servidor WINS especificado pelo parâmetro
<em>wins server</em> do <code>smb.conf</code> (veja <a
href="#s-s-samba-s-nameresolv-wins">WINS, Seção 18.5.2</a>).
</li>
<li>
<samp>bcast</samp> - Envia um pacote para o endereço de broadcast de sua
configuração de rede.  Este geralmente deve ser o último método por gerar
tráfego excessivo em uma rede com um considerável número de computadores.
</li>
</ul>

<p>
A ordem que a resolução de nomes é feita pelo samba, pode ser modificada usando
o parâmetro &quot;name resolve order = [ordem]&quot; no arquivo de configuração
do samba (ex.  <samp>name resolve order = lmhosts host wins bcast</samp>).

<hr>

<a name="s-s-samba-s-nameresolv-lmhosts"></a>
<h3>18.5.1 Arquivo <code>/etc/samba/lmhosts</code></h3>

<p>
Este arquivo é um banco de dados que mapeia o endereço IP com o nome NetBIOS de
uma máquina, semelhante ao formato do <code>/etc/hosts</code>.  Este arquivo é
útil quando temos servidores que são acessados com freqüência, quando
servidores de rede estão em segmentos separados e não temos um servidor WINS
entre os dois pontos para resolução de nomes, para definir máquinas WINS que
serão acessados pela internet, etc.  Para ter certeza da localização do arquivo
<code>lmhosts</code> em sua máquina, digite <samp>smbclient -d 3 -L
localhost</samp> e veja o diretório de pesquisa deste arquivo.  Veja um exemplo
de arquivo <code>lmhosts</code> em <a
href="#s-s-samba-s-nameresolv-lmhosts-unix-ex">Exemplo de <code>lmhosts</code>
do UNIX, Seção 18.5.1.1</a>.

<p>
O uso do arquivo <code>lmhosts</code> evita o excesso de broadcasting na rede,
pois a ordem padrão usada para a resolução de nomes do <code>samba</code>,
procura primeiro resolver o nome procurando em arquivos lmhosts, depois usando
<em>dns</em>, <em>wins</em> e <em>broadcast</em>.  Dependendo do projeto de sua
rede e como as máquinas resolvem os nomes, ele pode ser uma camada a mais de
segurança contra um simples hijacking de servidor através de NetBEUI ou WINS
(isso é evitado com o uso de domínios, veja <a
href="#s-s-samba-dom-config">Configurando um servidor PDC no SAMBA, Seção
18.7.4</a>).

<p>
<strong>OBS:</strong> Note que em clientes <code>Windows</code> que estejam em
outra subrede, é necessário o arquivo <code>\windows\lmhosts</code> apontando
para um servidor PDC mesmo que ele esteja apontando para o servidor WINS, caso
contrário, a máquina não efetuará o logon.

<p>
O formato do arquivo <code>lmhosts</code> do <code>Windows</code> é mais
complexo do que o do <code>Linux</code> pois o sistema precisa de mais detalhes
para resolver os nomes e tipos de máquinas no domínio.  Veja o modelo
<code>lmhosts.sam</code> em seu sistema <code>Windows</code> para compreender
seu funcionamento.

<hr>

<a name="s-s-samba-s-nameresolv-lmhosts-unix-ex"></a>
<h4>18.5.1.1 Exemplo de <code>lmhosts</code> do UNIX</h4>

<p>
O exemplo abaixo mapeia o endereço IP das máquinas (primeira coluna) com o
respectivo nome de máquina (segunda coluna):

<pre>
     172.16.0.34 servarq
     172.16.0.30 serverdom
     192.168.5.2 servwins
     172.16.0.3 servpdc
     172.16.0.1 gateway
</pre>

<hr>

<a name="s-s-samba-s-nameresolve-lmhosts-windows-ex"></a>
<h4>18.5.1.2 Exemplo de <code>lmhosts</code> do Windows</h4>

<p>
O arquivo possui uma sintaxe idêntica a do <code>lmhosts</code> do UNIX, mas
alguns parâmetros especiais são especificados para ajudar o
<code>Windows</code> resolver algumas coisas que não consegue fazer sozinho
(principalmente com relação a identificação de função de máquinas em redes
segmentadas):

<pre>
     192.168.0.5 servarq
     192.168.0.1 serverpdc #PRE #DOM:dominio
     192.168.0.2 &quot;serverwins    \0x1e&quot; #PRE
     #INCLUDE \\serverpdc\lmhosts
</pre>

<p>
A primeira entrada do arquivo é a tradicional, onde o nome da máquina NetBIOS é
associada ao IP.  A segunda utiliza dois parâmetros adicionais:
<ul>
<li>
<samp>#PRE</samp> - Faz a entrada ser carregada logo na inicialização e se
tornando uma entrada permanente no cache NetBIOS.
</li>
<li>
<samp>#DOM</samp> - Especifica que a máquina é um controlador de domínio.  A
máquina deverá ter sido configurada para a função de domínio, pois caso
contrário isso simplesmente não funcionará.
</li>
</ul>

<p>
Note que ambos <samp>#PRE</samp> e <samp>#DOM</samp> devem ser especificados em
maiúsculas.  O terceiro exemplo faz uma referência permanente (#PRE) a máquina
servidora WINS <em>serverwins</em>.  Neste exemplo é usada uma característica
especial para especificar a ID hexadecimal da máquina na rede <em>1e</em>.  O
quarto utiliza um include para associar outro arquivo ao atual, útil quando
temos um compartilhamento que distribui um arquivo <code>lmhosts</code> para
diversas máquinas na rede.  De preferência, utilize sempre uma diretiva
<em>#PRE</em> para todas as máquinas especificadas na diretiva
<em>#INCLUDE</em> em seu arquivo de configuração.

<p>
Para a especificação de ID de serviço manual, é necessário manter os 15
caracteres no nome da máquina (preenchendo os restantes com espaços, caso seja
preciso).  O último caracter é o código hexadecimal que identifica o serviço de
rede (veja <a href="#s-s-samba-c-workgroup-linux-nmblookup">nmblookup, Seção
18.14.2.9.3</a> para ver a lista de serviços e sua respectiva função).

<p>
<strong>OBS:</strong> Caso crie este arquivo em um editor de textos do
<code>Linux</code>, não se esqueça de converter o arquivo para que contenha o
CR+LF no final das linhas.

<hr>

<a name="s-s-samba-s-nameresolv-wins"></a>
<h3>18.5.2 WINS</h3>

<p>
Este é um serviço de resolução de nomes que funciona de forma semelhante ao
DNS, só que voltado para o NetBIOS.  Quando uma máquina cliente NetBIOS entra
na rede, o servidor WINS pega seu nome e IP e inclui em uma tabela para futura
consulta pelos clientes da rede.

<p>
Esta tabela consultada toda vez que um cliente NetBIOS solicita um nome de
máquina, componentes do grupo de trabalho ou domínio na rede.  Uma outra
aplicação importante de um servidor WINS é permitir a resolução de nomes em
pontos de redes que requerem roteamento, a simplicidade de um protocolo não
roteável como o NetBIOS fica limitada a simplicidade das instalações de rede.
Um servidor WINS pode ser instalado em cada ponta da rede e eles trocarem dados
entre si e atualizar suas tabelas de nomes/grupos de trabalhos/IPs.

<p>
A resolução de nomes de máquinas será feita consultando diretamente a máquina
WINS ao invés de broadcasting (que geram um tráfego alto na rede).

<hr>

<a name="s-s-samba-s-nameresolv-wins-s"></a>
<h4>18.5.2.1 Configurando o servidor WINS</h4>

<p>
Para ativar o servidor WINS no <code>samba</code>, inclua as seguinte linha na
seção <samp>[global]</samp> do seu arquivo <code>/etc/samba/smb.conf</code>:

<pre>
     [global]
     wins support = yes
     wins proxy = no
     dns proxy = no
     max wins ttl = 518400
</pre>

<p>
O parâmetro <samp>wins proxy</samp> pode ser necessário para alguns clientes
antigos que tenham problemas no envio de suas requisições WINS.  O <samp>dns
proxy</samp> permite que o servidor WINS faça a pesquisa no DNS para
localização de nomes de máquinas caso não exista no cache.  Ambas as opções
<samp>wins support</samp>, <samp>wins proxy</samp> e <samp>dns proxy</samp> tem
como valor padrão <samp>não</samp>.  Pronto, seu servidor samba agora suporta
WINS.  Fácil, prático e rápido :-)

<p>
Se estiver configurando uma subrede com masquerade para acesso a um PDC ou um
servidor WINS, você terá que mexer no gateway central para apontar uma rota
para o gateway masquerade.  O motivo disto é porque o masquerade do
<code>Linux</code> atua somente nos cabeçalhos, mas o IP da estação é enviada e
processada pelo PDC para retornar uma resposta.  Da mesma forma, este IP é
registrado no servidor WINS para uso das estações de trabalho.  Isto só vai ser
resolvido quando for escrito um módulo de conntrack para conexões SAMBA (até o
lançamento do kernel <samp>2.4.22</samp>, isso ainda não ocorreu).

<p>
<strong>OBS1:</strong> NUNCA configure mais de um servidor WINS em uma mesma
rede.

<p>
<strong>OBS2:</strong> NÃO especifique o parâmetro <samp>wins server</samp>
caso esteja usando o suporte a WINS.

<hr>

<a name="s-s-samba-s-nameresolv-wins-c"></a>
<h4>18.5.2.2 Configurando o Cliente WINS</h4>

<p>
Para os clientes da rede (<code>Linux, Windows, OS/2, etc.</code>) fazer uso
das vantagens da resolução de nomes usando o WINS, é necessário configurar para
que eles o utilizem para resolver os nomes de máquinas.  Isto é feito da
seguinte forma em cada um dos sistemas operacionais:
<dl>
<dt>Linux</dt>
<dd>
Adicione a linha <samp>wins server = ip_do_servidor_WINS</samp> na seção global
do arquivo <code>/etc/samba/smb.conf</code>:
<pre>
     [global]
     wins server = 192.168.1.1
</pre>
<p>
Após isto, reinicie o servidor <code>samba</code>.  Caso esteja executando o
servidor via <samp>inetd</samp>, digite: <samp>killall -HUP nmbd</samp>.  Se
estiver rodando através de daemons: <samp>/etc/init.d/samba restart</samp>.
Não é necessário reiniciar o computador!
</dd>
<dt>Windows 9x</dt>
<dd>
Clique com o botão direito sobre o ícone <em>Ambiente de Rede</em> e selecione
propriedades.  Na janela de configuração de rede clique na aba
<em>Configuração</em>.  Na lista que aparece selecione o protocolo TCP/IP
equivalente a sua placa de rede local e clique em <em>Propriedades</em>.
<p>
Na tela de <em>Propriedades TCP/IP</em> clique em <em>Configurações WINS</em> e
marque a opção <em>Ativar resolução WINS</em>.  Digite o endereço do servidor
WINS e clique em <em>Adicionar</em>.
<p>
<strong>OBS:</strong> Se utilizar um servidor DHCP em sua rede local e o
endereço do servidor WINS também é oferecido através dele, você poderá marcar a
opção <em>Usar DHCP para resolução WINS</em>.  Note que esta opção somente
estará disponível se escolher a opção <em>Obter um endereço IP
automaticamente</em> na tab <em>Endereços IP</em>.  Clique em OK até fechar
todas as telas e reinicie quando o computador perguntar :-)
</dd>
</dl>

<hr>

<a name="s-s-samba-s-timeserver"></a>
<h2>18.6 Servidor de data/hora</h2>

<p>
O samba pode atuar como um servidor de data/hora ajustando o horário de suas
estações de trabalho com o servidor da rede.

<p>
As estações clientes poderão executar o comando <code>net</code> para
sincronizar seu relógio durante a inicialização do Windows, ou durante o logon
da rede através do script de logon, caso tenha configurado o servidor
<code>samba</code> para logon em domínios NT.

<hr>

<a name="s-s-samba-s-timeserver-s"></a>
<h3>18.6.1 Configuração do serviço de data/hora no SAMBA</h3>

<p>
Para configurar o samba para atuar como servidor de data/hora de sua rede,
adicione o seguinte parâmetro na seção global do arquivo de configuração
<code>/etc/samba/smb.conf</code>:

<pre>
     [global]
     time server = yes
</pre>

<p>
Para sincronizar a data/hora das estações de trabalho usando o servidor samba,
veja <a href="#s-s-samba-s-timeserver-c">Sincronizando a data/hora no Cliente,
Seção 18.6.2</a>.  Caso o seu servidor SAMBA também seja o servidor de
autenticação PDC da rede, a melhor forma de se fazer isto é colocar o comando
<samp>net time \\servidor_SAMBA /set /yes</samp> em um script que será
executado pela estação.

<p>
<strong>OBS</strong> É recomendável instalar um cliente ntp para manter o
relógio do servidor sempre atualizado, conseqüentemente mantendo a data/hora
das estações também em sincronismo .  .

<hr>

<a name="s-s-samba-s-timeserver-c"></a>
<h3>18.6.2 Sincronizando a data/hora no Cliente</h3>

<p>
Na estação cliente Windows, use o seguinte comando:

<pre>
     NET TIME \\SERVIDOR /WORKGROUP:GRUPO /SET /YES
</pre>

<p>
Um local interessante para colocação deste comando é na pasta Iniciar da
estação Windows, pois todos os comandos que estejam nesta pasta são executados
quando o sistema é iniciado.

<p>
Exemplos:
<ul>
<li>
<samp>net time \\linux /set /yes</samp> - Sincroniza a hora com o servidor
&quot;\\linux&quot; e não pede confirmação (/yes).
</li>
<li>
<samp>net time \\linux /WORKGROUP:pinguim /set /yes</samp> - Sincroniza a hora
com o servidor &quot;\\linux&quot; do grupo de trabalho pinguim
(/WORKGROUP:pinguim) e não pede confirmação (/yes).
</li>
</ul>

<hr>

<a name="s-s-samba-dom"></a>
<h2>18.7 Configuração em <samp>Domínio</samp></h2>

<p>
Esta seção descreve todos os passos necessários para configurar um servidor de
domínio PDC (<em>Primary Domain Control</em>) com perfis móveis e outros
recursos que tornam úteis e seguras a administração de uma rede NetBEUI.

<hr>

<a name="s-s-samba-dom-intro"></a>
<h3>18.7.1 Uma breve introdução a um Domínio de rede</h3>

<p>
Um domínio de rede consiste em uma máquina central chamada de PDC, que mantém o
controle de todas as contas de usuários/grupos e permissões para acesso a rede
NetBEUI.  O acesso desta forma é centralizado, como vantagem disto você pode
usar o nível de acesso por usuários nas máquinas, definindo quais usuários ou
grupos terão acesso de leitura/gravação.

<p>
É permitido criar scripts de logon, assim comandos programados pelo
administrador serão executados nas máquinas clientes durante o logon no domínio
(veja <a href="#s-s-samba-dom-logonscripts">Criando Scripts de logon, Seção
18.7.7</a>).

<p>
O nome da máquina é protegido contra hijacking através de contas de máquinas
que fazem parte do domínio (veja <a href="#s-s-samba-dom-contasmac">Contas de
máquinas de domínio, Seção 18.7.5</a>).  Isto só é possível em clientes
<code>Linux</code>, <code>Windows NT</code>, <code>Windows 2000</code> e
<code>Windows XP</code>.

<p>
Você poderá usar perfis móveis, copiando todas as personalizações do seu
desktop para qualquer máquina na rede que você faça o logon.  Para o
administrador, ele poderá definir políticas com o <code>Poledit</code> e outros
programas que serão salvas junto com o perfil do usuário, valendo para qualquer
máquina que ele se autentique na rede (veja <a
href="#s-s-samba-dom-logonscripts">Criando Scripts de logon, Seção 18.7.7</a>).

<p>
Se você deseja iniciar logo a configuração do seu domínio, siga até <a
href="#s-s-samba-dom-config">Configurando um servidor PDC no SAMBA, Seção
18.7.4</a>.

<hr>

<a name="s-s-samba-dom-lmbrowser"></a>
<h3>18.7.2 Local Master Browser</h3>

<p>
É a máquina que ganhou a eleição no segmento local de rede (veja <a
href="#s-s-samba-s-oslevel">Níveis de sistema para eleição de rede, Seção
18.2.12</a>).  Logo que é declarada o <em>local master browser</em>, ela começa
a receber via broadcasting a lista de recursos compartilhados por cada máquina
para montar a lista principal que será retornada para outras máquinas do grupo
de trabalho ou outras subredes que solicite os recursos compartilhados por
aquele grupo.

<p>
Uma nova eleição é feita a cada 36 minutos ou quando a máquina escolhida é
desligada.

<hr>

<a name="s-s-samba-dom-dmbrowser"></a>
<h3>18.7.3 Domain Master Browser</h3>

<p>
Quando o local master browse é eleito no segmento de rede, uma consulta é feita
ao servidor WINS para saber quem é o Domain Master Browse da rede para enviar a
lista de compartilhamentos.  A máquina escolhida como Local Master Browse envia
pacotes para a porta UDP 138 do Domain Master e este responde pedindo a lista
de todos os nomes de máquinas que o local master conhece, e também o registra
como local master para aquele segmento de rede.

<p>
Caso tenha configurado sua máquina para ser o domain master browser da rede
(também chamado de <em>controlador principal de domínio</em> ou PDC), ela
tentará se tornar a máquina que terá a lista completa de recursos enviados
pelos locais master browsers de cada segmento de rede.  Um PDC também é o local
master browse de seu próprio segmento de rede.

<p>
É possível ter mais de um domain master browse, desde que cada um controle seu
próprio domínio, mas não é possível ter 2 domain master browsers em um mesmo
domínio.  Caso utilize um servidor <samp>WINS</samp> em sua rede, o PDC fará
consultas constantes em sua base de dados para obter a lista de domínios
registrados.  O domínio é identificado pelo caracter <em>1b</em> na rede (veja
<a href="#s-s-samba-c-workgroup-linux-nmblookup">nmblookup, Seção
18.14.2.9.3</a>).

<p>
<strong>OBS:</strong> O Windows NT configurado como PDC sempre tenta se tornar
o domain master browser em seu grupo de trabalho.  Não sendo possível retirar o
Windows NT configurado como PDC do domínio (por alguma outra razão), a única
forma será deixar ele ser o domain master browser.  Se este for o caso, você
poderá continuar lendo este documento para aprender mais sobre NetBIOS e talvez
ainda mudar de idéia sobre manter o NT na rede após ver as características do
SAMBA ;-)

<hr>

<a name="s-s-samba-dom-config"></a>
<h3>18.7.4 Configurando um servidor PDC no SAMBA</h3>

<p>
Esta é a parte interessante do guia, a prática.  Para os administradores que
conhecem através da experiência própria os problemas e definições do SAMBA,
grande parte do guia foi apenas uma revisão (por favor, se faltou algo que acha
interessante, me notifiquem que incluirei na próxima versão e colocarei uma
nota no lançamento e na página com os devidos créditos :-))

<p>
Para configurar uma máquina para ser o PDC (<em>Controladora Principal de
Domínio</em> ou <em>Primary Domain Control</em>), siga esta seqüência:
<ul>
<li>
Habilite o suporte a senhas criptografadas.  Caso ainda não tenha feito isso,
leia a seção <a href="#s-s-samba-senhas-crypto">Ativando o suporte a senhas
criptografadas, Seção 18.8</a>.
</li>
<li>
Na seção <em>[global]</em>, insira/modifique os seguintes parâmetros:
<pre>
     ; Identificação da máquina e domínio
     netbios name = gleydson
     workgroup = focalinux
     
     ;níveis de acesso e funções do servidor
     security = user
     domain master = yes
     prefered master = yes
     local master = yes
     
     ; senhas criptografadas
     encrypt passwords = yes
     smb passwd file = /etc/samba/smbpasswd.db
</pre>
<p>
Onde os parâmetros significam:
<ul>
<li>
<samp>netbios name = gleydson</samp> - Nome do computador.  Este também será o
nome usado pelas outras máquinas clientes quando for configurar o PDC
(<em>controlador de domínio</em>).
</li>
<li>
<samp>workgroup = focalinux</samp> - Nome do domínio que está criando.  Todas
as máquinas que pertencerem a este domínio, terão o nível de acesso definido
pelo PDC.  Note que o parâmetro <samp>workgroup</samp> também é usado ao
especificar o nome do grupo de trabalho quando se é usado a configuração
<em>grupo de trabalho</em> (<a href="#s-s-samba-wrkgrp">Configuração em
<samp>Grupo de Trabalho</samp>, Seção 18.4</a>).
</li>
<li>
<samp>security = user</samp> - Requerido para controle de acesso por domínio,
já que é utilizado o controle de acesso local usando usuários e grupos locais.
</li>
<li>
<samp>domain master = yes</samp> - Especifica se está máquina está sendo
configurada para ser o PDC da rede.
<p>
<strong>OBS:</strong> Por favor, certifique-se que não existe outro PDC no
domínio.  Veja <a href="#s-s-samba-dom-dmbrowser">Domain Master Browser, Seção
18.7.3</a>.  <samp>prefered master = yes</samp> - Força uma eleição com algumas
vantagens para seu servidor ser eleito sempre como o controlador de domínio.
Isto garante que a máquina <code>SAMBA</code> sempre seja o PDC.  Veja <a
href="#s-s-samba-s-global-browsing">Navegação no servidor/tipo de servidor,
Seção 18.2.8.6</a>.  <samp>local master = yes</samp> - Define se a máquina será
o controlador principal do grupo de trabalho local que ela pertence.
</li>
</ul>
</li>
</ul>

<p>
Pronto, agora teste se existem erros em sua configuração executando o comando
<code>testparm</code> (<a href="#s-s-samba-s-testparm">Buscando problemas na
configuração, Seção 18.2.11</a>) e corrija-os se existir.  Resta agora
reiniciar o servidor <code>nmbd</code> para que todas as suas alterações tenham
efeito.  Para adicionar seus clientes a um domínio, veja <a
href="#s-s-samba-dom-contasmac">Contas de máquinas de domínio, Seção 18.7.5</a>
e <a href="#s-s-samba-c-dominio">Configurando clientes em Domínio, Seção
18.14.3</a>.

<hr>

<a name="s-s-samba-dom-contasmac"></a>
<h3>18.7.5 Contas de máquinas de domínio</h3>

<p>
Uma conta de máquina de domínio garante que nenhum outro computador possa
utilizar o mesmo nome de uma máquina confiável e assim utilizar os
compartilhamentos que ela tem permissão.  Os clientes <code>Windows NT</code>,
<code>Windows XP</code> e <code>Windows 2000</code> precisam de uma conta de
máquina para ter acesso ao domínio e seus recursos.  A criação de uma conta de
máquina é bastante semelhante a criação da conta de um usuário normal no
domínio.

<p>
Existe uma coisa que precisa sempre ter em mente quando estiver configurando
uma conta de máquina de domínio: Quando você cria uma conta para a máquina, ela
entra e altera sua senha no próximo logon usando um &quot;segredo&quot; entre
ela e o PDC, este segredo a identifica sempre como dona daquele nome NetBIOS,
ou seja, até o primeiro logon no NT, outra máquina com o mesmo nome NetBIOS
poderá ser a dona do netbios naquele domínio caso faça o logon no domínio.  A
única forma de se evitar isto é logar imediatamente no domínio NT assim que
criar as contas de máquinas.

<p>
Existem duas formas para criação de contas de máquinas: manual e automática.

<hr>

<a name="s-s-samba-dom-contasmac-dom-m"></a>
<h4>18.7.5.1 Criando contas de máquinas manualmente</h4>

<p>
Para criar uma conta de domínio para a máquina <samp>master</samp>, siga estes
2 passos:
<ol type="1" start="1" >
<li>
Crie uma conta de máquina no arquivo <code>/etc/passwd</code>:
<pre>
     useradd -g domainmac -c &quot;Maquina de Dominio&quot; -s /bin/false -d /dev/null master$
</pre>
<p>
O comando acima cria uma conta para a máquina <samp>master$</samp> e torna ela
parte do grupo <samp>domainmac</samp>.  É necessário especificar o caracter
<samp>$</samp> após o nome da máquina para criar uma conta de máquina no
domínio, caso contrário o próximo passo irá falhar.  Acredito que nas próximas
versões do SAMBA seja desnecessário o uso do arquivo <code>/etc/passwd</code>
para a criação de contas de máquina.
</li>
<li>
Crie uma conta de máquina no arquivo <code>/etc/samba/smbpasswd</code>:
<pre>
     smbpasswd -m -a master
</pre>
<p>
Isto cria uma conta de máquina para o computador <samp>master</samp> no arquivo
<code>/etc/samba/smbpasswd</code>.  Note que a criação de uma conta de máquina
é muito semelhante a criação de um usuário apenas precisa adicionar a opção
<samp>-m</samp>.  Quando for criar uma conta com o <code>smbpasswd</code> Não é
necessário especificar <samp>$</samp> no final do nome da máquina.
<p>
O mais importante: Entre <strong>IMEDIATAMENTE</strong> no domínio após criar a
conta de máquina usando a conta de administrador de domínio criada no SAMBA
(veja <a href="#s-s-samba-dom-admin">Criando uma conta de administrador de
domínio, Seção 18.7.6</a>)!  como a máquina ainda não se autenticou pela
primeira vez, qualquer máquina que tenha o mesmo nome e entre no domínio,
poderá alocar o nome recém criado.  A única forma de resolver este problema, é
apagando a conta de máquina e criando-a novamente no domínio.  Siga os passos
de acordo com o sistema operacional em <a
href="#s-s-samba-c-dominio">Configurando clientes em Domínio, Seção 18.14.3</a>
para colocar seus clientes em domínio.
</li>
</ol>

<p>
<strong>OBS1:</strong> Como segurança, recomendo desativar a conta de máquina
no <code>/etc/passwd</code> usando o comando <samp>passwd -l conta</samp>.
Esta conta NUNCA deverá ser usada para login, isto deixa nossa configuração um
pouco mais restrita.

<p>
<strong>OBS2:</strong> A localização do arquivo de senhas criptografadas do
SAMBA pode ser modificado através da opção <samp>smb passwd file</samp> na
seção <samp>[global]</samp> do arquivo <code>smb.conf</code>.

<p>
<strong>OBS3:</strong> Os que tem experiência com NT e Windows 2000 devem ter
notado que este método é semelhante ao do <em>Server Manager</em> das
ferramentas de gerenciamentos de servidores existentes no Windows.

<hr>

<a name="s-s-samba-dom-contasmac-dom-a"></a>
<h4>18.7.5.2 Criando contas de máquinas automaticamente</h4>

<p>
Através deste método, as máquinas clientes terão sua conta criada
automaticamente assim que seja feita a entrada no domínio usando a conta do
administrador de domínio no SAMBA.  Este é o método recomendável de colocação
de máquinas no domínio por ser mais prática ao invés do método manual.  Note
que normalmente isto funciona para o WinXP e Win2000 mas não funciona em redes
com o NT4, devendo ser criadas contas de máquinas usando o método manual.

<p>
Para fazer a configuração automática, coloque a seguinte linha no arquivo
<code>smb.conf</code> na seção <samp>[global]</samp>:

<pre>
     add user script = useradd -g domainmac -c &quot;Maquina de Dominio&quot; -s /bin/false -d /dev/null %u
</pre>

<p>
Assim, a conta de máquina será automaticamente criada quando o administrador
fizer sua configuração no domínio (veja <a href="#s-s-samba-dom-admin">Criando
uma conta de administrador de domínio, Seção 18.7.6</a>).  No SAMBA 3.0, a
opção <samp>add machine script</samp> deverá ser usada no lugar de <samp>add
user script</samp> para adicionar uma máquina no domínio.

<hr>

<a name="s-s-samba-dom-admin"></a>
<h3>18.7.6 Criando uma conta de administrador de domínio</h3>

<p>
A conta de administrador do domínio é a conta que tem permissões para realizar
operações de manutenção e administração de máquinas que compõem o domínio de
rede.  Com ela é possível, entre outras coisas, adicionar e remover máquina que
compõem o domínio.  Para especificar que contas de usuários do arquivo
<code>/etc/samba/smbpasswd</code> que terão poderes administrativos, utilize a
opção <samp>domain admin group</samp> ou <samp>admin users</samp> na seção
<samp>[global]</samp> do arquivo <code>/etc/samba/smb.conf</code>.

<p>
O parâmetro <samp>admin users</samp> permite que todas as operações realizadas
pelo usuário sejam feitas com poderes de usuário <samp>root</samp>.  Isto é
necessário porque o arquivo <code>smbpasswd</code> (usado para ajustar as
contas de máquinas) normalmente tem permissões de leitura/gravação somente para
root.  O <em>domain admin group</em> permite que usuários específicos ou
usuários do grupo especificado sejam parte do grupo de administradores do
domínio para adicionar máquinas, etc.  Por exemplo, para tornar o usuário
<samp>gleydson</samp> com privilégios para adicionar/remover máquinas no
domínio:

<pre>
     [global]
     ...
     admin users = gleydson
     ou
     domain admin group = @admins gleydson
</pre>

<p>
Isto permite que o usuário <samp>gleydson</samp> possa adicionar/remover
máquinas do domínio NT (veja <a href="#s-s-samba-c-dominio">Configurando
clientes em Domínio, Seção 18.14.3</a>) entre outras tarefas.  Por segurança,
recomendo que coloque esta conta no <samp>invalid users</samp> de cada
compartilhamento para que seja utilizada somente para fins de gerenciamento de
máquinas no domínio, a menos que deseje ter acesso total aos compartilhamentos
do servidor (nesse caso, tenha consciência do nível de acesso que esta conta
possui e dos problemas que pode causar caso caia em mãos erradas).

<p>
<strong>OBS1:</strong> Tenha SEMPRE bastante cuidado com quem dará poderes de
administrador de domínio, pois toda sua rede poderá ficar vulnerável caso os
cuidados de administração não estejam em boas mãos.

<p>
<strong>OBS2:</strong> Em versões antigas do SAMBA, somente o usuário
<samp>root</samp> tem poderes para adicionar máquinas no domínio usando o
parâmetro <em>domain admins group</em>, devendo ser também adicionado no
arquivo <code>smbpasswd</code> para que possa fazer isto e obviamente não
deverá estar listado em <samp>invalid users</samp>.  Mesmo assim, existem
outras formas explicadas no guia de se contornar o risco causado pela liberação
de acesso do usuário <samp>root</samp>.

<hr>

<a name="s-s-samba-dom-logonscripts"></a>
<h3>18.7.7 Criando Scripts de logon</h3>

<p>
Uma dos recursos mais úteis em um domínio é a possibilidade de se executar
comandos nas máquinas cliente quando fazem o logon no domínio.  Desta forma, é
possível instalar programas, executar anti-vírus, mapear compartilhamentos
automaticamente no clientes, etc.  A programação de scripts de logon é feita
usando a linguagem em lote do DOS, com possibilidades de usar variáveis de
ambiente, cópia de arquivos entre servidores, etc.  O guia não irá abordar a
programação em linguagem de lote, mas isto é simples de se encontrar na
internet e mesmo a documentação que acompanha o próprio <code>Windows</code> é
útil.

<p>
Para habilitar o recurso de scripts de logon na máquina, adicione os seguintes
parâmetros no arquivo <code>smb.conf</code>:

<pre>
     [global]
     domain logons = yes
     logon script = logon.cmd
     
     [netlogon]
         path = /pub/samba/netlogon
         read only = yes
         write list = ntadmin
</pre>

<p>
Segue a descrição de cada parâmetro com detalhes importantes para a
configuração e funcionamento do recurso de logon:
<ul>
<li>
<samp>domain logons</samp> - Deve ser definido para <samp>yes</samp> para
ativar o recurso de logon scripts do SAMBA.
</li>
</ul>
<ul>
<li>
<samp>logon drive</samp> é a unidade de disco que terá o homedir do usuário
mapeado.  Isto somente é usado por máquinas NT/2000/XP.
</li>
</ul>
<ul>
<li>
<samp>logon script</samp> - Define qual é o script que será executado na
máquina cliente quando fizer o logon.  Ele deve ser gravado no diretório
especificado pela opção <samp>path</samp> do compartilhamento
<samp>[netlogon]</samp> (<code>/pub/samba/netlogon</code> no exemplo).  Os
scripts de logon podem ser tanto em formato <code>.bat</code> ou
<code>.cmd</code>.  Se for programar um script universal, é recomendável o uso
do formato <code>.bat</code> por ser compatível tanto com <code>Win9X</code> e
<code>WinNT</code>.
</li>
</ul>

<p>
Um detalhe que deve ser lembrado durante a programação do script de logon é que
ele <strong>DEVE</strong> seguir o formato DOS, ou seja, ter os caracteres
<samp>CR+LF</samp> como finalizador de linhas.  Para utilizar editores do UNIX
para escrever este script, será necessário executar o programa
<code>flip</code> (<samp>flip -m -b arquivo</samp>) ou <code>unix2dos</code> no
arquivo para converte-lo em formato compatível com o DOS.

<p>
Segue abaixo um exemplo de script de logon que detecta quando o cliente é
Windows 95/NT, ajusta a hora com o servidor e mapeia 2 unidades de disco:

<pre>
     @echo off
     cls
     rem Logon Script desenvolvido por Gleydson Mazioli 
     rem da Silva como modelo para o guia Foca GNU/Linux
     rem
     rem Este script pode ser utilizado para fins didáticos
     rem e distribuído livremente de acordo com os termos
     rem da GPL 
     rem 
     echo &quot;Aguarde enquanto sua máquina efetua&quot;
     echo &quot;o logon na rede do domínio focalinux.&quot;
     rem 
     if %OS%==Windows_NT goto NT-2000
     rem 
     echo &quot;--------------------------------&quot;
     echo &quot;SO: %OS%&quot;
     echo &quot;Usuário: %USERNAME%&quot;
     echo &quot;Grupo de Trabalho: %LANGROUP%&quot;
     echo &quot;Servidor: %DOMINIO%&quot;
     echo &quot;--------------------------------&quot;
     echo &quot;Recuperando compartilhamentos&quot;
     rem mapeia o compartilhamento publico definido no servidor
     net use e: \\gleydson\publico
     echo &quot;Sincronizando data/hora&quot;
     rem sincroniza a data/hora com o servidor
     net time \\gleydson /set /yes
     goto fim
     rem
     rem
     :NT-2000
     echo &quot;--------------------------------&quot;
     echo &quot;SO: %OS%&quot;
     echo &quot;Usuário: %USERNAME%&quot;
     echo &quot;Windows: %windir%&quot;
     echo &quot;Logon de domínio: %LOGONSERVER%&quot;
     echo &quot;--------------------------------&quot;
     echo &quot;Recuperando compartilhamentos&quot;
     net use e: \\gleydson\publico /persistent:yes
     echo &quot;Sincronizando data/hora&quot;
     net time \\gleydson /set /yes
     rem
     rem
     goto fim
     rem
     :fim
</pre>

<p>
Note no exemplo acima que não podem haver linhas em branco, você deverá
utilizar a palavra <var>rem</var> (comentário em arquivos em lote) em seu
lugar.  Note que existem diferenças entre o comando <code>net</code> do Windows
9x/ME e do NT, as variáveis também possuem um significado diferente entre estes
2 sistemas, isto explica a necessidade de se incluir um bloco separado
detectando a existência de qual sistema está sendo efetuado o logon.

<p>
A lista completa de variáveis disponíveis para cada sistema operacional pode
ser obtida colocando-se <samp>set &gt;c:\vars.txt</samp> que gravará uma lista
de variáveis disponíveis durante o logon no arquivo <code>c:\vars.txt</code> da
máquina cliente.

<p>
<strong>OBS:</strong> Caso especifique um computador que contém o script de
login, lembre-se de faze-lo sempre com <samp>\</samp> ao invés de
<samp>/</samp> para não ter incompatibilidade com o <code>Windows
95/3.11</code>.

<p>
<strong>ATENÇÃO:</strong> Lembre-se que copiar e colar pode não funcionar para
este script.  Leia novamente esta seção do guia se estiver em dúvidas.

<hr>

<a name="s-s-samba-dom-profiles"></a>
<h3>18.7.8 Configurando perfis de usuários</h3>

<p>
Os profiles permitem que os clientes utilizem o mesmo perfil em qualquer
máquina que ele se autentique na rede.  Isto é feito após a autenticação
copiando os arquivos que contém os dados de personalização de usuários
(<code>user.dat</code>, <code>NTuser.dat</code>) para a máquina local.  Este
processo também inclui a cópia de papéis de parede, links da área de trabalho,
cache do IE, etc.  Para configurar o recurso de perfis móveis no domínio, é
necessário adicionar os seguintes parâmetros no seu arquivo
<code>smb.conf</code>:

<pre>
     [global]
     security = user
     encrypt passwords = yes
     domain logons = yes
     logon drive = H:
     logon path = \\%N\profilesNT\%u
     logon home  = \\%N\profiles\%u
     preserve case = yes
     short preserve case = yes
     case sensitive = no
     
     [profiles]
         path = /pub/profiles
         read only = no
         create mask = 0600
         directory mask = 0700
     
     [profilesNT]
         path = /pub/profilesNT
         read only = no
         create mask = 0600
         directory mask = 0700
</pre>

<p>
Segue a descrição dos parâmetros de detalhes para seu funcionamento:
<ul>
<li>
O parâmetro <samp>domain logons = yes</samp> especifica que o servidor será
usado para fazer logons no domínio.  Quando este parâmetro é definido para
<samp>yes</samp>, a máquina automaticamente tentará ser o PDC.
</li>
<li>
<samp>logon path</samp> e <samp>logon home</samp> definem (respectivamente) o
diretório de logon do <code>/pub/profilesNT/usuario</code> (<code>NT</code>) e
<code>/pub/profiles/usuario</code> (<code>Win95</code>) respectivamente.
Durante o logon, a variável <samp>%N</samp> será substituída pelo nome do
servidor (ou servidor de diretórios, se for o caso) e a variável
<samp>%u</samp> pelo nome do usuário.
<p>
O sistema operacional de origem é detectado no momento da conexão.  Isto
significa que o usuário poderá ter 2 profiles diferentes, de acordo com o tipo
de sistema operacional cliente que estiver conectando.
</li>
<li>
O diretório home do usuário será mapeado para a unidade <samp>H:</samp>
(<samp>logon drive = h:</samp>).  O parâmetro <samp>logon drive</samp> somente
é usado pelo NT/2000/XP.
</li>
<li>
As opções <samp>preserve case</samp>, <samp>short preserve case</samp> e
<samp>case sensitive</samp> permite que os nomes dos arquivos/diretórios tenham
as letras maiúsculas/minúsculas mantidas, isto é requerido para os profiles.
</li>
</ul>

<p>
O compartilhamento dos 2 profiles pode ser feito sem tantos traumas, mas isto
não será explicado profundamente no guia pois o procedimento segue o mesmo
padrão do NT sendo bastante documentado na internet.

<p>
Note que é possível definir um servidor separado para servir os profiles para
um domínio modificando a variável <samp>%N</samp> para apontar direto para a
máquina.  Na máquina que armazenará os profiles, basta definir o nível de
segurança por <samp>servidor</samp> (<samp>security = server</samp>) e o
endereço IP do servidor de senhas (<samp>password server = IP</samp>).

<p>
<strong>OBS1:</strong> Os perfis só funcionam caso o servidor de profiles
contenha a opção <samp>security = user</samp> e <samp>encrypt passwords =
yes</samp> ou <samp>security = server</samp> e <samp>password server =
endereço_IP</samp>.  Caso tenha problemas, verifique se uma destas alternativas
está correta.

<p>
<strong>OBS2:</strong> Quando utiliza o SAMBA com o Windows 2000 SP2, é
necessário adicionar a opção <samp>nt acl support = no</samp> no
compartilhamento <samp>[profiles]</samp>, caso contrário, ele retornará um erro
de acesso ao compartilhamento.

<hr>

<a name="s-s-samba-dom-perm-clientes"></a>
<h3>18.7.9 Modificações de permissões de acesso pelos clientes do domínio</h3>

<p>
Um usuário do Windows NT (ou versões baseadas neste) pode modificar as
permissões dos arquivos/diretórios que tem acesso através da caixa de diálogo
de listas de acesso do NT, lembrando que estas permissões nunca substituirão as
definidas pelo administrador local.

<p>
A opção &quot;nt acl support&quot; deverá estar definida para &quot;yes&quot;
na seção <samp>[global]</samp> do arquivo de configuração, caso contrário você
não terá acesso para mudar as permissões através de caixas de diálogo do NT.  \

<hr>

<a name="s-s-samba-senhas-crypto"></a>
<h2>18.8 Ativando o suporte a senhas criptografadas</h2>

<p>
O uso de senhas criptografadas é um requisito quando você deseja configurar o
SAMBA para ser um servidor PDC ou um cliente de um domínio.  Quando utiliza
senhas criptografadas, elas trafegam em formato seguro através da rede,
dificultando a captura por outras pessoas.  Em versões mais recentes do Windows
(a partir da OSR/2 e NT 4 service pack3) o suporte a senhas criptografadas vem
habilitado como padrão para login e utilização de serviços da rede.  Não é
recomendável desativar o uso de senhas criptografadas, mas se mesmo assim for
necessário veja <a href="#s-s-samba-a-passwords">Senhas criptografadas ou em
texto puro?, Seção 18.12.15</a>.

<p>
Quando usamos senhas criptografadas, elas são armazenadas no arquivo
<code>/etc/samba/smbpasswd</code> ao invés do <code>/etc/passwd</code>, isto
permite que possamos controlar as permissões de usuários separadamente das do
sistema e diferenciar os logins do domínio dos logins do sistema (usuários que
possuem shell).  Caso tenha um servidor que já possua muitas contas de usuários
acessando em texto plano, recomendo ler <a
href="#s-s-samba-senhas-crypto-migrando">Migrando de senhas texto plano para
criptografadas, Seção 18.8.1</a> para facilitar o processo de migração de
contas.

<p>
O utilitário <code>smbpasswd</code> é o programa utilizado para gerenciar este
arquivo de senhas e também o status de contas de usuários/máquinas do domínio.
Siga estes passos para ativar o uso de senhas criptografadas no SAMBA:
<ol type="1" start="1" >
<li>
Edite o arquivo <code>/etc/samba/smb.conf</code> e altere as seguintes linhas
na seção <samp>[global]</samp> para adicionar o suporte a senhas
criptografadas:
<pre>
     [global]
     encrypt passwords = true
     smb passwd file =/etc/samba/smbpasswd
</pre>
<p>
A linha <samp>encrypt passwords = true</samp> diz para usar senhas
criptografadas e que o arquivo <code>/etc/samba/smbpasswd</code> contém as
senhas (<samp>smb passwd file =/etc/samba/smbpasswd</samp>).
<p>
Caso sua máquina seja apenas um cliente de rede (e não um PDC), você pode pular
para o passo onde o <code>SAMBA</code> é reiniciado (no final dessa lista), não
é necessária a criação do arquivo de senhas para autenticação pois os usuários
serão validados no servidor.
</li>
<li>
Execute o comando <samp>mksmbpasswd &lt;/etc/passwd
&gt;/etc/samba/smbpasswd</samp>.  Ele pega toda a base de usuários do
<code>/etc/passwd</code> e gera um arquivo <code>/etc/samba/smbpasswd</code>
contendo as contas destes usuários.  Por padrão, todas as contas são
DESATIVADAS por segurança quando este novo arquivo é criado.  O novo arquivo
terá o seguinte formato:
<pre>
     gleydson:1020:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:[U          ]:LCT-00000000:Gleydson Mazioli da Silva,,,
     geovani:1004:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:[U          ]:LCT-00000000:Geovani Mazioli da Silva,,,
</pre>
<p>
Os campos são separados por &quot;:&quot; e cada campo possui o seguinte
significado:
<ol type="1" start="1" >
<li>
O primeiro é o nome de usuário
</li>
<li>
UID do usuário no sistema UNIX que a conta será mapeada.
</li>
<li>
Senha Lan Manager codificada em hex 32 criado usando criptografia DES usada
pelo Windows 95/98/ME.
</li>
<li>
Senha hash criada em formato do NT codificada em hex 32.  Esta senha é criada
pegando a senha do usuário, convertendo-a para maiúsculas, adicionados 5 bytes
de caracteres nulos e aplicando o algoritmo md4.
</li>
<li>
Opções da conta criada no <code>smbpasswd</code>:
<ul>
<li>
<samp>U</samp> - Especifica que a conta é uma conta de usuário normal (veja <a
href="#s-s-samba-senhas-crypto-criando">Adicionando usuários no
<code>smbpasswd</code>, Seção 18.8.2</a>)
</li>
<li>
<samp>D</samp> - Significa que a conta foi desativada com a opção
<samp>-d</samp> (veja <a
href="#s-s-samba-senhas-crypto-desabilitando">Desabilitando uma conta no
<code>smbpasswd</code>, Seção 18.8.4</a>).
</li>
<li>
<samp>W</samp> - Especifica que a conta é uma conta de máquina criada com a
opção <samp>-m</samp> (veja <a href="#s-s-samba-dom-contasmac">Contas de
máquinas de domínio, Seção 18.7.5</a>).
</li>
<li>
<samp>N</samp> - A conta não possui senha (veja <a
href="#s-s-samba-senhas-crypto-nopasswd">Definindo acesso sem senha para o
usuário, Seção 18.8.7</a>).
</li>
</ul>
</li>
</ol>
<p>
Os caracteres &quot;XXXXXXXXXXXXXXX&quot; no campo da senha, indica que a conta
foi recém criada, e portanto está desativada.  O próximo passo é ativar a conta
para ser usada pelo SAMBA.
<p>
<strong>ATENÇÃO:</strong> O método de criptografia usado neste arquivo não é
totalmente seguro.  Recomendo manter o arquivo de senhas <code>smbpasswd</code>
em um diretório com a permissão de leitura somente pelo <samp>root</samp>.
</li>
<li>
Para ativar a conta do usuário <samp>gleydson</samp>, usamos o comando:
<pre>
     smbpasswd -U gleydson
</pre>
<p>
Digite a senha do usuário e repita para confirmar.  Assim que a senha for
definida, a conta do usuário é ativada.  Você também pode especificar a opção
&quot;-s&quot; para entrar com a senha pela entrada padrão (muito útil em
scripts).  Apenas tenha cuidado para que esta senha não seja divulgada em seus
arquivos/processos.
</li>
<li>
Reinicie o processo do SAMBA (veja <a href="#s-s-samba-rodando">Iniciando o
servidor/reiniciando/recarregando a configuração, Seção 18.1.9</a>).
</li>
<li>
Verifique se o suporte a senhas criptografadas está funcionando com o comando:
<pre>
      smbclient -L localhost -U gleydson
</pre>
<p>
Substitua <samp>localhost</samp> pelo IP do servidor e <samp>gleydson</samp>
pelo usuário.  Caso obtenha a mensagem <samp>session setup failed:
NT_STATUS_LOGON_FAILURE</samp> significa que a senha informada está incorreta.
</li>
</ol>

<hr>

<a name="s-s-samba-senhas-crypto-migrando"></a>
<h3>18.8.1 Migrando de senhas texto plano para criptografadas</h3>

<p>
No SAMBA, é possível fazer um processo de migração de senhas em texto plano de
usuários para criptografadas sem que eles deixem de acessar o servidor durante
esta mudança.  Caso este seja seu caso, insira o parâmetro

<pre>
     update encrypted = yes
</pre>

<p>
na seção <samp>[global]</samp> do seu arquivo de configuração
<code>smb.conf</code>.  A senha criptografada é definida assim que o usuário se
logar usando sua senha em texto plano.  Não se esqueça de desativar esta opção
ou remove-la após o prazo necessário para que todas as senhas sejam trocadas.

<hr>

<a name="s-s-samba-senhas-crypto-criando"></a>
<h3>18.8.2 Adicionando usuários no <code>smbpasswd</code></h3>

<p>
A adição de um usuário no <code>smbpasswd</code> segue duas etapas: primeiro é
necessário adiciona-lo no sistema com o <code>adduser</code> e depois no samba
com o <code>smbpasswd</code>.  Você deve estar se perguntando qual a vantagem
de se ter um arquivo separado de usuários se ainda é preciso criar o login nos
dois arquivos; O <code>SAMBA</code> para fazer o controle de acesso aos
arquivos utiliza além dos mecanismos tradicionais do NT, o controle de
permissões a nível UNIX para manter os arquivos ainda mais restritos.  Além
disso, será necessário usuários e grupos para criação e acesso ao sistema.
<ol type="1" start="1" >
<li>
Adicione um usuário no sistema com o comando:
<pre>
      useradd -g grupo-dominio -c &quot;Usuário de Domínio&quot; -s /bin/false -d /dev/null joao
</pre>
<p>
Este comando adiciona o usuário &quot;joao&quot; no grupo
<samp>grupo-dominio</samp> e não define hem uma shell, diretório home nem senha
para este usuário.  Isto mantém o sistema mais seguro e não interfere no
funcionamento do SAMBA, pois somente é necessário para fazer o mapeamento de
UID/GID de usuários com as permissões do sistema UNIX.
<p>
É interessante padronizar os usuários criados no domínio para um mesmo grupo
para pesquisa e outras coisas.
</li>
<li>
Crie o usuário &quot;joao&quot; no SAMBA:
<pre>
     smbpasswd -a joao
</pre>
<p>
Será solicitada a senha do usuário.
</li>
</ol>

<hr>

<a name="s-s-samba-senhas-crypto-removendo"></a>
<h3>18.8.3 Removendo usuários do <code>smbpasswd</code></h3>

<p>
Utilize o comando <samp>smbpasswd -x usuario</samp> para remover um usuário do
arquivo <code>smbpasswd</code>.  Se desejar, você pode manter o usuário no
<code>/etc/passwd</code> ou remove-lo com o <code>userdel</code>.

<p>
<strong>OBS:</strong> Removendo um usuário deste arquivo fará que ele não tenha
mais acesso ao SAMBA.  Utilize o comando <samp>smbpasswd -a teste</samp>

<hr>

<a name="s-s-samba-senhas-crypto-desabilitando"></a>
<h3>18.8.4 Desabilitando uma conta no <code>smbpasswd</code></h3>

<p>
Como administrador, pode ser necessário que precise desativar temporariamente
uma conta de usuário por alguma situação qualquer (má utilização de recursos,
dúvida se a conta está sendo usada, para que ele ligue reclamando de
autenticação para ter aquela desejada conversa (hehe), etc.).  Remover uma
conta e novamente adiciona-la então não é uma situação muito prática.  Utilize
então o seguinte comando para desativar uma conta de usuário:

<pre>
     smbpasswd -d usuario
</pre>

<p>
Quando a conta de usuário é desativada, uma flag &quot;D&quot; é adicionada às
opções do usuário (junto com as opções &quot;UX&quot;).  Veja <a
href="#s-s-samba-senhas-crypto-habilitando">Habilitando uma conta no
<code>smbpasswd</code>, Seção 18.8.5</a> para reativar a conta.

<hr>

<a name="s-s-samba-senhas-crypto-habilitando"></a>
<h3>18.8.5 Habilitando uma conta no <code>smbpasswd</code></h3>

<p>
Uma conta desativada com o uso do comando <samp>smbpasswd -d</samp> pode ser
novamente ativada usando:

<pre>
      smbpasswd -e usuario
</pre>

<hr>

<a name="s-s-samba-senhas-crypto-chpasswd"></a>
<h3>18.8.6 Alterando a senha de um usuário</h3>

<p>
O utilitário <code>smbpasswd</code> pode ser usado tanto para alterar a senha
de usuários locais do <code>SAMBA</code> ou de uma conta em um servidor remoto
(seja <code>SAMBA</code>, <code>NT</code>, <code>W2K</code>).  Para alterar a
senha de um usuário local, digite:

<pre>
     smbpasswd -U usuario
</pre>

<p>
Lhe será pedida a antiga senha, a nova senha e a confirmação.  Caso seja o
usuário <samp>root</samp>, somente a nova senha e a confirmação.  Isto é
mecanismo de proteção para usuários que esquecem a senha ;-)

<p>
Para alterar a senha de um usuário remoto, utilize:

<pre>
     smbpasswd -r servidor -U usuario
</pre>

<p>
Note que apenas foi adicionada a opção <samp>-r servidor</samp> comparado com a
opção anterior.  A diferença é que a senha antiga do usuário sempre será
solicitada para troca (pois o root das 2 máquinas pode não ser o mesmo).

<hr>

<a name="s-s-samba-senhas-crypto-nopasswd"></a>
<h3>18.8.7 Definindo acesso sem senha para o usuário</h3>

<p>
Para fazer um usuário acessar sem senha, use o comando:

<pre>
     smbpasswd -n usuario
</pre>

<p>
Isto é completamente desencorajado e necessita que a opção <samp>null
passwords</samp> da seção <samp>[global]</samp> no arquivo
<code>smb.conf</code> esteja ajustada para <em>yes</em> (<strong>que NÃO é o
padrão</strong>).

<hr>

<a name="s-s-samba-senhas-plano"></a>
<h2>18.9 Ativando o suporte a senhas em texto plano</h2>

<p>
Esta forma de autenticação é enviada por implementações NetBIOS antigas, como a
encontrada no <code>Lan Manager</code>, <code>Windows for Workgroups</code> e
<code>Windows 95 OSR1</code>.  As versões mais novas destas implementações
enviam a senha em formato criptografado, sendo necessário também usar o formato
criptografado no SAMBA para que possa se autenticar (veja <a
href="#s-s-samba-senhas-crypto">Ativando o suporte a senhas criptografadas,
Seção 18.8</a>).

<p>
Em <a href="#s-s-samba-a-passwords">Senhas criptografadas ou em texto puro?,
Seção 18.12.15</a> é feita uma comparação entre o uso de autenticação usando
senhas em texto plano e senhas criptografadas.  Em geral, o administrador
prefere a utilização da autenticação usando texto plano quando deseja usar o
<code>/etc/passwd</code> para autenticação e está usando grupos de trabalho é
necessário usar senhas criptografadas para autenticação).

<p>
Para configurar o <code>SAMBA</code> para utilizar senhas em texto, modifique o
parâmetro <samp>encrypt passwords</samp> para <samp>no</samp>:

<pre>
     [global]
     encrypt passwords = no
</pre>

<p>
Reinicie o <code>SAMBA</code> (<a href="#s-s-samba-rodando">Iniciando o
servidor/reiniciando/recarregando a configuração, Seção 18.1.9</a>) e a partir
de agora, ele usará o <code>/etc/passwd</code> para autenticação.

<p>
<strong>OBS:</strong> Tenha certeza de não estar participando de um domínio ou
que sua máquina seja o PDC antes de fazer esta modificação.

<hr>

<a name="s-s-samba-senhas-plano-c"></a>
<h3>18.9.1 Configurando o acesso de clientes para uso de senhas em texto plano</h3>

<p>
Esta seção descreve como configurar clientes para acessar o servidor
<code>SAMBA</code> usando autenticação em texto plano.  Atualmente o guia cobre
os seguintes clientes:
<ul>
<li>
<a href="#s-s-samba-senhas-plano-c-lanmanager">Lan Manager, Seção 18.9.1.1</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-wfw">Windows for Workgroups, Seção
18.9.1.2</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-win95a">Windows 95 / Windows 95A, Seção
18.9.1.3</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-win95b">Windows 95B, Seção 18.9.1.4</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-win98">Windows 98/98SE, Seção 18.9.1.5</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-winME">Windows ME, Seção 18.9.1.6</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-winNT">Windows NT Server/WorkStation, Seção
18.9.1.7</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-win2000">Windows 2000, Seção 18.9.1.8</a>
</li>
<li>
<a href="#s-s-samba-senhas-plano-c-linux">Linux, Seção 18.9.1.9</a>
</li>
</ul>

<p>
Em cada seção, também é explicado como habilitar novamente a autenticação
usando senhas criptografadas (se suportado pelo cliente).

<hr>

<a name="s-s-samba-senhas-plano-c-lanmanager"></a>
<h4>18.9.1.1 Lan Manager</h4>

<p>
Cliente NetBIOS para DOS.  Ele trabalha somente com senhas em texto plano.

<hr>

<a name="s-s-samba-senhas-plano-c-wfw"></a>
<h4>18.9.1.2 Windows for Workgroups</h4>

<p>
Este é o padrão de autenticação do <code>Windows for Workgroups</code> caso não
tenha feito nenhuma alteração específica (mas desconheço algo que faça-o
trabalhar com senhas criptografadas).

<hr>

<a name="s-s-samba-senhas-plano-c-win95a"></a>
<h4>18.9.1.3 Windows 95 / Windows 95A</h4>

<p>
O <code>Windows 95</code> até a release &quot;A&quot;, utiliza texto plano como
padrão para autenticação (veja qual a release clicando com o botão direito em
<em>Meu Computador</em> e <em>Propriedades</em>.

<hr>

<a name="s-s-samba-senhas-plano-c-win95b"></a>
<h4>18.9.1.4 Windows 95B</h4>

<p>
Copie o seguinte conteúdo para um arquivo chamado
<code>win95-textoplano.reg</code>:

<pre>
     REGEDIT4
     
     [HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\VNETSUP]
     &quot;EnablePlainTextPassword&quot;=dword:00000001
</pre>

<p>
Após isto, execute no <code>Windows 95</code> o seguinte comando: <samp>regedit
win95-textoplano.reg</samp> e reinicie o computador para fazer efeito.

<p>
Para voltar a utilizar criptografia, apenas altere o valor <samp>dword</samp>
para <samp>00000000</samp> no arquivo e executa novamente o
<code>regedit</code>.

<hr>

<a name="s-s-samba-senhas-plano-c-win98"></a>
<h4>18.9.1.5 Windows 98/98SE</h4>

<p>
O procedimento é idêntico ao <a href="#s-s-samba-senhas-plano-c-win95b">Windows
95B, Seção 18.9.1.4</a>.

<hr>

<a name="s-s-samba-senhas-plano-c-winME"></a>
<h4>18.9.1.6 Windows ME</h4>

<p>
O procedimento é idêntico ao <a href="#s-s-samba-senhas-plano-c-win95b">Windows
95B, Seção 18.9.1.4</a>.

<hr>

<a name="s-s-samba-senhas-plano-c-winNT"></a>
<h4>18.9.1.7 Windows NT Server/WorkStation</h4>

<p>
Copie o seguinte conteúdo para um arquivo chamado
<code>winNT-textoplano.reg</code>:

<pre>
     REGEDIT4
     
     [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Rdr\Parameters]
     &quot;EnablePlainTextPassword&quot;=dword:00000001
</pre>

<p>
Após isto, execute no <code>Windows NT</code> o seguinte comando: <samp>regedit
winNT-textoplano.reg</samp> e reinicie o computador para fazer efeito.

<p>
Para voltar a utilizar criptografia, apenas altere o valor <samp>dword</samp>
para <samp>00000000</samp> no arquivo e execute novamente o
<code>regedit</code>.

<hr>

<a name="s-s-samba-senhas-plano-c-win2000"></a>
<h4>18.9.1.8 Windows 2000</h4>

<p>
Copie o seguinte conteúdo para um arquivo chamado
<code>win2000-textoplano.reg</code>:

<pre>
     REGEDIT4
     
     [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkStation\Parameters]
     &quot;EnablePlainTextPassword&quot;=dword:00000001
</pre>

<p>
Após isto, execute no <code>Windows 2000</code> o seguinte comando:
<samp>regedit win2000-textoplano.reg</samp> e reinicie o computador para fazer
efeito.

<p>
Para voltar a utilizar criptografia, apenas altere o valor <samp>dword</samp>
para <samp>00000000</samp> no arquivo e execute novamente o
<code>regedit</code>.

<hr>

<a name="s-s-samba-senhas-plano-c-linux"></a>
<h4>18.9.1.9 Linux</h4>

<p>
Inclua/modifique a linha <samp>encrypt passwords = no</samp> no arquivo
<code>smb.conf</code> e reinicie o <code>SAMBA</code>.  Para voltar a utilizar
criptografia, veja <a href="#s-s-samba-senhas-crypto">Ativando o suporte a
senhas criptografadas, Seção 18.8</a>.

<hr>

<a name="s-s-samba-usermap"></a>
<h2>18.10 Mapeamento de usuários/grupos em clientes</h2>

<p>
O mapeamento de usuários do servidor remoto com a máquina local é usado quando
você deseja controlar o acesso aos arquivos/diretórios a nível de usuário.  No
<code>Windows</code> isto permite que cada arquivo/diretório tenha o acesso
leitura/gravação somente para os usuários definidos e autenticados no
controlador de domínio.  No <code>Linux</code> as permissões de arquivos e
diretórios podem ser definidas para o usuário do PDC, garantindo o mesmo nível
de controle de acesso.

<p>
Esta seção explica como configurar o mapeamento de UID/GID entre o servidor PDC
SAMBA e seus clientes NetBIOS Windows e Linux.

<hr>

<a name="s-s-samba-usermap-w"></a>
<h3>18.10.1 Mapeamento de usuários/grupos domínio em Windows</h3>

<p>
Para o <code>Windows</code> utilizar os usuários remotos do servidor para fazer
seu controle de acesso por nível de usuário, siga os seguintes passos:
<dl>
<dt>Windows 9X</dt>
<dd>
Entre no <em>Painel de Controle</em>/<em>Propriedades de Rede</em> e clique na
tab <em>Controle de Acesso</em>.  Marque a opção <em>Controle de acesso a nível
de usuário</em> e coloque o nome da máquina PDC na caixa de diálogo de onde os
usuários/grupos serão obtidos.  Você também pode colocar o nome do grupo de
trabalho, neste caso a máquina fará uma busca pelo PDC ou outra máquina de onde
pode obter os nomes de usuários/grupos.
<p>
<strong>OBS:</strong> Para fazer isto, você deverá estar autenticado no
domínio.
</dd>
</dl>

<hr>

<a name="s-s-samba-usermap-l"></a>
<h3>18.10.2 Mapeamento de usuários/grupos domínio em Linux</h3>

<p>
A associação de UIDs de usuários de um domínio com usuários locais no
<code>Linux</code> é feita pelo programa <code>winbind</code>.  Ele utiliza o
mecanismo <code>nsswitch</code> para obter outras fontes de dados de usuários e
os associa nas ferramentas de gerenciamento de contas existentes no sistema.
Siga estes passos para fazer sua instalação e configuração do
<code>Winbind</code> em um servidor <code>Linux</code>:
<ul>
<li>
Instale o programa <code>winbind</code>: <samp>apt-get install winbind</samp>.
</li>
<li>
Modifique o arquivo <code>smb.conf</code> adicionando as seguintes linhas na
seção <samp>[global]</samp>:
<pre>
     winbind separator = +
     winbind cache time = 30
     winbind uid = 10000-15000
     winbind gid = 10000-12000
     winbind enum users = yes
     winbind enum groups = yes
     template homedir = /home/winbind/%D/%U
     template shell = /bin/false
</pre>
<p>
Onde
<dl>
<dt>winbind separator</dt>
<dd>
Separador usado para separar o nome dos grupos do nome de domínio.  Este
parâmetro somente tem sentido quando usado em conjunto com um PDC Windows ou
quando os módulos <code>pam_winbind.so</code> e <code>nss_winbind.so</code>
estão sendo utilizados.
</dd>
<dt>winbind cache time</dt>
<dd>
Define a quantidade de tempo em segundos que um nome/grupo permanecerá no cache
local para não ser feita uma nova consulta no servidor PDC.
</dd>
<dt>winbind uid</dt>
<dd>
Especifica o intervalo que será usado para mapear os nomes de usuários remotos
como UIDs locais.  Você precisará ter certeza que nenhum UID nesse intervalo é
usado no sistema, como pelo LDAP, NIS ou usuários normais.  Por padrão, os IDS
de usuários normais na maioria dos sistemas Linux, começam por 1000.  No
exemplo serão usados os UIDs de 10000 a 15000 para mapeamento e UIDs dos
usuários do domínio para usuários locais.
</dd>
<dt>winbind gid</dt>
<dd>
Especifica o intervalo de GIDs que será usado para mapear os nomes de grupos
remotos do domínio como GIDs locais.  Como no parâmetro <samp>winbind
uid</samp>, você deverá ter certeza que esta faixa de GIDs não está sendo usada
em seu sistema.
<p>
<strong>OBS:</strong> Atualmente <code>SAMBA</code> não possui suporte a grupos
globais, apenas para usuários globais, desta forma os grupos da máquina remota
não serão trazidos para o sistema.  Uma forma de contornar isto, é utilizando o
LDAP ou o NIS no PDC e nos clientes <code>Linux</code>.
</dd>
<dt>winbind enum users</dt>
<dd>
Permite enumerar usuários do winbind para retornarem dados quando solicitados.
A não ser que possua uma instalação parecida em todas as máquinas (como com o
uso de LDAP e NIS) responda &quot;yes&quot; para não ter problemas.
</dd>
<dt>winbind enum groups</dt>
<dd>
Permite enumerar grupos do winbind para retornarem dados quando solicitados.  A
não ser que possua uma instalação parecida em todas as máquinas (como com o uso
de LDAP e NIS) responda &quot;yes&quot; para não ter problemas.
</dd>
<dt>template homedir</dt>
<dd>
Quando o sistema cliente for um Windows NT ou baseado, este diretório será
retornado como diretório de usuário para o sistema.  O parâmetro %D será
substituído pelo nome do domínio e %U pelo nome de usuário durante a conexão.
</dd>
<dt>template shell</dt>
<dd>
Este será o shell enviado para máquinas NT ou baseadas nele como shell usado
para login.  O valor usado foi <code>/bin/false</code> pois desabilita os
logons, mas você poderá usar <code>/bin/sh</code> (ou algum outro shell) para
efetuar conexões do comando <code>net</code> ou outras ferramentas NetBEUI ao
servidor.
</dd>
</dl>
</li>
<li>
Reinicie o servidor <code>SAMBA</code>
</li>
<li>
Edite o arquivo <code>/etc/nsswitch.conf</code> alterando a ordem de pesquisa
de nomes de usuários e grupos do sistema local para a seguinte:
<pre>
     passwd:         files winbind
     group:          files winbind
     shadow:         compat
</pre>
</li>
<li>
Agora, inicie o daemon <code>winbind</code> local com o comando:
<samp>/etc/init.d/winbind restart</samp>.
</li>
<li>
Entre no domínio com o comando: <samp>smbpasswd -j domínio -r nome_do_PDC -U
usuario</samp> (veja <a href="#s-s-samba-c-dominio-linux">Linux, Seção
18.14.3.9</a> para aprender como entrar no domínio em caso de dúvidas).
</li>
<li>
Agora faça o teste para obter a listagem dos grupos e usuários do domínio do
PDC digitando:
<pre>
     wbinfo -u
     wbinfo -g
     getent passwd
     getent group
</pre>
<p>
Caso isto não aconteça, revise suas configurações e veja os logs procurando por
erros quando o <code>winbind</code> tenta obter a lista de usuários/grupos do
domínio.
</li>
</ul>

<p>
Agora você deve ser capaz de criar diretórios/arquivos locais usando os nomes
de usuários/grupos do domínio.  Lembre-se de reiniciar sempre o
<code>winbind</code> quando reiniciar o SAMBA por alguma modificação for feita
(ao mesmo que saiba que não afeta o <code>winbind</code>), assim como entrar
novamente no domínio, caso contrário o mapeamento deixará de funcionar.

<p>
<strong>OBS:</strong> Atualmente, o <code>winbind</code> não oferece suporte a
restrições por data/hora de logon para estações de trabalho.  Isto deverá ser
implementado em uma futura versão

<hr>

<a name="s-s-samba-i"></a>
<h2>18.11 Compartilhamento de impressão no servidor SAMBA</h2>

<p>
Este capítulo documenta como configurar o seu servidor samba para permitir o
acesso a compartilhamento de arquivos e impressão no sistema.

<hr>

<a name="s-s-samba-i-win-linux"></a>
<h3>18.11.1 Configurando o Linux como um servidor de impressão Windows</h3>

<p>
Será necessário ter o pacote <code>samba</code> instalado e adicionar as
seguintes linhas no seu arquivo <code>/etc/samba/smb.conf</code>:

<pre>
     [hp-printer]
      path = /tmp
      printer name=HP DeskJet 690C
      printable = yes
      print command = lpr -r -h -P %p %s
      valid users = winuser winuser2
      create mode = 0700
</pre>

<p>
O compartilhamento acima tornará disponível a impressora local &quot;lp&quot;
as máquinas Windows com o nome &quot;HP DeskJet 690C&quot;.  Uma impressora
alternativa pode ser especificada modificando a opção <em>-P</em> da linha de
comando do <code>lpr</code>.  Note que somente os usuários &quot;winuser&quot;
e &quot;winuser2&quot; poderão usar esta impressora.  Os arquivos de spool
(para gerenciar a fila de impressão) serão gravador em <code>/tmp</code>
(<samp>path = /tmp</samp>) e o compartilhamento <samp>[hp-printer]</samp> será
mostrado como uma impressora (<samp>printable = yes</samp>).

<p>
Agora será necessário instalar o driver desta impressora no Windows (HP 690C) e
escolher impressora instalada via rede e seguir os demais passos de
configuração.

<hr>

<a name="s-s-samba-a"></a>
<h2>18.12 Controle de acesso ao servidor SAMBA</h2>

<p>
Este capítulo documenta o controle de acesso ao servidor samba e restrições.

<hr>

<a name="s-s-samba-a-compart"></a>
<h3>18.12.1 Nível de acesso de usuários conectados ao SAMBA</h3>

<p>
Quando acessa um compartilhamento, o usuário do samba é mapeado com o UID
respectivo de usuário do sistema ou o usuário guest (especificado pela opção
&quot;guest account&quot;) no caso de um acesso público.  Quando isto ocorre,
um processo filho do <code>smbd</code> é executado sobre o UID e GID deste
usuário.  Isto significa que em nenhuma ocasião o <code>SAMBA</code> dará mais
permissões que as necessárias para o usuário (com excessão de quando é usado o
parâmetro <samp>admin users</samp>, veja <a href="#s-s-samba-dom-admin">Criando
uma conta de administrador de domínio, Seção 18.7.6</a>).

<hr>

<a name="s-s-samba-a-restrip"></a>
<h3>18.12.2 Restringindo o acesso por IP/rede</h3>

<p>
Esta restrição pode ser feita pelos parâmetros <em>allow hosts</em> e <em>deny
hosts</em> tanto em serviços individuais ou em todo o servidor.  Os parâmetros
<em>hosts allow</em> e <em>hosts deny</em> são equivalentes a estes acima.  O
<em>allow hosts</em> permite o acesso a máquina especificadas como argumento.
São permitidos os seguintes métodos para permitir o acesso a uma máquina/rede:
<ul>
<li>
<samp>192.168.1.1</samp> - IP da máquina
</li>
<li>
<samp>servidor</samp> - Nome da máquina
</li>
<li>
<samp>192.168.1.0/255.255.255.0</samp> - IP com máscara de rede
</li>
<li>
<samp>192.168.1.0/24</samp> - IP com máscara de rede octal
</li>
<li>
<samp>192.168.1.</samp> - Porção de rede sem o host (como no
<code>hosts.allow</code> e <code>hosts.deny</code>.
</li>
<li>
<samp>@nome</samp> - Pesquisa por máquinas no grupo NIS.
</li>
</ul>

<p>
É permitido usar mais de um endereço IP separando-os por vírgulas ou espaços.
A palavra chave <em>EXCEPT</em> pode ser usada para fazer excessão de um ou
mais endereços IPs, por exemplo:

<pre>
     hosts allow = 192.168.1. EXCEPT 192.168.1.20
</pre>

<p>
Que permite o acesso a toda as máquinas da faixa de rede
<samp>192.168.1.0/24</samp> exceto para a <samp>192.168.1.20</samp>.

<p>
O <em>deny hosts</em> possui a mesma sintaxe do <em>allow hosts</em> mas
bloqueia o acesso das máquinas especificadas como argumento.  Quando o
<em>allow hosts</em> e <em>deny hosts</em> são usados juntos, as máquinas em
<em>allow hosts</em> terão prioridade (processa primeiro as diretivas em
<em>allow hosts</em> e depois em <em>deny hosts</em>).

<p>
<strong>OBS:</strong> O endereço de loopback (127.0.0.1) nunca é bloqueado
pelas diretivas de acesso.  Provavelmente deve ter notado porque o endereço de
loopback não pode ser bloqueado e as conseqüências disto para o SAMBA.

<p>
Se você está executando o SAMBA via <em>inetd</em>, os arquivos
<code>hosts.allow</code> e <code>hosts.deny</code> são verificados antes do
controle e acesso <em>allow hosts</em> e <em>deny hosts</em> para controle de
acesso ao <code>smbd</code>.  Caso estiver usando o SAMBA via<em>inetd</em> e
deseja restringir o acesso usando TCP Wrappers, veja <a
href="ch-rede.html#s-rede-seg-tcpd">O mecanismo de controle de acessos tcpd,
Seção 4.8.3</a>.

<p>
<strong>OBS:</strong> Lembre-se de usar o <code>testparm</code> para verificar
a sintaxe do arquivo <code>smb.conf</code> sempre que desconfiar de problemas
(veja <a href="#s-s-samba-s-testparm">Buscando problemas na configuração, Seção
18.2.11</a>).

<hr>

<a name="s-s-samba-a-restrip-test"></a>
<h4>18.12.2.1 Testando a restrição de Acesso por IP/Redes</h4>

<p>
Um método interessante e útil para testar se a nossa configuração vai bloquear
o acesso a serviços é usando o <code>testparm</code> da seguinte forma:

<pre>
     testparm /etc/samba/smb.conf IP/host
</pre>

<p>
Você precisará dizer para o <code>testparm</code> qual é o arquivo de
configuração que está usando e o endereço IP/nome de host que fará a
<samp>simulação</samp> de acesso.  Este método não falsifica o endereço IP para
testes, apenas usa os valores em <em>allow hosts</em> e <em>deny hosts</em>
para checagem.  Por exemplo, para verificar o acesso vindo do IP
<code>192.168.1.50</code>:

<pre>
     testparm /etc/samba/smb.conf 192.168.1.50
     Load smb config files from /etc/samba/smb.conf
     Processing section &quot;[homes]&quot;
     Processing section &quot;[printers]&quot;
     Processing section &quot;[tmp]&quot;
     Processing section &quot;[cdrom]&quot;
     Loaded services file OK.
     Allow connection from /etc/samba/smb.conf (focalinux) to homes
     Allow connection from /etc/samba/smb.conf (focalinux) to printers
     Allow connection from /etc/samba/smb.conf (focalinux) to tmp
     Allow connection from /etc/samba/smb.conf (focalinux) to cdrom
</pre>

<hr>

<a name="s-s-samba-a-restrif"></a>
<h3>18.12.3 Restringindo o acesso por interface de rede</h3>

<p>
Esta restrição de acesso permite que façamos o SAMBA responder requisições
somente para a interfaces indicadas.  O método de segurança descrito em <a
href="#s-s-samba-a-restrip">Restringindo o acesso por IP/rede, Seção
18.12.2</a> serão analisadas logo após esta checagem.

<p>
Para restringir o serviço SAMBA a interfaces, primeiro será necessário ativar o
parâmetro <samp>bind interfaces only</samp> usando <samp>1</samp>,
<samp>yes</samp> ou <samp>true</samp> (o padrão é desativado).  Depois, definir
que interfaces serão servidas pelo samba com o parâmetro <em>interfaces</em>.
Os seguintes formatos de interfaces são permitidos:
<ul>
<li>
<samp>eth0, sl0, plip0, etc</samp> - Um nome de interface local.  É permitido o
uso de <samp>*</samp> para fazer o SAMBA monitorar todas as interfaces que
iniciam com aquele nome (por exemplo, <code>eth*</code>).
</li>
<li>
<samp>192.168.1.1, 192.168.1.2, etc</samp> - Um endereço IP de interface local.
</li>
<li>
<samp>192.168.1.2/24, 192.168.1.2/255.255.255.0</samp> - Um par de
endereço/máscara de rede.
</li>
</ul>

<p>
Mais de uma interface pode ser usada separando-as com vírgula ou espaços.  A
escolha do uso de nome da interface ou do IP é feita de acordo com a
configuração da máquina.  Em uma máquina DHCP por exemplo, é recomendado o uso
do nome da interface.  Quando <em>bind interfaces only</em> estiver ativado, o
padrão é esperar conexões em todas as interfaces que permitem broadcast exceto
a loopback.

<p>
Exemplo:

<pre>
     bind interfaces only = 1
     interfaces = loopback eth0
</pre>

<p>
Permite o recebimento de requisições de acesso ao <code>SAMBA</code> somente da
interface <code>loopback</code> (desnecessário, pois como notou durante a
leitura, sempre é permitida a conexão) e <code>eth0</code>.

<hr>

<a name="s-s-samba-a-restrusu"></a>
<h3>18.12.4 Restringindo o acesso por usuários</h3>

<p>
Permite que você controle quem poderá ou não acessar o compartilhamento da
máquina.  Este controle é feito pelos parâmetros <em>valid users</em> e
<em>invalid users</em>.

<p>
O <em>invalid users</em> lista de usuário que <strong>NÃO</strong> terão acesso
ao compartilhamento.  Se o nome for iniciado por &quot;+&quot; o parâmetro será
tratado como um nome de grupo UNIX (<code>/etc/group</code>).  O caracter
&quot;&amp;&quot; faz ele pesquisar o nome de grupo no banco de dados NIS.  O
caracter &quot;@&quot; permite fazer a busca do grupo primeiro no banco de
dados NIS e caso ele não seja encontrado, no arquivo de grupos do sistema
(<code>/etc/group</code>).

<p>
É possível usar a combinação de caracteres &quot;+&amp;&quot; e
&quot;&amp;+&quot; para alternar a ordem de busca enter o
<code>/etc/group</code> e o <em>NIS</em>.

<p>
Exemplos:
<dl>
<dt>invalid users = junior, marcio, +badusers</dt>
<dd>
Não permite que os usuários especificados e os usuários do grupo
<samp>+badusers</samp> tenham acesso ao compartilhamento.
</dd>
<dt>invalid users = &amp;;semacesso</dt>
<dd>
Bloqueia o acesso de todos os usuários NIS que pertençam ao grupo
<samp>semacesso</samp>.
</dd>
<dt>invalid users = bruno, henrique, +@users,</dt>
<dd>
Bloqueia o acesso dos usuários bruno, henrique e de todos os usuários que
pertençam ao grupo <samp>users</samp>.  A pesquisa de grupo é feita primeiro no
<code>/etc/group</code> e em seguida no NIS.
</dd>
<dt>invalid users = @semacesso</dt>
<dd>
Bloqueia o acesso dos usuários que pertencem ao grupo &quot;semacesso&quot;.  A
pesquisa é feita primeiro no NIS e depois no <code>/etc/group</code>
(equivalente ao uso de &quot;&amp;+&quot;).
</dd>
</dl>

<p>
O <em>valid users</em> possui a mesma sintaxe de funcionamento do <samp>invalid
users</samp>, mas permite somente o acesso para os usuários/grupos listados.
Caso a opção <samp>valid users</samp> não seja especificada ou a lista esteja
vazia, o acesso é permitido.  Se um mesmo nome de usuário estiver na lista
<samp>valid users</samp> e <samp>invalid users</samp>, o padrão é ser mais
restritivo, negando o acesso.

<pre>
      valid users = gleydson, michelle, geo
</pre>

<p>
A segurança deste método de acesso depende muito da forma de autenticação dos
nomes antes de passar o controle para o SAMBA, pois uma autenticação fraca põe
em risco a segurança da sua máquina.

<hr>

<a name="s-s-samba-a-hostsequiv"></a>
<h3>18.12.5 Evite o uso do parâmetro <em>hosts equiv</em>!</h3>

<p>
Este parâmetro permite que máquinas tenham acesso sem senha a um servidor.
Isto pode se tornar um *ENORME* buraco na segurança do seu sistema, pois mesmo
usando uma senha inválida, a máquina poderá ter acesso a todos os recursos do
compartilhamento e não é complicado fazer um ataque usando DNS spoofing.

<p>
Se realmente deseja fazer isto, tenha em mente os dados que poderão ser
acessados daquela máquina, se realmente não existe nenhuma outra forma de
disponibilizar o acesso de forma que mantenha o controle de restrições (usando
todos os outros métodos), restrinja o acesso usando MAC Address com o
<code>iptables</code> ou o <code>arp</code> (veja <a
href="ch-d-restr.html#s-d-restr-ipmac">Restrições por MAC Address/IP, Seção
19.7</a>).  O padrão é não usar nenhum arquivo <code>hosts.equiv</code>.

<hr>

<a name="s-s-asmba-a-nullpasswd"></a>
<h3>18.12.6 Evite o uso de senhas em branco!</h3>

<p>
O parâmetro <samp>null passwords</samp> é usado na seção <em>[global]</em>
permitindo que contas de usuários sem senha tenham acesso permitido ao
servidor.  <strong>ISTO É TOTALMENTE INSEGURO</strong> e deve ser sempre
evitado.  Caso você tenha feito uma bela restrição em sua máquina e deseja que
o seu shell script de cópia de arquivos funcione usando este método, você está
jogando toda a segurança do seu sistema por ralo abaixo.

<p>
Não existe motivo para usar senhas em branco em um controle de acesso por
usuário, a não ser que precise testar algo realmente temporário e que depurando
algo no SAMBA.

<hr>

<a name="s-s-samba-a-publico"></a>
<h3>18.12.7 Criando um compartilhamento para acesso sem senha</h3>

<p>
Em algumas situações (mesmo em instalações seguras) é preciso tornar um
compartilhamento acessível publicamente, exemplos disto incluem um diretório
que contém drivers de impressoras, arquivos comuns, um diretório temporário,
etc.

<p>
Para configurar um acesso público utilizamos a opção <samp>public = yes</samp>
ou <samp>guest ok = yes</samp> (que é um sinônimo para o último comando).  O
UID utilizado no acesso público é especificado pelo parâmetro <samp>guest
account</samp>, portanto ele deverá ser um usuário válido do sistema.  Caso
você queira somente definir acesso guest a um compartilhamento, especifique a
opção <samp>guest only</samp> para o serviço, desta forma, mesmo que o usuário
tenha acesso, ele será mapeado para o usuário guest.

<p>
Uma boa medida de segurança é usar o usuário <samp>nobody</samp> pois a maioria
das distribuições de <code>Linux</code> seguras adotam-o como padrão como
usuário que não é dono de quaisquer arquivos/diretórios no sistema, não possui
login, senha ou sequer um diretório home.

<p>
Veja um exemplo disponibilizando o compartilhamento <samp>[download]</samp>
para acesso público com acesso a gravação:

<pre>
     [global] 
     guest account = nobody
     ..
     ..
     
     [download]
      path = /downloads
      comment = Espaço público para abrigar downloads de Usuários
      guest ok = yes (aqui poderá ser também &quot;public = yes&quot;).
      writable = yes
      follow symlinks = false
</pre>

<p>
O parâmetro <samp>guest account</samp> também poderá ser especificado no
compartilhamento, isto é útil quando não quiser que o usuário que acesse o
compartilhamento não seja o mesmo usado na diretiva [global].

<p>
Caso seu servidor somente disponibiliza compartilhamentos para acesso público,
é mais recomendado utilizar o nível <samp>security = share</samp> pra diminuir
a carga máquina, pois o usuário <em>guest</em> será o primeiro a ser checado
pelas regras de acesso (ao contrário do nível <em>user</em>, onde o acesso
guest é o último checado).

<p>
<strong>OBS:</strong> Lembre-se que o compartilhamento funciona de modo
recursivo, ou seja, todos os arquivos e subdiretórios dentro do diretório que
compartilhou serão disponibilizados, portanto tenha certeza da importância dos
dados que existem no diretório, verifique se existem links simbólicos que
apontam para ele, etc.  Recomendo dar uma olhada rápida em <a
href="#s-s-samba-a-public-access">Considerações de segurança com o uso do
parâmetro &quot;public = yes&quot;, Seção 18.12.14</a>.

<hr>

<a name="s-s-samba-a-ro"></a>
<h3>18.12.8 Criando um compartilhamento com acesso somente leitura</h3>

<p>
Esta proteção é útil quando não desejamos que pessoas alterem o conteúdo de um
compartilhamento.  Isto pode ser feito de duas formas: negando o acesso de
gravação para todo o compartilhamento ou permitindo leitura somente para
algumas pessoas.  O parâmetro usado para fazer a restrição de acesso somente
leitura é o <samp>read only = yes</samp> ou seu antônimo <samp>writable =
no</samp>.  Abaixo seguem os dois exemplos comentados:

<pre>
     [teste]
      comment = Acesso a leitura para todos
      path = /tmp
      read only = yes
      public = yes
</pre>

<p>
No exemplo acima, o diretório <code>/tmp</code> (<em>path = /tmp</em>) foi
compartilhado com o nome <samp>teste</samp> (<em>[teste]</em>), de forma
pública (acesso sem senha - <em>public = yes</em>), e todos podem apenas ler
seu conteúdo <em>read only = yes</em>).

<pre>
     [teste]
      comment = Acesso a gravação para todos com excessões
      path = /tmp
      read only = no
      read list = @users, gleydson
      invalid users = root
</pre>

<p>
Neste, o mesmo compartilhamento <samp>teste</samp> (<em>[teste]</em>) foi
definido como acesso leitura/gravação para todos (<em>read only = no</em>), mas
os usuários do grupo <em>@users</em> e o usuário <em>gleydson</em> terão sempre
acesso leitura (<em>read list = @users, gleydson</em>).  Adicionalmente foi
colocada uma proteção para que o superusuário não tenha acesso a ele
(<em>invalid users = root</em>).  Esta forma de restrição é explicada melhor em
<a href="#s-s-samba-a-restr">Excessão de acesso na permissão padrão de
compartilhamento, Seção 18.12.10</a>).

<hr>

<a name="s-s-samba-a-rw"></a>
<h3>18.12.9 Criando um compartilhamento com acesso leitura/gravação</h3>

<p>
Esta forma de compartilhamento permite a alteração do conteúdo do
compartilhamento dos usuários que possuem as permissões de acesso apropriadas.
Este controle pode ser feito de duas formas: Acesso total de gravação para os
usuários e acesso de gravação apenas para determinados usuários.  Este controle
é feito pela opção <samp>read only = no</samp> e seu antônimo equivalente
<samp>writable = yes</samp>.  Abaixo dois exemplos:

<pre>
     [teste]
      comment = Acesso de gravação para todos.
      path = /tmp
      writable = yes
      public = yes
</pre>

<p>
No exemplo acima, o diretório <code>/tmp</code> (path = /tmp) foi compartilhado
com o nome <samp>teste</samp> ([teste]), de forma pública (acesso sem senha -
public = yes) e todos podem ler/gravar dentro dele (writable = yes).

<pre>
     [teste]
      comment = Acesso a leitura para todos com excessões
      path = /tmp
      writable = no
      write list = @users, gleydson
</pre>

<p>
Neste, o mesmo compartilhamento <samp>teste</samp> (<em>[teste]</em>) foi
definido como acesso de leitura para todos (<em>writable = no</em>), mas os
usuários do grupo <em>@users</em> e o usuário <em>gleydson</em> serão os únicos
que terão também acesso a gravação (<em>write list = @users, gleydson</em>).
Esta forma de restrição é explicada melhor em <a
href="#s-s-samba-a-restr">Excessão de acesso na permissão padrão de
compartilhamento, Seção 18.12.10</a>).

<hr>

<a name="s-s-samba-a-restr"></a>
<h3>18.12.10 Excessão de acesso na permissão padrão de compartilhamento</h3>

<p>
É possível alterar o nível de acesso para determinados usuários/grupos em um
compartilhamento, para entender melhor: Caso tenha criado um compartilhamento
somente leitura e queira permitir que apenas alguns usuários ou grupos tenham
acesso a gravação, isto é possível e será explicado nesta seção.  Este
comportamento é controlado por duas opções: <samp>read list</samp> e
<samp>write list</samp>.  Veja alguns exemplos:

<pre>
     [temporario] 
      comment = Diretório temporário
      path = /tmp
      writable = yes
      read list = gleydson, root
      browseable = no
      available = yes
</pre>

<p>
Neste exemplo, disponibilizamos o diretório <code>/tmp</code> (<em>path =
/tmp</em>) como compartilhamento de nome <samp>temporario</samp>
(<em>[temporario]</em>), seu acesso padrão é leitura/gravação para todos
(<em>writable = yes</em>), exceto para os usuários <samp>root</samp> e
<samp>gleydson</samp> (<em>read list = root, gleydson</em>).  Em adição,
tornamos o compartilhamento <em>invisível</em> (veja <a
href="#s-s-samba-a-invisivel">Criando um compartilhamento invisível, Seção
18.12.12</a>) no &quot;Ambiente de Rede&quot; do Windows (<em>browseable =
no</em>) e ele será lido e disponibilizado pelo SAMBA (<em>available =
yes</em>).

<pre>
     [temporario] 
      comment = Diretório temporário
      path = /tmp
      writable = no
      write list = gleydson, @operadores
      browseable = yes
</pre>

<p>
Neste exemplo, disponibilizamos o diretório <code>/tmp</code> (<em>path =
/tmp</em>) como compartilhamento de nome <samp>temporario</samp>
(<em>[temporario]</em>), seu acesso padrão é apenas leitura para todos
(<em>writable = no</em>), exceto para o usuário <samp>gleydson</samp> e
usuários do grupo Unix <samp>operadores</samp>, que tem acesso a
leitura/gravação (<em>write list = gleydson, @operadores</em>).  Tornamos o
compartilhamento <em>visível</em> no &quot;Ambiente de Rede&quot; do Windows
(<em>browseable = yes</em> - que é o padrão).

<hr>

<a name="s-s-samba-a-ipc-admin"></a>
<h3>18.12.11 Restringindo o IPC$ e ADMIN$</h3>

<p>
É seguro restringir os serviços <code>IPC$</code> e <code>ADMIN$</code> para
acesso somente pelas faixas de rede de confiança.  Isto pode ser feito através
da mesma forma que a restrição em outros compartilhamentos.  Os efeitos desta
restrição serão que somente as redes autorizadas possam obter a lista de
máquinas, se autenticar no domínio e realizar tarefas administrativas gerais:

<pre>
     [IPC$]
     read only = yes
     allow from 192.168.1.0/24
     
     [ADMIN$]
     read only = yes
     allow from 192.168.1.0/24
</pre>

<p>
O exemplo acima permite que os serviços <samp>IPC$</samp> e <samp>ADMIN$</samp>
sejam acessados de qualquer máquina na faixa de rede
<samp>192.168.1.0/24</samp>.  Para forçar a autenticação para acesso a estes
serviços:

<pre>
     [IPC$]
     invalid users = nobody
     valid users = gleydson michelle
     read only = yes
     allow from 192.168.1.0/24
     
     [ADMIN$]
     invalid users = nobody
     valid users = gleydson michelle
     read only = yes
     allow from 192.168.1.0/24
</pre>

<p>
Os exemplos acima são similares ao de antes, mas o acesso a listagem dos
compartilhamentos é restringida (<em>invalid users = nobody</em>), pois o
usuário <em>nobody</em> (usado para mostrar o compartilhamento) tem o acesso
negado.  Somente os usuários <samp>gleydson</samp> e <samp>michelle</samp>
(<em>valid users = gleydson michelle</em>) podem listar seu conteúdo.

<p>
<strong>OBS:</strong> Mesmo que estejam restritos, os serviços
<samp>IPC$</samp> e <samp>ADMIN$</samp> sempre poderão ser acessados de
127.0.0.1, ou teríamos problemas com o funcionamento do SAMBA.  Assim não é
necessário colocar 127.0.0.1 na lista de IPs autorizados.

<hr>

<a name="s-s-samba-a-invisivel"></a>
<h3>18.12.12 Criando um compartilhamento invisível</h3>

<p>
Para não exibir um compartilhamento da lista de compartilhamentos das máquinas,
utilize o parâmetro <samp>browseable = no</samp>.  Por exemplo:

<pre>
     [teste]
      path = /tmp
      comment = Diretório temporário
      read only = yes
      browseable = no
</pre>

<p>
Neste exemplo, o diretório <code>/tmp</code> (<em>path = /tmp</em>) foi
compartilhado através de <samp>teste</samp> (<em>[teste]</em>) com acesso
somente leitura (<em>read only = yes</em>) e ele não será mostrado na listagem
de compartilhamentos do ambiente de rede do Windows (<em>browseable = no</em>).

<p>
Note que o compartilhamento continua disponível, porém ele poderá ser acessado
da estação Windows, especificando a \\maquina\compartilhamento.  Para acessar o
compartilhamento do exemplo acima:

<pre>
     # Clique em Iniciar/Executar e digite:
     \\nome_do_servidor_samba\teste
</pre>

<p>
Ao contrário das máquinas <code>Windows</code> onde é necessário adicionar um
&quot;$&quot; do nome de compartilhamento para criar um compartilhamento oculto
(como <samp>teste$</samp>) o SAMBA cria um compartilhamento
<strong>realmente</strong> oculto, não aparecendo mesmo na listagem do
<code>smbclient</code>.

<hr>

<a name="s-s-samba-a-comandos"></a>
<h3>18.12.13 Executando comandos antes e após o acesso ao compartilhamento</h3>

<p>
Este recurso oferece uma infinidade de soluções que podem resolver desde
problemas de praticidade até segurança usando as opções <samp>preexec</samp> e
<samp>postexec</samp>.  Por exemplo, imagine que esteja compartilhando 4
unidades de CD-Rom de um servidor na rede, e deseje que estes CDs estejam
sempre disponíveis mesmo que algum operador engraçadinho tenha ejetado as
gavetas de propósito, podemos fazer a seguinte configuração:

<pre>
     [cdrom]
      path = /cdrom
      comment = Unidade de CD-ROM 1
      read only = yes
      preexec = /bin/mount /cdrom
      preexec close = yes
      postexec = /bin/umount /cdrom
</pre>

<p>
Na configuração acima, o CD-ROM será compartilhado como <samp>cdrom</samp>
(<em>[cdrom]</em>), somente leitura (<em>red only = yes</em>), quando o usuário
acessar o compartilhamento ele &quot;fechará&quot; a gaveta do CD (<em>preexec
= /bin/mount /cdrom</em>) e desmontará o drive de CD assim que o
compartilhamento for fechado (<em>postexec = /bin/umount /cdrom</em>).
Adicionalmente, caso o comando <code>mount</code> da opção <samp>preexec</samp>
tenha retornado um valor diferente de 0, a conexão do compartilhamento é
fechada (<em>preexec close = yes</em>).

<p>
A UID do processo do <samp>preexec</samp> e <samp>postexec</samp> será o mesmo
do usuário que está acessando o compartilhamento, por este motivo ele deverá
ter permissões para montar/desmontar o CD-ROM no sistema.  Caso precise
executar comandos como usuário <samp>root</samp>, utilize a variante <samp>root
preexec</samp> e <samp>root postexec</samp>.  Apenas tenha consciência que os
programas sendo executados são seguros o bastante para não comprometer o seu
sistema.

<p>
Usando a mesma técnica, é possível que o sistema lhe envie e-mails alertando
sobre acesso a compartilhamentos que em conjunto com um debug level 2 e logs
configurados independentes por máquina, você possa ver o que a máquina tentou
acessar (e foi negado) e o que ela conseguiu acesso.

<p>
Como bom administrador, você poderá criar scripts que façam uma checagem de
segurança no compartilhamento e encerre automaticamente a conexão caso seja
necessário, montar um &quot;honney pot&quot; para trojans, etc.

<p>
Como deve estar notando, as possibilidades do SAMBA se extendem além do simples
compartilhamento de arquivos, se integrando com o potencial dos recursos do
sistema UNIX.

<hr>

<a name="s-s-samba-a-public-access"></a>
<h3>18.12.14 Considerações de segurança com o uso do parâmetro &quot;public = yes&quot;</h3>

<p>
Este parâmetro permite que você acesso um compartilhamento sem fornecer uma
senha, ou seja, que o usuário não esteja autenticado.  NÃO utilize o parâmetro
&quot;public = yes&quot; (ou um de seus sinônimos) no compartilhamento
<samp>[homes]</samp>, pois abrirá brechas para que possa acessar o diretório
home de qualquer usuário e com acesso a gravação (que é o padrão adotado pelos
administradores para permitir o acesso ao seu diretório home remoto).

<p>
Recomendo utilizar o parâmetro <samp>public = yes</samp> somente em
compartilhamentos onde é realmente necessário, como o [netlogon] ou outras
áreas de acesso público onde as permissões do sistema de arquivos local estejam
devidamente restritas.  Outra medida é não utilizar a opção <samp>follow
symlinks</samp>, que poderá lhe causar problemas com usuários mal intencionados
que tenham acesso shell.

<p>
<strong>OBS:</strong> Tenha em mente todas as considerações de segurança
abordadas neste capítulo, bem como as permissões de acesso ao sistema Unix e
como elas funcionam.  A disponibilidade de arquivos em uma rede é simples,
simples também pode ser o acesso indevido a eles caso não saiba o que está
fazendo.

<hr>

<a name="s-s-samba-a-passwords"></a>
<h3>18.12.15 Senhas criptografadas ou em texto puro?</h3>

<p>
Como regra geral, prefira sempre utilizar senhas criptografadas.  Aqui alguns
motivos:
<ul>
<li>
A senha é enviada de uma forma que dificulta sua captura por pessoas
maliciosas.
</li>
<li>
O NT não permite que você navegue no ambiente de rede em um sistema SAMBA com
nível de acesso por usuário autenticando usando senhas em texto plano.
</li>
<li>
Será solicitada sempre a senha para reconexão em cada compartilhamento da
máquina.
</li>
<li>
Todas as versões de Windows NT 4 a partir SP3 e Windows 95 OSR/2 utilizam
senhas criptografadas como padrão.  É possível faze-lo utilizar senhas em texto
plano modificando chaves no registro das máquinas clientes (veja <a
href="#s-s-samba-senhas-plano">Ativando o suporte a senhas em texto plano,
Seção 18.9</a> para detalhes).
</li>
</ul>

<p>
As vantagens da utilização da autenticação usando texto plano:
<ul>
<li>
A senha utilizada será a mesma do <code>/etc/passwd</code> (servindo para ftp,
login, etc)
</li>
<li>
O servidor PDC pode ser usado para logon desde que os clientes estejam usando
senhas em texto plano.
</li>
<li>
Elas não são armazenadas no disco da estação cliente.
</li>
<li>
Você não será perguntado por uma senha durante cada reconexão de recurso.
</li>
</ul>

<p>
Antes de optar por utilizar um sistema de senhas em texto plano, leve em
consideração estes pontos.  Se você já utiliza telnet ou ftp, provavelmente a
utilização de autenticação usando texto plano no SAMBA não trará problemas mais
graves para você.

<p>
<strong>OBS</strong>: Caso seu NT ou versão derivada não navegue no ambiente de
rede (só aceitando conexões especificando diretamente o
&quot;\\servidor\compartilhamento&quot;) modifique sua configuração do SAMBA
para autenticar usando senhas criptografadas (veja <a
href="#s-s-samba-senhas-crypto">Ativando o suporte a senhas criptografadas,
Seção 18.8</a>) para detalhes de como fazer isto.

<hr>

<a name="s-s-samba-a-usernamemap"></a>
<h3>18.12.16 Mapeamento de nomes de usuários</h3>

<p>
Este recurso faz a mapeamento (tradução) de nomes de usuários usados no momento
do acesso para contas de acesso locais, bastante útil quando o nome de usuário
enviado pela máquina não confere com NENHUMA conta local do sistema (um exemplo
é quando o login do usuário no <code>Windows</code> é diferente de seu Login no
<code>Linux</code>).  Outro vantagem de seu uso é permitir que uma categoria de
usuários utilizem um mesmo nível de acesso no sistema.

<p>
Seu formato é o seguinte: <samp>username map = arquivo</samp>.

<p>
As seguintes regras são usadas para construir o arquivo de mapeamento de nomes:
<ul>
<li>
Um arquivo de múltiplas linhas onde o sinal de &quot;=&quot; separa os dois
parâmetros principais.  O arquivo é processado linha por linha da forma
tradicional, a diferença é o que o processamento do arquivo continua mesmo que
uma condição confira.  Para que o processamento do resto do arquivo seja
interrompido quando um mapeamento confira, coloque o sinal &quot;!&quot; na
frente do nome local.
</li>
<li>
O parâmetro da esquerda é a conta Unix local que será usada para fazer acesso
ao compartilhamento.  Somente uma conta Unix poderá ser utilizada.
</li>
<li>
O parâmetro da direita do sinal de &quot;=&quot; pode conter um ou mais nomes
de usuários separados por espaços que serão mapeados para a conta Unix local.
<p>
O parâmetro &quot;@grupo&quot; permite que usuários pertencentes ao grupo Unix
local sejam mapeados para a conta de usuário do lado esquerdo.  Outro caracter
especial é o &quot;*&quot; e indica que qualquer usuário será mapeado.
</li>
</ul>

<p>
Você pode utilizar comentários na mesma forma que no arquivo de configuração
<code>smb.conf</code>.  Alguns exemplos:

<pre>
     # Mapeia o usuário &quot;gleydson mazioli&quot; com o usuário local gleydson
     gleydson = gleydson mazioli
     
     # Mapeia o usuário root e adm para o usuário nobody
     nobody = root adm
     
     # Mapeia qualquer nome de usuário que pertença ao grupo smb-users para o usuário
     # samba. 
     samba = @smb-users
     
     # Utiliza todos os exemplos anteriores, se nenhum usuário conferir, ele será 
     # mapeado para o usuário nobody (como o usuário root e adm já são mapeados
     # para &quot;nobody&quot;, este exemplo terá o mesmo efeito).
     !gleydson = gleydson mazioli
     !samba = @smb-users
     nobody = *
</pre>

<hr>

<a name="s-s-samba-perf"></a>
<h2>18.13 Melhorando a performance do compartilhamento/servidor</h2>

<p>
Esta seção trará algumas formas de otimização do servidor SAMBA que fazem
diferença quando os valores adequados são utilizados: A primeira é a ativação
de um cache de gravação/leitura de arquivos.  Este cache é feito pela opção
<samp>write cache size</samp> e funciona fazendo o cache dos arquivos que serão
lidos/gravados.  Ele é esvaziado assim que o arquivo for fechado ou quando
estiver cheio.  O valor especificado nesta opção é em bytes e o padrão é
&quot;0&quot; para não causar impacto em sistemas com pouca memória (ou
centenas de compartilhamentos).  Exemplo:

<pre>
     [publico]
      path = /pub
      comment = Diretório de acesso público
      read only = yes
      public = yes
      write cache size = 384000
</pre>

<p>
Compartilha o diretório <code>/pub</code> (<em>path = /pub</em>) como
compartilhamento de nome <samp>publico</samp> (<em>[publico]</em>), seu acesso
será feito como somente leitura (<em>read only = yes</em>) e o tamanho do cache
de leitura/gravação reservado de 384Kb (<em>write cache size = 384000</em>).

<p>
Deixar a opção para seguir links simbólicos ativada (<samp>follow
symlinks</samp>) garante mais performance de acesso a arquivos no
compartilhamento.  A desativação da opção <samp>wide links</samp> em conjunto
com o uso de cache nas chamadas getwd (<samp>getwd cache</samp>) permite
aumentar a segurança e tem um impacto perceptível na performance dos dados.

<p>
A desativação da opção global <em>nt smb support</em> também melhora a
performance de acesso dos compartilhamentos.  Esta é uma opção útil para
detectar problemas de negociação de protocolo e por padrão, ela é ativada.

<p>
Caso utiliza um valor de depuração de log muito alto (<em>debug level</em>), o
sistema ficará mais lento pois o servidor sincroniza o arquivo após cada
operação.  Em uso excessivo do servidor de arquivos, isso apresenta uma
degradação perceptível de performance.

<p>
A opção <samp>prediction</samp> permite que o SAMBA faça uma leitura adiante no
arquivo abertos como somente-leitura enquanto aguarda por próximos comandos.
Esta opção associada com bons valores de <em>write cache size</em> pode fazer
alguma diferença.  Note que o valor de leitura nunca ultrapassa o valor de
&quot;read size&quot;.

<p>
A opção <em>read size</em> permite obter um sincronismo fino entre a leitura e
gravação do disco com o envio/recebimento de dados da rede.  O valor é
dependente da instalação local, levando em consideração a velocidade de disco
rígido, rede, etc.  O valor padrão é 16384.

<p>
Em casos onde um NFS montado ou até mesmo leitura em discos locais é
compartilhada, o parâmetro <em>strict locking</em> definido para
<samp>yes</samp> pode fazer alguma diferença de performance.  Note que nem
todos os sistemas ganham performance com o uso desta opção e não deve ser usada
em aplicativos que não requisitam o estado do lock de arquivo ao servidor.

<p>
Caso você possua aplicativos que fazem o lock corretamente de arquivos, você
poderá usar o <em>share modes = no</em>, isto significa que futuras aberturas
de arquivo podem ser feitas em em modo leitura/gravação.  Caso utiliza um
aplicativo muito bem programado que implementa de forma eficiente de lock, você
poderá desativar esta opção.

<p>
O uso de <em>oplocks yes</em> em compartilhamentos aumenta a performance de
acesso a arquivos em até 30%, pois utiliza um código de cache no cliente.
Tenha certeza do que está fazendo antes de sair usando <em>oplocks</em> em tudo
que é lugar.  A desativação de <em>kernel oplocks</em> é necessária para que
isto funcione.

<p>
A opção <em>read raw</em> e <em>write raw</em> devem ter seus valores
experimentados para ver se faz diferença na performance da sua rede, pois é
diretamente dependente do tipo de cliente que sua rede possui.  Alguns clientes
podem ficar mais lentos em modo de leitura raw.

<p>
O tipo de sistema de arquivos adotado na máquina e suas opções de montagem tem
um impacto direto na performance do servidor, principalmente com relação a
atualização de status dos arquivos no sistema de arquivos (hora de acesso,
data, etc).

<p>
O cache de leitura adiante de abertura de arquivos em modo somente leitura
aumenta a performance com o uso do oplocks nível 2.  Para isto, ajuste a opção
<samp>level2 oplocks</samp> para <samp>yes</samp>.  A recomendação deste tipo
de oplock é o mesmo do nível 1.

<p>
Como o SAMBA faz o transporte NetBEUI via TCP/IP, ajustes no socket fazem
diferença nos dados que trafegam na rede.  Como isso é dependente de rede você
precisará usar técnicas de leitura/gravação para determinar quais são as
melhores que se encaixam em seu caso.  A opção <em>socket options</em> é usada
para fazer tais ajustes, por exemplo:

<pre>
     socket options = SO_SNDBUF=2048 IPTOS_THROUGHPUT=1
</pre>

<p>
Em especial, a opção <samp>TCP_NODELAY</samp> apresenta uma perceptível
melhoria de performance no acesso a arquivos locais.

<p>
<strong>OBS:</strong>: Não use espaços entre o sinal de &quot;=&quot; quando
especificar as opções do parâmetro <samp>socket options</samp>.

<hr>

<a name="s-s-samba-c"></a>
<h2>18.14 Configuração de Clientes NetBEUI</h2>

<p>
Este capítulo documenta a configuração de máquinas clientes NetBEUI,
requerimentos de cada configuração e documenta os passos necessários para ter o
cliente se comunicando perfeitamente com o seu servidor.  Serão explicadas
tanto a configuração de <em>grupo de trabalho</em> como de <em>domínio</em> e
como a configuração é compatível entre <code>Linux</code> e
<code>Windows</code>, estas explicações são perfeitamente válidas para
configurar clientes que acessem servidores <code>Windows</code>.

<hr>

<a name="s-s-samba-c-wfw-lman"></a>
<h3>18.14.1 Considerações sobre o Windows for Workgroups e LanManager</h3>

<p>
Sistemas com implementações NetBIOS mais antigos, como o <code>Windows for
Workgroups</code> (Windows 3.11) e o <code>Lan Manager</code> (DOS), enviam
somente a senha para acesso ao compartilhamento, desta forma, para o acesso ser
autorizado pelo <code>samba</code>, você deverá especificar a diretiva <em>user
= usuario</em> para que a senha confira com o usuário local do sistema.  A
senha enviada também é em formato texto plano.  Este problema não ocorre no
Windows 95 e superiores, que enviam o nome de usuário que efetuou o logon junto
com a respectiva senha.

<p>
Se a segurança do seu samba depende de senhas criptografadas, será necessário
utilizar a diretiva <samp>&quot;include =
outro_arquivo_de_configuração.%m</samp> para definir configurações específicas
de acesso para estas máquinas.

<p>
Outro detalhe que deve ser lembrado é que o <code>Windows for Workgroups</code>
envia sempre a senha em MAIÚSCULAS, então é preciso configurar o SAMBA para
tentar combinações de maiúsculas/minúsculas usando o parâmetro <em>mangle
case</em> e <em>default case</em> na seção global do <code>smb.conf</code>.

<hr>

<a name="s-s-samba-c-workgroup"></a>
<h3>18.14.2 Configurando clientes em Grupo de Trabalho</h3>

<p>
Para configurar o cliente para fazer parte de um <em>grupo de trabalho</em>, é
necessário apenas que tenha em mãos o <samp>nome do grupo de trabalho</samp>
(workgroup) que os clientes farão parte e o nome de uma outra máquina que faz
parte do mesmo grupo (para testes iniciais).  Com estes dados em mãos,
selecione na lista abaixo o nome do cliente que deseja configurar para incluir
no grupo de trabalho:
<ul>
<li>
<a href="#s-s-samba-c-workgroup-w9x">Windows 9X, Seção 18.14.2.1</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPHome">Windows XP Home Edition, Seção
18.14.2.2</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPprofessional">Windows XP Professional
Edition, Seção 18.14.2.3</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPServer">Windows XP Server Edition, Seção
18.14.2.4</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-NTWorkstation">Windows NT WorkStation, Seção
18.14.2.5</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-NTServer">Windows NT Server, Seção
18.14.2.6</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-w2kProfessional">Windows 2000 Professional,
Seção 18.14.2.7</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-w2kServer">Windows 2000 Server, Seção
18.14.2.8</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-linux">Linux, Seção 18.14.2.9</a>
</li>
</ul>

<hr>

<a name="s-s-samba-c-workgroup-w9x"></a>
<h4>18.14.2.1 Windows 9X</h4>

<p>
Estas configurações são válidas para clientes Windows 95, Windows 95OSR/2,
Windows 98.  Caso utilize o <code>Windows 95</code> (qualquer uma das séries) é
aconselhável atualizar a stack TCP/IP e NetBEUI para corrigir alguns problemas
que podem deixar sua máquina vulnerável na versão que acompanha o WinSock do
Windows 95.

<p>
Para tornar uma máquina parte do grupo de trabalho, siga os seguintes passos:
<ul>
<li>
Entre nas propriedades de rede no Painel de Controle
</li>
<li>
Instale o Cliente para redes Microsoft (caso não esteja instalado).
</li>
<li>
Instale o Protocolo TCP/IP.  Você também pode instalar o protocolo NetBIOS, mas
utilizaremos o suporte NetBIOS sobre TCP/IP que é o usado pelo
<code>SAMBA</code> além de ter um melhor desempenho, permitir integração com
servidores WINS, etc.
</li>
<li>
Clique em &quot;Protocolo TCP/IP&quot; e em Propriedades.  Clique na tab
&quot;NetBIOS&quot; e marque a opção &quot;Desejo ativar o NetBIOS através do
TCP/IP&quot;.  Caso esta caixa esteja em cinza, então está tudo certo também.
</li>
<li>
Clique na tab &quot;Identificação&quot; e coloque lá o nome que identificará o
computador (até 15 caracteres) e o nome do grupo de trabalho que ele fará
parte(por exemplo &quot;workgroup&quot;, &quot;suporte&quot;, etc) .  No campo
&quot;Descrição do Computador&quot;, coloque algo que identifique a máquina na
rede (por exemplo, &quot;Computador da área de suporte&quot;).
</li>
<li>
Clique na tab &quot;Controle de Acesso&quot; e marque o &quot;Controle de
acesso a nível de compartilhamento&quot; (a não ser que tenha configurado um
servidor que mantenha um controle de nível de usuário na rede para as máquinas
fora do domínio).
</li>
<li>
Clique em OK até reiniciar o computador.
</li>
</ul>

<p>
A máquina cliente agora faz parte do grupo de trabalho!  Tente acessar um outro
computador da rede e navegar através do ambiente de rede.  Caso a lista de
máquinas demore em aparecer, tente acessar diretamente pelo nome do computador,
usando o seguinte formato: &quot;\\computador&quot;

<hr>

<a name="s-s-samba-c-workgroup-wXPHome"></a>
<h4>18.14.2.2 Windows XP Home Edition</h4>

<p>
Siga as instruções de <a href="#s-s-samba-c-workgroup-wXPprofessional">Windows
XP Professional Edition, Seção 18.14.2.3</a>.

<hr>

<a name="s-s-samba-c-workgroup-wXPprofessional"></a>
<h4>18.14.2.3 Windows XP Professional Edition</h4>

<ul>
<li>
Logue como administrador do sistemas local.
</li>
<li>
Entre no item <em>Sistema</em> dentro do painel de controle.  A tela
propriedades de sistema será aberta.
</li>
<li>
No campo <em>Descrição do Computador</em>, coloque algo que descreva a máquina
(opcional).
</li>
<li>
Clique na TAB <em>Nome do Computador</em> e no botão <em>Alterar</em> na parte
de baixo da janela.
</li>
<li>
No campo <em>nome do computador</em>, coloque um nome de no máximo 15
caracteres para identificar a máquina na rede.
</li>
<li>
Clique em <em>grupo de trabalho</em> e digite o nome do <em>grupo de
trabalho</em> na caixa de diálogo.
</li>
<li>
Clique em OK e aguarde a mensagem confirmando sua entrada no grupo de trabalho.
Será necessário reiniciar a máquina.
</li>
</ul>

<hr>

<a name="s-s-samba-c-workgroup-wXPServer"></a>
<h4>18.14.2.4 Windows XP Server Edition</h4>

<p>
Siga as instruções de <a href="#s-s-samba-c-workgroup-wXPprofessional">Windows
XP Professional Edition, Seção 18.14.2.3</a>.

<hr>

<a name="s-s-samba-c-workgroup-NTWorkstation"></a>
<h4>18.14.2.5 Windows NT WorkStation</h4>

<p>
Veja <a href="#s-s-samba-c-dominio-NTServer">Windows NT Server, Seção
18.14.3.6</a>.

<hr>

<a name="s-s-samba-c-workgroup-NTServer"></a>
<h4>18.14.2.6 Windows NT Server</h4>

<ul>
<li>
Clique no item <samp>Rede</samp> do painel de controle.
</li>
<li>
Na tab <samp>Serviços</samp>, confira se os serviços <samp>Estação de
trabalho</samp>, <samp>Interface de NetBIOS</samp> e <samp>Serviços TCP/IP
simples</samp> estão instalados.  Caso não estejam, faça sua instalação usando
o botão <samp>Adicionar</samp> nesta mesma janela.
</li>
<li>
Na tab <samp>Protocolos</samp>, verifique se os protocolos <em>NetBEUI</em> e
<em>TCP/IP</em> estão instalados.  Caso não estejam, faça sua instalação
clicando no botão <samp>Adicionar</samp> nesta mesma janela.
</li>
<li>
Na tab identificação, clique no botão <samp>Alterar</samp>
</li>
<li>
Na janela que se abrirá, coloque o nome do computador no campo <samp>Nome do
Computador</samp>
</li>
<li>
Clique em <samp>Grupo de trabalho</samp> e escreva o nome do grupo de trabalho
em frente.
</li>
<li>
Clique em <samp>OK</samp> até voltar.
</li>
<li>
Pronto, seu computador agora faz parte do grupo de trabalho.
</li>
</ul>

<hr>

<a name="s-s-samba-c-workgroup-w2kProfessional"></a>
<h4>18.14.2.7 Windows 2000 Professional</h4>

<ul>
<li>
Logue como administrador do sistemas local.
</li>
<li>
Entre no item <em>Sistema</em> dentro do painel de controle.  A tela
propriedades de sistema será aberta.  Clique em &quot;Computador&quot; e então
no botão &quot;Propriedades&quot;.
</li>
<li>
No campo <em>nome do computador</em>, coloque um nome de no máximo 15
caracteres para identificar a máquina na rede.
</li>
<li>
Clique em <em>grupo de trabalho</em> e digite o nome do <em>grupo de
trabalho</em> na caixa de diálogo.
</li>
<li>
Clique em OK e aguarde a mensagem confirmando sua entrada no grupo de trabalho.
Será necessário reiniciar a máquina.
</li>
</ul>

<hr>

<a name="s-s-samba-c-workgroup-w2kServer"></a>
<h4>18.14.2.8 Windows 2000 Server</h4>

<ul>
<li>
Logue como administrador do sistemas local.
</li>
<li>
Entre no item <em>Sistema</em> dentro do painel de controle.  A tela
propriedades de sistema será aberta.  Clique em &quot;Descrição de rede&quot; e
então no botão &quot;Propriedades&quot;.
</li>
<li>
No campo <em>nome do computador</em>, coloque um nome de no máximo 15
caracteres para identificar a máquina na rede.
</li>
<li>
Clique em <em>grupo de trabalho</em> e digite o nome do <em>grupo de
trabalho</em> na caixa de diálogo.
</li>
<li>
Clique em OK e aguarde a mensagem confirmando sua entrada no grupo de trabalho.
Será necessário reiniciar a máquina.
</li>
</ul>

<hr>

<a name="s-s-samba-c-workgroup-linux"></a>
<h4>18.14.2.9 Linux</h4>

<p>
Os aplicativos <code>smbclient</code> e <code>smbmount</code> são usados para
navegação e montagem dos discos e impressoras compartilhadas em máquinas
<code>Linux</code>.  Se você procura programas de navegação gráficos, como o
<em>Ambiente de Rede</em> do <code>Windows</code> ou mais poderosos, veja <a
href="#s-s-samba-c-graficos">Programas de navegação gráficos, Seção
18.14.5</a>.  Como complemento, também é explicado o programa
<code>nmblookup</code> para resolução de endereços NetBIOS em IP e vice-versa e
a forma que as funções de máquinas são definidas em uma rede NetBEUI.

<hr>

<a name="s-s-samba-c-workgroup-linux-smbmount"></a>
<h5>18.14.2.9.1 smbmount</h5>

<p>
O <code>smbmount</code> é uma ferramenta que permite a montagem de um disco
compartilhado por uma máquina NetBEUI remota como uma partição.  Veja alguns
exemplos:
<dl>
<dt>smbmount //servidor/discoc /mnt/discoc</dt>
<dd>
Monta o compartilhamento de <em>//servidor/discoc</em> em
<code>/mnt/discoc</code> usando o nome de usuário atual.  Será pedido uma senha
para acessar o conteúdo do compartilhamento, caso ele seja público, você pode
digitar qualquer senha ou simplesmente pressionar enter.
</dd>
<dt>smbmount //servidor/discoc /mnt/discoc -N</dt>
<dd>
Semelhante ao comando cima, com a diferença que o parâmetro <samp>-N</samp> não
pergunta por uma senha.  Isto é ideal para acessar compartilhamentos anônimos.
</dd>
<dt>smbmount //servidor/discoc /mnt/discoc -o username=gleydson,workgroup=teste</dt>
<dd>
Semelhante aos anteriores, mas acessa o compartilhamento usando
<em>gleydson</em> como nome de usuário e <em>teste</em> como grupo de trabalho.
Este método é ideal para redes que tem o nível de acesso por usuário ou para
acessar recursos compartilhados em um domínio.
</dd>
</dl>

<hr>

<a name="s-s-samba-c-workgroup-linux-smbclient"></a>
<h5>18.14.2.9.2 smbclient</h5>

<p>
O <code>smbclient</code> é uma ferramenta de navegação em servidores SAMBA.  Ao
invés dela montar o compartilhamento como um disco local, você poderá navegar
na estrutura do servidor de forma semelhante a um cliente FTP e executar
comandos como <samp>ls</samp>, <samp>get</samp>, <samp>put</samp> para fazer a
transferência de arquivos entre a máquina remota e a máquina local.  Também é
através dele que é feita a interface com impressoras compartilhadas
remotamente.  Veja exemplos do uso do <code>smbclient</code>:
<dl>
<dt>smbclient -L samba1</dt>
<dd>
Lista todos os compartilhamentos existentes (<samp>-L</samp>) no servidor
<code>samba1</code>.
</dd>
<dt>smbclient //samba1/discoc</dt>
<dd>
Acessa o conteúdo do compartilhamento <samp>discoc</samp> no servidor
<samp>samba1</samp>.
</dd>
<dt>smbclient //samba1/discoc -N</dt>
<dd>
Idêntico ao acima, mas não utiliza senha (ideal para compartilhamentos com
acesso anônimo).
</dd>
<dt>smbclient //samba1/discoc -I 192.168.1.2</dt>
<dd>
Se conecta ao compartilhamento usando o endereço IP <code>192.168.1.2</code> ao
invés da resolução de nomes.
</dd>
<dt>smbclient //samba1/discoc -U gleydson -W teste</dt>
<dd>
Se conecta ao compartilhamento como usuário <samp>gleydson</samp> usando o
grupo de trabalho <samp>teste</samp>.
</dd>
<dt>smbclient //samba1/discoc -U gleydson%teste1 -W teste</dt>
<dd>
Idêntico ao acima, mas também envia a senha <samp>teste1</samp> para fazer a
conexão diretamente.
</dd>
</dl>

<p>
Caso receba a mensagem <samp>NT Status Access Denied</samp>, isto quer dizer
que não possui direitos de acesso adequados para listas ou acessar os
compartilhamentos da máquina.  Nesse caso, utilize as opções <samp>-U
usuário</samp> e <samp>-W grupo/domínio</samp> para fazer acesso com uma conta
válida de usuário existente na máquina.

<p>
<strong>OBS:</strong>Note que a ordem das opções faz diferença no
<code>smbmount</code>.

<hr>

<a name="s-s-samba-c-workgroup-linux-nmblookup"></a>
<h5>18.14.2.9.3 nmblookup</h5>

<p>
Esta é uma ferramenta usada para procurar nomes de cliente usando o endereço
IP, procurar um IP usando o nome e listar as características de cada cliente.
Veja alguns exemplos:
<dl>
<dt>nmblookup -A 127.0.0.1</dt>
<dd>
Lista o nome e as opções usadas pelo servidor <code>127.0.0.1</code>
</dd>
<dt>nmblookup servidor</dt>
<dd>
Resolve o endereço IP da máquina <samp>servidor</samp>.
</dd>
</dl>

<p>
A listagem exibida pela procura de IP do <code>nmblookup</code> possui códigos
hexadecimais e cada um deles possui um significado especial no protocolo
NetBEUI.  Segue a explicação de cada um:
<dl>
<dt>Identificação da máquina</dt>
<dd>
<ul>
<li>
COMPUTADOR&lt;00&gt;= O serviço NetBEUI está sendo executado na máquina.
</li>
<li>
COMPUTADOR&lt;03&gt; = Nome genérico da máquina (nome NetBIOS).
</li>
<li>
COMPUTADOR&lt;20&gt; = Serviço LanManager está sendo executado na máquina.
</li>
</ul>
</dd>
<dt>Identificação de grupos/domínio</dt>
<dd>
<ul>
<li>
GRUPO_TRABALHO&lt;1d&gt; - &lt;GRUPO&gt; = Navegador Local de Domínio/Grupo.
</li>
<li>
GRUPO_TRABALHO&lt;1b&gt; = Navegador Principal de Domínio.
</li>
<li>
GRUPO_TRABALHO&lt;03&gt; - &lt;GRUPO&gt; = Nome Genérico registrado por todos
os membros do grupo de trabalho.
</li>
<li>
GRUPO_TRABALHO&lt;1c&gt; - &lt;GRUPO&gt; = Controladores de Domínio /
Servidores de logon na rede.
</li>
<li>
GRUPO_TRABALHO&lt;1e&gt; - &lt;GRUPO&gt; = Resolvedores de Nomes Internet
(<samp>WINS</samp>).
</li>
</ul>
</dd>
</dl>

<p>
Estes códigos podem lhe ser úteis para localizar problemas mais complicados que
possam ocorrer durante a configuração de um servidor.

<hr>

<a name="s-s-samba-c-dominio"></a>
<h3>18.14.3 Configurando clientes em Domínio</h3>

<p>
Para configurar qualquer um dos cliente abaixo para fazer parte de um domínio
de rede, é necessário apenas que tenha em mãos os seguintes dados:
<ul>
<li>
Nome do controlador de domínio PDC
</li>
<li>
Nome do domínio
</li>
<li>
Nome de usuário e senha que foram cadastrados no servidor.
</li>
<li>
Acesso administrador no SERVIDOR PDC (SAMBA, NT, etc).
</li>
<li>
Cria uma conta de máquina no domínio (no caso da máquina ser um Windows NT,
Windows XP, Windows 2k ou Linux).  Veja <a
href="#s-s-samba-dom-contasmac">Contas de máquinas de domínio, Seção 18.7.5</a>
para maiores detalhes.
</li>
</ul>

<p>
Como o Windows 3.11, Windows 95, Windows 98, Windows ME não possuem uma conta
de máquina, eles nunca serão um membro real de um domínio, podendo sofrer um
name spoofing e terem a identidade roubada.  Mesmo assim, eles terão pleno
acesso aos recursos do domínio e uma configuração mais fácil que os demais
clientes.  Com estes dados em mãos, selecione na lista abaixo o nome do cliente
que deseja integrar no grupo de trabalho:
<ul>
<li>
<a href="#s-s-samba-c-workgroup-w9x">Windows 9X, Seção 18.14.2.1</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPHome">Windows XP Home Edition, Seção
18.14.2.2</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPprofessional">Windows XP Professional
Edition, Seção 18.14.2.3</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-wXPServer">Windows XP Server Edition, Seção
18.14.2.4</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-NTWorkstation">Windows NT WorkStation, Seção
18.14.2.5</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-NTServer">Windows NT Server, Seção
18.14.2.6</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-w2kProfessional">Windows 2000 Professional,
Seção 18.14.2.7</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-w2kServer">Windows 2000 Server, Seção
18.14.2.8</a>
</li>
<li>
<a href="#s-s-samba-c-workgroup-linux">Linux, Seção 18.14.2.9</a>
</li>
</ul>

<p>
<strong>OBS:</strong> O Windows 2000 apresenta algumas dificuldades em entrar
na rede do SAMBA 2.2, sendo necessário o uso do SAMBA TNG 2.2.x para aceitar o
logon de estações Windows 2000.

<hr>

<a name="s-s-samba-c-dominio-w9x"></a>
<h4>18.14.3.1 Windows 9X</h4>

<p>
Estas configurações são válidas para clientes Windows 95, Windows 95OSR/2,
Windows 98.  Caso utilize o <code>Windows 95</code> (qualquer uma das séries) é
aconselhável atualizar a stack TCP/IP e NetBEUI para corrigir alguns problemas
que podem deixar sua máquina vulnerável na versão que acompanha o WinSock do
Windows 95.

<p>
Para tornar uma máquina parte do domínio, siga os seguintes passos:
<ul>
<li>
Entre nas propriedades de rede no Painel de Controle
</li>
<li>
Instale o Cliente para redes Microsoft (caso não esteja instalado).
</li>
<li>
Instale o Protocolo TCP/IP.  Você também pode instalar o protocolo NetBIOS, mas
utilizaremos o suporte NetBIOS sobre TCP/IP que é o usado pelo
<code>SAMBA</code> além de ter um melhor desempenho, permitir integração com
servidores WINS, etc.
</li>
<li>
Clique em &quot;Cliente para redes Microsoft&quot;, marque a opção
&quot;Efetuar logon no domínio do Windows NT&quot;.  Coloque o nome do domínio
que irá configurar o cliente para fazer parte na caixa &quot;Domínio do Windows
NT&quot; (por exemplo, &quot;suporte&quot;).  Na parte de baixo da caixa de
diálogo, você poderá escolher como será o método para restaurar as conexões de
rede.  Inicialmente, recomendo que utilize a &quot;Efetuar logon e restaurar as
conexões de rede&quot; que é mais útil para depurar problemas (possíveis erros
serão mostrados logo que fizer o logon no domínio).
<p>
Adeque esta configuração as suas necessidades quando estiver funcionando :)
</li>
<li>
Clique em &quot;Protocolo TCP/IP&quot; e em Propriedades.  Clique na tab
&quot;NetBIOS&quot; e marque a opção &quot;Desejo ativar o NetBIOS através do
TCP/IP&quot;.  Caso esta caixa esteja em cinza, então está tudo certo também.
</li>
<li>
Clique na tab &quot;Identificação&quot; e coloque lá o nome que identificará o
computador (até 15 caracteres).
</li>
<li>
Digite o nome de um grupo de trabalho que a máquina fará parte no campo
&quot;Grupo de Trabalho&quot; (por exemplo &quot;workgroup&quot;,
&quot;suporte&quot;, etc).  Este campo somente será usado caso o logon no
domínio NT não seja feito com sucesso.  No campo &quot;Descrição do
Computador&quot;, coloque algo que identifique a máquina na rede (por exemplo,
&quot;Computador da área de suporte&quot;).
</li>
<li>
Clique na tab &quot;Controle de Acesso&quot; e marque o &quot;Controle de
acesso a nível de usuário e especifique o nome da máquina que serve a lista de
usuários, que normalmente é a mesma do PDC.
</li>
<li>
Clique em OK até reiniciar o computador.
</li>
</ul>

<p>
Quando for mostrada a tela pedindo o nome/senha, preencha com os dados da conta
de usuário que criou no servidor.  No campo domínio, coloque o domínio que esta
conta de usuário pertence e tecle &lt;Enter&gt;.  Você verá o script de logon
em ação (caso esteja configurado) e a máquina cliente agora faz parte do
domínio!  Tente acessar um outro computador da rede e navegar através do
ambiente de rede.  Caso a lista de máquinas demore em aparecer, tente acessar
diretamente pelo nome do computador, usando o seguinte formato:
&quot;\\computador&quot;

<hr>

<a name="s-s-samba-c-dominio-wXPHome"></a>
<h4>18.14.3.2 Windows XP Home Edition</h4>

<p>
Não é possível fazer o <code>Windows XP Home Edition</code> ser parte de um
domínio, por causa de limitações desta versão.

<hr>

<a name="s-s-samba-c-dominio-wXPprofessional"></a>
<h4>18.14.3.3 Windows XP Professional Edition</h4>

<ul>
<li>
Primeiro, siga todos os passos para ingressar a máquina em um grupo de trabalho
como documentado em <a href="#s-s-samba-c-workgroup-wXPprofessional">Windows XP
Professional Edition, Seção 18.14.2.3</a>.
</li>
<li>
Atualize o registro para permitir a entrada no domínio:
<ol type="1" start="1" >
<li>
Copie o seguinte conteúdo para o arquivo <code>WinXP-Dom.reg</code>:
<pre>
     REGEDIT4
     
     HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\netlogon\parameters
     &quot;RequireSignOrSeal&quot;=dword:00000000
     &quot;SignSecureChannel&quot;=dword:00000000
</pre>
</li>
<li>
Execute o comando <samp>regedit WinXP-Dom.reg</samp> no cliente XP.
</li>
</ol>
</li>
<li>
Entre nos ítens (em seqüencia) Painel de controle/Ferramentas Administrativas/
Política de segurança local/políticas locais e depois em &quot;opções de
segurança&quot;.  Na janela de opções de segurança, desative as opções
&quot;Encriptar digitalmente ou assinar um canal seguro (sempre)&quot;,
&quot;Desativar modificações de senha na conta de máquina&quot; e &quot;Requer
chave de seção forte (Windows 2000 ou superior).&quot;
</li>
<li>
Reinicie a máquina.
</li>
<li>
Após reiniciar a máquina, volte na tela de alteração de identificação de
máquina na rede.
</li>
<li>
Clique com o mouse em &quot;Domínio&quot; e digite o nome do domínio na caixa
de diálogo.
</li>
<li>
Na tela seguinte, será lhe pedido o nome de usuário e senha com poderes
administrativos que podem inserir/remover máquinas do domínio.
</li>
<li>
Clique em OK e aguarde a mensagem confirmando sua entrada no domínio.  Será
necessário reiniciar a máquina após concluir este passo.
</li>
</ul>

<hr>

<a name="s-s-samba-c-dominio-wXPServer"></a>
<h4>18.14.3.4 Windows XP Server Edition</h4>

<p>
Siga os procedimentos documentados em <a
href="#s-s-samba-c-dominio-wXPprofessional">Windows XP Professional Edition,
Seção 18.14.3.3</a>

<hr>

<a name="s-s-samba-c-dominio-NTWorkstation"></a>
<h4>18.14.3.5 Windows NT WorkStation</h4>

<p>
Veja os passos em <a href="#s-s-samba-c-dominio-NTServer">Windows NT Server,
Seção 18.14.3.6</a>.

<hr>

<a name="s-s-samba-c-dominio-NTServer"></a>
<h4>18.14.3.6 Windows NT Server</h4>

<ul>
<li>
Clique no item <samp>Rede</samp> do painel de controle.
</li>
<li>
Na tab <samp>Serviços</samp>, confira se os serviços <samp>Estação de
trabalho</samp>, <samp>Interface de NetBIOS</samp> e <samp>Serviços TCP/IP
simples</samp> estão instalados.  Caso não estejam, faça sua instalação usando
o botão <samp>Adicionar</samp> nesta mesma janela.
</li>
<li>
Na tab <samp>Protocolos</samp>, verifique se os protocolos <em>NetBEUI</em> e
<em>TCP/IP</em> estão instalados.  Caso não estejam, faça sua instalação
clicando no botão <samp>Adicionar</samp> nesta mesma janela.
</li>
<li>
Na tab identificação, clique no botão <samp>Alterar</samp>
</li>
<li>
Na janela que se abrirá, coloque o nome do computador no campo <samp>Nome do
Computador</samp>
</li>
<li>
Clique em <samp>Dominio</samp> e escreva o nome do domínio que deseja entrar.
</li>
<li>
Para criar uma <em>conta de máquina</em> no domínio, clique em <samp>criar uma
conta de computador no domínio</samp> e coloque na parte de baixo o nome do
usuário sua senha.  O usuário deverá ter poderes para adicionar máquinas no
domínio.  Caso a conta de máquina não seja criada, o Windows NT será como um
Windows 95/98 na rede, sem a segurança que seu nome NetBIOS não seja usado por
outros (veja <a href="#s-s-samba-dom-contasmac">Contas de máquinas de domínio,
Seção 18.7.5</a>).
</li>
<li>
Clique em OK até voltar.
</li>
<li>
Pronto, seu computador agora faz parte do domínio.
</li>
</ul>

<hr>

<a name="s-s-samba-c-dominio-w2kProfessional"></a>
<h4>18.14.3.7 Windows 2000 Professional</h4>

<p>
Siga os passos descritos em <a href="#s-s-samba-c-dominio-w2kServer">Windows
2000 Server, Seção 18.14.3.8</a>.

<hr>

<a name="s-s-samba-c-dominio-w2kServer"></a>
<h4>18.14.3.8 Windows 2000 Server</h4>

<ul>
<li>
Primeiro, siga todos os passos para ingressar a máquina em um grupo de trabalho
como documentado em <a href="#s-s-samba-c-workgroup-w2kServer">Windows 2000
Server, Seção 18.14.2.8</a>.
</li>
<li>
Após reiniciar a máquina, volte na tela de alteração de identificação de
máquina na rede.
</li>
<li>
Clique com o mouse em &quot;Domínio&quot; e digite o nome do domínio na caixa
de diálogo.
</li>
<li>
Na tela seguinte, será lhe pedido o nome de usuário e senha com poderes
administrativos que podem inserir/remover máquinas do domínio.
</li>
<li>
Clique em OK e aguarde a mensagem confirmando sua entrada no domínio.  Será
necessário reiniciar a máquina após concluir este passo.
</li>
</ul>

<p>
Caso não consiga trocar a senha do Windows 2000 no servidor PDC, desative a
opção <samp>unix password sync</samp>.

<hr>

<a name="s-s-samba-c-dominio-linux"></a>
<h4>18.14.3.9 Linux</h4>

<ul>
<li>
Entre no sistema como usuário <em>root</em>.
</li>
<li>
Instale o <code>SAMBA</code> caso não esteja ainda instalado.
</li>
<li>
Edite o arquivo de configuração do samba <code>/etc/samba/smb.conf</code>, será
necessário modificar as seguintes linhas na seção <em>[global]</em>:
<pre>
     [global]
      workgroup = nome_domínio
      security = domain
      password server = nome_pdc nome_bdc
      encrypt passwords = true
</pre>
<p>
Onde:
<ul>
<li>
<samp>workgroup</samp> - Nome do domínio que deseja fazer parte.
</li>
<li>
<samp>security</samp> - Nível de segurança.  Nesta configuração, utilize
&quot;domain&quot;.
</li>
<li>
<samp>password server</samp> - Nome da máquina PDC, BDC.  Também poderá ser
usado <samp>*</samp>, assim o <code>SAMBA</code> tentará descobrir o servidor
PDC e BDC automaticamente, da mesma forma usada pelo <code>Windows</code>.
</li>
<li>
<samp>encrypt passwords</samp> - Diz se as senhas serão encriptadas ou não.
Sempre utilize senhas criptografadas para colocar uma máquina em um domínio.
</li>
</ul>
<p>
Reinicie o servidor <code>SAMBA</code> após estas modificações.
</li>
<li>
Execute o comando: <samp>smbpasswd -j domínio -r PDC/BDC -U
usuario_admin</samp>.  Onde:
<ul>
<li>
<samp>domínio</samp> - Domínio que deseja fazer o logon
</li>
<li>
<samp>PDC/BDC</samp> - Nome da máquina PDC/BDC do domínio.  Em alguns casos,
pode ser omitido.
</li>
<li>
<samp>usuario_admin</samp> - Usuário com poderes administrativos para
ingressara a máquina no domínio.
</li>
</ul>
</li>
<li>
Se tudo der certo, após executar este comando, você verá a mensagem:
<pre>
     Joined domain &quot;domínio&quot;.
</pre>
</li>
</ul>

<p>
Se sua configuração não funcionou, revise com atenção todos os ítens acima.
Verifique se a conta de máquina foi criada no servidor e se o
<code>SAMBA</code> na máquina cliente foi reiniciado.  De também uma olhada em
<a href="#s-s-samba-c-dominio-erros">Erros conhecidos durante o logon do
cliente, Seção 18.14.4</a>.

<p>
<strong>OBS:</strong>O SAMBA envia primeiramente um usuário/senha falso para
verificar se o servidor rejeita o acesso antes de enviar o par de nome/senha
corretos.  Por este motivo, seu usuário pode ser bloqueado após um determinado
número de tentativas em alguns servidores mais restritivos.  Para acessar os
recursos compartilhados, veja <a href="#s-s-samba-c-workgroup-linux">Linux,
Seção 18.14.2.9</a>.  Note que não é obrigatório realizar as configurações
acima para acessar os recursos de uma máquina em domínio, basta apenas que
autentique com seu nome de usuário/senha no domínio e que ela seja autorizada
pelo PDC.

<hr>

<a name="s-s-samba-c-dominio-erros"></a>
<h3>18.14.4 Erros conhecidos durante o logon do cliente</h3>

<p>
Esta seção contém os erros mais comuns e a forma de correção da maioria dos
problemas que ocorrem quando um cliente SAMBA tenta entrar em domínio.
<ul>
<li>
<samp>error creating domain user: NT_STATUS_ACCESS_DENIED</samp> - A conta de
máquina no domínio não foi criada.  Veja <a
href="#s-s-samba-dom-contasmac">Contas de máquinas de domínio, Seção 18.7.5</a>
para mais detalhes.
</li>
<li>
<samp>NT_STATUS_NO_TRUST_SAM_ACCOUNT</samp> - Não existe conta de máquina no
<code>Windows NT</code> para autenticar uma máquina no domínio.  Esta mensagem
é mostrada quando a máquina SAMBA é cliente de um domínio NT.
</li>
<li>
<samp>error setting trust account password: NT_STATUS_ACCESS_DENIED</samp> - A
senha para criação de conta na máquina está incorreta ou a conta utilizada não
tem permissões para ingressar uma máquina no domínio (veja <a
href="#s-s-samba-dom-admin">Criando uma conta de administrador de domínio,
Seção 18.7.6</a>).  Caso esteja usando um cliente SAMBA, verifique se o
parâmetro <samp>encrypt passwords</samp> está ativado.
</li>
<li>
<samp>A senha informada não está correta ou o acesso ao seu servidor de logon
foi negado</samp> - Verifique primeiro os logs de acessos do sistema.  Caso o
SAMBA esteja sendo executado via <code>inetd</code>, verifique se a
configuração padrão é restritiva e se o acesso está sendo negado pelos arquivos
do tcp wrappers <code>hosts.allow</code> e <code>hosts.deny</code>.
</li>
<li>
<samp>não existem servidores de logon no domínio</samp> - Verifique se o
parâmetro <samp>domain logons = yes</samp> foi usado para permitir o logon em
domínio.
</li>
</ul>

<hr>

<a name="s-s-samba-c-graficos"></a>
<h3>18.14.5 Programas de navegação gráficos</h3>

<p>
O <code>smbclient</code>, <code>nmblookup</code> e <code>smbmount</code> são
ferramentas extremamente poderosas auxiliando bastante o administrador na
tarefa de configuração de sua rede e resolver problemas.  Para o uso no dia a
dia ou quando não é necessária a operação via console, você pode utilizar uma
das alternativas abaixo que são front-ends a estas ferramentas e facilitam o
trabalho de navegação na rede.

<hr>

<a name="s-s-samba-c-graficos-linneighborhood"></a>
<h4>18.14.5.1 linneighborhood</h4>

<p>
Cliente SAMBA baseado em GTK, muito leve e possibilita a navegação entre os
grupos máquinas em forma de árvore.  Ele também permite a montagem de
compartilhamentos remotos.  Caso precise de recursos mais complexos e
autenticação, recomendo o <a href="#s-s-samba-c-graficos-tksmb">TkSmb, Seção
18.14.5.2</a>.

<hr>

<a name="s-s-samba-c-graficos-tksmb"></a>
<h4>18.14.5.2 TkSmb</h4>

<p>
Cliente SAMBA baseado em TCL/TK.  Seu ponto forte é a navegação nos recursos da
máquina ao invés da rede completa, possibilitando autenticação em domínio/grupo
de trabalho, montagem de recursos, etc.

<hr>

<a name="s-s-samba-c-conf"></a>
<h3>18.14.6 Cliente de configuração gráficos</h3>

<p>
São ferramentas que permitem a configuração do samba usando a interface
gráfica.  Isto facilita bastante o processo, principalmente se estiver em
dúvidas em algumas configurações, mas como todo bom administrador UNIX sabe,
isto não substitui o conhecimento sobre o funcionamento de cada opção e ajustes
e organização feita diretamente no arquivo de configuração.

<hr>

<a name="s-s-samba-c-conf-gnosamba"></a>
<h4>18.14.6.1 gnosamba</h4>

<p>
Ferramenta de configuração gráfica usando o GNOME.  Com ele é possível definir
configurações localmente.  Ele ocupa pouco espaço em disco, e se você gosta de
GTK, este é o recomendado.

<p>
As opções do SAMBA são divididas em categorias facilitando sua localização e
uso.

<hr>

<a name="s-s-samba-c-conf-swat"></a>
<h4>18.14.6.2 swat</h4>

<p>
Ferramenta de administração via web do samba.  Este é um daemon que opera na
porta 901 da máquina onde o servidor samba foi instalado.  A configuração é
feita através de qualquer navegador acessando
<samp>http://ip_do_servidor:901</samp> e logando-se como usuário root (o único
com poderes para escrever no arquivo de configuração).

<p>
Esta ferramenta vem evoluindo bastante ao decorrer dos meses e é a recomendada
para a configuração do servidor SAMBA remotamente.  Seu modo de operação
divide-se em <em>básico</em> e <em>avançado</em>.  No modo <samp>básico</samp>,
você terá disponível as opções mais comuns e necessárias para compartilhar
recursos na rede.  O modo <samp>avançado</samp> apresenta praticamente todos os
parâmetros aceitos pelo servidor samba (restrições, controle de acesso,
otimizações, etc.).

<hr>

<a name="s-s-samba-exemplos"></a>
<h2>18.15 Exemplos de configuração do servidor SAMBA</h2>

<p>
Os exemplos existentes nesta seção cobrem diferentes tipos de configuração do
servidor, tanto em modo de compartilhamento com acesso público ou um domínio
restrito de rede.  Todos os exemplos estão bem comentados e explicativos,
apenas pegue o que se enquadre mais em sua situação para uso próprio e
adaptações.

<hr>

<a name="s-s-samba-exemplos-workgroup-p"></a>
<h3>18.15.1 Grupo de Trabalho com acesso público</h3>

<p>
Este exemplo pode ser usado de modelo para construir uma configuração baseada
no controle de acesso usando o nível de segurança <em>share</em> e quando
possui compartilhamentos de acesso público.  Esta configuração é indicada
quando necessita de compatibilidade com softwares NetBIOS antigos.

<pre>
      # Arquivo de configuração do SAMBA criado por 
      # Gleydson Mazioli da Silva &lt;gleydson@debian.org&gt;
      # para o guia Foca GNU/Linux Avançado - Capítulo SAMBA
      # Este script pode ser copiado e distribuído livremente de 
      # acordo com os termos da GPL. Ele não tem a intenção de 
      # atender uma determinada finalidade, sendo usado apenas 
      # para fins didáticos, portanto fica a inteira responsabilidade
      # do usuário sua utilização.
     
     [global]
      # nome da máquina na rede
      netbios name = teste
      # nome do grupo de trabalho que a máquina pertencerá
      workgroup = focalinux
      # nível de segurança share permite que clientes antigos mantenham a compatibilidade
      # enviando somente a senha para acesso ao recurso, determinando o nome de usuário
      # de outras formas
      security = share
      # O recurso de senhas criptografadas não funciona quando usamos o nível share 
      # de segurança. O motivo disto é porque automaticamente é assumido que você 
      # está selecionando este nível por manter compatibilidade com sistemas antigos
      # ou para disponibilizar compartilhamentos públicos, onde 
      encrypt passwords = false
      # Conta que será mapeada para o usuário guest
      guest account = nobody
      # Como todos os compartilhamentos desta configuração são de acesso público
      # coloquei este parâmetro na seção [global], assim esta opção afetará todos
      # os compartilhamentos.
      guest ok = 1
      # Conjunto de caracteres utilizados para acessar os compartilhamentos. O padrão
      # para o Brasil e países de língua latina é o ISO 8859-1
      character set = ISO8859-1
      
     
     # Compartilha o diretório /tmp (path = /tmp) com o nome &quot;temporario&quot; ([temporario]),
     # é adicionada a descrição &quot;Diretório temporário&quot; com acesso leitura/gravação 
     # (read only = no) e exibido na janela de navegação da rede (browseable = yes).
     [temporario]
      path = /tmp
      comment = Diretório temporário
      read only = no
      browseable = yes
     
     # Compartilha o diretório /pub (path = /pub) com o nome &quot;publico&quot; ([publico]).
     # A descrição &quot;Diretório de acesso público&quot; é associada ao compartilhamento
     # com acesso somente leitura (read only = yes) e exibido na janela de navegação 
     # da rede (browseable = yes).
     [publico] 
      path =/pub
      comment = Diretório de acesso público
      read only = yes
      browseable = yes
     
     # Compartilha todas as impressoras encontradas no /etc/printcap do sistema
     # Uma descrição melhor do tipo especial de compartilhamento &quot;[printers]&quot;
     # é explicado no inicio do guia Foca Linux
     [printers]
      comment = All Printers
      path = /tmp
      create mask = 0700
      printable = Yes
      browseable = No
</pre>

<hr>

<a name="s-s-samba-exemplos-workgroup-u"></a>
<h3>18.15.2 Grupo de Trabalho com acesso por usuário</h3>

<p>
O exemplo abaixo descreve uma configuração a nível de segurança por usuário
onde existem compartilhamentos que requerem login e usuários específicos, e
restrições de IPs e interface onde o servidor opera.  Esta configuração utiliza
senhas em texto claro para acesso dos usuários, mas pode ser facilmente
modificada para suportar senhas criptografadas.

<pre>
      # Arquivo de configuração do SAMBA criado por 
      # Gleydson Mazioli da Silva &gt;gleydson@debian.org&gt;
      # para o guia Foca GNU/Linux Avançado - Capítulo SAMBA
      # Este script pode ser copiado e distribuído livremente de 
      # acordo com os termos da GPL. Ele não tem a intenção de 
      # atender uma determinada finalidade, sendo usado apenas 
      # para fins didáticos, portanto fica a inteira responsabilidade
      # do usuário sua utilização.
     
     [global]
      # nome da máquina na rede
      netbios name = teste
      # nome do grupo de trabalho que a máquina pertencerá
      workgroup = focalinux
      # nível de segurança user somente aceita usuários autenticados após o envio 
      # de login/senha
      security = user
      # É utilizada senhas em texto claro nesta configuração
      encrypt passwords = false
      # Conta que será mapeada para o usuário guest
      guest account = nobody
      # Permite restringir quais interfaces o SAMBA responderá
      bind interfaces only = yes
      # Faz o samba só responder requisições vindo de eth0
      interfaces = eth0
      # Supondo que nossa interface eth0 receba conexões roteadas de diversas 
      # outras redes, permite somente as conexões vindas da rede 192.168.1.0/24
      hosts allow = 192.168.1.0/24
      # A máquina 192.168.1.57 possui gateway para acesso interno, como medida
      # de segurança, bloqueamos o acesso desta máquina.
      hosts deny = 192.168.1.57/32
      
      # Conjunto de caracteres utilizados para acessar os compartilhamentos. O padrão
      # para o Brasil e países de língua latina é o ISO 8859-1
      character set = ISO8859-1
     
      # As restrições do PAM terão efeito sobre os usuários e recursos usados do SAMBA
      obey pam restriction = yes 
     
     # Mapeia o diretório home do usuário autenticado. Este compartilhamento especial
     # é descrito em mais detalhes no inicio do capítulo sobre o SAMBA no Foca Linux.
     [homes]
       comment = Diretório do Usuário
       create mask = 0700
       directory mask = 0700
       browseable = No
     
     # Compartilha o diretório win (path = /win) com o nome &quot;win&quot; ([win]). 
     # A descrição associada ao compartilhamento será &quot;Disco do Windows&quot;, 
     # o nome de volume precisa ser especificado pois usamos programas 
     # que a proteção anti cópia é o serial. Ainda fazemos uma proteção
     # onde qualquer usuário existente no grupo @adm é automaticamente 
     # rejeitado e o usuário &quot;baduser&quot; somente possui permissão de leitura
     # (read list = baduser).
     #
     [win]
      path = /win
      comment = Disco do Windows
      volume = 3CF434C
      invalid users = @adm
      browseable = yes
      read list = baduser
     
     # Compartilha o diretório /pub (path = /pub) com o nome &quot;publico&quot; ([publico]).
     # A descrição &quot;Diretório de acesso público&quot; é associada ao compartilhamento
     # com acesso somente leitura (read only = yes) e exibido na janela de navegação 
     # da rede (browseable = yes). O parâmetro public = yes permite que este 
     # compartilhamento seja acessado usando o usuário &quot;nobody&quot; sem o fornecimento
     # de senha.
     [publico] 
      path =/pub
      comment = Diretório de acesso público
      read only = yes
      browseable = yes
      public = yes
</pre>

<hr>

<a name="s-s-samba-exemplos-dominio"></a>
<h3>18.15.3 Domínio</h3>

<pre>
      # Arquivo de configuração do SAMBA criado por 
      # Gleydson Mazioli da Silva &lt;gleydson@debian.org&gt;
      # para o guia Foca GNU/Linux Avançado - Capítulo SAMBA
      # Este script pode ser copiado e distribuído livremente de 
      # acordo com os termos da GPL. Ele não tem a intenção de 
      # atender uma determinada finalidade, sendo usado apenas 
      # para fins didáticos, portanto fica a inteira responsabilidade
      # do usuário sua utilização.
     
     [global]
      # nome da máquina na rede
      netbios name = teste
      # nome do grupo de trabalho que a máquina pertencerá
      workgroup = focalinux
      # String que será mostrada junto com a descrição do servidor
      server string = servidor PDC principal de testes
      # nível de segurança user somente aceita usuários autenticados após o envio 
      # de login/senha
      security = user
      # Utilizamos senhas criptografadas nesta configuração
      encrypt passwords = true
      smb passwd file = /etc/samba/smbpasswd
      # Conta que será mapeada para o usuário guest
      guest account = nobody
      # Permite restringir quais interfaces o SAMBA responderá
      bind interfaces only = yes
      # Faz o samba só responder requisições vindo de eth0
      interfaces = eth0
     
      # como estamos planejando ter um grande número de usuários na rede, dividimos
      # os arquivos de log do servidor por máquina.
      log file =  /var/log/samba/samba-%m-%I.log
      # O tamanho de CADA arquivo de log criado deverá ser 1MB (1024Kb). 
      max log size = 1000 
      # Escolhemos um nível de OS com uma boa folga para vencer as eleições de 
      # controlador de domínio local
      os level = 80 
      # Dizemos que queremos ser o Domain Master Browse (o padrão é auto)
      domain master = yes
      # Damos algumas vantagens para o servidor ganhar a eleição caso 
      # aconteça desempate por critérios
      preferred master = yes
      # Também queremos ser o local master browser para nosso segmento de rede
      local master = yes
      # Este servidor suportará logon de usuários
      domain logons = yes
      # Usuários que possuem poderes para adicionar/remover máquinas no domínio
      # (terão seu nível de acesso igual a root)
      admin users = gleydson
      # Unidade que será mapeada para o usuário local durante o logon (apenas
      # sistemas baseados no NT).
      logon drive = m:
      # Nome do script que será executado pelas máquinas clientes
      logon script = logon.bat
     
      # Ação que será tomada durante o recebimento de mensagens do 
      # Winpopup. 
      message command = /bin/sh -c '/usr/bin/linpopup &quot;%f&quot; &quot;%m&quot; %s; rm %s' &amp;
     
      # Conjunto de caracteres utilizados para acessar os compartilhamentos. O padrão
      # para o Brasil e países de língua latina é o ISO 8859-1
      character set = ISO8859-1
     
      # As restrições do PAM terão efeito sobre os usuários e recursos usados do SAMBA
      obey pam restriction = yes 
     
     # Mapeia o diretório home do usuário autenticado. Este compartilhamento especial
     # é descrito em mais detalhes no inicio do capítulo sobre o SAMBA no Foca Linux.
     [homes]
       comment = Diretório do Usuário
       create mask = 0700
       directory mask = 0700
       browseable = No
     
     # Compartilha o diretório win (path = /win) com o nome &quot;win&quot; ([win]). 
     # A descrição associada ao compartilhamento será &quot;Disco do Windows&quot;, 
     # o nome de volume precisa ser especificado pois usamos programas 
     # que a proteção anti cópia é o serial. Ainda fazemos uma proteção
     # onde qualquer usuário existente no grupo @adm é automaticamente 
     # rejeitado e o usuário &quot;baduser&quot; somente possui permissão de leitura
     # (read list = baduser).
     #
     [win]
      path = /win
      comment = Disco do Windows
      volume = 3CF434C
      invalid users = @adm
      browseable = yes
      read list = baduser
     
     # Compartilha o diretório /pub (path = /pub) com o nome &quot;publico&quot; ([publico]).
     # A descrição &quot;Diretório de acesso público&quot; é associada ao compartilhamento
     # com acesso somente leitura (read only = yes) e exibido na janela de navegação 
     # da rede (browseable = yes). O parâmetro public = yes permite que este 
     # compartilhamento seja acessado usando o usuário &quot;nobody&quot; sem o fornecimento
     # de senha.
     [publico] 
      path =/pub
      comment = Diretório de acesso público
      read only = yes
      browseable = yes
      public = yes
     
     # Compartilhamento especial utilizado para o logon de máquinas na rede
     [netlogon]
      path=/pub/samba/netlogon/logon.bat
      read only = yes
</pre>

<hr>

[ <a href="ch-s-cvs.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ <a href="ch-s-apache.html">12</a> ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ <a href="ch-s-cvs.html">17</a> ]
[ 18 ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-d-restr.html">próximo</a> ]

<hr>

<p>
Guia Foca GNU/Linux

<address>
Versão 6.40 - segunda, 30 de outubro de 2006<br>
<br>
Gleydson Mazioli da Silva <code><a href="mailto:gleydson@guiafoca.org">gleydson@guiafoca.org</a></code><br>
<br>
</address>

<hr>

</body>

</html>

