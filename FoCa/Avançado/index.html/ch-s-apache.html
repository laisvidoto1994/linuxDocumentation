<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Guia Foca GNU/Linux - Apache</title>

</head>

<body>

<a name="ch-s-apache"></a>
<hr>

[ <a href="ch-d-contas.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ 12 ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ <a href="ch-s-cvs.html">17</a> ]
[ <a href="ch-s-samba.html">18</a> ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-s-ident.html">próximo</a> ]

<hr>

<h1>
Guia Foca GNU/Linux
<br>Capítulo 12 - Apache
</h1>

<hr>

<p>
Esta capítulo documenta a configuração, personalização, introdução aos
mecanismos de autenticação e controle de acesso do <code>Apache</code>, sistema
proxy, virtual hosting, e exemplos de configuração do servidor
<code>httpd</code>.  Ele não tem como objetivo ser uma referência completa de
configuração, mas sim abordar didaticamente o assunto.

<hr>

<a name="s-s-apache-intro"></a>
<h2>12.1 Introdução</h2>

<p>
O servidor web é um programa responsável por disponibilizar páginas, fotos, ou
qualquer outro tipo de objeto ao navegador do cliente.  Ele também pode operar
recebendo dados do cliente, processando e enviando o resultado para que o
cliente possa tomar a ação desejada (como em aplicações CGI's, banco de dados
web, preenchimento de formulários, etc).

<p>
O <code>Apache</code> é um servidor Web extremamente configurável, robusto e de
alta performance desenvolvido por uma equipe de voluntários (conhecida como
<samp>Apache Group</samp>) buscando criar um servidor web com muitas
características e com código fonte disponível gratuitamente via Internet.
Segundo a Netcraft (<code><a
href="http://www.netcraft.com/">http://www.netcraft.com/</a></code>), o
<code>Apache</code> é mais usado que todos os outros servidores web do mundo
juntos.

<p>
Este capítulo não tenta ser um guia completo ao <code>Apache</code>, mas
tentará mostrar como sua estrutura é organizada, as diretivas principais de
configuração, diretivas de segurança, virtual hosting, proxy, o uso de
utilitários de gerenciamento do servidor, como personalizar algumas partes do
servidor e programas úteis de terceiros para análise e diagnóstico do servidor
web.  Não deixe também de ver <a href="#s-s-apache-exemplo">Exemplo comentado
de um arquivo de configuração do Apache, Seção 12.14</a> pois contém diretivas
básicas de configuração comentadas e explicações interessante e faz parte do
aprendizado.

<hr>

<a name="s-s-apache-versao"></a>
<h3>12.1.1 Versão</h3>

<p>
É assumido que esteja usando a versão 1.3.22 do <code>apache</code>.  As
explicações contidas aqui podem funcionar para versões posteriores, mas é
recomendável que leia a documentação sobre modificações no programa (changelog)
em busca de mudanças que alterem o sentido das explicações fornecidas aqui.

<hr>

<a name="s-s-apache-historia"></a>
<h3>12.1.2 Um resumo da História do Apache</h3>

<p>
O <code>Apache</code> tem como base o servidor web <code>NCSA 1.3</code>
(<em>National Center of Supercomputing Applications</em>), que foi desenvolvido
por Rob McCool.  Quando Rob deixou o NCSA, o desenvolvimento foi interrompido,
assim muitos desenvolvedores buscaram personalizar sua própria versão do NCSA
ou adicionar mais características para atender as suas necessidades.  Neste
momento começa a história do <code>Apache</code> com <em>Brian Behlendorf</em>
e <em>Cliff Skolnick</em> abrindo uma lista de discussão para interessados no
desenvolvimento, conseguindo espaço em um servidor doado pela <em>HotWired</em>
e trocando patches corrigindo problemas, adicionando recursos e discutindo
idéias com outros desenvolvedores e hackers interessados neste projeto.

<p>
A primeira versão oficial do <code>Apache</code> foi a 0.6.2, lançada em Abril
de 1995 (neste período a NCSA retomava o desenvolvimento de seu servidor web,
tendo como desenvolvedores <em>Brandon Long</em> e <em>Beth Frank</em> que
também se tornaram membros especiais do grupo <code>Apache</code>,
compartilhando idéias sobre seus projetos).

<p>
Nas versões 2.x do Apache, a escalabilidade do servidor foi ampliada suportando
as plataformas <code>Win32</code> (não obtendo o mesmo desempenho que em
plataformas UNIX mas sendo melhorado gradativamente).

<hr>

<a name="s-s-apache-contribuindo"></a>
<h3>12.1.3 Enviando Correções/Contribuindo com o projeto</h3>

<p>
Um formulário está disponível na Web para o envio de correções/sugestões em
<samp><code><a
href="http://www.apache.org/bug_report.html/">http://www.apache.org/bug_report.html/</a></code></samp>.
Uma lista de anuncio sobre o <code>Apache</code> está disponível em <code><a
href="mailto:apache-announce@apache.org">apache-announce@apache.org</a></code>
que divulgam correções, novas versões e realização de eventos.

<p>
Mais detalhes sobre o desenvolvimento do Apache podem ser visualizadas na URL
<samp><code><a
href="http://dev.apache.org/">http://dev.apache.org/</a></code></samp>.

<hr>

<a name="s-s-apache-caracteristicas"></a>
<h3>12.1.4 Características do Apache</h3>

<p>
Abaixo estão algumas características que fazem esse servidor web o preferido
entre os administradores de sistemas:
<ul>
<li>
Possui suporte a scripts cgi usando linguagens como <em>Perl, PHP, Shell
Script, ASP, etc</em>.
</li>
<li>
Suporte a autorização de acesso podendo ser especificadas restrições de acesso
separadamente para cada endereço/arquivo/diretório acessado no servidor.
</li>
<li>
Autenticação requerendo um nome de usuário e senha válidos para acesso a alguma
página/sub-diretório/arquivo (suportando criptografia via Crypto e MD5).
</li>
<li>
Negociação de conteúdo, permitindo a exibição da página Web no idioma
requisitado pelo Cliente Navegador.
</li>
<li>
Suporte a tipos mime.
</li>
<li>
Personalização de logs.
</li>
<li>
Mensagens de erro.
</li>
<li>
Suporte a virtual hosting (é possível servir 2 ou mais páginas com endereços/
portas diferentes através do mesmo processo ou usar mais de um processo para
controlar mais de um endereço).
</li>
<li>
Suporte a IP virtual hosting.
</li>
<li>
Suporte a name virtual hosting.
</li>
<li>
Suporte a servidor Proxy ftp e http, com limite de acesso, caching (todas
flexivelmente configuráveis).
</li>
<li>
Suporte a proxy e redirecionamentos baseados em URLs para endereços Internos.
</li>
<li>
Suporte a criptografia via SSL,Certificados digitais
</li>
<li>
Módulos DSO (Dynamic Shared Objects) permitem adicionar/remover funcionalidades
e recursos sem necessidade de recompilação do programa.
</li>
</ul>

<hr>

<a name="s-s-apache-ficha"></a>
<h3>12.1.5 Ficha técnica</h3>

<p>
Pacote: <code>apache</code>

<p>
Utilitários:
<ul>
<li>
<samp>apache</samp> - Servidor Web Principal
</li>
<li>
<samp>apachectl</samp> - Shell script que faz interface com o
<code>apache</code> de forma mais amigável
</li>
<li>
<samp>apacheconfig</samp> - Script em Perl para configuração interativa básica
do <code>Apache</code>
</li>
<li>
<samp>htpasswd</samp> - Cria/Gerencia senhas criptografadas Crypto/MD5
</li>
<li>
<samp>htdigest</samp> - Cria/Gerencia senhas criptografadas Crypto/MD5
</li>
<li>
<samp>dbmmanage</samp> - Cria/Gerencia senhas em formato DBM (Perl)
</li>
<li>
<samp>logresolve</samp> - Faz um DNS reverso dos arquivos de log do
<code>Apache</code> para obter o endereço de hosts com base nos endereços IP's.
</li>
<li>
<samp>ab</samp> - Apache Benchmarcking - Ferramenta de medida de desempenho do
servidor Web Apache.
</li>
</ul>

<p>
Por padrão, os arquivos de configuração do <code>Apache</code> residem no
diretório <code>/etc/apache</code>:
<dl>
<dt>httpd.conf</dt>
<dd>
Arquivo de configuração principal do <code>Apache</code>, possui diretivas que
controlam a operação do daemon servidor.  Um arquivo de configuração
alternativo pode ser especificado através da opção &quot;-f&quot; da linha de
comando.
</dd>
<dt>srm.conf</dt>
<dd>
Contém diretivas que controlam a especificação de documentos que o servidor
oferece aos clientes.  O nome desse arquivo pode ser substituído através da
diretiva ResourceConfig no arquivo principal de configuração.
</dd>
<dt>access.conf</dt>
<dd>
Contém diretivas que controlam o acesso aos documentos.  O nome desse arquivo
pode ser substituído através da diretiva <em>AccessConfig</em> no arquivo
principal de configuração.
</dd>
</dl>

<p>
O servidor Web lê os arquivos acima na ordem que estão especificados
(<code>httpd.conf</code>, <code>srm.conf</code> e <code>access.conf</code>).
As configurações também podem ser especificadas diretamente no arquivo
<code>httpd.conf</code>.  Note que não é obrigatório usar os arquivos
<code>srm.conf</code> e <code>access.conf</code>, mas isto proporciona uma
melhor organização das diretivas do servidor, principalmente quando se tem um
grande conjunto de diretivas.  Um exemplo comentado destes três arquivos de
configuração é encontrado em <a href="#s-s-apache-exemplo">Exemplo comentado de
um arquivo de configuração do Apache, Seção 12.14</a>.

<hr>

<a name="s-s-apache-hwreq"></a>
<h3>12.1.6 Requerimentos</h3>

<p>
A máquina mínima para se rodar um servidor <code>Apache</code> para atender a
uma rede padrão 10MB/s é um Pentium 90, 24MB de RAM, um HD com um bom
desempenho e espaço em disco considerável de acordo com o tamanho projetado de
seu servidor web (considerando seu crescimento).

<p>
Uma configuração mais rápida para redes 100MB/s teria como processador um Cyrix
MX ou Intel Pentium MMX como plataforma mínima (Cyrix é o recomendado pelo alto
desempenho no processamento de strings), barramento de HD SCSI com uma boa
placa controladora (Adaptec 19160 ou superior) com 64MB de RAM no mínimo.

<hr>

<a name="s-s-apache-logs"></a>
<h3>12.1.7 Arquivos de log criados pelo Apache</h3>

<p>
O servidor <code>httpd</code> grava seus arquivos de log geralmente em
<code>/var/log/apache</code>, não é possível descrever os arquivos de logs
usados porque tanto seus nomes como conteúdo podem ser personalizados no
arquivo <code>httpd.conf</code>.  Mesmo assim, os arquivos de logs encontrados
na instalação padrão do <code>Apache</code> são os seguintes:
<ul>
<li>
<code>access.log</code> - Registra detalhes sobre o acesso as páginas do
servidor <code>httpd</code>.
</li>
<li>
<code>error.log</code> - Registra detalhes saber erros de acesso as páginas ou
erros internos do servidor.
</li>
<li>
<code>agent.log</code> - Registra o nome do navegador do cliente (campo
<var>UserAgent</var> do cabeçalho http).
</li>
</ul>

<p>
Mais referências podem ser encontradas em <a href="#s-s-apache-log">Sistema de
Log do Apache, Seção 12.10</a>.  Um bom programa para geração de estatísticas
de acesso com gráficos é o <a href="#s-s-apache-log-webalizer">Relatório
gráfico de acesso ao sistema, Seção 12.10.15</a>.

<hr>

<a name="s-s-apache-install"></a>
<h3>12.1.8 Instalação</h3>

<p>
<samp>apt-get install apache apache-doc</samp>

<p>
(o pacote <code>apache-doc</code> contém a documentação de referencia do
<code>Apache</code>, é recomendável instala-lo se estiver curioso e deseja
entender melhor seu funcionamento ou consultar diretivas).

<hr>

<a name="s-s-apache-rodando"></a>
<h3>12.1.9 Iniciando o servidor/reiniciando/recarregando a configuração</h3>

<p>
O <code>Apache</code> pode ser executado tanto como um servidor <em>Inetd</em>
ou como um <em>Daemon</em>.  A inicialização de programas pelo <em>Inetd</em> é
uma boa estratégia quando você precisa de um controle de acesso básico (o
fornecido pelo <code>tcpd</code>), e o serviço é pouco usado na máquina.

<p>
A segurança de um serviço iniciado pelo <code>inetd</code> pode ser substituída
e melhorada por um firewall bem configurado, garantindo facilidades extras como
um relatório de tráfego para a porta do servidor web, por exemplo.  Mesmo assim
se o servidor <code>Apache</code> estiver rodando como daemon e estiver ocioso,
ele será movido para swap liberando a memória RAM para a execução de outros
programas.

<p>
Neste capítulo será assumido seu funcionamento do <code>Apache</code> como
Daemon, que é o método de funcionamento recomendado para sites de grande
tráfego onde ele é freqüentemente requisitado e considerado um serviço crítico.

<p>
O método padrão para iniciar programas como daemons na <code>Debian</code> é
através dos diretórios <code>/etc/rc?.d</code>.  Cada diretório deste contém os
programas que serão executados/interrompidos no nível de execução &quot;?&quot;
(<code>rc1.d/</code>, <code>rc2.d/</code> ...).  O conteúdo destes diretórios
são links para os scripts originais em <code>/etc/init.d/programa</code>, o
nosso programa alvo é <code>/etc/init.d/apache</code>.  O
<code>/etc/init.d/apache</code> aceita os seguintes parâmetros:
<ul>
<li>
<samp>start</samp> - Inicia o <code>Apache</code>
</li>
<li>
<samp>stop</samp> - Finaliza o <code>Apache</code>
</li>
<li>
<samp>restart</samp> - Reinicia o <code>Apache</code>, efetuando uma pausa de 5
segundos entre a interrupção do seu funcionamento e reinicio.
</li>
<li>
<samp>reload</samp> - Recarrega os arquivos de configuração do
<samp>Apache</samp>, as alterações entram em funcionamento imediatamente.
</li>
<li>
<samp>reload-modules</samp> - Recarrega os módulos.  Basicamente é feito um
restart no servidor.
</li>
<li>
<samp>force-reload</samp> - Faz a mesma função que o reload
</li>
</ul>

<p>
Para reiniciar o <code>Apache</code> usando o <code>/etc/init.d/apache</code>,
digite:

<p>
./etc/init.d/apache restart

<p>
ou

<p>
<samp>cd /etc/init.d;./apache restart</samp>

<p>
Na realidade, o que o <code>/etc/init.d/apache</code> faz é interagir
diretamente com o shell script <code>apachectl</code>.

<p>
O <code>apachectl</code> recebe os parâmetros enviados pelo usuário e converte
para sinais que serão enviados para o binário <code>apache</code>.  Da mesma
forma ele verifica os códigos de saída do <code>apache</code> e os transforma
em mensagens de erro legíveis para o usuário comum.  Os seguintes comandos são
aceitos pelo <code>apachectl</code>:
<ul>
<li>
<samp>httpd-server/start</samp> - Inicia o <code>Apache</code>
</li>
<li>
<samp>stop</samp> - Finaliza o <code>Apache</code> (enviando um sinal TERM)
</li>
<li>
<samp>restart</samp> - Reinicia o <code>Apache</code> (enviando um sinal HUP)
</li>
<li>
<samp>graceful</samp> - Recarrega os arquivos de configuração do
<code>Apache</code> (enviando um sinal USR1)
</li>
<li>
<samp>fullstatus</samp> - Mostra o status completo do servidor
<code>Apache</code> (requer o <code>lynx</code> e o módulo <em>mod_status</em>
carregado).
</li>
<li>
<samp>status</samp> - Mostra o status do processo do servidor
<code>Apache</code> (requer o <code>lynx</code> e o módulo <em>mod_status</em>
carregado).
</li>
<li>
<samp>configtest</samp> - Verifica se a sintaxe dos arquivos de configuração
está OK (executa um <samp>apache -t</samp>).
</li>
</ul>

<hr>

<a name="s-s-apache-opcoescmd"></a>
<h3>12.1.10 Opções de linha de comando</h3>

<ul>
<li>
<samp>-D nome</samp> - define um nome que será usado na diretiva &lt;IfDefine
nome&gt;.
</li>
<li>
<samp>-d diretório</samp> - especifica o diretório <em>ServerRoot</em>
(substitui o do arquivo de configuração).
</li>
<li>
<samp>-f arquivo</samp> - especifica um arquivo <em>ServerConfigFile</em>
alternativo.
</li>
<li>
<samp>-C &quot;diretiva&quot;</samp> - processa a diretiva antes de ler os
arquivo de configuração.
</li>
<li>
<samp>-c &quot;diretiva&quot;</samp> - processa a diretiva depois de ler os
arquivos de configuração.
</li>
<li>
<samp>-v</samp> - mostra a versão do programa.
</li>
<li>
<samp>-V</samp> - mostra opções usadas na compilação do <code>Apache</code>.
</li>
<li>
<samp>-h</samp> - Mostra o help on-line do programa
</li>
<li>
<samp>-l</samp> - lista módulos compilados junto com o Apache (embutidos)
</li>
<li>
<samp>-L</samp> - lista diretivas de configurações disponíveis
</li>
<li>
<samp>-S</samp> - Mostra configurações de Virtual Hosting
</li>
<li>
<samp>-t</samp> - executa a checagem de sintaxe nos arquivos de configuração do
Apache (incluindo a checagem da diretiva <em>DocRoot</em>).
</li>
<li>
<samp>-T</samp> - executa a checagem de sintaxe nos arquivos de configuração do
<code>Apache</code> (menos da diretiva <em>DocRoot</em>).
</li>
</ul>

<hr>

<a name="s-s-apache-port"></a>
<h2>12.2 Configurando a porta padrão do Apache</h2>

<p>
Use a diretiva <em>Port</em> para configurar a porta padrão que o
<code>Apache</code> receberá requisições por padrão.  A diretiva
<em>Listen</em> também é usada para ajustar o endereço/portas alternativas
(usadas também em <samp>Virtual Hosts</samp>) e substituirá as definições de
<em>Port</em>(veja <a href="#s-s-apache-listen">Especificando endereços/portas
adicionais (a diretiva <em>Listen</em>), Seção 12.5</a> para detalhes).

<p>
<strong>OBS:</strong>: Somente uma diretiva <em>Port</em> e um argumento
poderão ser especificados.  Para mais controle sobre as portas do sistema use a
diretiva <em>Listen</em>.

<hr>

<a name="s-s-apache-adicpagina"></a>
<h2>12.3 Adicionando uma página no Apache</h2>

<p>
Existem dois tipos de páginas que podem ser adicionadas ao <code>Apache</code>:
a página raíz e sub-páginas.
<dl>
<dt><em>Página Raíz</em></dt>
<dd>
A página raíz é especificada através da diretiva <em>DocumentRoot</em> e será
mostrada quando se entrar no domínio principal, como
<code>http://www.guiafoca.org</code>.  Na configuração padrão do
<code>Apache</code>, <em>DocumentRoot</em> aponta para o diretório
<code>/var/www</code>.  Este diretório será assumido como <strong>raíz</strong>
caso os diretórios não sejam iniciados por uma <code>/</code>:
<ul>
<li>
<code>home/focalinux</code> - Aponta para <code>/var/www/home/focalinux</code>
</li>
<li>
<code>/home/focalinux</code> - Aponta para <code>/home/focalinux</code>
</li>
</ul>

<p>
Este diretório deve conter um arquivo de índice válido (especificado pela
diretiva <em>DocumentIndex</em> no <code>srm.conf</code>) e permissões de
acesso válidas no arquivo <code>access.conf</code> para autorizar o acesso as
páginas em <code>/var/www</code> (veja <a
href="#s-s-apache-acesso-restr">Restrições de Acesso, Seção 12.7</a> para
detalhes).
</dd>
</dl>
<dl>
<dt>Sub-páginas</dt>
<dd>
Sub páginas são armazenadas abaixo do diretório da <em>Página raíz</em>, como
<code>http://www.guiafoca.org/download</code>.  Elas podem ser um subdiretório
da página principal em <code>/var/www</code> ou serem criadas através da
diretiva <em>Alias</em> no arquivo <code>srm.conf</code>.  Caso seja um
sub-diretório, as permissões de acesso de <code>/var/www</code> serão herdadas
para este subdiretório, mas também poderão ser modificadas com a especificação
de uma nova diretiva de acesso.

<p>
Através da diretiva <em>Alias</em> a página pode estar localizada em outro
diretório do disco (até mesmo outro sistema de arquivos) e as permissões de
acesso deverão ser definidas para aquela página.  Para criar um endereço
<code>http://www.guiafoca.org/iniciante</code> que aponta para o diretório
<code>/home/focalinux/download/iniciante</code> no disco local, basta usar a
seguinte diretiva no <code>srm.conf</code>:

<pre>
     Alias /iniciante /home/focalinux/download/iniciante
</pre>

<p>
Pode ser necessário permitir o acesso a nova página caso o servidor tenha uma
configuração restritiva por padrão (veja <a
href="#s-s-apache-acesso-restr">Restrições de Acesso, Seção 12.7</a> para
detalhes).  Após isto, faça o servidor <code>httpd</code> re-ler os arquivos de
configuração ou reinicia-lo.  Após isto, a página
<code>/home/focalinux/download/iniciante</code> estará acessível via
<code>http://www.guiafoca.org/iniciante</code>.

<p>
<strong>OBS:</strong> Caso inclua uma <code>/</code> no diretório que será
acessível via URL, o endereço somente estará disponível caso você entre com
<code>/</code> no final da URL:

<pre>
     Alias /doc/ /usr/doc/
</pre>

<p>
O diretório <code>/doc</code> somente poderá ser acessado usando
<code>http://www.guiafoca.org/doc/</code>, o uso de
<code>http://www.guiafoca.org/doc</code> retornará uma mensagem de URL não
encontrada.
</dd>
</dl>

<hr>

<a name="s-s-apache-bindaddress"></a>
<h2>12.4 Configurando as interfaces que o Apache atenderá</h2>

<p>
A diretiva <em>BindAddress</em> é usada para especificar endereços IP das
interfaces ou endereços FQDN que o <code>Apache</code> responderá requisições.
Mais de um endereço podem ser especificados separados por espaços.  Caso não
seja definido, o <code>Apache</code> assumirá o valor &quot;*&quot; (atenderá
requisições vindas de qualquer interface).

<p>
<strong>OBS1:</strong> - É permitido usar somente uma diretiva
<em>BindAddress</em>.  A diretiva <em>Listen</em> deverá ser usada se desejar
mais controle sobre as portas do servidor web.  Veja <a
href="#s-s-apache-listen">Especificando endereços/portas adicionais (a diretiva
<em>Listen</em>), Seção 12.5</a> para detalhes.

<p>
<strong>OBS2:</strong> - As interfaces especificadas pela diretiva
<em>Listen</em> substituirá as especificadas em <em>BindAddress</em>.

<p>
Exemplo:
<ul>
<li>
<samp>BindAddress 192.168.1.1</samp> - Especifica que os usuários da faixa de
rede <code>192.168.1.*</code> terão acesso ao servidor <code>httpd</code>.
Isto assume que a máquina possui o endereço <code>192.168.1.1</code> em sua
interface de rede interna.
</li>
<li>
<samp>BindAddress *</samp> - Atenderá requisições vindas de qualquer interface
de rede.
</li>
</ul>

<hr>

<a name="s-s-apache-listen"></a>
<h2>12.5 Especificando endereços/portas adicionais (a diretiva <em>Listen</em>)</h2>

<p>
A diretiva <em>Listen</em> é usada para se ter um controle maior sobre a
especificação de endereços/portas alternativas que o servidor web esperará por
requisições externas.  Esta diretiva é muito usada na construção de <em>Virtual
Hosts</em>.  Esta diretiva pode substituir completamente as diretivas
<em>Port</em> e <em>BindAddress</em>.  Podem ser usados o número da porta, ou o
par <samp>endereço:porta</samp>:

<pre>
     Listen 192.168.1.1:80
     Listen 192.168.7.1:81
     Listen 60000
</pre>

<p>
O endereço que deverá ser usado é o da interface de rede (assim como na
diretiva <em>BindAddress</em>).  No exemplo acima, o servidor
<code>httpd</code> esperará por requisições vindas de <code>192.168.1.*</code>
na porta 80 e também 60000, e requisições vindas de 192.168.7.1 na porta 81 e
também 60000.

<hr>

<a name="s-s-apache-acesso"></a>
<h2>12.6 Especificando opções/permissões para as páginas</h2>

<p>
As opções de restrição podem tanto ser especificadas nas diretivas
&lt;Directory&gt;, &lt;Location&gt; ou &lt;Files&gt; quanto nos arquivos
<code>.htaccess</code> (ou outro nome de arquivo de controle de acesso
especificado pela opção <em>AccessFileName</em> do arquivo de configuração do
<code>Apache</code>).  Cada diretiva de acesso é especificada entre
&lt;tags&gt; e devem ser fechadas com &lt;/tag&gt; (como na linguagem HTML).
As seguintes diretivas de acesso são válidas no <code>Apache</code>:
<dl>
<dt>Directory</dt>
<dd>
As restrição afetará o diretório no disco especificado, conseqüentemente a
página armazenada nele.  Por exemplo:

<pre>
     &lt;Directory /var/www&gt;
      Order deny,allow
      deny from all
      allow from 10.1.0.1
     &lt;Directory&gt;
</pre>

<p>
O acesso ao diretório <code>/var/www</code> será permitido somente ao
computador com o endereço IP <samp>10.1.0.1</samp>.
</dd>
</dl>
<dl>
<dt>DirectoryMatch</dt>
<dd>
Funciona como a diretiva &lt;Directory&gt; mas trabalha com expressões
regulares como argumento.  Por exemplo:

<pre>
     &lt;DirectoryMatch &quot;^/www/.*&quot;&gt;
      Order deny,allow
      deny from all
     &lt;DirectoryMatch&gt;
</pre>

<p>
Bloqueará o acesso ao diretório <code>/www</code> e sub-diretórios dentro dele.
</dd>
</dl>
<dl>
<dt>Files</dt>
<dd>
As restrições afetarão os arquivos do disco que conferem com o especificado.  É
possível usar os coringas <em>?</em> e <em>*</em> como no shell.  Também podem
ser usadas expressões regulares especificando um &quot;~&quot; após
<samp>Files</samp> e antes da expressão.  Por exemplo:

<pre>
     &lt;Files *.txt&gt;
      Order deny,allow
      deny from all
     &lt;/Files&gt;
</pre>

<p>
Bloqueia o acesso a todos os arquivos com a extensão <code>.txt</code>

<pre>
     &lt;Files ~ &quot;\.(gif|jpe?g|bmp|png)$&quot;&gt;
      Order deny,allow
     &lt;/Files&gt;
</pre>

<p>
Bloqueia o acesso a arquivos <code>gif, jpg, jpeg, bmp, png</code> (note que o
&quot;~&quot; ativa o modo de interpretação de expressões regulares).
</dd>
</dl>
<dl>
<dt>FilesMatch</dt>
<dd>
Permite usar expressões regulares na especificação de arquivos (equivalente a
diretiva &lt;Files ~ &quot;expressão&quot;&gt;).  Por exemplo:

<pre>
     &lt;FilesMatch &quot;\.(gif|jpe?g|bmp|png)$&quot;&gt;
      Order deny,allow
     &lt;/FilesMatch&gt;
</pre>

<p>
Bloqueia o acesso a arquivos <code>gif, jpg, jpeg, bmp, png</code>.
</dd>
</dl>
<dl>
<dt>Location</dt>
<dd>
As restrições afetarão o diretório base especificado na URL e seus
sub-diretórios.  Por exemplo:

<pre>
     &lt;Location /security&gt;
      Order allow,deny
     &lt;/Location&gt;
</pre>

<p>
Bloqueia o acesso de todos os usuários ao diretório <code>/security</code> da
URL (a explicação porque o acesso é bloqueado neste caso será explicado em <a
href="#s-s-apache-acesso-restr-autor">Autorização, Seção 12.7.1</a>).
</dd>
</dl>
<dl>
<dt>LocationMatch</dt>
<dd>
Idêntico a diretiva &lt;Location&gt; mas trabalha com expressões regulares.
Por exemplo:

<pre>
     &lt;LocationMatch &quot;/(extra|special)/data&quot;&gt;
      Order deny,allow
      deny from all
     &lt;/LocationMatch&gt;
</pre>

<p>
Bloqueará URLs que contém a substring &quot;/extra/data&quot; ou
&quot;/special/data&quot;.
</dd>
</dl>

<p>
O uso das diretivas &lt;Directory&gt; e &lt;Files&gt; é apropriada quando você
deseja trabalhar com permissões a nível de diretórios/arquivos no disco local
(o controle do proxy também é feito via &lt;Directory&gt;), o uso da diretiva
&lt;Location&gt; é adequado para trabalhar com permissões a nível de URL.  A
ordem de processamento das diretivas de acesso são processadas é a seguinte:
<ol type="1" start="1" >
<li>
A diretiva &lt;Directory&gt; (com exceção de &lt;DirectoryMatch&gt;) e os
arquivos <code>.htaccess</code> são processados simultaneamente.  As definições
dos arquivos <code>.htaccess</code> substituem as de &lt;Directory&gt;)
</li>
<li>
Expressões regulares de &lt;DirectoryMatch&gt;, &lt;Directory&gt;.
</li>
<li>
&lt;Files&gt; e &lt;FilesMatch&gt; são processados simultaneamente.
</li>
<li>
&lt;Location&gt; e &lt;LocationMatch&gt; são processados simultaneamente.
</li>
</ol>

<p>
Normalmente é encontrado a opção <em>Options</em> dentro de uma das diretivas
acima, a função desta diretiva é controlar os seguintes aspectos da listagem de
diretórios:
<dl>
<dt>All</dt>
<dd>
Todas as opções são usadas exceto a <samp>MultiViews</samp>.  É a padrão caso a
opção <em>Options</em> não seja especificada.
</dd>
<dt>ExecCGI</dt>
<dd>
Permite a execução de scripts CGI.
</dd>
<dt>FollowSymLinks</dt>
<dd>
O servidor seguirá links simbólicos neste diretório (o caminho não é
modificado).  Esta opção é ignorada caso apareça dentro das diretivas
&lt;Location&gt;, &lt;LocationMatch&gt; e &lt;DirectoryMatch&gt;.
</dd>
<dt>Includes</dt>
<dd>
É permitido o uso de includes no lado do servidor.
</dd>
<dt>IncludesNOEXEC</dt>
<dd>
É permitido o uso de includes do lado do servidor, mas o comando
<samp>#exec</samp> e <samp>#include</samp> de um script CGI são desativados.
</dd>
<dt>Indexes</dt>
<dd>
Se não existir um arquivo especificado pela diretiva &lt;DirectoryIndex&gt; no
diretório especificado, o servidor formatará automaticamente a listagem ao
invés de gerar uma resposta de acesso negado.
</dd>
<dt>MultiViews</dt>
<dd>
Permite o uso da Negociação de conteúdo naquele diretório.  A negociação de
conteúdo permite o envio de um documento no idioma requisitado pelo navegador
do cliente.
</dd>
<dt>SymLinksIfOwnerMatch</dt>
<dd>
O servidor somente seguirá links simbólicos se o arquivo ou diretório alvo
tiver como dono o mesmo user ID do link.  Esta opção é ignorada caso apareça
dentro das diretivas &lt;Location&gt;, &lt;LocationMatch&gt; e
&lt;DirectoryMatch&gt;.
</dd>
</dl>

<p>
Múltiplos parâmetros para <em>Options</em> podem ser especificados através de
espaços.

<p>
<strong>OBS1</strong>: A opção Options não tem efeito dentro da diretiva FILES.

<p>
<strong>OBS2</strong>: Tanto faz usar maiúsculas quanto minúsculas nas
diretivas de configuração, opções e parâmetros de configuração do
<code>Apache</code>, a capitalização apenas ajuda a leitura e interpretação:
SymLinksIfOwnerMatch (LinksSimbólicosSeDonoConferir).

<p>
As opções especificadas para o diretório afetam também seus sub-diretórios, a
não ser que sejam especificadas opções separadas para o sub-diretório:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes FollowSymLinks
     &lt;/Directory&gt;
</pre>

<p>
Ao acessar o diretório <code>/var/www/focalinux</code>, as permissões usadas
serão de <code>/var/www</code>, ao menos que uma diretiva &lt;Directory&gt; ou
&lt;Location&gt; seja especificada:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes FollowSymLinks
     &lt;/Directory&gt;
     
     &lt;Directory /var/www/focalinux&gt;
      Options Includes
     &lt;/Directory&gt;
</pre>

<p>
As opções e restrições de acesso de <code>/var/www/focalinux</code> serão
EXATAMENTE as especificadas no bloco da diretiva &lt;Directory
/var/www/focalinux&gt; e somente os <em>includes</em> serão permitidos.  Para
adicionar ou remover uma opção individual definidas por diretivas anteriores,
podem ser usado os sinais &quot;+&quot; ou &quot;-&quot;, por exemplo:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes FollowSymLinks
     &lt;/Directory&gt;
     
     &lt;Directory /var/www/focalinux&gt;
      Options +Includes -Indexes
     &lt;/Directory&gt;
</pre>

<p>
As opções <em>Indexes</em> e <em>FollowSymLinks</em> são definidas para o
diretório <code>/var/www</code>, então as permissões do diretório
<code>/var/www/focalinux</code> serão <em>FollowSymLinks</em> (do diretório
<code>/web/docs</code>) e <em>Includes</em> (adicionada) e o parâmetro
<em>Indexes</em> não terá efeito neste diretório.

<p>
É permitido fazer um aninhamento das diretivas &lt;Directory&gt; e
&lt;Files&gt;:

<pre>
     &lt;Directory /var/www&gt;
      Order allow,deny
      allow from all
     
      &lt;Files LEIAME-DONO.txt&gt;
       Order deny,allow
       deny from all
      &lt;/Files&gt;
     
     &lt;/Directory&gt;
</pre>

<p>
Neste caso, somente os arquivos <code>LEIAME-DONO.txt</code> existentes no
diretório <code>/var/www</code> e seus sub-diretórios serão bloqueados.

<p>
Se a diretiva &lt;Files&gt; for usada fora de uma estrutura &lt;Directory&gt;,
ela terá efeito em todos os arquivos disponibilizados pelo servidor.  Este é
excelente método para proteger os arquivos de acesso, senhas e grupos, conforme
será explicado mais adiante.

<p>
Qualquer outro tipo de aninhamento de diretivas resultará em um erro de
configuração ao se tentar carregar/recarregar o <code>Apache</code>.  Um
exemplo de diretiva incorreta:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes FollowSymLinks
     
      &lt;Directory /var/www/focalinux&gt;
       Options +Includes -Indexes
      &lt;/Directory&gt;
     
     &lt;/Directory&gt;
</pre>

<p>
O correto é:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes FollowSymLinks
     &lt;/Directory&gt;
     
     &lt;Directory /var/www/focalinux&gt;
      Options +Includes -Indexes
     &lt;/Directory&gt;
</pre>

<p>
Espero que tenha observado o erro no exemplo acima.

<p>
<strong>OBS1</strong>: Você pode verificar se a configuração do apache está
correta digitando <samp>apache -t</samp> como usuário root, se tudo estiver
correto com suas configurações ele retornará a mensagem: &quot;Syntax OK&quot;.

<p>
<strong>OBS2</strong>: Se <em>Options</em> não for especificado, o padrão será
permitir tudo exceto <em>MultiViews</em>.

<p>
<strong>OBS3</strong>: Qualquer restrição afetará o diretório atual e todos os
seus sub-diretórios!  Defina permissões de sub-diretórios específicos
separadamente caso precise de um nível de acesso diferente.  Veja também a
seção sobre arquivos OverRide (<code>.htaccess</code>) para detalhes sobre este
tipo de arquivo.

<p>
<strong>OBS4</strong>: A diretiva de acesso &quot;&lt;Directory /&gt;&quot; não
afetará outros sistemas de arquivos montados dentro de seus subdiretórios.
Caso uma diretiva de acesso padrão não seja especificada para outros sistemas
de arquivos, o acesso será automaticamente negado.

<hr>

<a name="s-s-apache-acesso-restr"></a>
<h2>12.7 Restrições de Acesso</h2>

<p>
A restrição de acesso do <code>Apache</code> é feita através de
<em>Autorização</em> (<a href="#s-s-apache-acesso-restr-autor">Autorização,
Seção 12.7.1</a>) e <em>Autenticação</em> (<a
href="#s-s-apache-acesso-restr-auth">Autenticação, Seção 12.7.2</a>).  Através
da <em>autorização</em>, é checado se o endereço/rede especificada tem ou não
permissão para acessar a página.  A <em>autenticação</em> requer que seja
passado nome e senha para garantir acesso a página.  Os métodos de
<em>Autorização</em> e <em>Autenticação</em> podem ser combinados como veremos
mais adiante.

<hr>

<a name="s-s-apache-acesso-restr-autor"></a>
<h3>12.7.1 Autorização</h3>

<p>
A restrição de acesso por autorização (controlado pelo módulo
<code>mod_access</code>), permite ou não o acesso ao cliente de acordo com o
endereço/rede especificada.  As restrições afetam também os sub-diretórios do
diretório alvo.  Abaixo um exemplo de restrição de acesso que bloqueia o acesso
de qualquer host que faz parte do domínio <em>.spammers.com.br</em> a URL
<code>http://servidor/teste</code>:

<pre>
     &lt;Location /teste&gt;
      Option Indexes
      Order allow,deny
      allow from all
      deny from .spammers.com.br
     &lt;/Location&gt;
</pre>

<p>
A opção <samp>Option</samp> foi explicada acima, seguem as explicações das
outras diretivas:
<dl>
<dt>Order</dt>
<dd>
Especifica em que ordem as opções de acesso <em>allow/deny</em> serão
pesquisadas.  Caso não seja especificada, o padrão será <em>deny/allow</em>.
Note que a ordem de pesquisa de <em>allow</em> e <em>deny</em> é a inversa da
especificada.  A diretiva <em>Order</em> aceita os seguintes valores:
<ul>
<li>
<samp>deny,allow</samp> - Esta é a padrão, significa um servidor mais
restritivo; a diretiva <em>allow</em> é processada primeiro e somente depois a
diretiva <em>deny</em>.  Caso nenhuma diretiva allow e deny forem especificadas
ou não conferirem, <strong>PERMITE TUDO</strong> como padrão.
</li>
<li>
<samp>allow,deny</samp> - Significa um servidor mais permissivo, a opção
<em>deny</em> é processada primeiro e somente depois a opção <em>allow</em>.
Caso nenhuma diretiva allow e deny for especificadas ou não conferirem,
<strong>BLOQUEIA TUDO</strong> como padrão.
</li>
<li>
<samp>mutual-failure</samp> - Somente permite o acesso se o usuário receber
autorização através da opção <em>allow</em> e <strong>NÃO</strong> ser
bloqueado pela opção <em>deny</em>, caso uma das checagens falhe, o acesso é
imediatamente negado.  É uma opção interessante quando você quer somente
pessoas de um determinado endereço/rede acessando o seu sistema e não estejam
em sua lista negra :-)
</li>
</ul>
<p>
<strong>ATENÇÃO</strong>: É importante saber se a página será permissiva ou
restritiva para escolher a ordem mais adequada ao seu caso, também leve em
consideração a possibilidade do processamento cair na diretiva de acesso
padrão, caso nem a diretiva allow e deny conferiram e estiver usando a ordem de
acesso &quot;allow,deny&quot; ou &quot;deny,allow&quot;.  Um sistema mal
configurado neste aspecto poderá trazer sérias conseqüências.
<p>
É comum em páginas permissivas se definir a seguinte configuração:
<pre>
     Order allow,deny
     allow from all
</pre>
<p>
O motivo é que em um grande site, se forem adicionadas mais restrições nesta
página (devido a alguns domínios que tem usuários mal comportados, bloqueio de
acesso a rede do concorrente, potenciais atacantes, etc...), estas deverão ser
lidas antes da diretiva &quot;allow from all&quot; e podem passar
desapercebidas ao administrador e podem simplesmente não funcionar caso a opção
<em>Order</em> não esteja ajustada corretamente (lembre-se, você é o
administrador e a integridade do site depende de sua atenção na escolha da
ordem correta das diretivas de acesso).
</dd>
<dt>allow from</dt>
<dd>
Especifica o endereço que terá acesso ao recurso especificado.  A diretiva
<em>allow</em> from aceita os seguintes valores:
<ul>
<li>
<samp>all</samp> - O acesso é permitido a todos.
</li>
<li>
um endereço de domínio completo (FQDN).  Por exemplo
<code>www.debian.org.br</code>.
</li>
<li>
um endereço de domínio parcial.  Qualquer computador que confira com o inicio
ou fim terá o acesso permitido.  Por exemplo, <code>.spammers.com.br</code>,
<code>.debian.org</code>.
</li>
<li>
um endereço IP completo, como <samp>192.168.1.1</samp>
</li>
<li>
um endereço IP parcial como <samp>192.168.1.</samp>
</li>
<li>
um par rede/máscara como <samp>10.1.0.0/255.255.0.0</samp> ou
<samp>10.1.0.0/16</samp>, uma faixa de acesso a máquinas de uma mesma rede pode
ser definida facilmente através deste método.
</li>
</ul>
<p>
<strong>OBS1</strong>: É necessário reiniciar o <code>Apache</code> depois de
qualquer modificação em seu arquivo de configuração (executando <samp>apachectl
restart</samp>), ou recarregar os arquivos de configuração (<samp>apachectl
graceful</samp>).
<p>
<strong>OBS2</strong>: Mais de um host pode ser especificado separando com um
espaço:
<pre>
     allow from 192.168. .debian.org.br
</pre>
<p>
Permitirá o acesso de qualquer máquina que o endereço IP confira com
<samp>192.168.*.*</samp> e qualquer computador do domínio
<samp>debian.org.br</samp>
<p>
<strong>OBS3</strong>: Regras baseadas em nomes simples de hosts (como
<samp>www</samp>) não conferirão!  Deverá ser usado o FQDN ou IP:
<samp>www.dominio.com.br</samp>
<p>
<strong>OBS4</strong>: Caso Order não seja especificado, <em>deny,allow</em>
será usado como padrão (ou seja, permitirá tudo como padrão).
</dd>
<dt>deny from</dt>
<dd>
Especifica os endereços que NÃO terão acesso ao recurso especificado.  As
explicações referentes a esta diretiva de acesso são idêntica as de <em>allow
from</em>.
</dd>
</dl>

<p>
É recomendável o uso de endereços IP ao invés de endereços DNS e um mecanismo
anti-spoofing no firewall ou código de roteamento, pois ficará mais difícil um
ataque baseado em DNS spoofing, aumentando consideravelmente a segurança de seu
servidor web.

<p>
<strong>ATENÇÃO</strong>: Caso receba erros 403 (acesso negado) sem bloquear a
URL nas diretivas de acesso, uma dos seguintes problemas pode ser a causa:
<ul>
<li>
O servidor Web não tem permissões para acessar/abrir o diretório da página.
Certifique-se que o <em>dono</em> e <em>grupo</em> do processo
<code>Apache</code> (especificado pela diretiva <em>User</em> e <em>Group</em>)
possuem permissões de acesso àquele diretório.
</li>
</ul>
<ul>
<li>
Quando quer fazer uma listagem de arquivos do diretório e não especifica a
opção <samp>Option Indexes</samp> como opção de listagem.
</li>
</ul>
<ul>
<li>
Quando não está usando <samp>Option Indexes</samp> para impedir a listagem de
conteúdo do diretório e o não foi encontrado um arquivo de índice válido dentre
os existentes na diretiva <samp>DirectoryIndex</samp> no diretório atual.
</li>
</ul>

<p>
Abaixo alguns exemplos de permissões de acesso:

<pre>
     &lt;Directory /var/www&gt;
      Options SymLinksIfOwnerMatch Indexes MultiViews
      Order allow,deny
      allow from all
     &lt;/Directory&gt;
</pre>

<p>
Permite o acesso a de qualquer usuário de qualquer lugar (allow from all),
permite também a visualização da listagem formatada de arquivos caso nenhum
arquivo especificado na diretiva <em>DirectoryIndex</em> seja encontrado
(Indexes), permite negociação de conteúdo (<em>MultiViews</em>) e seguir links
caso o dono do arquivo confira com o nome do link
(<em>SymLinksIfOwnerMatch</em>).

<pre>
     &lt;Directory /var/www&gt;
      Options SymLinksIfOwnerMatch Indexes MultiViews
     &lt;/Directory&gt;
</pre>

<p>
Tem o mesmo significado da diretiva acima por métodos diferentes; quando
nenhuma opção <em>Order</em> é especificada, <em>deny,allow</em> é definido
como padrão, e como nenhuma opção de acesso <em>allow/deny</em> foi
especificada, o padrão &quot;Order deny,allow&quot; é usado e permite TUDO como
padrão.

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      Order deny,allow
      deny from all
     &lt;/Directory&gt;
</pre>

<p>
Esta regra acima não tem muita lógica pois restringe o acesso de todos os
usuários ao diretório <code>/var/www</code>, ao menos se esta for sua
intenção...

<pre>
     &lt;Location /focalinux&gt;
      Options All
      Order allow,deny
      allow from all
     &lt;/Location&gt;
</pre>

<p>
A regra acima permite o acesso a URL
<code>http://www.servidor.org/focalinux</code> de qualquer host na Internet

<pre>
     &lt;Files .htaccess&gt;
      Order deny,allow
      deny from all
     &lt;/Files&gt;
</pre>

<p>
Bloqueia o acesso a qualquer arquivo <code>.htaccess</code> do sistema

<pre>
     &lt;Files ~ &quot;leiame-(arm|alpha|m68k|sparc|powerpc)\.txt&quot;&gt;
      Order deny,allow
      deny from all
     &lt;/Files&gt;
</pre>

<p>
Bloqueia o acesso a qualquer arquivo <code>leiame-arm.txt</code>,
<code>leiame-alpha.txt</code>, <code>leiame-m68k.txt</code>,
<code>leiame-sparc.txt</code> e <code>leiame-powerpc.txt</code> fazendo uso de
expressões regulares.

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      Order mutual-failure
      allow from .dominio.com.br
      deny from lammer.dominio.com.br
     &lt;/Directory&gt;
</pre>

<p>
A diretiva acima somente permite acesso ao diretório <code>/var/www</code> de
máquinas pertencentes ao domínio <code>.dominio.com.br</code> desde que não
seja <code>lammer.dominio.com.br</code>.

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes MultiViews
      Order allow,deny
      deny from .com .com.br
      allow from all 
     &lt;/Directory&gt;
</pre>

<p>
Bloqueia o acesso ao diretório <code>/var/www</code> de computadores
pertencentes aos domínios <em>.com</em> e <em>.com.br</em>.

<pre>
     &lt;Directory /var/www&gt;
      Options None
      Order deny,allow
      allow from 192.168.1. .guiafoca.org .debian.org
      deny from 200.200.123.
     &lt;/Directory&gt;
</pre>

<p>
A regra acima permite o acesso de máquinas da rede <samp>192.168.1.*</samp>, do
domínio <samp>*.guiafoca.org</samp> e <samp>*.debian.org</samp>, o acesso de
máquinas da rede <samp>200.200.123.*</samp> é bloqueado (nada contra, peguei
nesse número ao acaso :-).

<p>
Note que a máquina <samp>192.168.4.10</samp> terá acesso LIVRE a regra acima,
pois não conferirá nem com <em>allow</em> nem com <em>deny</em>, então o
processamento cairá na diretiva padrão de <em>deny,allow</em>, que neste caso
permite o acesso caso nem <em>allow</em> e <em>deny</em> conferiram com o
padrão.

<pre>
     &lt;Directory /var/www&gt;
      Options None
      Order allow,deny
      allow from 192.168.1. .cipsga.org.br .debian.org
      deny from 200.200.123.
     &lt;/Directory&gt;
</pre>

<p>
A regra acima é idêntica a anterior somente com a mudança da opção
<em>Order</em>.  Bloqueia o acesso de máquinas da rede
<samp>200.200.123.*</samp> e permite o acesso de máquinas da rede
<samp>192.168.1.*</samp>, do domínio <samp>*.cipsga.org.br</samp> e
<samp>*.debian.org</samp>.

<p>
Note que a máquina <samp>192.168.4.10</samp> terá acesso BLOQUEADO a regra
acima, pois não conferirá nem com <em>allow</em> nem com <em>deny</em>, então o
processamento cairá na diretiva padrão de <em>allow,deny</em> que neste caso
bloqueia o acesso.

<hr>

<a name="s-s-apache-acesso-restr-auth"></a>
<h3>12.7.2 Autenticação</h3>

<p>
Através da <em>autenticação</em> (controlado pelo módulo <code>mod_auth</code>)
é possível especificar um <em>nome</em> e <em>senha</em> para acesso ao recurso
solicitado.  As senhas são gravadas em formato criptografado usando
<em>Crypto</em> ou <em>MD5</em> (conforme desejado).  O arquivo de senhas pode
ser centralizado ou especificado individualmente por usuário, diretório ou até
mesmo por arquivo acessado.

<hr>

<a name="s-s-apache-acesso-restr-auth-arqsenha"></a>
<h4>12.7.2.1 Criando um arquivo de Senhas</h4>

<p>
O arquivo de senhas pode ser criado e mantido através do uso de 3 utilitários:
<code>htpasswd</code>, <code>htdigest</code> e <code>dbmmanage</code>:

<hr>

<a name="s-s-apache-acesso-restr-auth-arqsenha-htpasswd"></a>
<h5>12.7.2.1.1 htpasswd</h5>

<p>
Este é usado para criar o arquivo de senhas.  Para criar um banco de dados com
o nome <code>senhas</code> para o usuário <var>convidado</var>, é usada a
seguinte sintaxe:

<p>
<samp>htpasswd -c -m senhas convidado</samp>

<p>
Você será perguntado por uma senha para o usuário <var>convidado</var> e para
redigita-la.  A opção &quot;-c&quot; indica que deverá ser criado um arquivo, a
opção &quot;-m&quot; indica a utilização de senhas criptografadas usando o
algoritmo <em>MD5</em>, que garante maior segurança que o método
<em>Crypto</em>.  A senha pode ser especificada diretamente na linha de comando
através da opção &quot;-b&quot; (isto é um ótimo recurso para utilização em
shell scripts ou programas CGI de integração com o navegador).

<p>
<samp>htpasswd -b -d senhas chefe abcdef</samp>

<p>
No exemplo acima, uma senha de alta segurança será introduzida no banco de
dados <code>senhas</code> tornando impossível o acesso a página do usuário :-)

<p>
Note que esta senha foi cadastrada usando o algoritmo de criptografia Crypto
(opção -d).  O algoritmo <em>SHA</em> também pode ser usado como alternativa,
através da opção &quot;-s&quot;.  Para modificar a senha do usuário convidado,
basta usar a mesma sintaxe (sem a opção &quot;-c&quot; que é usada para criar
um novo arquivo):

<p>
<samp>htpasswd -m senhas convidado</samp>

<p>
ou

<p>
<samp>htpasswd -b -m senhas convidado nova_senha</samp>

<p>
Opcionalmente você pode especificar a opção &quot;-d&quot; para atualizar
também o formato da senha para <em>Crypto</em>.  Podem existir senhas de
criptografias mistas (<em>SHA, Crypto, MD5</em>) no mesmo arquivo sem nenhum
problema.

<p>
A mudança do formato de senhas é útil quando se deseja aumentar o nível de
segurança oferecido por um melhor sistema ou para manter a compatibilidade com
alguns scripts/programas que compartilhem o arquivo de senhas.

<hr>

<a name="s-s-apache-acesso-restr-auth-arqsenha-htdigest"></a>
<h5>12.7.2.1.2 htdigest e dbmmanage</h5>

<p>
Estes são idênticos ao <code>htpasswd</code>, a diferença é que o
<code>htdigest</code> permite criar/manter um arquivo de senhas usando a
autenticação Digest, enquanto o <code>dbmmanage</code> permite manter o banco
de dados de senhas em um arquivo <code>DB, DBM, GDBM</code> e
<code>NDBM</code>, formatos conhecidos pelo Perl.

<hr>

<a name="s-s-apache-acesso-restr-auth-usuarios"></a>
<h4>12.7.2.2 Autenticação através de usuários</h4>

<p>
Através deste método é possível especificar que usuários terão acesso ao
recurso definido, usando senhas de acesso individuais criptografadas usando um
dos utilitários da seção anterior.  Para restringir o acesso ao endereço
<code>http://servidor.org/teste</code>:

<pre>
     &lt;Location /teste&gt;
      AuthName &quot;Acesso a página do Foca Linux&quot;
      AuthType basic
      AuthUserFile /home/gleydson/SenhaUsuario
     # AuthGroupFile /home/users/SenhaGrupo
      Require valid-user
     &lt;/Location&gt;
</pre>

<p>
Ao tentar acessar o endereço <code>http://servidor/teste</code>, será aberta
uma janela no navegador com o título <em>Enter username for Acesso a página do
Foca Linux at servidor.org</em>, a diretiva <em>Require valid-user</em> definem
que o usuário e senha digitados devem existir no arquivo especificado por
<em>AuthUserFile</em> para que o acesso seja garantido.  Uma explicação de cada
opção de acesso usado na autenticação:
<dl>
<dt>AuthName</dt>
<dd>
Será o nome que aparecerá na janela de autenticação do seu navegador indicando
qual área restrita está solicitando senha (podem existir várias no servidor,
bastando especificar várias diretivas de restrições).
</dd>
<dt>AuthType</dt>
<dd>
Especifica o método de que o nome e senha serão passados ao servidor.  Este
método de autenticação pode ser <em>Basic</em> ou <em>Digest</em>
<ul>
<li>
<samp>Basic</samp> - Utiliza a codificação <em>base64</em> para encodificação
de nome e senha, enviando o resultado ao servidor.  Este é um método muito
usado e pouco seguro, pois qualquer sniffer instalado em um roteador pode
capturar e descobrir facilmente seu nome e senha.
</li>
<li>
<samp>Digest</samp> - Transmite os dados de uma maneira que não pode ser
facilmente decodificada, incluindo a codificação da área protegida
(especificada pela diretiva <em>AuthName</em>) que possui a seqüencia de
login/senha válida.  A diferença deste método é que você precisará de arquivos
de senhas diferentes para cada área protegida especificada por
<em>AuthName</em> (também chamada de Realm).
</li>
</ul>
</dd>
<dt>AuthUserFile</dt>
<dd>
É o arquivo gerado pelo utilitário <code>htpasswd</code> que contém a senha
correspondente ao usuário
</dd>
<dt>AuthGroupFile</dt>
<dd>
É um arquivo texto que contém o nome do grupo, dois pontos (&quot;:&quot;) e o
nome dos usuários que podem ter acesso ao recurso, separados por vírgulas.  No
exemplo acima ele se encontra comentado, mas a seguir encontrará exemplos que
explicam em detalhes o funcionamento desta diretiva.
</dd>
<dt>Require</dt>
<dd>
Especifica que usuários podem ter acesso ao diretório.  Podem ser usadas uma
das 3 sintaxes:
<ul>
<li>
<samp>Require user usuário1 usuário2 usuário3</samp> - Somente os usuários
especificados são considerados válidos para ter acesso ao diretório.
</li>
<li>
<samp>Require group grupo1 grupo2 grupo3</samp> - Somente os usuários dos
grupos especificados são considerados válidos para terem acesso ao diretório.
Esta diretiva é útil quando deseja que somente alguns usuários de determinado
grupo tenham acesso ao recurso (por exemplo, usuários do grupo admins).
</li>
<li>
<samp>Require valid-user</samp> - Qualquer usuário válido no banco de dados de
senhas pode acessar o diretório.  É bem útil quando as opções de acesso
especificadas por Require user são muito longas.
<p>
A opção Require deve ser acompanhado das diretivas <em>AuthName</em>,
<em>AuthType</em> e as diretivas <em>AuthUserFile</em> e <em>AuthGroupFile</em>
para funcionar adequadamente.
</li>
</ul>
</dd>
</dl>

<p>
<strong>OBS</strong>: É necessário reiniciar o <code>Apache</code> depois de
qualquer modificação em seu arquivo de configuração (<samp>apachectl
restart</samp>), ou recarregar os arquivos de configuração (<samp>apachectl
graceful</samp>).  Note que o <code>apachectl</code> é somente um shell script
para interação mais amigável com o servidor web <code>apache</code>, retornando
mensagens indicando o sucesso/falha no comando ao invés de códigos de saída.

<p>
Alguns exemplos para melhor assimilação:

<pre>
     &lt;Location /teste&gt;
      AuthName &quot;Acesso a página do Foca Linux&quot;
      AuthType basic
      AuthUserFile /home/gleydson/SenhaUsuario
      Require user gleydson
     &lt;/Location&gt;
</pre>

<p>
As explicações são idênticas a anterior, mas somente permite o acesso do
usuário <samp>gleydson</samp> a URL <code>http://servidor.org/teste</code>,
bloqueando o acesso de outros usuários contidos no arquivo
<em>AuthUserFile</em>.

<pre>
     &lt;Location /teste&gt;
      AuthName &quot;Acesso a página do Foca Linux&quot;
      AuthType basic
      AuthUserFile /home/gleydson/SenhaUsuario
      Require user gleydson usuario1 usuario2
     &lt;/Location&gt;
</pre>

<pre>
     &lt;Location /teste&gt;
      AuthName &quot;Acesso a página do Foca Linux&quot;
      AuthType basic
      AuthUserFile /home/gleydson/SenhaUsuario
      Require user gleydson
      Require user usuario1
      Require user usuario2
     &lt;/Location&gt;
</pre>

<p>
As 2 especificações acima são equivalentes e permite o acesso aos usuários
<samp>gleydson</samp>, <samp>usuario1</samp> e <samp>usuario2</samp> a página
<code>http://servidor.org/teste</code>.

<hr>

<a name="s-s-apache-acesso-restr-auth-grupos"></a>
<h4>12.7.2.3 Autenticação usando grupos</h4>

<p>
Há casos onde existem usuários de um arquivo de senhas que devem ter acesso a
um diretório e outros não, neste caso a diretiva <em>valid-user</em> não pode
ser especificada (porque permitiria o acesso de todos os usuários do arquivo de
senha ao diretório) e uma grande lista de usuários ficaria bastante complicada
de ser gerenciada com vários usuários na diretiva <em>Require user</em>.

<p>
Quando existe esta situação, é recomendado o uso de grupos de usuários.  Para
fazer uso desse recurso, primeiro deverá ser criado um arquivo quer armazenará
o nome do <em>grupo</em> e dos usuários pertencente àquele grupo usando a
seguinte sintaxe (vamos chamar este arquivo de <code>SenhaGrupo</code>):

<pre>
     admins: gleydson usuario2
     usuarios: usuario1 usuario2 usuario3 gleydson
</pre>

<p>
Agora adaptamos o exemplo anterior para que somente os usuários especificados
no grupo admins do arquivo criado acima:

<pre>
     &lt;Location /teste&gt;
      AuthName &quot;Acesso a página do Foca Linux&quot;
      AuthType basic
      AuthUserFile /home/gleydson/SenhaUsuario
      AuthGroupFile /home/gleydson/SenhaGrupo
      Require group admins
     &lt;/Location&gt;
</pre>

<p>
Agora somente os usuários pertencentes ao grupo <em>admins</em>
(<em>gleydson</em> e <em>usuario2</em>) poderão ter acesso ao diretório
<code>/teste</code>.

<p>
<strong>OBS1</strong>: Verifique se o servidor Web possui acesso a leitura no
arquivo de senhas de usuários e grupos, caso contrário será retornado um código
&quot;500 - Internal Server Error&quot;.  Este tipo de erro é caracterizado por
tudo estar OK na sintaxe dos arquivos de configuração após checagem com
&quot;apache -t&quot; e todas as diretivas de controle de acesso apontam para
os diretórios e arquivos corretos.

<p>
<strong>OBS2:</strong>: Sempre use espaços para separar os nomes de usuários
pertencentes a um grupo.

<p>
<strong>OBS3</strong>: NUNCA coloque os arquivos que contém senhas e grupos em
diretórios de acesso público onde usuários podem ter acesso via o servidor Web.
Tais localizações são <code>/var/www</code>,
<code>/home/&quot;usuario&quot;/public_html</code> e qualquer outro diretório
de acesso público que defina em seu sistema.

<p>
É recomendável também ocultar estes arquivos através da diretiva &lt;Files&gt;
evitando possíveis riscos de segurança com usuários acessando os arquivos de
senha e grupo.

<p>
Na distribuição <code>Debian</code>, qualquer arquivo iniciando com
<code>.ht*</code> será automaticamente ocultado pelo sistema, pois já existe
uma diretiva &lt;Files ~ &quot;\.ht&quot;&gt;.  Tal diretiva pode também ser
especificada no arquivo de acesso <code>.htaccess</code>.  Assim um arquivo
<code>.htsenha</code> e <code>.htgroup</code> são bons nomes se estiver
desejando ocultar dados de olhos curiosos...

<hr>

<a name="s-s-apache-acesso-restr-autor+auth"></a>
<h3>12.7.3 Usando autorização e autenticação juntos</h3>

<p>
Os métodos de <em>autorização</em> e <em>autenticação</em> podem ser usados ao
mesmo tempo dentro de qualquer uma das diretivas de controle de acesso.  As
diretivas de <em>autorização</em> são processadas primeiro (mod_access) e
depois as diretivas de <em>autenticação</em> (mod_auth).  Segue um exemplo:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      Order deny,allow
      allow from .dominiolocal.com.br
      deny from all
      AuthName &quot;Acesso ao diretório do servidor Web&quot;
      AuthType basic
      AuthUserFile /var/cache/apache/senhas
      Require valid-user
     &lt;/Directory&gt;
</pre>

<p>
Para ter acesso ao diretório <code>/var/www</code>, primeiro o computador deve
fazer parte do domínio <code>.dominiolocal.com.br</code>, assim ela passa pelo
teste de autorização, depois disso será necessário fornecer o login e senha
para acesso a página, digitando o login e senha corretos, o teste de
autenticação será completado com sucesso e o acesso ao diretório
<code>/var/www</code> autorizado.

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      Order mutual-failure
      allow from .dominiolocal.com.br
      deny from lammer.dominiolocal.com.br
      AuthName &quot;Acesso ao diretório do servidor Web&quot;
      AuthType basic
      AuthUserFile /var/cache/apache/senhas
      AuthGroupFile /var/cache/apache/grupos
      Require group admins
     &lt;/Directory&gt;
</pre>

<p>
No exemplo acima, é usado o método de autorização com a opção <em>Order
mutual-failure</em> e o método de autenticação através de <em>grupos</em>.
Primeiro é verificado se o usuário pertence ao domínio
<code>.dominiolocal.com.br</code> e se ele não está acessando da máquina
<code>lammer.dominiolocal.com.br</code>, neste caso ele passa pelo teste de
autorização.  Depois disso ele precisará fornecer o nome e senha válidos, com o
login pertencente ao <em>AuthGroupFile</em>, passando pelo processo de
autenticação e obtendo acesso ao diretório <code>/var/www</code>.

<hr>

<a name="s-s-apache-acesso-restr-autor+auth-diferenciado"></a>
<h4>12.7.3.1 Acesso diferenciado em uma mesma diretiva</h4>

<p>
É interessante permitir usuários fazendo conexões de locais confiáveis terem
acesso direto sem precisar fornecer nome e senha e de locais inseguros
acessarem somente após comprovarem <strong>quem</strong> realmente são.  Como é
o caso de permitir usuários de uma rede privada terem acesso completo aos
recursos e permitir o acesso externo ao mesmo recurso somente através de senha.
Isto pode ser feito com o uso da diretiva <em>Satisfy</em> junto ao bloco de
<em>autorização/autenticação</em>.  Vamos tomar como base o exemplo anterior:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      Order mutual-failure
      allow from .dominiolocal.com.br
      deny from lammer.dominiolocal.com.br
      AuthName &quot;Acesso ao diretório do servidor Web&quot;
      AuthType basic
      AuthUserFile /var/cache/apache/senhas
      AuthGroupFile /var/cache/apache/grupos
      Require group admins
      Satisfy any
     &lt;/Directory&gt;
</pre>

<p>
Note que o exemplo é o mesmo com a adição da diretiva <em>Satisfy any</em> no
final do bloco do arquivo.  Quando a opção <em>Satisfy</em> não é especificada,
ela assumirá &quot;all&quot; como padrão, ou seja, o usuário deverá passar no
teste de autorização e autenticação para ter acesso.

<p>
A diferença do exemplo acima em relação ao da seção anterior é se a máquina
passar no teste de autorização ela já terá acesso garantido.  Caso falhe no
teste de autorização, ainda terá a chance de ter acesso a página passando na
checagem de autenticação.

<p>
Isto garante acesso livre aos usuários do domínio
<code>.dominiolocal.com.br</code>.  Já os outros usuários, incluindo acessos
vindos de <code>lammer.dominiolocal.com.br</code> que pode ser uma máquina com
muito uso, poderá ter acesso ao recurso caso tenha fornecido um nome e senha
válidos para passar pelo processo de autenticação.  Tenha isto em mente...
este tipo de problema é comum e depende mais de uma política de segurança e
conduta interna, o sistema de segurança não pode fazer nada a não ser permitir
acesso a um nome e senha válidos.

<p>
Tenha cuidado com o uso da opção <em>Satisfy</em> em diretivas que especificam
somente o método de autenticação:

<pre>
     &lt;Directory /var/www&gt;
      Options Indexes
      AuthName &quot;Acesso ao diretório do servidor Web&quot;
      AuthType basic
      AuthUserFile /var/cache/apache/senhas
      AuthGroupFile /var/cache/apache/grupos
      Require group admins
      Satisfy any
     &lt;/Directory&gt;
</pre>

<p>
ATENÇÃO PARA O DESCUIDO ACIMA!: Como o método de autorização NÃO é
especificado, é assumido <em>deny,allow</em> como padrão, que permite o acesso
a TODOS os usuários.  O bloco acima <strong>NUNCA</strong> executará o método
de autenticação por este motivo.  A melhor coisa é NÃO usar a opção
<em>Satisfy</em> em casos que só requerem autenticação ou usar <em>Satisfy
all</em> (que terá o mesmo efeito de não usa-la, hehehe).

<p>
A falta de atenção nisto pode comprometer silenciosamente a segurança de seu
sistema.

<hr>

<a name="s-s-apache-acesso-restr-htaccess"></a>
<h3>12.7.4 O arquivo <code>.htaccess</code></h3>

<p>
O arquivo <code>.htaccess</code> deve ser colocado no diretório da página que
deverá ter suas permissões de acesso/listagem controladas.  A vantagem em
relação a inclusão direta de diretivas de acesso dentro do arquivo de
configuração do <code>Apache</code>, é que o controle de acesso poderá ser
definido pelo próprio webmaster da página, sem precisar ter acesso direto a
configuração do <code>Apache</code>, que requerem privilégios de root.

<p>
Outro ponto fundamental é que não há necessidade de reiniciar o servidor Web,
pois este arquivo é lido no momento de cada acesso ao diretório que controla.
O nome do arquivo OverRide pode ser definido através da diretiva
<em>AccessFileName</em> no arquivo de configuração do <code>Apache</code>,
<code>.htaccess</code> é usado como padrão.

<p>
O controle de que opções estarão disponíveis no <code>.htaccess</code> são
definidas na diretiva <em>AllowOverride</em> que pode conter o seguintes
parâmetros:
<ul>
<li>
<samp>None</samp> - O servidor não buscará o arquivo <samp>.htaccess</samp> nos
diretórios
</li>
<li>
<samp>All</samp> - O servidor utilizará todas as opções abaixo no arquivo
<code>.htaccess</code>
</li>
<li>
<samp>AuthConfig</samp> - Permite o uso de diretivas de autenticação
(<em>AuthDBMGroupFile</em>, <em>AuthDBMUserFile</em>, <em>AuthGroupFile</em>,
<em>AuthName</em>, <em>AuthType</em>, <em>AuthUserFile</em>, <em>Require</em>,
etc.).
</li>
<li>
<samp>FileInfo</samp> - Permite o uso de diretivas controlando o tipo de
documento (<em>AddEncoding</em>, <em>AddLanguage</em>, <em>AddType</em>,
<em>DefaultType</em>, <em>ErrorDocument</em>, <em>LanguagePriority</em>, etc.).
</li>
<li>
<samp>Indexes</samp> - Permite o uso de diretivas controlando a indexação de
diretório (<em>AddDescription</em>, <em>AddIcon</em>,
<em>AddIconByEncoding</em>, <em>AddIconByType</em>, <em>DefaultIcon</em>,
<em>DirectoryIndex</em>, <em>FancyIndexing</em>, <em>HeaderName</em>,
<em>IndexIgnore</em>, <em>IndexOptions</em>, <em>ReadmeName</em>, etc.).
</li>
<li>
<samp>Limit</samp> - Permite o uso de diretivas controlando o acesso ao
computador (<em>allow</em>, <em>deny</em> e <em>order</em>).
</li>
<li>
<samp>Options</samp> - Permite o uso de diretivas controlando características
específicas do diretório (<em>Options</em> e <em>XBitHack</em>).
</li>
</ul>

<p>
<strong>OBS</strong>: Não tem sentido usar a opção <em>AllowOverride</em>
dentro da diretiva &lt;Location&gt;, ela será simplesmente ignorada.

<p>
Para acesso ao arquivo <code>.htaccess</code> do diretório
<code>/var/www/focalinux</code>, o <code>Apache</code> buscará os arquivos
<code>.htaccess</code> na seqüencia: <code>/.htaccess</code>,
<code>/var/.htaccess</code>, <code>/var/www/.htaccess</code>,
<code>/var/www/focalinux/.htaccess</code>, qualquer diretiva que não exista no
<code>.htaccess</code> do diretório <code>/var/www/focalinux</code> terá seu
valor definido pela diretiva dos arquivos <code>.htaccess</code> dos diretórios
anteriores.  Somente após esta seqüencia de checagens o acesso ao documento é
permitido (ou negado).

<p>
Por este motivo, muitos administradores decidem desativar completamente o uso
de arquivos <code>.htaccess</code> no diretório raíz e habilitar somente nos
diretórios especificados pela diretiva &lt;Directory&gt; no arquivo de
configuração do <code>Apache</code>, evitando brechas de segurança na
manipulação destes arquivos (esta é uma boa idéia a não ser que se dedique 24
horas somente na administração do seu servidor Web e conheça toda sua estrutura
hierárquica de segurança:

<pre>
     &lt;Directory /&gt;
      AllowOverride none
     &lt;/Directory&gt;
     
     &lt;Directory /var/www&gt;
      AllowOverride limit authconfig indexes
     &lt;/Directory&gt;
</pre>

<p>
Na especificação acima, o arquivo <code>.htaccess</code> será procurado no
diretório <code>/var/www</code> e seus sub-diretórios, usando somente opções
que controlam a autorização de acesso (<em>limit</em>), autenticação e opções
(<em>authconfig</em>) e de indexação de documentos (<em>indexes</em>).

<p>
Alguns exemplos do uso do arquivo <code>.htaccess</code>:

<p>
Para permitir o acesso direto de usuários da rede <samp>192.168.1.*</samp>
diretamente, e requerer senha de acesso para outros usuários, o seguinte
arquivo <code>.htaccess</code> deve ser criado no diretório
<code>/var/www</code>:

<pre>
     Order deny,allow
     allow from 192.168.1.0/24
     deny from all
     AuthName &quot;Acesso a página Web principal da Empresa&quot;
     AuthType basic
     AuthUserFile /var/cache/apache/senhas
     Require valid-user
     Satisfy any
</pre>

<p>
Note que a sintaxe é exatamente a mesma das usadas na diretivas de acesso, por
este motivo vou dispensar explicações detalhadas a respeito.

<p>
<strong>ATENÇÃO</strong>: A diretiva <em>Options Indexes</em> deverá ser
especificada no <em>AllowOverRide</em> e não no arquivo <code>.htaccess</code>.
Agora você já sabe o que fazer se estiver recebendo erros 500 ao tentar acessar
a página (Erro interno no servidor)...

<hr>

<a name="s-s-apache-acesso-setenvif"></a>
<h3>12.7.5 Usando a diretiva SetEnvIf com Allow e Deny</h3>

<p>
É possível especificar o acesso baseado em variáveis de ambiente usando a
diretiva <em>SetEnvIf</em>, isto lhe permite controlar o acesso de acordo com o
conteúdo de cabeçalhos HTTP.  A sintaxe é a seguinte:

<p>
<samp>SetEnvIf [<em>atributo</em>] [<em>expressão</em>]
[<em>variável</em>]</samp>

<p>
Isto poder ser facilmente interpretado como: Se o &quot;atributo&quot;
especificado conter a &quot;expressão&quot;, a &quot;variável&quot; será criada
e armazenará o valor verdadeiro.  Veja abaixo:

<pre>
     SetEnvIf User-Agent &quot;.*MSIE*.&quot; EXPLODER
     &lt;Directory /var/www&gt;
      Order deny,allow
      allow from all
      deny from env=EXPLODER
     &lt;/Directory&gt;
</pre>

<p>
Se o Navegador (campo <em>User-Agent</em> do cabeçalho http) usado para acessar
a página for o <samp>Internet Explorer</samp>, a variável <var>EXPLODER</var>
será criada e terá o valor verdadeiro (porque a expressão de <em>SetEnvIf</em>
conferiu com a expressão).

<p>
Note o uso de &quot;deny from env=VARIÁVEL&quot;.  Neste caso se o navegador
for o <samp>Internet Explorer</samp>, o acesso será bloqueado (pois o navegador
conferiu, assim a variável <var>EXPLODER</var> recebeu o valor verdadeiro).

<p>
É permitido especificar as diretivas de acesso normais junto com especificação
de variáveis de ambiente, basta separa-los com espaços.  Uma descrição completa
dos cabeçalhos HTTP, conteúdo e parâmetros aceitos por cada um são descritos na
<samp>RFC 2068</samp>.

<hr>

<a name="s-s-apache-acesso-limit"></a>
<h3>12.7.6 A diretiva &lt;Limit&gt;</h3>

<p>
Esta diretiva é semelhante a &lt;Directory&gt; mas trabalha com métodos HTTP
(como GET, PUT, POST, etc) ao invés de diretórios.  A diretiva &lt;Limit&gt;
pode ser usada dentro da diretiva de acesso &lt;Directory&gt;,
&lt;Location&gt;, mas nenhuma diretiva de controle de acesso pode ser colocada
dentro de &lt;Limit&gt;.

<p>
Os métodos HTTP válidos são: GET, POST, PUT DELETE, CONNECT, OPTIONS, TRACE,
PATCH, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK e UNLOCK.  Note que os
métodos são case-sensitive.  Por exemplo:

<pre>
     &lt;Directory /var/www&gt;
      Option Indexes
       &lt;Limit POST PUT DELETE&gt;
          Order deny,allow
          allow from 192.168.1.0/24
          deny from all
        &lt;/Limit&gt;
     &lt;/Directory&gt;
</pre>

<p>
Somente permitem o uso dos métodos POST, PUT, DELETE de máquinas da rede
interna.

<p>
<strong>OBS1</strong>: Se o método GET é bloqueado, o cabeçalho HTTP também
será bloqueado.

<p>
<strong>OBS2</strong>: A diretiva de acesso &lt;Limit&gt; somente terá efeito
na diretiva &lt;Location&gt; se for especificada no arquivo de configuração do
servidor web.  A diretiva &lt;Location&gt; simplesmente é ignorada nos arquivos
<code>.htaccess</code>...

<p>
Este abaixo é usado por padrão na distribuição <code>Debian</code> para
restringir para somente leitura o acesso aos diretórios de usuários acessados
via módulo <code>mod_userdir</code>:

<pre>
     &lt;Directory /home/*/public_html&gt;
         AllowOverride FileInfo AuthConfig Limit
         Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
         &lt;Limit GET POST OPTIONS PROPFIND&gt;
             Order allow,deny
             Allow from all
         &lt;/Limit&gt;
         &lt;Limit PUT DELETE PATCH PROPPATCH MKCOL COPY MOVE LOCK UNLOCK&gt;
             Order deny,allow
             Deny from all
         &lt;/Limit&gt;
     &lt;/Directory&gt;
</pre>

<hr>

<a name="s-s-apache-acesso-limitexcept"></a>
<h3>12.7.7 Diretiva &lt;LimitExcept&gt;</h3>

<p>
Esta diretiva é semelhante a &lt;Limit&gt;, mas atinge todos os métodos HTTP,
menos os especificados.

<hr>

<a name="s-s-apache-errordocument"></a>
<h2>12.8 Definindo documentos de erro personalizados</h2>

<p>
Documentos de erros personalizados são definidos através da diretiva
<em>ErrorDocument</em>.  É possível especificar códigos de erros que serão
atendidos por certos documentos ou colocar esta diretiva dentro de blocos de
controle de acesso &lt;Directory&gt;, &lt;Location&gt; ou &lt;VirtualHost&gt;
para que tenham mensagens de erro personalizadas, ao invés da padrão usada pelo
servidor <code>httpd</code>.

<p>
<samp>ErrorDocument [<em>código de erro</em>] [<em>documento</em>]</samp>

<p>
Onde:
<dl>
<dt><em>código de erro</em></dt>
<dd>
Código de erro da mensagem (veja <a href="#s-s-apache-httpcodes">Códigos HTTP,
Seção 12.15</a> como referência).  O código de erro <em>401</em> deve
referir-se a um arquivo local.
</dd>
<dt><em>documento</em></dt>
<dd>
Documento, mensagem de erro ou redirecionamento que será usado no servidor caso
aquele código de erro seja encontrado:
</dd>
</dl>

<p>
Para definir uma mensagem de erro padrão para todo servidor web, basta colocar
a diretiva <em>ErrorDocument</em> fora das diretivas que controlam o acesso a
diretórios e virtual hosts (o inicio do arquivo <code>httpd.conf</code> é
ideal).

<p>
Exemplos:
<ul>
<li>
<samp>ErrorDocument 404 /cgi-bin/erros404.pl</samp> - Direciona para um script
em Perl que manda um e-mail ao administrador falando sobre o link quebrado e
envia o usuário a uma página de erro padrão.
</li>
<li>
<samp>ErrorDocument 404 /naoencontrada.html</samp> - Direciona o usuário para o
arquivo <code>naoencontrada.html</code> (dentro de <em>DocumentRoot</em>)
quando ocorrer o erro 404.  Note que o diretório <code>/</code> levado em
consideração é o especificado pela diretiva <em>DocumentRoot</em>.
</li>
<li>
<samp>ErrorDocument 500 &quot;Erro Interno no servidor&quot;</samp> - Mostra a
mensagem na tela quando ocorrer o erro 500.
</li>
<li>
<samp>ErrorDocument 401 /obtendoacesso.html</samp> - Direciona o usuário ao
arquivo explicando como obter acesso ao sistema.
</li>
<li>
<samp>ErrorDocument 503 http://www.guiafoca.org/servicos.html</samp> -
Redireciona o usuário a URL especificada.
</li>
<li>
<samp>ErrorDocument 403 &quot;Acesso negado&quot;</samp> - Mostra a mensagem na
tela no caso de erros 403.
</li>
</ul>

<hr>

<a name="s-s-apache-dso"></a>
<h2>12.9 Módulos DSO</h2>

<p>
Os módulos <em>DSO</em> permitem adicionar/remover características do
<code>Apache</code> sem necessidade de recompilar todo o servidor web, assim
interrompendo o serviço para a atualização dos arquivos.  Módulos de programas
terceiros também podem ser compilados e adicionado sem problemas através deste
recurso.

<p>
Os módulos são carregados para a memória no momento que o <code>apache</code> é
iniciado através da diretiva <em>LoadModule</em> no arquivo de configuração.
Dessa forma, toda vez que um novo módulo for adicionado, removido ou alterado,
será necessário reiniciar o servidor <code>apache</code>.  A sintaxe da linha
para carregar módulos <code>.so</code> é a seguinte:

<p>
<samp>LoadModule [<em>nome_do_modulo</em>]
[<em>caminho_do_arquivo_so</em>]</samp>

<dl>
<dt><em>nome_do_modulo</em></dt>
<dd>
Especifica o nome do módulo, não deve conter espaços.
</dd>
<dt><em>caminho_do_arquivo_so</em></dt>
<dd>
Define a localização do arquivo que contém o módulo especificado.  Por padrão
os módulos estão localizados em <code>/usr/lib/apache/[versão]</code>
</dd>
</dl>

<p>
A posição em que os módulos aparecem podem ter influência em seu funcionamento,
alguns requerem que sejam especificados antes de outros módulos para
funcionarem corretamente (como o módulo <em>php3_module</em>, que deve ser
carregado antes de qualquer módulo de controle de CGI's).  Leia a documentação
específica sobe o módulo em caso de dúvidas, os módulos que acompanham o
<code>Apache</code> são documentados em detalhes no manual do
<code>Apache</code>.

<p>
Para usar uma característica/diretiva/opção do <code>Apache</code> que dependa
de um certo módulo, obviamente você deverá carregar o módulo correspondente (em
caso de dúvidas, leia a documentação sobre o módulo).  Veja a <a
href="#s-s-apache-exemplo-httpd">httpd.conf, Seção 12.14.1</a> para exemplos do
uso da diretiva <em>LoadModule</em>.

<p>
Por exemplo, se você quiser utilizar as diretivas de autorização (<em>allow,
deny, order</em>) deverá ter o módulo <em>mod_access</em> carregado, para usar
as diretivas de autorização (<em>authname, authuserfile, authtype, etc</em>)
deverá ter o módulo <em>mod_auth</em> carregado.  Mais detalhes podem ser
encontrados em <a href="#s-s-apache-acesso-restr-autor">Autorização, Seção
12.7.1</a>.  <strong>OBS1</strong>: O suporte a <em>DSO</em> atualmente só está
disponível para plataforma <code>UNIX</code> e seus derivados, como o
<code>Linux</code>.

<p>
Também é possível ativar certas diretivas verificando se o módulo
correspondente estiver ou não carregado através da diretiva <em>IfModule</em>:

<pre>
     &lt;IfModule mod_userdir.c&gt;
      UserDir disabled root
      UserDir public_html
     &lt;/IfModule&gt;
</pre>

<p>
Nas linhas acima, as diretivas <em>UserDir</em> somente serão executadas se o
módulo <em>mod_userdir.c</em> estiver carregado através da diretiva
<em>LoadModule</em>.

<p>
Segue abaixo uma lista de módulos padrões que acompanham do
<code>Apache</code>, os módulos marcados com &quot;*&quot; são ativados por
padrão:
<dl>
<dt>Criação de Ambiente</dt>
<dd>
<ul>
<li>
<samp>* mod_env</samp> - Ajusta variáveis de ambiente para scripts CGI/SSI
</li>
<li>
<samp>* mod_setenvif</samp> - Ajusta variáveis de ambiente de acordo com
cabeçalhos http
</li>
<li>
<samp>mod_unique_id</samp> - Gera identificadores únicos para requisições
</li>
</ul>
</dd>
<dt>Decisão de tipo de conteúdo de arquivos</dt>
<dd>
<ul>
<li>
<samp>* mod_mime</samp> - Determinação de tipo/encodificação do conteúdo
(configurado)
</li>
<li>
<samp>mod_mime_magic</samp> - Determinação de tipo/encodificação do conteúdo
(automático)
</li>
<li>
<samp>* mod_negotiation</samp> - Seleção de conteúdo baseado nos cabeçalhos
&quot;HTTP Accept*&quot;
</li>
</ul>
</dd>
<dt>Mapeamento de URL</dt>
<dd>
<ul>
<li>
<samp>* mod_alias</samp> - Tradução e redirecionamento de URL simples
</li>
<li>
<samp>mod_rewrite</samp> - Tradução e redirecionamento de URL avançado
</li>
<li>
<samp>* mod_userdir</samp> - Seleção de diretórios de recursos por nome de
usuário
</li>
<li>
<samp>mod_speling</samp> - Correção de URLs digitadas incorretamente
</li>
<li>
<samp>mod_vhost_alias</samp> - Suporte para virtual hosts dinamicamente
configurados em massa.
</li>
</ul>
</dd>
<dt>Manipulação de Diretórios</dt>
<dd>
<ul>
<li>
<samp>* mod_dir</samp> - Manipulação de Diretório e arquivo padrão de diretório
</li>
<li>
<samp>* mod_autoindex</samp> - Geração de índice automático de diretório
</li>
</ul>
</dd>
<dt>Controle de Acesso</dt>
<dd>
<ul>
<li>
<samp>* mod_access</samp> - Controle de acesso por autorização (usuário,
endereço, rede)
</li>
<li>
<samp>* mod_auth</samp> - Autenticação HTTP básica (usuário, senha)
</li>
<li>
<samp>mod_auth_dbm</samp> - Autenticação HTTP básica (através de arquivos NDBM
do Unix)
</li>
<li>
<samp>mod_auth_db</samp> - Autenticação HTTP básica (através de arquivos
Berkeley-DB)
</li>
<li>
<samp>mod_auth_anon</samp> - Autenticação HTTP básica para usuários no estilo
anônimo
</li>
<li>
<samp>mod_auth_digest</samp> - Autenticação MD5
</li>
<li>
<samp>mod_digest</samp> - Autenticação HTTP Digest
</li>
</ul>
</dd>
<dt>Respostas HTTP</dt>
<dd>
<ul>
<li>
<samp>mod_headers</samp> - Cabeçalhos de respostas HTTP (configurado)
</li>
<li>
<samp>mod_cern_meta</samp> - Cabeçalhos de respostas HTTP (arquivos no estilo
CERN)
</li>
<li>
<samp>mod_expires</samp> - Respostas de expiração HTTP
</li>
<li>
<samp>* mod_asis</samp> - Respostas HTTP em formato simples (raw)
</li>
</ul>
</dd>
<dt>Scripts</dt>
<dd>
<ul>
<li>
<samp>* mod_include</samp> - Suporte a Includes no lado do servidor (SSI -
Server Sides Includes)
</li>
<li>
<samp>* mod_cgi</samp> - Suporte a CGI (Common Gateway Interface)
</li>
<li>
<samp>* mod_actions</samp> - Mapeia scripts CGI para funcionarem como
'handlers' internos.
</li>
</ul>
</dd>
<dt>Manipuladores de conteúdo Interno</dt>
<dd>
<ul>
<li>
<samp>* mod_status</samp> - Visualiza status do servidor em tempo de execução.
</li>
<li>
<samp>mod_info</samp> - Visualiza sumário de configuração do servidor.
</li>
</ul>
</dd>
<dt>Registros de Requisições</dt>
<dd>
<ul>
<li>
<samp>* mod_log_config</samp> - Registro de requisições personalizáveis
</li>
<li>
<samp>mod_log_agent</samp> - Registro especializado do User-Agent HTTP
(depreciado)
</li>
<li>
<samp>mod_log_refer</samp> - Registro especializado do Referrer HTTP
(depreciado)
</li>
<li>
<samp>mod_usertrack</samp> - Registro de cliques de usuários através de Cookies
HTTP
</li>
</ul>
</dd>
<dt>Outros</dt>
<dd>
<ul>
<li>
<samp>* mod_imap</samp> - Suporte a Mapeamento de Imagem no lado do servidor.
</li>
<li>
<samp>mod_proxy</samp> - Módulo de Cache do Proxy (HTTP, HTTPS, FTP).
</li>
<li>
<samp>mod_so</samp> - Inicialização do Dynamic Shared Object (DSO)
</li>
</ul>
</dd>
<dt>Experimental</dt>
<dd>
<ul>
<li>
<samp>mod_mmap_static</samp> - Cache de páginas freqüentemente servidas via
mmap()
</li>
</ul>
</dd>
<dt>Desenvolvimento</dt>
<dd>
<ul>
<li>
<samp>mod_example</samp> - Demonstração da API do Apache (somente
desenvolvedores)
</li>
</ul>
</dd>
</dl>

<hr>

<a name="s-s-apache-log"></a>
<h2>12.10 Sistema de Log do Apache</h2>

<p>
O <code>Apache</code> é bem flexível na especificação do que será registrado em
seus arquivos de log, possibilitando utilizar um arquivo de log único, diversos
arquivos de logs registrando cada evento ocorrido no sistema (conexão,
navegador, bloqueio de acesso, erros, etc) incluindo os campos que deseja em
cada arquivo e a ordem dos campos em cada um deles.

<p>
Enfim qualquer coisa pode ser especificada de forma que atenda as suas
necessidades particulares de logging.

<hr>

<a name="s-s-apache-log-agentlog"></a>
<h3>12.10.1 AgentLog</h3>

<p>
<samp>AgentLog arquivo/pipe</samp>: Indica o nome do arquivo que registrará o
nome do navegador que está acessando a página (conteúdo do cabeçalho
<samp>User-Agent</samp>).  É possível usar o pipe &quot;|&quot; para direcionar
os erros para um programa de formatação ou processamento.
<strong>ATENÇÃO</strong>: Se um programa for usado como pipe, ele será
executado sob o usuário que iniciou o <code>apache</code>.  Revise o código
fonte do programa para ter certeza que não contém falhas que possam comprometer
a segurança de seu sistema.

<p>
Exemplo: <samp>AgentLog /var/log/apache/agent.log</samp>

<hr>

<a name="s-s-apache-log-errorlog"></a>
<h3>12.10.2 ErrorLog</h3>

<p>
<samp>ErrorLog arquivo/pipe</samp> - Especifica o arquivo que registrará as
mensagens de erro do servidor <code>Apache</code>.  É possível usar o pipe
&quot;|&quot; para direcionar os erros para um programa de formatação ou
processamento.

<p>
Exemplo: <samp>ErrorLog /var/log/apache/errors.log</samp>

<hr>

<a name="s-s-apache-log-customlog"></a>
<h3>12.10.3 CustomLog</h3>

<p>
Permite especificar onde os logs serão gravados para os arquivos de logs
personalizados.  Esta diretiva também aceita apelidos definidos pela diretiva
<em>LogFormat</em>.

<p>
<samp>CustomLog [arquivo/pipe] [formato/nome]</samp>

<p>
Onde:
<dl>
<dt><em>arquivo/pipe</em></dt>
<dd>
Arquivo de log personalizado ou pipe.
</dd>
<dt><em>formato/nome</em></dt>
<dd>
Especifica o formato do arquivo de log (da mesma forma que o especificado na
opção <em>LogFormat</em>).  Deverá ser especificado entre &quot;aspas&quot;
caso tiver espaços.  Veja <a href="#s-s-apache-log-logformat">LogFormat, Seção
12.10.10</a> para detalhes.
</dd>
</dl>

<p>
Ao invés de especificar o formato, também é possível usar um apelido definido
pela opção <em>LogFormat</em> (<a href="#s-s-apache-log-logformat">LogFormat,
Seção 12.10.10</a>), neste caso os parâmetros definidos pelo <em>LogFormat</em>
para &quot;nome&quot; serão atribuídos a diretiva <em>CustomLog</em>.

<p>
Exemplos:
<ul>
<li>
<samp>CustomLog /var/log/apache/common.log &quot;%h %l %u %t \&quot;%r\&quot;
%&gt;s %b&quot;</samp>
</li>
<li>
<samp>CustomLog /var/log/apache/common.log common</samp>
</li>
</ul>

<hr>

<a name="s-s-apache-log-refererlog"></a>
<h3>12.10.4 RefererLog</h3>

<p>
<samp>RefererLog [arquivo/pipe]</samp>: Indica que arquivo/pipe registrará os
campos Referer do cabeçalho HTTP.  Esta diretiva é mantida por compatibilidade
com o servidor web NCSA 1.4.

<p>
A configuração padrão do <code>Apache</code> usa uma diretiva alternativa para
a especificação do <em>referer</em> que é a seguinte:

<pre>
     LogFormat &quot;%{Referer}i -&gt; %U&quot; referer
     CustomLog /var/log/apache/referer.log referer
</pre>

<p>
Exemplo: <samp>RefererLog /var/log/apache/referer.log</samp>

<hr>

<a name="s-s-apache-log-rewritelog"></a>
<h3>12.10.5 RewriteLog</h3>

<p>
<samp>RewriteLog: [arquivo/pipe]</samp>: Indica o arquivo/pipe que registrará
qualquer regravação de URL feita pelo <code>Apache</code>.

<p>
<strong>OBS</strong>: Não é recomendável direcionar o nome de arquivo para
<code>/dev/null</code> como forma de desativar este log, porque o módulo de
regravação não cria a saída para um arquivo de log, ele cria a saída de log
internamente.  Isto somente deixará o servidor lento.  Para desativar este
registro, simplesmente remova/comente a diretiva RewriteLog ou use a opção
RewriteLogLevel 0.

<p>
Exemplo: <samp>RewriteLog &quot;/usr/local/var/apache/logs/rewrite.log</samp>

<hr>

<a name="s-s-apache-log-rewriteloglevel"></a>
<h3>12.10.6 RewriteLogLevel</h3>

<p>
<samp>RewriteLogLevel [num]</samp>: Especifica os detalhes que serão incluídos
no registro da opção RewriteLog, os valores permitidos estão entre 0 e 9.  Se
for usado 0, o registro do RewriteLog é totalmente desativado (esta é a
padrão).  <strong>OBS</strong>: Qualquer valor acima de 2 deixa o servidor Web
cada vez mais lento devido ao processamento e a quantidade de detalhes
registrados no arquivo especificado por <em>RewriteLog</em>.

<hr>

<a name="s-s-apache-log-scriptlog"></a>
<h3>12.10.7 ScriptLog</h3>

<p>
<samp>ScriptLog [arquivo]</samp>: Especifica o nome do arquivo de log que
receberá as mensagens de erros gerados por scripts CGI executados no servidor.
Esta opção é controlada pelo módulos <em>mod_cgi</em>.

<p>
Os arquivos de log serão abertos por um sub-processo rodando com as permissões
do usuário especificado na diretiva &quot;user&quot;.

<p>
<strong>OBS</strong>: Esta opção somente é recomendada como depuradora de
scripts CGI, não para uso contínuo em servidores ativos.

<p>
Exemplo: <samp>ScriptLog /var/log/apache/cgiscripts.log</samp>

<hr>

<a name="s-s-apache-log-scriptlogbuffer"></a>
<h3>12.10.8 ScriptLogBuffer</h3>

<p>
<samp>ScriptLogBuffer</samp>: Especifica o tamanho do cabeçalho PUT ou POST
gravado no arquivo especificado por <em>ScriptLog</em>.  O valor padrão é 1024
bytes.  Esta opção é controlada pelo módulos <em>mod_cgi</em>

<p>
Exemplo: <samp>ScriptLogBuffer 512</samp>

<hr>

<a name="s-s-apache-log-scriptloglength"></a>
<h3>12.10.9 ScriptLogLength</h3>

<p>
<samp>ScriptLogLength: [tamanho]</samp>: Especifica o tamanho máximo do arquivo
de log gerado pela opção ScriptLog.  O valor padrão é 10385760 bytes (10.3MB).
Esta opção é controlada pelo módulos <em>mod_cgi</em>

<p>
Exemplo: <samp>ScriptLogLength 1024480</samp>

<hr>

<a name="s-s-apache-log-logformat"></a>
<h3>12.10.10 LogFormat</h3>

<p>
<samp>LogFormat</samp>: Define os campos padrões do arquivo gerado pela opção
<em>TransferLog</em>.  O seu formato é o seguinte:

<p>
<samp>LogFormat [formato] [nome]</samp>

<p>
Quando o formato não é especificado, assume o valor padrão <samp>%h %l %u %t
\&quot;%r\&quot; %s %b</samp>.  A especificação do [<em>nome</em>] permite que
você utilize o formato especificado em uma opção <em>CustomLog</em> ou outra
diretiva <em>LogFormat</em>, facilitando a especificação do formato do log.

<p>
Os seguintes formatos são válidos:
<ul>
<li>
<samp>%b</samp> - Bytes enviados, excluindo cabeçalhos HTTP.
</li>
<li>
<samp>%f</samp> - Nome do arquivo.
</li>
<li>
<samp>%{FOOBAR}e</samp> - O conteúdo da variável de ambiente FOOBAR.
</li>
<li>
<samp>%h</samp> - Máquina cliente.
</li>
<li>
<samp>%a</samp> - Endereço IP da máquina cliente.
</li>
<li>
<samp>%A</samp> - Endereço IP local.  Muito útil em virtual hostings.
</li>
<li>
<samp>%{Foobar}i</samp> - O conteúdo de Foobar: linhas de cabeçalho na
requisição enviada ao servidor.
</li>
<li>
<samp>%l</samp> - O nome de login remoto enviado pelo identd (se fornecido).
</li>
<li>
<samp>%{Foobar}n</samp> - O conteúdo de &quot;FooBar&quot; de outro módulo.
</li>
<li>
<samp>%{Foobar}o:</samp> - O conteúdo de Foobar: linhas de cabeçalho na
resposta.
</li>
<li>
<samp>%p</samp> - A porta do servidor servindo a requisição.
</li>
<li>
<samp>%P</samp> - A identificação do processo filho que serviu a requisição.
</li>
<li>
<samp>%r</samp> - A primeira linha da requisição.
</li>
<li>
<samp>%s</samp> - Status.  Para requisições que foram redirecionadas.
internamente.  Este é o status de uma requisição *original*.  Use %s para a
última.
</li>
<li>
<samp>%t</samp> - Hora, no formato do arquivo de log (formato inglês padrão).
</li>
<li>
<samp>%{format}t</samp> - Hora, no formato definido por strftime.
</li>
<li>
<samp>%T</samp> - O tempo necessário para servir a requisição, em segundos.
</li>
<li>
<samp>%u</samp> - Usuário remoto (através do auth, pode ser falso se o status
de retorno (%s) for 401).
</li>
<li>
<samp>%U</samp> - O caminho da URL requisitada.
</li>
<li>
<samp>%v</samp> - O nome canônico definido por <em>ServerName</em> que serviu a
requisição.
</li>
<li>
<samp>%V</samp> - O nome do servidor de acordo com a configuração de
<em>UseCanonicalName</em>.
</li>
</ul>

<p>
Exemplos:

<pre>
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %T %v&quot; full
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %P %T&quot; debug
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common
      LogFormat &quot;%{Referer}i -&gt; %U&quot; referer
      LogFormat &quot;%{User-agent}i&quot; agent
</pre>

<hr>

<a name="s-s-apache-log-transferlog"></a>
<h3>12.10.11 TransferLog</h3>

<p>
<samp>TransferLog [arquivo/pipe]</samp>: Indica o arquivo que armazenará as
transferências entre o servidor http e o cliente.  Ela cria o arquivo de log
com o formato definido pela opção <em>LogFormat</em> mais recente (sem a
especificação do nome associado a diretiva) ou o formato padrão CLF do log do
<code>Apache</code>.

<p>
Se omitido, o arquivo não será gerado

<p>
Exemplo: <samp>TransferLog /var/log/apache/transferências.log</samp>

<p>
<strong>OBS:</strong> Se esta não é uma opção muito utilizada na administração
de seus sistemas, é recomendável o uso da diretiva <em>CustomLog</em> (veja <a
href="#s-s-apache-log-customlog">CustomLog, Seção 12.10.3</a>) para evitar
confusões futuras.

<hr>

<a name="s-s-apache-log-loglevel"></a>
<h3>12.10.12 LogLevel</h3>

<p>
Define o nível de alerta das mensagens que serão gravadas no arquivo
especificado pela diretiva <em>ErrorLog</em>.  Quando não é especificado,
assume o nível &quot;error&quot; como padrão.  Abaixo os parâmetros aceitos em
sua respectiva ordem de importância:
<ul>
<li>
<samp>emerg</samp> - O sistema está inutilizável.
</li>
<li>
<samp>alert</samp> - A ação deve ser tomada imediatamente.
</li>
<li>
<samp>crit</samp> - Condições críticas.
</li>
<li>
<samp>error</samp> - Condições de erro.
</li>
<li>
<samp>warn</samp> - Condições de alerta.
</li>
<li>
<samp>notice</samp> - Condição normal mas significante.
</li>
<li>
<samp>info</samp> - Mensagens informativas.
</li>
<li>
<samp>debug</samp> - Mensagens do nível de depuração.
</li>
</ul>

<p>
Note que os níveis são os mesmos usados pelo <code>syslog</code>.  Quando um
nível particular é especificado, as mensagens de todos os níveis de maior
importância também serão registrados.  Por exemplo, se o nível &quot;info&quot;
for especificado, as mensagens com os níveis de &quot;notice&quot; e
&quot;warn&quot; também serão registradas.  É recomendado o uso de um nível de
no mínimo <em>crit</em>.

<hr>

<a name="s-s-apache-log-anonylogmail"></a>
<h3>12.10.13 Anonymous_LogEmail</h3>

<p>
Se estiver como &quot;on&quot; a senha digitada será registrada no arquivo
especificado por <em>ErrorLog</em>.  Esta diretiva é <em>ativada</em> por
padrão.

<p>
Exemplo: <samp>Anonymous_LogEmail off</samp>

<hr>

<a name="s-s-apache-log-cookielog"></a>
<h3>12.10.14 CookieLog</h3>

<p>
Especifica o arquivo que será usado para registrar os cookies

<p>
<strong>OBS1</strong>: Caso o caminho do arquivo não for especificado nas
diretivas, será assumido <em>DocumentRoot</em> como diretório padrão.

<p>
<strong>OBS2</strong>: Caso esteja usando o pipe, o dono do processo será o
mesmo que iniciou o servidor WEB Apache.  Tenha certeza do funcionamento do
programa para não comprometer o seu sistema, e cuide para que ele não possa ser
modificado indevidamente por outros usuários.

<p>
Exemplo: <samp>CookieLog /var/log/apache/cookies.log</samp>

<hr>

<a name="s-s-apache-log-webalizer"></a>
<h3>12.10.15 Relatório gráfico de acesso ao sistema</h3>

<p>
O programa <code>webalizer</code> poderá ser instalado para gerar um relatório
gráfico com a estatísticas de visitas por ano/mes/dia/hora usando os dados do
<code>access.log</code>.  Outra interessante característica são as estatísticas
de códigos http (veja <a href="#s-s-apache-httpcodes">Códigos HTTP, Seção
12.15</a>), onde é possível saber a quantidade de links quebrados existentes em
nosso servidor (estes poderão ser detectados usando o pacote de análise de
sites <code>linbot</code>).  O <code>webalizer</code> também é compatível com
os formatos de log do <code>squid</code> e <code>proftpd</code>.  Na
distribuição <code>Debian</code> ele pode ser instalado a partir do pacote
<code>webalizer</code> e gera um relatório geral quando é executado sem opções.

<hr>

<a name="s-s-apache-proxy"></a>
<h2>12.11 Configurando o Apache como servidor proxy</h2>

<p>
O <code>Apache</code> pode ser configurado para funcionar como servidor proxy
transparente para sua rede interna, possibilitando inclusive o uso de cache de
disco.  É possível se fazer conexões HTTP (incluindo SSL) e FTP.  Através desta
característica também é possível usar uma das características mais interessante
desse servidor web: o redirecionamento de conexões para uma determinada URL
para uma outra máquina, que pode ser um outro host remoto ou uma máquina da
rede interna (não acessível diretamente via Internet).

<p>
O primeiro passo é ativar o módulo de proxy no arquivo <code>httpd.conf</code>,
basta descomentar a linha:

<pre>
     # LoadModule proxy_module /usr/lib/apache/1.3/libproxy.so
</pre>

<p>
O seguinte bloco pode ser colocado no final do arquivo <code>httpd.conf</code>
para configurar um servidor proxy para realizar conexões diretas (sem o uso de
cache) e permitir o uso de servidores proxy em sua rede:

<pre>
     # Suporte a Proxy
     #
     &lt;IfModule mod_proxy.c&gt;
       ProxyRequests off
       ProxyRemote * http://debian:3128
       ProxyBlock microsoft.com microsoft.com.br
       NoProxy 192.168.1.0/24
       ProxyDomain .gms.com.br
     
     # Ativa/Desativa a manipulação de cabeçalhos HTTP/1.1 &quot;Via:&quot;.
     # 
     # (&quot;Full&quot; adiciona a versão do servidor Apache; &quot;Block&quot; remove todos os cabeçalhos 
     # de saída &quot;Via:&quot;)
     # Escolha uma das opções: Off | On | Full | Block
     #
     #ProxyVia On
     #&lt;/IfModule&gt;
</pre>

<p>
Segue a explicação de cada uma das diretivas acima:
<dl>
<dt>ProxyRequests [<em>on/off</em>]</dt>
<dd>
Ativa (on) ou Desativa (off) o serviço de proxy do servidor Apache.  Note que o
módulo <code>libproxy.so</code> deve estar carregado para que o bloco
&lt;IfModule libproxy.c&gt; seja processado.  A desativação desta diretiva não
afeta a diretiva <em>ProxyPass</em>.
</dd>
<dt>ProxyRemote [<em>origem</em>] [<em>URL</em>]</dt>
<dd>
Esta opção é útil para fazer o Apache redirecionar suas requisições para outro
servidor proxy (como o <code>squid</code> ou o gateway da rede, caso o Apache
estiver sendo executado em uma máquina interna).  A <em>origem</em> pode ser
uma URL completa (como http://www.debian.org), uma URL parcial (como ftp, http)
ou &quot;*&quot; para que o redirecionamento seja sempre usado.
</dd>
<dt>ProxyBlock [<em>padrão</em>]</dt>
<dd>
Permite bloquear o acesso a endereços que contenham o <em>padrão</em>
especificado.  Podem ser especificadas palavras, máquinas, domínios, URLs
separados por espaços.  O <code>Apache</code> fará a resolução DNS no caso de
endereços IP e fará o cache para requisições futuras.
</dd>
<dt>NoProxy [<em>endereços</em>]</dt>
<dd>
Permite especificar endereços Internos que não serão redirecionados para o
servidor proxy especificado por <em>ProxyRemote</em>.  Podem ser usados nomes
de máquinas, endereços IP, subredes ou domínios separados por espaços.
</dd>
<dt>ProxyDomain [<em>endereço</em>]</dt>
<dd>
Especifica o endereço que será adicionado a URL caso seja recebida uma
requisição que contenha somente um nome de máquina.  É útil em redes Internas.
</dd>
</dl>

<p>
Note que quando o suporte a proxy não está ativado no <code>Apache</code>,
qualquer endereço de URL externa levará a página definida pela diretiva
<em>DocumentRoot</em>.  Isto deixará de funcionar após configurar o serviço de
proxy.

<p>
O uso do cache é interessante para acelerar as requisições http da rede interna
para a rede externa, desta forma, se uma requisição foi feita anteriormente,
será descarregado o arquivo do disco rígido e assim evitar uma nova conexão
externa (isto libera a rede para outras coisas).  Para configurar um cache no
serviço proxy, adicione as seguintes linhas no final do bloco anterior de
proxy:

<pre>
       # As linhas abaixo ativam o cache do apache, o cache não funcionará ao menos que
       # CacheRoot seja especificado
       CacheRoot /var/spool/apache
       CacheForceCompletion 70
       CacheSize 5
       CacheGcInterval 3
       CacheDefaultExpire 5
       CacheMaxExpire 300
       NoCache 192.168.1.0/24 a_domain.com outrodomínio.com.br outro.dominio.net
</pre>

<p>
Cada diretiva acima possui o seguinte significado:
<dl>
<dt>CacheRoot</dt>
<dd>
Diretório base onde serão criados os outros diretórios de cache.  O cache só
será ativado se esta diretiva for definida.
</dd>
<dt>CacheForceCompletion [<em>num</em>]</dt>
<dd>
Se uma transferência for cancelada e passar de <em>num</em>%, o
<code>Apache</code> continuará a transferência e armazenará o arquivo no cache.
O valor padrão é 90.
</dd>
<dt>CacheSize [<em>num</em>]</dt>
<dd>
Define o tamanho máximo do diretório de cache do <code>Apache</code>, em KB.
Não especifique um valor que tome mais de 70% do espaço em disco.  O valor
padrão é 5.
</dd>
<dt>CacheGcInterval [<em>num</em>]</dt>
<dd>
Define o tempo que o cache será checado em busca de arquivos maiores que o
total do cache.  Arquivos que ultrapassem o tamanho do cache são
automaticamente eliminados.
</dd>
<dt>CacheDefaultExpire [<em>num</em>]</dt>
<dd>
Define o tempo que os documentos ficarão no cache, se foram transferidos
através de protocolos que não suportam horas de expiração.  O valor padrão é 1
hora.
</dd>
<dt>CacheMaxExpire [<em>num</em>]</dt>
<dd>
Define o tempo que os documentos permanecerão armazenados no cache (em horas).
Esta opção ignora a hora de expiração do documento (caso fornecida).  O valor
padrão é 24 horas.
</dd>
<dt>NoCache [<em>endereços</em>]</dt>
<dd>
Permite especificar lista de palavras, máquinas, domínios, IP's que não serão
armazenados no cache do <code>Apache</code>.  Caso seja usado <samp>NoCache
*</samp> o cache será desativado completamente.  Note que o cache também pode
ser desativado comentando a diretiva <em>CacheRoot</em>.
</dd>
</dl>

<p>
Se você desejar um servidor cache mais flexível, rápido, dinâmico, configurável
(com possibilidade de uso de restrições baseadas em URL, tempo de acesso,
autenticação), instale o <code>squid</code> e configure o <code>apache</code>
para fazer forward de conexões para ele (<a
href="#s-s-apache-proxy-redir">Redirecionamento de conexões no Apache, Seção
12.11.2</a>).

<hr>

<a name="s-s-apache-proxy-access"></a>
<h3>12.11.1 Controlando o acesso ao servidor proxy</h3>

<p>
Incluir o bloco abaixo no arquivo <code>access.conf</code> para definir o
acesso dos serviços de proxy nas redes desejadas (se a sua configuração for
aberta como padrão isto pode ser opcional):

<pre>
     # Acesso aos serviços proxy do apache
     &lt;Directory proxy:*&gt;
         Order deny,allow
         Deny from all
         Allow from .seudominio.com.br
     &lt;/Directory&gt;
</pre>

<p>
Para explicações sobre o processo de bloqueio acima, veja <a
href="#s-s-apache-acesso-restr-autor">Autorização, Seção 12.7.1</a>.

<hr>

<a name="s-s-apache-proxy-redir"></a>
<h3>12.11.2 Redirecionamento de conexões no Apache</h3>

<p>
Este recurso do <code>Apache</code> é interessante para criar clusters de
servidores em sua rede interna.  O que ele faz é pegar uma requisição a um
determinado endereço e redireciona-lo a outra máquina e as respostas são
repassadas ao servidor web (para o cliente a mesma máquina esta atendendo a
requisição, para você o processamento das requisições esta sendo distribuído
internamente na rede).

<p>
As seguintes diretivas são usadas para realizar o redirecionamento de conexões:
<em>ProxyPass</em> e <em>ProxyPassReverse</em>
<dl>
<dt>ProxyPass [<em>diretório_da_url</em> [<em>outro_servidor:/diretório</em>]</dt>
<dd>
A <em>ProxyPass</em> permite que a URL seja redirecionada para o servidor local
e diretório especificado.  Por exemplo, assumindo que o endereço principal de
nosso servidor é <code>http://www.guiafoca.org</code> e desejamos que a URL
<code>http://www.guiafoca.org/download</code> seja atendida por uma máquina
localizada na nossa rede privada com o endereço
<code>http://192.168.1.54</code>.  Basta incluir a linha:
<pre>
     ProxyPass /download http://192.168.1.54
</pre>
<p>
Qualquer requisição externa a
<code>http://www.guiafoca.org/download/iniciante</code> será atendida por
<code>http://192.168.1.54/iniciante</code>.
</dd>
<dt>ProxyPassRemote [<em>diretório_da_url</em> [<em>outro_servidor:/diretório</em>]</dt>
<dd>
Esta diretiva permite modificar o cabeçalho <samp>Location</samp> nas mensagens
de respostas de redirecionamento enviadas pelo <code>Apache</code>.  Isto
permite que o endereço retornado seja o do servidor (que faz a interface
externa com o cliente) e não da máquina do redirecionamento.
<pre>
     ProxyPass        /download http://192.168.1.54
     ProxyPassReverse /download http://192.168.1.54
</pre>
<p>
Se a máquina <code>192.168.1.54</code> redirecionar a URL para
<code>http://192.168.1.54/download/iniciante</code>, a resposta será modificada
para <code>http://www.guiafoca.org/download/iniciante</code> antes de ser
retornada ao cliente.
</dd>
</dl>

<p>
\

<hr>

<a name="s-s-apache-vhosts"></a>
<h2>12.12 Virtual Hosts</h2>

<p>
Virtual Hosts (sites virtuais) é um recurso que permite servir mais de um site
no mesmo servidor.  Podem ser usadas diretivas específicas para o controle do
site virtual, como nome do administrador, erros de acesso a página, controle de
acesso e outros dados úteis para personalizar e gerenciar o site.  Existem 2
métodos de virtual hosts:
<ul>
<li>
<samp>Virtual Hosts baseados em IP</samp> - Requer um endereço IP diferente
para cada site.  Este poderá ser um IP real (da interface de rede) ou um
apelido (veja <a href="ch-cfgrede.html#s-cfgrede-ipalias">IP Alias, Seção
5.1</a>), o que interessa é que deve haver um endereço IP diferente para cada
site.  O número de sites servidos estará limitado a quantidade de endereços IP
disponíveis em sua classe de rede.  Veja <a
href="#s-s-apache-vhosts-ip">Virtual hosts baseados em IP, Seção 12.12.1</a>
para detalhes de como construir um virtual host deste tipo.
<p>
O <code>apache</code> foi um dos primeiros servidores web a incluir suporte a
virtual hosts baseados em IP.
</li>
<li>
<samp>Virtual Hosts baseados em nome</samp> - Este utiliza nomes para
identificar os sites servidos e requerem somente um endereço IP.  Desta maneira
é possível servir um número ilimitado de sites virtuais.  O navegador do
cliente deve suportar os cabeçalhos necessários para garantir o funcionamento
deste recurso (praticamente todos os navegadores atuais possuem este suporte).
Veja <a href="#s-s-apache-vhosts-nome">Virtual hosts baseados em nome, Seção
12.12.2</a> para detalhes de como construir um virtual host deste tipo.
</li>
</ul>

<p>
As explicações desta seção são baseadas na documentação do <code>Apache</code>.

<hr>

<a name="s-s-apache-vhosts-ip"></a>
<h3>12.12.1 Virtual hosts baseados em IP</h3>

<p>
Existem duas maneiras de rodar este tipo de host virtual: Através de daemons
<code>httpd</code> separados ou em um único daemon <code>httpd</code> usando a
diretiva &lt;VirtualHost&gt;.

<p>
As vantagens do uso de <em>daemons separados</em> para servir requisições é a
proteção sob <em>UID</em> e <em>GID</em> diferente dos outros servidores, assim
o administrador do <em>site1</em> não terá acesso ao <code>httpd.conf</code>,
página do <code>site2</code> (porque ele estará rodando sob uma <em>UID</em> e
<em>GID</em> diferentes e o acesso é restrito).  Para usar este método,
especifique a opção <em>-f [arquivo_cfg]</em> para utilizar um arquivo de
configuração personalizado e a diretiva <em>Listen endereço:porta</em> para
dizer onde o servidor aguardará as requisições.

<p>
As vantagens do uso de um <em>mesmo daemon</em> para servir as requisições são:
quando não há problema se os administradores de outros sites tenham acesso ao
mesmo arquivo de configuração ou quando há a necessidade de servir muitas
requisições de uma só vez (quanto menos servidores web estiverem em execução,
melhor o desempenho do sistema).  Abaixo um exemplo de configuração de virtual
hosts servindo os sites <samp>www.site1.com.br</samp> e
<samp>www.site2.com.br</samp>:

<pre>
     ServerAdmin webmaster@site.com.br
     
     &lt;VirtualHost www.site1.com.br&gt;
      ServerName www.site1.com.br
      ServerAdmin site1@site1.com.br
      DocumentRoot /var/www/www_site1_com_br
      TransferLog /var/log/apache/site1/access.log
      ErrorLog /var/log/apache/site1/error.log
      User www-data
      Group www-data
     &lt;/VirtualHost&gt;
     
     &lt;VirtualHost www.site2.com.br&gt;
      ServerName www.site2.com.br
      DocumentRoot /var/www/www_site2_com_br
      CustomLog /var/log/apache/site2/access.log combined
      ErrorLog /var/log/apache/site2/error.log
     &lt;/VirtualHost&gt;
</pre>

<p>
Qualquer diretiva dentro de &lt;VirtualHost&gt; controlarão terão efeito no
site virtual especificado.  Quando uma diretiva não for especificada dentro de
&lt;VirtualHost&gt;, serão usados os valores padrões especificados no arquivo
de configuração do <code>Apache</code> (como a diretiva <em>ServerAdmin
webmaster@site.com.br</em> que será usado como padrão na configuração de
<em>www.site2.com.br</em>).

<p>
Digite <samp>apache -S</samp> para ver suas configurações de virtual hosts
atual.

<p>
<strong>OBS1:</strong> Desative a diretiva <samp>UseCanonicalName off</samp>
quando utilizar o recurso de máquinas virtuais, esta diretiva faz que o nome do
servidor retornado usando o valor em <samp>ServerName</samp> quando o cliente
digita um endereço qualquer.

<p>
<strong>OBS2:</strong> Utilize sempre que possível endereços IP em
configurações críticas, assim os serviços não serão tão vulneráveis a possíveis
falsificações ou erros.  Veja <a
href="ch-rede.html#s-rede-dns-a-hostconf">/etc/host.conf, Seção 4.6.2.2</a> e
<a href="ch-fw-iptables.html#s-fw-iptables-outras-ipspoof">Proteção contra IP
spoofing, Seção 10.6.5</a>.  Leia também a seção <a
href="#s-s-apache-vhosts-dnssec">Segurança no uso de IP's em Virtual Hosts,
Seção 12.12.3</a>.

<p>
<strong>OBS3:</strong> Não permita que outros usuários a não ser o root e o
dono do processo <code>Apache</code> (especificado pela diretiva <em>User</em>)
tenham acesso de gravação aos logs gerados pelo servidor, pois os dados podem
ser apagados ou criados links simbólicos para binários do sistema que serão
destruídos quando o <code>Apache</code> gravar dados.  Alguns binários e
bibliotecas são essenciais para o funcionamento do sistema.

<hr>

<a name="s-s-apache-vhosts-nome"></a>
<h3>12.12.2 Virtual hosts baseados em nome</h3>

<p>
Este método é idêntico ao baseado em IP, em especial adicionamos a diretiva
<em>NameVirtualHost</em> para dizer qual é o endereço IP do servidor que está
servindo os virtual hosts baseados em nome.  Veja o exemplo de configuração:

<pre>
     NameVirtualHost 200.200.200.10:80
     
     &lt;VirtualHost _default_:80 200.200.200.10:80&gt;
      ServerName www.site.com.br
      ServerAdmin admin@site.com.br
      DocumentRoot /var/www
      TransferLog /var/log/apache/access.log
      ErrorLog /var/log/apache/error.log
     &lt;/VirtualHost&gt;
     
     &lt;VirtualHost 200.200.200.10&gt;
      ServerName www.site1.com.br
      ServerAdmin admin1@site1.com.br
      DocumentRoot /var/www/www_site1_com_br
      TransferLog /var/log/apache/site1/access.log
      ErrorLog /var/log/apache/site1/error.log
     &lt;/VirtualHost&gt;
     
     &lt;VirtualHost 200.200.200.10&gt;
      ServerName www.site2.com.br
      ServerAdmin admin2@site2.com.br
      DocumentRoot /var/www/www_site2_com_br
      TransferLog /var/log/apache/site2/access.log
      ErrorLog /var/log/apache/site2/error.log
     &lt;/VirtualHost&gt;
</pre>

<p>
A diretiva <em>NameVirtualHost</em> diz que será usado virtual hosts baseados
em nome servidos pela máquina com IP <samp>200.200.200.10</samp>.  Os
parâmetros dentro do bloco das diretivas &lt;VirtualHost &gt; são específicas
somente no site virtual especificado, caso contrário os valores padrões
definidos no arquivo de configuração serão usados.  Caso nenhum virtual host
confira com a configuração, o virtualhost <em>_default_</em> será usado.

<p>
Digite <samp>apache -S</samp> para ver suas configurações de virtual hosts
atual.  Se sua intenção é criar um grande número de virtual hosts que serão
servidos pela mesma máquina, o uso da expansão <samp>%0</samp> e diretivas
<samp>VirtualDocumentRoot</samp> e <samp>VirtualScriptAlias</samp> são
recomendados:

<pre>
     NameVirtualHost 200.200.200.10:80
     
     &lt;VirtualHost 200.200.200.10&gt;
      VirtualDocumentRoot /var/www/%0
      VirtualScriptAlias /var/www/%0/cgi-bin
      TransferLog log/apache/site1/access.log
      ErrorLog log/apache/site1/error.log
     &lt;/VirtualHost&gt;
</pre>

<p>
Agora crie os diretórios em <code>/var/www</code> correspondentes aos nomes de
domínios que serão servidos por sua máquina: <samp>mkdir
/var/www/www.site1.com.br</samp>, <samp>mkdir /var/www/www.site2.com.br</samp>.
Note que sua máquina deverá estar com o DNS configurado para responder por
estes domínios .

<p>
<strong>ATENÇÃO</strong> É importante que os endereços especificados nas
diretivas <em>ServerName</em> (<samp>www.site1.com.br</samp>) resolvam o
endereço IP da diretiva <em>VirtualHost</em> (<code>200.200.200.10</code>).
Isto deve ser feito via DNS ou nos arquivos <code>/etc/hosts</code>.

<p>
<strong>OBS1:</strong> Utilize sempre que possível endereços IP em
configurações críticas, assim os serviços não serão tão vulneráveis a possíveis
falsificações ou erros.  Veja <a
href="ch-rede.html#s-rede-dns-a-hostconf">/etc/host.conf, Seção 4.6.2.2</a> e
<a href="ch-fw-iptables.html#s-fw-iptables-outras-ipspoof">Proteção contra IP
spoofing, Seção 10.6.5</a>.  Leia também a seção <a
href="#s-s-apache-vhosts-dnssec">Segurança no uso de IP's em Virtual Hosts,
Seção 12.12.3</a>.

<p>
<strong>OBS2:</strong> Não permita que outros usuários a não ser o root e o
dono do processo <code>Apache</code> (especificado pela diretiva <em>User</em>)
tenha acesso de gravação aos logs gerados pelo servidor.  Pois os dados podem
ser apagados ou criados links para binários do sistema que serão destruídos
quando o apache gravar dados para os logs.  Alguns binários e bibliotecas são
essenciais para o funcionamento do sistema.

<hr>

<a name="s-s-apache-vhosts-dnssec"></a>
<h3>12.12.3 Segurança no uso de IP's em Virtual Hosts</h3>

<p>
Quando você está colocando um nome na diretiva de configuração do seu virtual
hosts, está assumindo que ele resolverá o endereço IP corretamente (como
<samp>www.site1.com.br</samp> =&gt; <samp>200.200.200.10</samp>).  Se por algum
motivo o servidor DNS for modificado (por outra pessoa que tem acesso a isto),
o endereço IP resolvido para o site <samp>www.site1.com.br</samp> poderá ser
modificado para <samp>200.200.200.20</samp>, isto redirecionará as requisições
para outra máquina ao invés da máquina correta.  Este tipo de ataque é chamado
&quot;DNS Spoofing&quot; e o uso de endereço IP (ao invés de nomes)
praticamente evita que isto aconteça.  Esta situação pode acontecer com a
diretiva abaixo:

<pre>
     &lt;VirtualHost www.gms.com.br&gt;
      ServerName www.gms.com.br
      ServerAdmin gleydson@guiafoca.org
      DocumentRoot /var/www/www_gms_com_br
     &lt;/VirtualHost&gt;
</pre>

<p>
Outra situação, que impede o funcionamento do servidor Web, é quando o servidor
DNS está em manutenção ou por algum outro motivo não pode resolver o endereço
IP de um nome especificado (como <samp>www.site1.com.br</samp>).  O
<code>apache</code> precisa saber qual é o seu endereço IP para ser executado.
Veja a próxima modificação:

<pre>
     &lt;VirtualHost 192.168.1.1&gt;
      ServerName www.gms.com.br
      ServerAdmin gleydson@guiafoca.org
      DocumentRoot /var/www/www_gms_com_br
     &lt;/VirtualHost&gt;
</pre>

<p>
Na configuração acima usamos o IP do servidor para especificar o virtual host.
O <code>apache</code> tentará fazer o DNS reverso para determinar qual nome é
servido por aquele endereço IP (<samp>www.site1.com.br</samp>).  Se ele falhar,
somente a seção &lt;VirtualHost&gt; correspondente será desativada.  Isto já é
uma melhoria sobre a primeira configuração.  O nome do servidor na diretiva
<em>ServerName</em> garante que o servidor responda com o nome correto.

<p>
Para evitar ataques baseados em DNS siga os seguintes procedimentos de
segurança:
<ol type="1" start="1" >
<li>
Preferencialmente utilize o arquivo <code>/etc/hosts</code> para a resolução de
nomes em máquinas locais (principalmente quando existe somente um
administrador).  É um método que evita diversas consultas ao servidor DNS (que
pode deixar o acesso lento) e este arquivo é gerenciado pelo usuário
<samp>root</samp>, isto evita o acesso de qualquer usuário para a falsificação
de endereços.
<p>
Este arquivo também é útil caso a pesquisa DNS falhe (quando a ordem de
pesquisa for do servidor DNS para o arquivo <code>hosts</code> no arquivo
<code>/etc/host.conf</code>), pois de qualquer forma o nome será resolvido e o
servidor <code>Apache</code> será executado.
</li>
<li>
Evite dar poderes a outros administradores manipularem seu próprio domínio DNS,
não há nada que possa impedi-lo de modificar o endereço &quot;X&quot; para ser
servido pelo IP &quot;Y&quot; desviando o tráfego para seu próprio servidor
web.  Se isto não for possível, siga as dicas abaixo para diminuir possíveis
problemas.
</li>
<li>
Utilize endereços IP na diretiva &lt;VirtualHost&gt;.
</li>
<li>
Use endereços IP na diretiva <em>Listen</em>.
</li>
<li>
Use um endereço IP na diretiva <em>BindAddress</em>.
</li>
<li>
Sempre utilize o parâmetro <em>ServerName</em> em todas as diretivas
&lt;VirtualHost&gt;, isto evita o retorno incorreto de nomes (que pode
evitar/revelar fraudes).
</li>
<li>
Quando utilizar virtual hosts, crie uma diretiva &lt;VirtualHost
_default_L:*&gt; usando uma diretiva <em>DocumentRoot</em> que não aponte para
lugar algum.  Esta diretiva será acessada quando nenhuma diretiva
<em>VirtualHost</em> servir a requisição, conferindo com o endereço/ip.
</li>
</ol>

<hr>

<a name="s-s-apache-ssl"></a>
<h2>12.13 Uso de criptografia SSL</h2>

<p>
Esta seção é uma referência rápida para configuração e uso do módulo
<code>apache-ssl</code> com o servidor <code>Apache</code>.  Este módulo
realiza a comunicação segura de dados (criptografada) via porta 443 (que é
usada como padrão quando especificamos uma url iniciando com
<em>https://</em>).  A transmissão criptografada de dados é importante quanto
temos dados confidenciais que precisamos transmitir como movimentação bancária,
senhas, número de cartões de crédito, fazer a administração remota do servidor,
etc.  SSL significa <em>Secure Sockets Layer</em> (camada segura de
transferência) e TLS <em>Transport Layer Security</em> (camada segura de
Transporte).

<p>
A intenção aqui é fornecer explicações práticas para colocar um servidor
<code>Apache</code> com suporte a SSL funcionando no menor tempo possível.
Detalhes sobre funcionamento de certificados, métodos de criptografia,
assinatura, etc.  deverão ser buscados na documentação deste módulo ou em sites
especializados (é um assunto muito longo).

<hr>

<a name="s-s-apache-ssl-s"></a>
<h3>12.13.1 Servidor apache com suporte a ssl</h3>

<p>
Ao invés de utilizar o módulo <code>mod_ssl</code>, você poderá usar o pacote
<code>apache-ssl</code>, ele nada mais é que um servidor <code>Apache</code>
com o suporte SSL já incluso e não interfere no servidor <code>Apache</code>
padrão, porque é executado somente na porta 443.

<p>
Se você tem um grande site com configurações de acesso personalizadas, ele
trará mais trabalho de administração, pois as configurações e diretivas de
restrições de acesso deverão ser copiadas para este servidor web.  No entanto,
ele é indicado para máquinas que serão servidores SSL dedicados ou quando não
possui configurações especiais em seu servidor web principal.

<p>
Esta seção tem por objetivo a instalação do suporte ao módulo SSL
(<code>mod_ssl</code>) no servidor <code>Apache</code> padrão.

<hr>

<a name="s-s-apache-ssl-instal"></a>
<h3>12.13.2 Instalando o suporte a módulo SSL no Apache</h3>

<p>
Instale o pacote <code>libapache-mod-ssl</code>.  Após instala-lo, edite o
arquivo <code>/etc/apache/httpd.conf</code> adicionando a linha:

<pre>
     LoadModule ssl_module /usr/lib/apache/1.3/mod_ssl.so
</pre>

<p>
Depois, gere um certificado digital ssl com o programa
<code>mod-ssl-makecert</code>.  Ele será armazenado por padrão nos diretórios
em <code>/etc/apache/ssl.???</code> e seu uso explicado no resto desta seção.

<hr>

<a name="s-s-apache-ssl-mkcert"></a>
<h3>12.13.3 Gerando um certificado digital</h3>

<p>
O certificado digital é a peça que garante a transferência segura de dados.
Ele contém detalhes sobre a empresa que fará seu uso e quem o emitiu.  Para
gerar ou modificar um certificado digital, execute o comando
<samp>mod-ssl-makecert</samp> e siga as instruções.  O método de criptografia
usado pelo certificado digital é baseado no conceito de chave pública/privada,
a descrição sobre o funcionamento deste sistema de criptografia é feito em <a
href="ch-d-cripto.html#s-d-cripto-gpg">Usando pgp (<code>gpg</code>)para
criptografia de arquivos, Seção 20.5</a>.

<p>
<strong>OBS</strong> Não utilize acentos nos dados de seu certificado.

<hr>

<a name="s-s-apache-ssl-exemplo"></a>
<h3>12.13.4 Exemplo de configuração do módulo mod-ssl</h3>

<p>
Abaixo uma configuração rápida para quem deseja ter um servidor com suporte a
SSL funcionando em menor tempo possível (ela é feita para operar em todas as
instalações e não leva em consideração o projeto de segurança de sua
configuração atual do <code>Apache</code>).  Note que todas as diretivas
relacionadas com o módulo <code>mod_ssl</code> começam com o nome
&quot;SSL&quot;:

<pre>
     # Somente processa as diretivas relacionadas a SSL caso o módulo mod_ssl estiver
     # carregado pela diretiva LoadModule
     &lt;IfModule mod_ssl.c&gt;
     # É necessário especificar as portas que o servidor Web aguardará conexões (normais e 
     # ssl). 
     Listen 80
     Listen 443
     
     # Ativa o tratamento de conexões com o destino na porta 443 pela diretiva
     # VirtualHost abaixo
     &lt;VirtualHost _default_:443&gt;
     
     # Ativa ou desativa o módulo SSL para este host virtual
     SSLEngine on
     
     # Certificado do servidor
     SSLCertificateFile    /etc/apache/ssl.crt/server.crt
     
     # Chave privada de certificado do servidor. 
     SSLCertificateKeyFile /etc/apache/ssl.key/server.key
     
     # A linha abaixo força o fechamento de conexões quando a 
     # conexão com o navegador Internet Explorer é interrompida. Isto
     # viola o padrão SSL/TLS mas é necessário para este tipo de 
     # navegador. Alguns problemas de conexões de navegadores também
     # são causados por não saberem lidar com pacotes keepalive.
     SetEnvIf User-Agent &quot;.*MSIE.*&quot; nokeepalive ssl-unclean-shutdown
     
     &lt;/VirtualHost&gt;
     
     &lt;/IfModule&gt;
     
     #################################################################################
     # Adicionalmente poderão ser especificadas as seguintes opções para modificar   #
     # o comportamento da seção SSL (veja mais detalhes na documentação do mod-ssl)  #
     #################################################################################
     
     # Formato e localização do cache paralelo de processos da seção. O cache de seção é 
     # feito internamente pelo módulo mas esta diretiva acelera o processamento 
     # de requisições paralelas feitas por modernos clientes navegadores. Por padrão 
     # nenhum cache é usado (&quot;none&quot;). 
     SSLSessionCache         dbm:/var/run/ssl-cache
     
     # Localização do arquivo de lock que o módulo SSL utiliza para 
     # sincronização entre processos. O padrão é nenhum. 
     SSLMutex  file:/var/run/ssl-mutex
     
     # Especifica o método de embaralhamento de dados que será utilizado
     # durante o inicio de uma seção SSL (startup) ou durante o processo 
     # de conexão (connect). Podem ser especificados &quot;builtin&quot; (é muito rápido 
     # pois consome poucos ciclos da CPU mas não gera tanta combinação aleatória), um 
     # programa que gera números aleatórios (com &quot;exec&quot;) ou os dispositivos aleatórios 
     # /dev/random e /dev/urandom (com &quot;file&quot;). Por padrão nenhuma fonte 
     # adicional de números aleatórios é usada. 
     SSLRandomSeed startup builtin
     SSLRandomSeed connect builtin
     #SSLRandomSeed startup file:/dev/urandom 512
     #SSLRandomSeed connect file:/dev/urandom 512
     #SSLRandomSeed connect exec:/pub/bin/NumAleat
     
     # Tipos MIME para download de certificados
     AddType application/x-x509-ca-cert .crt
     AddType application/x-pkcs7-crl    .crl
     
     # Tempo máximo de permanência dos objetos do cache acima. O valor padrão é 
     # 300 segundos (5 minutos).
     SSLSessionCacheTimeout  300
     
     # Versão do protocolo SSL que será usada. Podem ser especificadas 
     # SSLv2, SSLv3 TLSv1 ou all. O mais compatível com os navegadores atuais 
     # é o &quot;SSLv2&quot;. Por padrão &quot;all&quot; é usado.
     #SSLProtocol all
     #SSLProtocol -all +SSLv3
     
     # Registra detalhes sobre o tráfego neste arquivo. Mensagens de erro 
     # também são armazenadas no arquivo de registro padrão do Apache
     SSLLog      /var/log/apache/ssl-mod.log
     
     # Nível das mensagens de log registradas por SSLLog
     SSLLogLevel info
</pre>

<p>
Algumas diretivas deste módulo podem fazer parte tanto da configuração global
do servidor como diretivas de acesso (<samp>Directory</samp>,
<samp>Location</samp>, <samp>.htaccess</samp>, veja a opção &quot;Context&quot;
na documentação do <code>mod_ssl</code>).

<hr>

<a name="s-s-apache-ssl-sslreq"></a>
<h3>12.13.5 Autorizando acesso somente a conexões SSL</h3>

<p>
Existem casos que precisa restringir o uso de conexões normais e permitir
somente conexões via SSL (como por exemplo, dentro da diretiva de acesso que
controla seu acesso a uma página com listagem de clientes).  A opção
<em>SSLRequereSSL</em> é usada para tal e deve ser usada dentro das diretivas
de controle acesso:

<pre>
     &lt;Directory /var/www/secure/clientes&gt;
      Options Indexes 
      Order deny,allow
      Deny from evil.cracker.com
      SSLRequireSSL
     &lt;/Directory&gt;
</pre>

<p>
A diretiva acima <em>requer</em> que sejam feitas conexões SSL (porta 443 -
https://) para acesso ao diretório <code>/var/www/secure/clientes</code>,
qualquer conexão padrão não criptografada (feita na porta 80) será rejeitada
com o erro 403.

<p>
<strong>OBS:</strong> A diretiva <em>SSLRequireSSL</em> podia ser colocada
entre as condicionais &quot;IfModule mod_ssl.c&quot; mas o servidor web
permitiria conexões não criptografadas se por algum motivo esse módulo não
estivesse carregado.  Na configuração acima, ocorrerá um erro e impedirá o
funcionamento do servidor web caso ocorra algum problema com o
<code>mod_ssl</code>.

<hr>

<a name="s-s-apache-ssl-inic"></a>
<h3>12.13.6 Iniciando o servidor Web com suporte a SSL</h3>

<p>
Verifique se a configuração do <code>Apache</code> está ok com <samp>apache
-t</samp>.  Caso positivo, reinicie o servidor usando um dos métodos descritos
em <a href="#s-s-apache-rodando">Iniciando o servidor/reiniciando/recarregando
a configuração, Seção 12.1.9</a>.  O servidor web lhe pedirá a FraseSenha para
descriptografar a chave privada SSL (esta senha foi escolhida durante o
processo de criação do certificado).

<p>
Esta senha garante uma segurança adicional caso a chave privada do servidor
seja copiada de alguma forma.  Somente quem tem conhecimento da FraseSenha
poderá iniciar o servidor com suporte a transferência segura de dados.
Verifique se o virtual host está servindo as requisições na porta 443 com
<samp>apache -S</samp>.

<p>
O único método para fazer o servidor web evitar de pedir a senha para
descriptografar a chave privada é colocando uma senha em branco.  Isto só é
recomendado em ambientes seguros e o diretório que contém a chave privada
deverá ter somente permissões para o dono/grupo que executa o servidor Web.
Qualquer outra permissão poderá por em risco a segurança da instalação caso a
chave privada seja roubada.  Depois disso, execute o comando:

<pre>
     # entre no diretório que contém a chave privada
     cd /etc/apache/ssl.key
     # renomeie a chave privada para outro nome
     ren server.key server.key-Csenha
     openssl rsa -in server.key-Csenha -out server.key
</pre>

<p>
Digite a senha quando pedido.  A chave original (com senha) estará gravada no
arquivo <code>server.key-Csenha</code> e poderá ser restaurada se necessário.
Reinicie o servidor <code>Apache</code>, desta vez ele não pedirá a senha.

<p>
<strong>OBS1:</strong> Tire uma cópia de segurança da chave privada original
antes de executar esta operação.

<p>
<strong>OBS2:</strong> Não se esqueça de ajustar as permissões de acesso no
diretório <code>/etc/apache/ssl.key</code> caso não utilize senha para proteger
seu certificado digital.

<hr>

<a name="s-s-apache-exemplo"></a>
<h2>12.14 Exemplo comentado de um arquivo de configuração do Apache</h2>

<p>
O exemplo abaixo foi retirado da distribuição <code>Debian GNU/Linux</code>,
fiz sua tradução, modificações e inclui alguns comentários sobre as diretivas
para deixa-lo mais de acordo com o conteúdo abordado pelo guia e mais
auto-explicativo.

<p>
A configuração do <code>Apache</code> está distribuída nos arquivos
<code>httpd.conf</code>, <code>srm.conf</code> e <code>access.conf</code> e
podem ser usados como modelo para a construção da configuração de seu servidor.

<hr>

<a name="s-s-apache-exemplo-httpd"></a>
<h3>12.14.1 httpd.conf</h3>

<pre>
     ##
     ## httpd.conf -- Arquivo de configuração do servidor httpd Apache
     ##
     
     #
     # Baseado nos arquivos de configuração originais do servidor NCSA por Rob McCool.
     # Modificado para distribuição junto ao guia Foca GNU/Linux Avançado
     # http://focalinux.cipsga.org.br/ &lt;gleydson@guiafoca.org&gt;
     #
     # Este é o arquivo de configuração principal do servidor Apache. Ele contém as
     # diretivas de configuração que dão ao servidor suas instruções.
     # Veja &lt;http://www.apache.org/docs/&gt; para informações detalhadas sobre as 
     # diretivas.
     #
     # NÃO leia simplesmente as instruções deste arquivo sem entender o que significam
     # e o que fazem, se não tiver certeza do que está fazendo consulte a documentação
     # on-line ou leia as seções apropriadas do guia. Você foi avisado.
     #
     # Após este arquivo ser processado, o servidor procurará e processará o arquivo
     # /etc/apache/srm.conf e então /etc/apache/access.conf
     # a não ser que você tenha modificado o nome dos arquivos acima através das 
     # diretivas ResourceConfig e/ou AccessConfig neste arquivo.
     #
     # Configuração e nomes de arquivos de log: Se os nomes de arquivos que 
     # especificar para os arquivos de controle do servidor iniciam com uma 
     # &quot;/&quot;, o servidor usará aquele caminho explicitamente. Se os nomes *não*
     # iniciarem com uma &quot;/&quot;, o valor de ServerRoot é adicionado -- assim 
     # &quot;logs/foo.log&quot; com ServerRoot ajustado para &quot;/usr/local/apache&quot; será 
     # interpretado pelo servidor como &quot;/usr/local/apache/logs/foo.log&quot;.
     #
     # Originalmente por Rob McCool
     # modificado por Gleydson Mazioli da Silva para o guia Foca GNU/Linux
     
     # Carga dos Módulos de Objetos Compartilhados:
     # Para você ser capaz de usa a funcionalidade de um módulo que foi construído como
     # um módulo compartilhado, será necessário adicionar as linhas 'LoadModule'
     # correspondente a sua localização, assim as diretivas que os módulos contém
     # estarão disponíveis _antes_ de serem usadas. 
     # Exemplo:
     
     #
     # ServerType pode ser inetd, ou standalone.  O modo Inetd somente é suportado nas 
     # plataformas Unix. O modo standalone inicia o servidor como um daemon.
     #
     
     ServerType standalone
     
     # Se estiver executando a partir do inetd, vá até a diretiva &quot;ServerAdmin&quot;.
     
     # Port: A porta que o servidor standalone escutará. Para portas &lt; 1023, será 
     # necessário o servidor funcionando como root inicialmente.
     
     Port 80
     
     #
     # HostnameLookups: Registra os nomes DNS dos clientes ou apenas seus endereços
     # IP's
     # ex., www.apache.org (on) ou 204.62.129.132 (off).
     # O valor padrão é off porque permitirá menos tráfego na rede. Ativando
     # esta opção significa que cada acesso de um cliente resultará em 
     # NO MÍNIMO uma requisição de procura ao servidor de nomes (DNS).
     #
     
     HostnameLookups off
     
     # Caso desejar que o servidor http seja executado como um usuário ou grupo diferente
     # você deve executar o httpd inicialmente como root e ele modificará sua ID para a 
     # especificada.  
     
     # User/Group: O nome (ou #número) do usuário/grupo que executará o servidor httpd.
     # No SCO (ODT 3) use &quot;User nouser&quot; e &quot;Group nogroup&quot;
     # No HPUX você pode não será capaz de usar memória compartilhada como nobody, e 
     # é sugerido que seja criado um usuário www e executar o servidor httpd como 
     # este usuário, adequando as permissões onde necessárias.
     
     User www-data
     Group www-data
     
     # ServerAdmin: Seu endereço de e-mail, onde os problemas com o servidor devem ser 
     # enviadas. Este endereço aparecerá nas mensagens de erro do servidor.
     ServerAdmin gleydson@guiafoca.org
     
     #
     # ServerRoot: O topo da árvore de diretórios onde os arquivos de configuração do 
     # servidor, erros, e log são mantidos.
     #
     # NOTA: Se tiver a intenção de colocar isto em um sistema de arquivos montado 
     # em um servidor NFS (ou outra rede) então por favor leia a documentação do 
     # LockFile 
     # (disponível em &lt;http://www.apache.org/docs/mod/core.html#lockfile&gt;);
     # e se salvará de vários problemas.
     #
     # Não adicione uma barra no fim do caminho do diretório.
     #
     
     ServerRoot /etc/apache
     
     # BindAddress: Você pode usar esta opção em virtual hosts. Esta
     # opção é usada para dizer ao servidor que endereço IP escutar. Ele pode 
     # conter ou &quot;*&quot;, um endereço IP, ou um nome de domínio completamente qualificado
     # (FQDN). Veja também a diretiva VirtualHost.
     
     BindAddress *
     
     #
     # Suporte a Objetos Compartilhados Dinamicamente (DSO - Dynamic Shared Object)
     #
     # Para ser capaz de usar a funcionalidade de um módulo que foi compilado como 
     # um módulo DSO, você terá que adicionar as linhas 'LoadModule' correspondentes
     # nesta localização, assim as diretivas contidas nela estarão disponíveis 
     # _antes_ de serem usadas. Por favor leia o arquivo README.DSO na distribuição
     # 1.3 do Apache para mais detalhes sobre o mecanismo DSO e execute o comando
     # &quot;apache -l&quot; para a lista de módulos já compilados (estaticamente linkados e 
     # assim sempre disponíveis) em seu binário do Apache.
     #
     # Please keep this LoadModule: line here, it is needed for installation.
     # LoadModule vhost_alias_module /usr/lib/apache/1.3/mod_vhost_alias.so
     # LoadModule env_module /usr/lib/apache/1.3/mod_env.so
     LoadModule config_log_module /usr/lib/apache/1.3/mod_log_config.so
     # LoadModule mime_magic_module /usr/lib/apache/1.3/mod_mime_magic.so
     LoadModule mime_module /usr/lib/apache/1.3/mod_mime.so
     LoadModule negotiation_module /usr/lib/apache/1.3/mod_negotiation.so
     LoadModule status_module /usr/lib/apache/1.3/mod_status.so
     # LoadModule info_module /usr/lib/apache/1.3/mod_info.so
     # LoadModule includes_module /usr/lib/apache/1.3/mod_include.so
     LoadModule autoindex_module /usr/lib/apache/1.3/mod_autoindex.so
     LoadModule dir_module /usr/lib/apache/1.3/mod_dir.so
     LoadModule php3_module /usr/lib/apache/1.3/libphp3.so
     LoadModule cgi_module /usr/lib/apache/1.3/mod_cgi.so
     # LoadModule asis_module /usr/lib/apache/1.3/mod_asis.so
     # LoadModule imap_module /usr/lib/apache/1.3/mod_imap.so
     # LoadModule action_module /usr/lib/apache/1.3/mod_actions.so
     # LoadModule speling_module /usr/lib/apache/1.3/mod_speling.so
     LoadModule userdir_module /usr/lib/apache/1.3/mod_userdir.so
     LoadModule alias_module /usr/lib/apache/1.3/mod_alias.so
     LoadModule rewrite_module /usr/lib/apache/1.3/mod_rewrite.so
     LoadModule access_module /usr/lib/apache/1.3/mod_access.so
     LoadModule auth_module /usr/lib/apache/1.3/mod_auth.so
     # LoadModule anon_auth_module /usr/lib/apache/1.3/mod_auth_anon.so
     # LoadModule dbm_auth_module /usr/lib/apache/1.3/mod_auth_dbm.so
     # LoadModule db_auth_module /usr/lib/apache/1.3/mod_auth_db.so
     # LoadModule proxy_module /usr/lib/apache/1.3/libproxy.so
     # LoadModule digest_module /usr/lib/apache/1.3/mod_digest.so
     # LoadModule cern_meta_module /usr/lib/apache/1.3/mod_cern_meta.so
     LoadModule expires_module /usr/lib/apache/1.3/mod_expires.so
     # LoadModule headers_module /usr/lib/apache/1.3/mod_headers.so
     # LoadModule usertrack_module /usr/lib/apache/1.3/mod_usertrack.so
     LoadModule unique_id_module /usr/lib/apache/1.3/mod_unique_id.so
     LoadModule setenvif_module /usr/lib/apache/1.3/mod_setenvif.so
     # LoadModule sys_auth_module /usr/lib/apache/1.3/mod_auth_sys.so
     # LoadModule put_module /usr/lib/apache/1.3/mod_put.so
     # LoadModule throttle_module /usr/lib/apache/1.3/mod_throttle.so
     # LoadModule allowdev_module /usr/lib/apache/1.3/mod_allowdev.so
     # LoadModule auth_mysql_module /usr/lib/apache/1.3/mod_auth_mysql.so
     # LoadModule pgsql_auth_module /usr/lib/apache/1.3/mod_auth_pgsql.so
     # LoadModule eaccess_module /usr/lib/apache/1.3/mod_eaccess.so
     # LoadModule roaming_module /usr/lib/apache/1.3/mod_roaming.so
     
     #
     # ExtendedStatus: Controla de o Apache gerará detalhes completos de status
     # (ExtendedStatus On) ou apenas detalhes básicos (ExtendedStatus Off) quando o 
     # manipulador (handler) &quot;server-status&quot; for usado. O padrão é Off.
     #
     ExtendedStatus on
     
     #
     # ErrorLog: A localização do arquivo de log de erros.
     # Se não estiver especificando a diretiva ErrorLog dentro de &lt;VirtualHost&gt;, 
     # as mensagens de erros relativas aos hosts virtuais serão registradas neste 
     # arquivo. Se definir um arquivo de log de erros para &lt;VirtualHost&gt;, as 
     # mensagens relativas ao servidor controlados por ela serão registradas lá e 
     # não neste arquivo.
     #
     ErrorLog /var/log/apache/error.log
     
     #
     # LogLevel: Controla o número de mensagens registradas no ErrorLog.
     # Facilidades possíveis incluem: debug, info, notice, warn, error, crit,
     # alert, emerg.
     # Veja as facilidades na seção do guia sobre o syslog para detalhes
     #
     LogLevel warn
     
     # As seguintes diretivas definem alguns formatos de nomes que serão usadas com a 
     # diretiva CustomLog (veja abaixo).
     
     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %T %v&quot; full
     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %P %T&quot; debug
     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
     LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common
     LogFormat &quot;%{Referer}i -&gt; %U&quot; referer
     LogFormat &quot;%{User-agent}i&quot; agent
     
     #
     # A localização e formato do arquivo de log de acesso (definida pela diretiva 
     # LogFormat acima).
     # Se não definir quaisquer arquivos de log de acesso dentro de um 
     # &lt;VirtualHost&gt;, elas serão registradas aqui. Se for definida dentro
     # de &lt;VirtualHost&gt; o arquivo de log de acesso será registrado no 
     # arquivo especificado na diretiva e não aqui.
     #
     #CustomLog /var/log/apache/access.log common
     
     # Se você desejar ter um arquivo de log separado para o agent (navegador usado) 
     # e referer, descomente as seguintes diretivas.
     
     #CustomLog /var/log/apache/referer.log referer
     #CustomLog /var/log/apache/agent.log agent
     
     # Se preferir um arquivo de log simples, com os detalhes de acesso, agent, e 
     # referer (usando o formato combined da diretiva LogFile acima), use a seguinte
     # diretiva.
     
     CustomLog /var/log/apache/access.log combined
     
     #
     # Incluir uma linha contendo a versão do servidor e um nome de host virtual
     # para as páginas geradas pelo servidor (documentos de erro, listagens 
     # de diretórios FTP, saída dos módulos mod_status e mod_info, etc., exceto 
     # para documentos gerados via CGI). Use o valor &quot;EMail&quot; para também incluir 
     # um link mailto: para o ServerAdmin. Escolha entre &quot;On&quot;, &quot;Off&quot; ou &quot;EMail&quot;.
     #
     ServerSignature On
     
     #
     # PidFile: O arquivo que o servidor gravará os detalhes sobre seu PID quando 
     # iniciar.
     #
     PidFile /var/run/apache.pid
     
     #
     # ScoreBoardFile: Arquivo usado para armazenar detalhes do processo interno do 
     # servidor. Nem todas as arquiteturas requerem esta diretiva, mas se a sua 
     # requerer (você saberá porque este arquivo será criado quando executar o 
     # Apache) então você *deverá* ter certeza que dois processos do Apache não
     # utilizam o mesmo arquivo ScoreBoardFile.
     #
     ScoreBoardFile /var/run/apache.scoreboard
     
     #
     # Na configuração padrão, o servidor processará este arquivo, o 
     # srm.conf e o access.conf neste ordem. Você pode fazer o servidor
     # ignorar estes arquivos usando &quot;/dev/null&quot;.
     #
     ResourceConfig /etc/apache/srm.conf
     AccessConfig /etc/apache/access.conf
     
     #
     # A diretiva LockFile define o caminho do lockfile usado quando o servidor 
     # Apache for compilado com a opção USE_FCNTL_SERIALIZED_ACCEPT ou
     # USE_FLOCK_SERIALIZED_ACCEPT. Esta diretiva normalmente deve ser deixada em seu
     # valor padrão. A razão principal de modifica-la é no caso do diretório de logs
     # for montado via um servidor NFS&lt; pois o arquivo especificado em LockFile
     # DEVE SER ARMAZENADO EM UM DISCO LOCAL. O PID do processo do servidor principal
     # é automaticamente adicionado neste arquivo.
     #
     LockFile /var/run/apache.lock
     
     # ServerName permite ajustar o nome de host que será enviado 
     # aos clientes, caso for diferente do nome real (por exemplo, se desejar usar 
     # www ao invés do nome real de seu servidor).
     #
     # Nota: Você não pode simplesmente inventar nomes e esperar que funcionem. O nome
     # que definir deverá ser um nome DNS válido para sua máquina. 
     
     ServerName debian.meudominio.org
     
     # UseCanonicalName: Com esta opção ligada, se o Apache precisar construir uma 
     # URL de referência (uma url que é um retorno do servidor a uma requisição) ele 
     # usará ServerName e Port para fazer o &quot;nome canônico&quot;. Com esta opção desligada,
     # o Apache usará computador:porta que o cliente forneceu, quando possível. 
     # Isto também afeta SERVER_NAME e SERVER_PORT nos scripts CGIs.
     # 
     # Dependendo de sua configuração, principalmente em virtual hosts, é recomendável
     # deixa-la desativada ou com o valor DNS. O valor DNS obtém o nome do servidor
     # através de uma requisição DNS reversa do endereço IP (muito útil para virtual
     # hosts baseados em IP).
     UseCanonicalName off
     
     # CacheNegotiatedDocs: Por padrão, o Apache envia Pragma: no-cache com cada 
     # documento que foi negociado na base do conteúdo. Isto permite dizer a 
     # servidores proxy para não fazerem cache do documento. Descomentando a 
     # seguinte linha desativa esta característica, e os proxyes serão capazes
     # de fazer cache dos documentos.
     
     #CacheNegotiatedDocs
     
     # Timeout: O número de segundos antes de receber e enviar um time out
     
     Timeout 300
     
     # KeepAlive: Se vai permitir ou não conexões persistentes (mais que uma requisição
     # por conexão). Mude para &quot;Off&quot; para desativar.
     KeepAlive On
     
     # MaxKeepAliveRequests: O número máximo de requisições que serão permitidas 
     # durante uma conexão persistente. Mude para 0 para permitir uma quantidade 
     # ilimitada. Nós recomendamos deixar este número alto, para obter a máxima 
     # performance
     
     MaxKeepAliveRequests 100
     
     # KeepAliveTimeout: Número de segundos que aguardará a próxima requisição
     
     KeepAliveTimeout 15
     
     # Regulagem do tamanho de pool do servidor. Ao invés de fazer você adivinhar
     # quantos processos servidores precisará, o Apache adapta dinamicamente 
     # de acordo com a carga que ele vê --- isto é, ele tenta manter o número de 
     # processos o bastante para manipular a carga atual, mas alguns poucos 
     # servidores esparsos para manipular requisições transientes (ex. requisições
     # simultâneas múltiplas de um navegador Netscape simples).
     
     # Ele faz isto verificando periodicamente quantos servidores estão 
     # aguardando por uma requisição. Se lá existe menos que MinSpareServers, 
     # ele cria um novo processo. Se existe mais que MaxSpareServers, ele 
     # fecha alguns processos. Os valores abaixo estão adequados para muitos
     # sites
     
     MinSpareServers 5
     MaxSpareServers 10
     
     # Número de servidores que serão iniciados --- deve conter um valor razoável.
     
     StartServers 5
     
     # Limita o número total de servidores rodando, i.e., limita o número de clientes
     # que podem conectar simultaneamente --- se este limite é sempre atingido,
     # os clientes podem serão BARRADOS, assim este valor NÃO DEVE SER MUITO PEQUENO.
     # Ele tem a intenção principal de ser um freio para manter um em execução com 
     # uma performance aceitável de acordo com os requerimentos de construção e 
     # carga calculada no servidor.
     
     MaxClients 150
     
     #
     # MaxRequestsPerChild: O número de requisições que cada processo tem permissão
     # de processar antes do processo filho ser finalizado. O filho será finalizado 
     # para evitar problemas após uso prolongado quando o Apache (e talvez as 
     # bibliotecas que utiliza) tomar memória e outros recursos. Na maioria dos 
     # sistemas, isto realmente não é necessário, exceto para alguns (como o 
     # Solaris) que possuem ponteiros notáveis em suas bibliotecas. Para estas 
     # plataformas, ajuste para algo em torno de 10000 ou algo assim; uma
     # configuração de 0 significa ilimitado. 
     #
     # NOTA: Este valor não inclui requisições keepalive após a requisição
     #       inicial por conexão. Por exemplo, se um processo filho manipula
     #       uma requisição inicial e 10 requisições &quot;keptalive&quot; subseqüentes, 
     #       ele somente contará 1 requisição neste limite.
     #
     MaxRequestsPerChild 30
     
     
     # Listen: Permite fazer o Apache escutar um IP determinado e/ou porta, em 
     # adição a padrão. Veja também o comando VirtualHost
     
     #Listen 3000
     #Listen 12.34.56.78:80
     
     # VirtualHost: Permite o daemon responder a requisições para mais que um 
     # endereço IP do servidor, se sua máquina estiver configurada para aceitar pacotes
     # para múltiplos endereços de rede. Isto pode ser feito com a opção de aliasing
     # do ifconfig ou através de patches do kernel como o de VIF.
     
     # Qualquer diretiva httpd.conf ou srm.conf pode ir no comando VirtualHost.
     # Veja também a entrada BindAddress.
     
     #&lt;VirtualHost host.some_domain.com&gt;
     #ServerAdmin webmaster@host.some_domain.com
     #DocumentRoot /var/www/host.some_domain.com
     #ServerName host.some_domain.com
     #ErrorLog /var/log/apache/host.some_domain.com-error.log
     #TransferLog /var/log/apache/host.some_domain.com-access.log
     #&lt;/VirtualHost&gt;
     
     
     # VirtualHost: Se você quiser manter múltiplos domínios/nomes de máquinas em sua 
     # máquina você pode ajustar o conteúdo de VirtualHost para eles.
     # Por favor veja a documentação em &lt;http://www.apache.org/docs/vhosts/&gt;
     # para mais detalhes antes de tentar configurar seus hosts virtuais.
     # Você pode usar a opção de linha de comando '-S' para verificar sua configuração
     # de hosts virtuais.
     
     #
     # Se desejar usar hosts virtuais baseados em nome, será necessário definir no
     # mínimo um endereço IP (e número de porta) para eles.
     #
     #NameVirtualHost 12.34.56.78:80
     #NameVirtualHost 12.34.56.78
     
     #
     # Exemplo de um Host Virtual:
     # Praticamente qualquer diretiva do Apache pode entrar na condicional 
     # VirtualHost.
     #
     #&lt;VirtualHost ip.address.of.host.some_domain.com&gt;
     #    ServerAdmin webmaster@host.some_domain.com
     #    DocumentRoot /www/docs/host.some_domain.com
     #    ServerName host.some_domain.com
     #    ErrorLog logs/host.some_domain.com-error.log
     #    CustomLog logs/host.some_domain.com-access.log common
     #&lt;/VirtualHost&gt;
     
     #&lt;VirtualHost _default_:*&gt;
     #&lt;/VirtualHost&gt;
</pre>

<hr>

<a name="s-s-apache-exemplo-srm"></a>
<h3>12.14.2 srm.conf</h3>

<pre>
     # Neste arquivo são definidos o espaço de nomes que os usuários visualizarão no
     # seu servidor http. Este arquivo também define configurações do servidor que
     # afetam como as requisições são servidas e como os resultados deverão ser 
     # formatados. 
     
     # Veja os tutoriais em http://www.apache.org/ para mais detalhes
     
     # DocumentRoot: O diretório principal onde você servira seus documentos.
     # Por padrão, todas as requisições são tomadas através deste diretório, 
     # exceto links simbólicos e aliases que podem ser usados para apontar para
     # outras localizações no sistema de arquivos.
     DocumentRoot /var/www
     
     #
     # UserDir: O nome do diretório que será adicionado ao diretório home do usuário
     # caso uma requisição ~usuário for recebida.
     #
     &lt;IfModule mod_userdir.c&gt;
         # Linha abaixo por recomendação de segurança do manual do Apache
         UserDir disabled root
         UserDir public_html
     &lt;/IfModule&gt;
     
     
     #
     # DirectoryIndex: Nome do arquivo ou arquivos que serão usados como índice do 
     # diretório. Especifique mais de um arquivos separados por espaços ao invés
     # de um só um nome (como &quot;index&quot;) para aumentar a performance do servidor. 
     #
     &lt;IfModule mod_dir.c&gt;
         DirectoryIndex index.html index.htm index.shtml index.cgi
     &lt;/IfModule&gt;
     
     #
     # Diretivas que controlam a exibição de listagem de diretórios geradas pelo servidor.
     #
     
     &lt;IfModule mod_autoindex.c&gt;
     
         #
         # FancyIndexing: se você deseja o padrão fancy index ou padrão para a indexação
         #                de arquivos no diretório. Usando FancyIndexing o servidor
         #                apache gerará uma listagem de arquivos que poderá ser 
         #                ordenada, usar tipos de ícones e encoding, etc. Veja as 
         #                próximas opções
         IndexOptions FancyIndexing
     
         #
         # As diretivas AddIcon* dizem ao servidor que ícone mostrar para um determinado
         # arquivo ou extensão de arquivos. Estes somente são mostrados para os 
         # diretórios classificados através da opção FancyIndexing.
         #
         AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip
     
         AddIconByType (TXT,/icons/text.gif) text/*
         AddIconByType (IMG,/icons/image2.gif) image/*
         AddIconByType (SND,/icons/sound2.gif) audio/*
         AddIconByType (VID,/icons/movie.gif) video/*
     
         AddIcon /icons/binary.gif .bin .exe
         AddIcon /icons/binhex.gif .hqx
         AddIcon /icons/tar.gif .tar
         AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
         AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
         AddIcon /icons/a.gif .ps .ai .eps
         AddIcon /icons/layout.gif .html .shtml .htm .pdf
         AddIcon /icons/text.gif .txt
         AddIcon /icons/c.gif .c
         AddIcon /icons/p.gif .pl .py
         AddIcon /icons/f.gif .for
         AddIcon /icons/dvi.gif .dvi
         AddIcon /icons/uuencoded.gif .uu
         AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
         AddIcon /icons/tex.gif .tex
         AddIcon /icons/bomb.gif */core
         AddIcon /icons/deb.gif .deb Debian
     
         AddIcon /icons/back.gif ..
         AddIcon /icons/hand.right.gif README
         AddIcon /icons/folder.gif ^^DIRECTORY^^
         AddIcon /icons/blank.gif ^^BLANKICON^^
     
         # DefaultIcon é o ícone que será mostrado para aplicativos que não tiverem um 
         # ícone explicitamente definido.
     
         DefaultIcon /icons/unknown.gif
     
         #
         # AddDescription: isto lhe permite colocar uma curta descrição após um arquivo
         # nos índices gerados pelo servidor. Estes somente são mostrados para diretórios
         # com índices organizados usando a opção FancyIndexing.
         # Formato: AddDescription &quot;descrição&quot; extensão
         #
         #AddDescription &quot;GZIP compressed document&quot; .gz
         #AddDescription &quot;tar archive&quot; .tar
         #AddDescription &quot;GZIP compressed tar archive&quot; .tgz
     
     
         # ReadmeName é o nome do arquivo LEIAME que o servidor procurará como 
         # padrão. Estes serão inseridos no fim da listagem de diretórios.
         Formato: ReadmeName nome
         #
         # O servidor procurará primeiro por nome.html, incluído se ele for encontrado,
         # e então procurará pelo nome e incluirá ele como texto plano se encontrado..
     
         ReadmeName README
         
         # HeaderName é o nome do arquivo que deve ser colocado no topo do índice
         # de diretórios. As regras de procura de nome são as mesmas do arquivo
         # README
         HeaderName HEADER
     
         #
         # IndexIgnore: um conjunto de nomes de arquivos que a listagem de diretórios
         # deve ignorar e não incluir na listagem. É permitido o uso de coringas 
         # como no interpretador de comandos.
         #
         IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
     
     &lt;/IfModule&gt;
     
     # AccessFileName: O nome do arquivo que será procurado em cada diretório
     # que contém detalhes sobre as permissões de acesso a um determinado 
     # diretório e opções de listagem. Tenha cuidado ao modificar o nome 
     # deste arquivo, muitas definições que trabalham em cima do nome
     # .htaccess nos arquivos de configuração deverão ser modificados para
     # não comprometer a segurança de seu servidor. 
     # Uma falta de atenção neste ponto poderá deixar este arquivo visível
     # em qualquer listagem de diretórios facilmente...
     
     AccessFileName .htaccess
     
     # TypesConfig especifica o arquivo de configuração que contém os tipos
     # usados pelo servidor
     TypesConfig /etc/mime.types
     
     #
     # DefaultType é o tipo MIME padrão que o servidor utilizará para um documento
     # caso ele não possa determinar seu conteúdo, como através de extensões 
     # de arquivos. Se o servidor contém em sua maioria texto ou documentos em HTML,
     # &quot;text/plain&quot; é um bom valor. Caso a maioria do conteúdo seja binários, tal
     # como aplicativos ou fotos, o tipo mais adequado ao seu caso poderá ser 
     # &quot;application/octet-stream&quot; para evitar que navegadores tentem exibir
     # aplicativos binários como se fossem texto.
     # Se desejar uma referência rápida sobre tipos mime, consulte o arquivo
     # /etc/mime.types
     #
     DefaultType text/plain
     
     #
     # Document types.
     #
     &lt;IfModule mod_mime.c&gt;
     
         # AddEncoding permite que alguns navegadores (Mosaic/X 2.1+, Netscape, etc)
         # descompactem dados durante sua abertura. N
         # Nota: Nem todos os navegadores suportam isto. Esqueça os nomes parecidos,
         # as seguintes diretivas Add* não tem nada a ver com personalizações
         # da opção FancyIndexing usada nas diretivas acima.
     
         AddEncoding x-compress Z
         AddEncoding x-gzip gz tgz
     
         #
         # AddLanguage: permite especificar o idioma do documento. Você pode
         # então usar a negociação de conteúdo para dar ao navegador um 
         # arquivo no idioma solicitado.
         #
         # Nota 1: O sufixo não precisa ser o mesmo da palavra chave do 
         # idioma --- estes com o documento em Polonês (no qual o 
         # código padrão da rede é pl) pode desejar usar &quot;AddLanguage pl .po&quot; 
         # para evitar confusão de nomes com a extensão comum de scripts
         # scripts em linguagem Perl.
         #
         # Nota 2: As entradas de exemplos abaixo mostram que em alguns casos
         # as duas letras de abreviação do 'Idioma' não é idêntico as duas letras
         # do 'País' para seu país, como 'Danmark/dk' versus 'Danish/da'.
         #
         # Nota 3: No caso de 'ltz' nós violamos a RFC usando uma especificação de 
         # três caracteres. Mas existe um 'trabalho em progresso' para corrigir isto
         # e obter os dados de referência para limpar a RFC1766.
         #
         # Danish (da) - Dutch (nl) - English (en) - Estonian (ee)
         # French (fr) - German (de) - Greek-Modern (el)
         # Italian (it) - Portugese (pt) - Luxembourgeois* (ltz)
         # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
         # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
         #
         AddLanguage da .dk
         AddLanguage nl .nl
         AddLanguage en .en
         AddLanguage et .ee
         AddLanguage fr .fr
         AddLanguage de .de
         AddLanguage el .el
         AddLanguage it .it
         AddLanguage ja .ja
     #    AddCharset ISO-2022-JP .jis
         AddLanguage pl .po
     #    AddCharset ISO-8859-2 .iso-pl
         AddLanguage pt .pt
         AddLanguage pt-br .pt-br
         AddLanguage ltz .lu
         AddLanguage ca .ca
         AddLanguage es .es
         AddLanguage sv .se
         AddLanguage cz .cz
     
         # LanguagePriority: permite definir a prioridade para a exibição de 
         # documentos caso nenhum documento confira durante a negociação de 
         # conteúdo.
         #
         # Para fazer isto, especifique os idiomas em ordem de preferência de exibição
         # de idiomas. 
         #
         &lt;IfModule mod_negotiation.c&gt;
             LanguagePriority pt-br pt es en da nl et fr de el it ja pl ltz ca sv
         &lt;/IfModule&gt;
     
         #
         # AddType permite modificar o mime.types sem editar o arquivo, ou fazer 
         # a associação de arquivos a certos tipos de conteúdo.
         #
         # Por exemplo, o módulo PHP 3.x (que não faz parte da distribuição do 
         # Apache - veja http://www.php.net) tipicamente utiliza isto:
         #
         #AddType application/x-httpd-php3 .php3
         #AddType application/x-httpd-php3-source .phps
         #
         # E para arquivos PHP 4.x use:
         #
         #AddType application/x-httpd-php .php
         #AddType application/x-httpd-php-source .phps
     
         AddType application/x-tar .tgz
         AddType image/bmp .bmp
     
         # hdml
         AddType text/x-hdml .hdml
     
         #
         # AddHandler permite mapear certas extensões de arquivos a programas
         # &quot;manipuladores&quot; adequados a seu conteúdo. Estes podem ser construídos
         # no servidor ou adicionados com o comando Action (veja abaixo).
         #
         # Se desejar usar includes no lado do servidor, ou servir diretórios
         # com scripts CGI para fora, descomente as seguintes linhas.
         #
         # Para usar scripts CGI:
         #
         #AddHandler cgi-script .cgi .sh .pl
     
         #
         # Para usar arquivos html gerados através do servidor
         #
         #AddType text/html .shtml
         #AddHandler server-parsed .shtml
     
         #
         # Descomente as seguintes linhas para ativar a características de arquivos
         # send-asis HTTP do servidor Apache
         #
         #AddHandler send-as-is asis
     
         #
         # Se desejar usar arquivos de mapas de imagens processadas no servidor, use
         #
         #AddHandler imap-file map
     
         #
         # Para ativar tipo de mapas, você poderá usar
         #
         #AddHandler type-map var
     
     &lt;/IfModule&gt;
     # Fim dos tipos de documentos
     
     # Preferências padrões de exibição de caracteres (veja http://www.apache.org/info/css-security/).
     
     AddDefaultCharset on
     AddDefaultCharsetName iso-8859-1
     
     # Redirect permite dizer aos clientes que documentos não existem mais no seu servidor 
     # e a nova localização do documento. 
     # Format: Redirect nomeurl url
     # &quot;nomeurl&quot; é o caminho especificado na url e &quot;url&quot; é a nova localização do 
     # documento
     
     # Aliases: Inclua aqui quantos apelidos você desejar (sem limite) o formato é:
     # Alias nomeurl nomereal
     # &quot;nomeurl&quot; é o caminho especificado na url e &quot;nomereal&quot; é a localização
     # do documento no sistema de arquivos local
     
     # Note que se você incluir uma / no fim de &quot;nomeurl&quot;, então o servidor 
     # requisitará que também esteja presente na URL. 
     
     Alias /icons/ /usr/share/apache/icons/
     Alias /doc/ /usr/doc/
     Alias /focalinux /var/www/focalinux
     Alias /debian-br /var/www/debian-br/htdocs
     Alias /debian /pub/mirror/debian
     
     # ScriptAlias: Esta diretiva controla que diretórios contém scripts do servidor.
     # Format: ScriptAlias fakename realname
     
     ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
     
     #
     # Action: permite definir os tipos de mídia que executarão um script quando um 
     # arquivo que conferir for chamado. Isto elimina a necessidade de caminhos de URLs
     # repetidas para processadores de arquivos CGI freqüentemente usados.
     # Format: Action media/type /cgi-script/location
     # Format: Action handler-name /cgi-script/location
     #
     
     #
     # MetaDir: especifica o nome do diretório no qual o apache procurará arquivos de 
     # detalhes do módulo mod_cern_meta. Os módulos meta contém cabeçalhos HTTP
     # adicionais que serão incluídos durante o envio do documento. 
     #
     #MetaDir .web
     
     #
     # Resposta de erros personalizada (no estilo do Apache)
     # estas podem ser 3 tipos:
     #
     #    1) texto plano
     #ErrorDocument 500 &quot;O servidor fez boo boo.
     #  n.b.  a aspa (&quot;) marca como texto, ela não será exibida
     #
     #    2) redirecionamentos locais
     #ErrorDocument 404 /missing.html
     #  para redirecionar para a URL local /missing.html
     #ErrorDocument 404 /cgi-bin/missing_handler.pl
     #  N.B.: É também possível redirecionar a um script o documento usando includes
     #  do lado do servidor (server-side-includes).
     #
     #    3) redirecionamentos externos
     #ErrorDocument 402 http://algum.outro_servidor.com/inscricao.html
     #  N.B.: Muitas das variáveis de ambientes associada com a requisição atual *não*
     # estarão disponíveis para tal script.
     
     #
     # O módulo mod_mime_magic permite o servidor usar várias dicas através do conteúdo
     # do arquivo para determinar o seu tipo. A diretiva MIMEMagicFile diz ao módulo
     # onde as definições de dicas estão localizadas. O módulo mod_mime_magic não é 
     # parte do servidor padrão Apache (você precisará adiciona-lo manualmente com 
     # uma linha LoadModule (veja o parágrafo DSO na seção Ambiente Global no 
     # arquivo httpd.conf), ou recompile o servidor e inclua mod_mime_magic como
     # parte de sua configuração), por este motivo ele está entre as condicionais
     # &lt;IfModule&gt;. Isto significa que a diretiva MIMEMagicFile somente será processada
     # caso o módulo estiver ativo no servidor. 
     #
     &lt;IfModule mod_mime_magic.c&gt;
         MIMEMagicFile conf/magic
     &lt;/IfModule&gt;
     
     
     &lt;IfModule mod_setenvif.c&gt;
         #
         # As seguintes diretivas modificam o funcionamento da resposta normal do 
         # servidor HTTP.
         # A primeira diretiva desativa o keepalive para o Netscape 2.x e navegadores que
         # as falsificam. Existem problemas conhecidos com estas implementações de 
         # navegadores. A segunda diretiva é para o MS IE 4.0b2 que tem uma implementação
         # defeituosa do HTTP/1.1 e não suporta adequadamente o keepalive quando ele
         # utiliza as respostas de redirecionamento 301 e 302.
         #
         BrowserMatch &quot;Mozilla/2&quot; nokeepalive
         BrowserMatch &quot;MSIE 4\.0b2;&quot; nokeepalive downgrade-1.0 force-response-1.0
     
         #
         # As seguintes diretivas desativam as respostas HTTP/1.1 para navegadores que
         # violam a especificação HTTP/1.0 não sendo capaz de enviar uma resposta 
         # 1.1 básica.
         #
         BrowserMatch &quot;RealPlayer 4\.0&quot; force-response-1.0
         BrowserMatch &quot;Java/1\.0&quot; force-response-1.0
         BrowserMatch &quot;JDK/1\.0&quot; force-response-1.0
     &lt;/IfModule&gt;
     
     # Se o módulo Perl está instalado, isto será ativado.
     &lt;IfModule mod_perl.c&gt;
       Alias /perl/ /var/www/perl/
       &lt;Location /perl&gt;
         Options +ExecCGI
         SetHandler perl-script
         PerlHandler Apache::Registry
       &lt;/Location&gt;
     &lt;/IfModule&gt;
</pre>

<hr>

<a name="s-s-apache-exemplo-access"></a>
<h3>12.14.3 access.conf</h3>

<pre>
     # access.conf: Configuração de acesso Global
     # Documentos on-line em http://www.apache.org/
     
     # Este arquivo define as configurações do servidor que afetam que tipos de 
     # serviços são permitidos e em quais circunstâncias. 
     
     # Cada diretório que o Apache possui acesso, pode ser configurado respectivamente
     # com quais serviços e características que podem ser permitidas e/ou bloqueadas 
     # no diretório (e seus subdiretórios).
     #
     # Primeiro a configuração restringe uma série de permissões
     &lt;Directory /&gt;
         Options SymLinksIfOwnerMatch
         AllowOverride None
     #    Order deny,allow
     #    Deny from all
     &lt;/Directory&gt;
     
     # Desse ponto em diante, é necessário especificar o que será permitido
     # caso contrário será bloqueado pelo bloco acima
     
     # Esta parte deve ser modificada para a localização do documento raíz do servidor.
     
     &lt;Directory /var/www&gt;
     
     # A opção Options pode conter os valores &quot;None&quot;, &quot;All&quot;, ou quaisquer combinação
     # de &quot;Indexes&quot;, &quot;Includes&quot;, &quot;FollowSymLinks&quot;, &quot;ExecCGI&quot;, ou &quot;MultiViews&quot;.
     #
     # Note que &quot;MultiViews&quot; deve ser *explicitamente* especificada --- &quot;Options All&quot;
     # não a ativa (pelo menos não ainda).
     
     Options Indexes FollowSymLinks Includes MultiViews
     
     # Esta opção controla que opções os arquivos .htaccess nos diretórios podem ser
     # substituídas. Pode também conter &quot;All&quot;, ou qualquer combinação de &quot;Options&quot;, 
     # &quot;FileInfo&quot;, &quot;AuthConfig&quot;, e &quot;Limit&quot;
     
     AllowOverride None
     
     # Controla quem pode obter materiais deste servidor. Leia a seção adequada no
     # guia para mais explicações sobre a ordem de acesso, padrões e valores permitidos.
     
     order allow,deny
     allow from all
     
     &lt;/Directory&gt;
     
     #
     # O diretório &quot;/usr/lib/cgi-bin&quot; deve ser modificado para o diretório que 
     # possuem seus scripts CGI, caso tenha configurado o suporte a CGI's no 
     # servidor. 
     #
     &lt;Directory /usr/lib/cgi-bin/&gt;
         AllowOverride None
         Options ExecCGI
         Order allow,deny
         Allow from all
     &lt;/Directory&gt;
     
     #
     # Permite ver relatórios de status e funcionamento do servidor web e 
     # processos filhos, através da URL http://servidor/server-status
     # isto requer o módulo status_module (mod_status.c) carregado no arquivo 
     # httpd.conf
     #
     #&lt;Location /server-status&gt;
     #    SetHandler server-status
     #    Order deny,allow
     #    Deny from all
     #    Allow from .meudominio.org
     #&lt;/Location&gt;
     
     #
     # Permite relatório de configuração remota do servidor, através da URL 
     # http://servername/server-info 
     # Isto requer o módulo info_module (mod_info.c) carregado no arquivo 
     # httpd.conf
     #
     #&lt;Location /server-info&gt;
     #    SetHandler server-info
     #    Order deny,allow
     #    Deny from all
     #    Allow from .meudominio.org
     #&lt;/Location&gt;
     
     # Visualização do diretório de ícones
     &lt;Directory /usr/share/apache/icons&gt;
         Options Indexes MultiViews
         AllowOverride None
         Order allow,deny
         Allow from all
     &lt;/Directory&gt;
     
     
     # O Debian Policy assume que /usr/doc é &quot;/doc/&quot; e linkado com /usr/share/doc, 
     # pelo menos para localhost.
     
     &lt;Directory /usr/doc&gt;
        Options Indexes FollowSymLinks 
        order deny,allow
        deny from all
        allow from 192.168.1.10/24
     &lt;/Directory&gt;
     
     # Esta define a localização visualizável do monitor de status mod_throttle
     #
     &lt;location /throttle-info&gt;
        SetHandler throttle-info
     &lt;/location&gt;
     
     #
     # As seguintes linhas previnem os arquivos .htaccess de serem mostrados nos
     # clientes Web. Pois os arquivos .htaccess freqüentemente contém detalhes
     # de autorização, o acesso é desabilitado por razões de segurança. Comente
     # estas linhas se desejar que seus visitantes vejam o conteúdo dos arquivos
     # .htaccess. Se modificar a diretiva AccessFileName acima, tenha certeza de 
     # fazer as modificações correspondentes aqui.
     #
     # As pessoas também tendem a usar nomes como .htpasswd nos arquivos de senhas
     # a diretiva abaixo os protegerá também.
     #
     &lt;Files ~ &quot;^\.ht&quot;&gt;
         Order allow,deny
         Deny from all
     &lt;/Files&gt;
     
     #
     # Controla o acesso a diretórios UserDir. As seguintes diretivas são um exemplo
     # para um site onde estes diretórios estão restritos a somente-leitura. Veja
     # detalhes sobre as opções de acesso, e limites na seção sobre controle
     # de acesso do guia
     #
     &lt;Directory /home/*/public_html&gt;
         AllowOverride FileInfo AuthConfig Limit
         Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
         &lt;Limit GET POST OPTIONS PROPFIND&gt;
             Order allow,deny
             Allow from all
         &lt;/Limit&gt;
         &lt;Limit PUT DELETE PATCH PROPPATCH MKCOL COPY MOVE LOCK UNLOCK&gt;
             Order deny,allow
             Deny from all
         &lt;/Limit&gt;
     &lt;/Directory&gt;
     
     #
     # As vezes ocorrem relatos de pessoas tentando abusar de uma falha antiga nos 
     # dias do Apache 1.1 (muitas páginas na Net documentam isso). Esta falha envolve
     # um script CGI distribuído como parte do Apache. Descomentando estas linhas você
     # poderá redirecionar estes ataques a um script de registro em phf.apache.org. Ou
     # poderá gravar em sua própria máquina, usando o script support/phf_abuse_log.cgi.
     #
     #&lt;Location /cgi-bin/phf*&gt;
     #    Deny from all
     #    ErrorDocument 403 http://phf.apache.org/phf_abuse_log.cgi
     #&lt;/Location&gt;
     
     
     # Acesso aos serviços proxy do apache
     #&lt;Directory proxy:*&gt;
     #    Order deny,allow
     #    Deny from all
     #    Allow from .your_domain.com
     #&lt;/Directory&gt;
     
     # a seguinte diretiva permite o acesso a todos os usuários ao conteúdo da página
     # do guia Foca GNU/Linux exceto os que possuem navegadores MSIE ;-)
     # Veja a seção sobre restrições de acesso para detalhes sobre a diretiva de 
     # controle de acesso baseado no user-agent
     SetEnvIf User-Agent MSIE EXPLODER
     &lt;Directory /var/www/focalinux&gt;
      Options Indexes
      Order allow,deny
      allow from all
      deny from env=EXPLODER
      ErrorDocument 403 &quot;Explorer não entra, página com o conteúdo potencialmente perigoso ao Windows, use um navegador seguro para ter acesso a esta página ;-)
     &lt;/Directory&gt;
     
     # A diretiva abaixo somente permite acesso a leitura do arquivo
     # h-supor-fonte.txt a pessoas que fornecerem o nome/senha corretos
     # que constam no arquivo passwd1
     # Este bloco contém um erro que é a localização do arquivo da senha em um
     # diretório público, você deverá adapta-lo se não quiser se ver em apuros.
     #
     # A permissão do diretório de nível superior prevalece sobre seus 
     # sub-diretórios no caso as permissões de /focalinux, a menos que 
     # sejam definidas opções de acesso específicas ao arquivo abaixo
     &lt;Location /focalinux/humor/h-supor-fonte.txt&gt;
      AuthName &quot;Piada de fonte de alimentação&quot;
      AuthType basic
      AuthUserFile /home/gleydson/public_html/passwd1
      Require valid-user
     # Satisfy all
     &lt;/Location&gt;
     
     # Libera o acesso a localização /debian (acessada através de /pub/mirror/debian, 
     # definida no Alias acima)
     &lt;Location /debian&gt;
      Options Indexes
      Order deny,allow
      allow from all
      deny from all
     &lt;/Location&gt;
</pre>

<hr>

<a name="s-s-apache-httpcodes"></a>
<h2>12.15 Códigos HTTP</h2>

<p>
Esta seção pode ser uma interessante referência para a programação e
configuração da diretiva <em>ErrorDocument</em>, etc.
<dl>
<dt>2xx - Sucesso</dt>
<dd>
<ul>
<li>
<samp>200</samp> OK
</li>
<li>
<samp>201</samp> Criado
</li>
<li>
<samp>202</samp> Aceito
</li>
<li>
<samp>203</samp> Informação não-autoritativa *
</li>
<li>
<samp>204</samp> Nenhum conteúdo
</li>
<li>
<samp>205</samp> Conteúdo resetado *
</li>
<li>
<samp>206</samp> Conteúdo parcial *
</li>
</ul>
</dd>
<dt>3xx - Redirecionamento</dt>
<dd>
<ul>
<li>
<samp>300</samp> Múltiplas escolhas
</li>
<li>
<samp>301</samp> Movido Permanentemente
</li>
<li>
<samp>302</samp> Movido Temporariamente
</li>
<li>
<samp>303</samp> Veja outra *
</li>
<li>
<samp>304</samp> Não modificada
</li>
<li>
<samp>305</samp> Use o Proxy (redirecionamento proxy) *
</li>
</ul>
</dd>
<dt>4xx - Erros no Cliente</dt>
<dd>
<ul>
<li>
<samp>400</samp> Requisição incorreta
</li>
<li>
<samp>401</samp> Não autorizado
</li>
<li>
<samp>402</samp> Pagamento Requerido *
</li>
<li>
<samp>403</samp> Bloqueado
</li>
<li>
<samp>404</samp> Não encontrada
</li>
<li>
<samp>405</samp> Método não permitido *
</li>
<li>
<samp>406</samp> Não aceitável *
</li>
<li>
<samp>407</samp> Autenticação via proxy requerida *
</li>
<li>
<samp>408</samp> Tempo limite da requisição expirado *
</li>
<li>
<samp>409</samp> Conflito *
</li>
<li>
<samp>410</samp> Gone *
</li>
<li>
<samp>411</samp> Tamanho requerido *
</li>
<li>
<samp>412</samp> Falha na pré-condição *
</li>
<li>
<samp>413</samp> A requisição parece ser grande *
</li>
<li>
<samp>414</samp> A URL requisitada é muito longa *
</li>
<li>
<samp>415</samp> Tipo de mídia não suportado
</li>
</ul>
</dd>
<dt>5xx - Erros no Servidor</dt>
<dd>
<ul>
<li>
<samp>500</samp> Erro Interno no Servidor
</li>
<li>
<samp>501</samp> Não implementado
</li>
<li>
<samp>502</samp> Gateway incorreto
</li>
<li>
<samp>503</samp> Serviço não disponível
</li>
<li>
<samp>504</samp> Tempo limite no gateway *
</li>
<li>
<samp>505</samp> Versão HTTP não suportada *
</li>
</ul>
</dd>
</dl>

<p>
Os códigos de erros marcados com um &quot;*&quot; pertencem ao padrão HTTP 1.1

<hr>

[ <a href="ch-d-contas.html">anterior</a> ]
[ <a href="index.html#contents">Conteúdo</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-bas.html">2</a> ]
[ <a href="ch-hardw.html">3</a> ]
[ <a href="ch-rede.html">4</a> ]
[ <a href="ch-cfgrede.html">5</a> ]
[ <a href="ch-log.html">6</a> ]
[ <a href="ch-deb.html">7</a> ]
[ <a href="ch-pers.html">8</a> ]
[ <a href="ch-impr.html">9</a> ]
[ <a href="ch-fw-iptables.html">10</a> ]
[ <a href="ch-d-contas.html">11</a> ]
[ 12 ]
[ <a href="ch-s-ident.html">13</a> ]
[ <a href="ch-s-telnet.html">14</a> ]
[ <a href="ch-s-ssh.html">15</a> ]
[ <a href="ch-s-pop3.html">16</a> ]
[ <a href="ch-s-cvs.html">17</a> ]
[ <a href="ch-s-samba.html">18</a> ]
[ <a href="ch-d-restr.html">19</a> ]
[ <a href="ch-d-cripto.html">20</a> ]
[ <a href="ch-apend.html">21</a> ]
[ <a href="ch-s-ident.html">próximo</a> ]

<hr>

<p>
Guia Foca GNU/Linux

<address>
Versão 6.40 - segunda, 30 de outubro de 2006<br>
<br>
Gleydson Mazioli da Silva <code><a href="mailto:gleydson@guiafoca.org">gleydson@guiafoca.org</a></code><br>
<br>
</address>

<hr>

</body>

</html>

